(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{0:function(e,t,n){e.exports=n("zUnb")},"5nFl":function(e,t,n){"use strict";e.exports=function(){function e(e,t,n){return e(n={path:t,exports:{},require:function(e,t){throw Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}},n.exports),n.exports}function t(e,t,n){return(e=e.match(t))&&e.length>=n&&Zs(e[n],10)}function n(e,t,n){if(e.RTCPeerConnection){var r=(e=e.RTCPeerConnection.prototype).addEventListener;e.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);let s=e=>{(e=n(e))&&i(e)};return this._eventMap=this._eventMap||{},this._eventMap[i]=s,r.apply(this,[e,s])};var i=e.removeEventListener;e.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n])return i.apply(this,arguments);let r=this._eventMap[n];return delete this._eventMap[n],i.apply(this,[e,r])},Ks(e,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function r(e){return"boolean"!=typeof e?Error("Argument type: "+typeof e+". Please use a boolean."):(eo=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function i(e){return"boolean"!=typeof e?Error("Argument type: "+typeof e+". Please use a boolean."):(to=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function s(){"object"!=typeof window||eo||"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}function o(e,t){to&&console.warn(e+" is deprecated, please use "+t+" instead.")}function a(e){let{navigator:n}=e,r={browser:null,version:null};if(void 0===e||!e.navigator)return r.browser="Not a browser.",r;if(n.mozGetUserMedia)r.browser="firefox",r.version=t(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)r.browser="chrome",r.version=t(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.mediaDevices&&n.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=t(n.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=t(n.userAgent,/AppleWebKit\/(\d+)\./,1),r.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return r}function c(e){var t;return"[object Object]"===Object.prototype.toString.call(e)?Hs(t=Vs(e)).call(t,function(t,n){var r="[object Object]"===Object.prototype.toString.call(e[n]);let i=r?c(e[n]):e[n];return r=r&&!Vs(i).length,void 0===i||r?t:Us(t,{[n]:i})},{}):e}function l(e,t,n){let r=n?"outbound-rtp":"inbound-rtp",i=new _s;if(null===t)return i;let s=[];return Ds(e).call(e,e=>{"track"===e.type&&e.trackIdentifier===t.id&&s.push(e)}),Ds(s).call(s,t=>{Ds(e).call(e,n=>{n.type===r&&n.trackId===t.id&&function e(t,n,r){var i;n&&!r.has(n.id)&&(r.set(n.id,n),Ds(i=Vs(n)).call(i,i=>{if(As(i).call(i,"Id"))e(t,t.get(n[i]),r);else if(As(i).call(i,"Ids")){var s;Ds(s=n[i]).call(s,n=>{e(t,t.get(n),r)})}}))}(e,n,i)})}),i}function u(e){let t=e&&e.navigator;if(t.mediaDevices){var n=a(e),r=function(e){var t;if("object"!=typeof e||e.mandatory||e.optional)return e;const n={};var r;return Ds(t=Vs(e)).call(t,t=>{if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var r="object"==typeof e[t]?e[t]:{ideal:e[t]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i,s=function(e,t){return e?e+t.charAt(0).toUpperCase()+cc(t).call(t,1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){n.optional=n.optional||[];let e={};"number"==typeof r.ideal?(e[s("min",t)]=r.ideal,n.optional.push(e),e={},e[s("max",t)]=r.ideal,n.optional.push(e)):(e[s("",t)]=r.ideal,n.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(n.mandatory=n.mandatory||{},n.mandatory[s("",t)]=r.exact):Ds(i=["min","max"]).call(i,e=>{void 0!==r[e]&&(n.mandatory=n.mandatory||{},n.mandatory[s(e,t)]=r[e])})}}),e.advanced&&(n.optional=To(r=n.optional||[]).call(r,e.advanced)),n},i=function(e,i){if(61<=n.version)return i(e);if((e=JSON.parse(cr(e)))&&"object"==typeof e.audio){var s=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};s((e=JSON.parse(cr(e))).audio,"autoGainControl","googAutoGainControl"),s(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;if(o=o&&("object"==typeof o?o:{ideal:o}),s=66>n.version,!(!o||"user"!==o.exact&&"environment"!==o.exact&&"user"!==o.ideal&&"environment"!==o.ideal||t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!s)){let n;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?n=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(n=["front"]),n)return t.mediaDevices.enumerateDevices().then(t=>{t=Io(t).call(t,e=>"videoinput"===e.kind);let s=hc(t).call(t,e=>Cc(n).call(n,t=>{var n;return Rc(n=e.label.toLowerCase()).call(n,t)}));return!s&&t.length&&Rc(n).call(n,"back")&&(s=t[t.length-1]),s&&(e.video.deviceId=o.exact?{exact:s.deviceId}:{ideal:s.deviceId}),e.video=r(e.video),Ac("chrome: "+cr(e)),i(e)})}e.video=r(e.video)}return Ac("chrome: "+cr(e)),i(e)},s=function(e){return 64<=n.version?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(e=function(e,n,r){i(e,e=>{t.webkitGetUserMedia(e,n,e=>{r&&r(s(e))})})},t.getUserMedia=gc(e).call(e,t),t.mediaDevices.getUserMedia){var o;let e=gc(o=t.mediaDevices.getUserMedia).call(o,t.mediaDevices);t.mediaDevices.getUserMedia=function(t){return i(t,t=>e(t).then(e=>{var n;if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw Ds(n=e.getTracks()).call(n,e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Ga.reject(s(e))))}}}}function d(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function h(e){if("object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)n(e,"track",e=>(e.transceiver||Ks(e,"transceiver",{value:{receiver:e.receiver}}),e));else{Ks(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{var n;t.stream.addEventListener("addtrack",n=>{let r;var i;r=e.RTCPeerConnection.prototype.getReceivers?hc(i=this.getReceivers()).call(i,e=>e.track&&e.track.id===n.track.id):{track:n.track},(i=new Event("track")).track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}),Ds(n=t.stream.getTracks()).call(n,n=>{let r;var i;r=e.RTCPeerConnection.prototype.getReceivers?hc(i=this.getReceivers()).call(i,e=>e.track&&e.track.id===n.id):{track:n},(i=new Event("track")).track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}}function p(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===t.kind?e.createDTMFSender(t):null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){var e;return this._senders=this._senders||[],cc(e=this._senders).call(e)};let n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};let r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t;r.apply(this,arguments);let n=nc(t=this._senders).call(t,e);var i;-1!==n&&Qa(i=this._senders).call(i,n,1)}}let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r;this._senders=this._senders||[],n.apply(this,[e]),Ds(r=e.getTracks()).call(r,e=>{this._senders.push(t(this,e))})};let r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t;this._senders=this._senders||[],r.apply(this,[e]),Ds(t=e.getTracks()).call(t,e=>{var t;let n=hc(t=this._senders).call(t,t=>t.track===e);var r,i;n&&Qa(r=this._senders).call(r,nc(i=this._senders).call(i,n),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return Ds(e).call(e,e=>e._pc=this),e},Ks(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}}function f(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,n,r]=arguments;if(0<arguments.length&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);let i=function(e){const t={};return e=e.result(),Ds(e).call(e,e=>{var n;const r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};Ds(n=e.names()).call(n,t=>{r[t]=e.stat(t)}),t[r.id]=r}),t},s=function(e){var t;return new _s(Ka(t=Vs(e)).call(t,t=>[t,e[t]]))};return 2<=arguments.length?t.apply(this,[function(e){n(s(i(e)))},e]):new Ga((e,n)=>{t.apply(this,[function(t){e(s(i(t)))},n])}).then(n,r)}}}function _(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return Ds(e).call(e,e=>e._pc=this),e});let n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){let e=this;return this._pc.getStats().then(t=>l(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return Ds(e).call(e,e=>e._pc=this),e}),n(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){let e=this;return this._pc.getStats().then(t=>l(t,e.track,!1))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(0<arguments.length&&arguments[0]instanceof e.MediaStreamTrack){var n,r;let e,t,i,s=arguments[0];return Ds(n=this.getSenders()).call(n,t=>{t.track===s&&(e?i=!0:e=t)}),Ds(r=this.getReceivers()).call(r,e=>(e.track===s&&(t?i=!0:t=e),e.track===s)),i||e&&t?Ga.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):e?e.getStats():t?t.getStats():Ga.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}}}function m(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Ka(e=Vs(this._shimmedLocalStreams)).call(e,e=>this._shimmedLocalStreams[e][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var r;if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===nc(r=this._shimmedLocalStreams[n.id]).call(r,i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t,r,i;this._shimmedLocalStreams=this._shimmedLocalStreams||{},Ds(t=e.getTracks()).call(t,e=>{var t;if(hc(t=this.getSenders()).call(t,t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});let s=this.getSenders();n.apply(this,arguments),t=Io(r=this.getSenders()).call(r,e=>-1===nc(s).call(s,e)),this._shimmedLocalStreams[e.id]=To(i=[e]).call(i,t)};let r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};let i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Ds(t=Vs(this._shimmedLocalStreams)).call(t,t=>{var n;let r=nc(n=this._shimmedLocalStreams[t]).call(n,e);var i;-1!==r&&Qa(i=this._shimmedLocalStreams[t]).call(i,r,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),i.apply(this,arguments)}}function g(e){function t(e,t){var n;let r=t.sdp;return Ds(n=Vs(e._reverseStreams||[])).call(n,t=>{t=e._reverseStreams[t],r=r.replace(new RegExp(e._streams[t.id].id,"g"),t.id)}),new RTCSessionDescription({type:t.type,sdp:r})}function n(e,t){var n;let r=t.sdp;return Ds(n=Vs(e._reverseStreams||[])).call(n,t=>{t=e._reverseStreams[t],r=r.replace(new RegExp(t.id,"g"),e._streams[t.id].id)}),new RTCSessionDescription({type:t.type,sdp:r})}var r;if(e.RTCPeerConnection){var i=a(e);if(e.RTCPeerConnection.prototype.addTrack&&65<=i.version)return m(e);var s=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let e=s.apply(this);return this._reverseStreams=this._reverseStreams||{},Ka(e).call(e,e=>this._reverseStreams[e.id])};var o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n;this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},Ds(n=t.getTracks()).call(n,e=>{var t;if(hc(t=this.getSenders()).call(t,t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),this._reverseStreams[t.id]||(n=new e.MediaStream(t.getTracks()),this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n),o.apply(this,[t])};var c=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r,i,s;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let o=cc([]).call(arguments,1);if(1!==o.length||!hc(r=o[0].getTracks()).call(r,e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(hc(i=this.getSenders()).call(i,e=>e.track===t))throw new DOMException("Track already exists.","InvalidAccessError");return this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},(r=this._streams[n.id])?(r.addTrack(t),Ga.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))})):(r=new e.MediaStream([t]),this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)),hc(s=this.getSenders()).call(s,e=>e.track===t)},Ds(r=["createOffer","createAnswer"]).call(r,function(n){let r=e.RTCPeerConnection.prototype[n];e.RTCPeerConnection.prototype[n]={[n](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[n=>{n=t(this,n),e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):r.apply(this,arguments).then(e=>t(this,e))}}[n]});var l=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=n(this,arguments[0]),l.apply(this,arguments)):l.apply(this,arguments)};var u=oo(e.RTCPeerConnection.prototype,"localDescription");Ks(e.RTCPeerConnection.prototype,"localDescription",{get(){let e=u.get.apply(this);return""===e.type?e:t(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let n;this._streams=this._streams||{},Ds(t=Vs(this._streams)).call(t,t=>{var r;hc(r=this._streams[t].getTracks()).call(r,t=>e.track===t)&&(n=this._streams[t])}),n&&(1===n.getTracks().length?this.removeStream(this._reverseStreams[n.id]):n.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}}function E(e){let t=a(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection){var n;53>t.version&&Ds(n=["setLocalDescription","setRemoteDescription","addIceCandidate"]).call(n,function(t){let n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}}[t]});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?78>t.version&&arguments[0]&&""===arguments[0].candidate?Ga.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Ga.resolve())}}}function v(e){n(e,"negotiationneeded",e=>{if("stable"===e.target.signalingState)return e})}function S(e,t,n,r,i){return t=Bc.writeRtpDescription(e.kind,t),t+=Bc.writeIceParameters(e.iceGatherer.getLocalParameters()),t+=Bc.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":i||"active"),t+="a=mid:"+e.mid+"\r\n",t+=e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender&&(e.rtpSender._initialTrackId=n=e.rtpSender._initialTrackId||e.rtpSender.track.id,t=t+"a="+(r="msid:"+(r?r.id:"-")+" "+n+"\r\n")+"a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+r,e.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+r,t+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")),t+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+Bc.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+Bc.localCName+"\r\n"),t}function T(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){return e=r(e.parameters.apt,n),t=r(t.parameters.apt,i),e&&t&&e.name.toLowerCase()===t.name.toLowerCase()};return e.codecs.forEach(function(r){for(var s=0;s<t.codecs.length;s++){var o=t.codecs[s];if(r.name.toLowerCase()===o.name.toLowerCase()&&r.clockRate===o.clockRate&&("rtx"!==r.name.toLowerCase()||!r.parameters||!o.parameters.apt||i(r,o,e.codecs,t.codecs))){(o=JSON.parse(JSON.stringify(o))).numChannels=Math.min(r.numChannels,o.numChannels),n.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n}function R(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function y(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}function I(e,t){return(t=Error(t)).name=e,t.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],t}function C(e){var t;let n=gc(t=(e=e&&e.navigator).mediaDevices.getUserMedia).call(t,e.mediaDevices);e.mediaDevices.getUserMedia=function(e){return n(e).catch(e=>Ga.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString(){return this.name}}}(e)))}}function A(e){var t;"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=gc(t=e.navigator.getDisplayMedia).call(t,e.navigator)))}function w(e){let t=a(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),15025>t.version)){let t=oo(e.MediaStreamTrack.prototype,"enabled");Ks(e.MediaStreamTrack.prototype,"enabled",{set(e){t.set.call(this,e);let n=new Event("enabled");n.enabled=e,this.dispatchEvent(n)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Ks(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);let n=jc(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=function(e,t){let n=!1;return e=JSON.parse(cr(e)),Io(e).call(e,e=>{if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&o("RTCIceServer.url","RTCIceServer.urls");let r="string"==typeof t;return r&&(t=[t]),t=Io(t).call(t,e=>0!==nc(e).call(e,"stun:")&&((e=Pc(e).call(e,"turn")&&!Pc(e).call(e,"turn:[")&&Rc(e).call(e,"transport=udp"))&&!n?(n=!0,!0):e&&!n)),delete e.url,e.urls=r?t[0]:t,!!t.length}})}(e.iceServers),s("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype}function b(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}function O(e){let t=a(e),n=e&&e.navigator;if(e=e&&e.MediaStreamTrack,n.getUserMedia=function(e,t,r){o("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(55<t.version&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var r;let t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},i=gc(r=n.mediaDevices.getUserMedia).call(r,n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(cr(e)),t(e.audio,"autoGainControl","mozAutoGainControl"),t(e.audio,"noiseSuppression","mozNoiseSuppression")),i(e)},e&&e.prototype.getSettings){let n=e.prototype.getSettings;e.prototype.getSettings=function(){let e=n.apply(this,arguments);return t(e,"mozAutoGainControl","autoGainControl"),t(e,"mozNoiseSuppression","noiseSuppression"),e}}if(e&&e.prototype.applyConstraints){let n=e.prototype.applyConstraints;e.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(cr(e)),t(e,"autoGainControl","mozAutoGainControl"),t(e,"noiseSuppression","mozNoiseSuppression")),n.apply(this,[e])}}}}function N(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Ks(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function k(e){let t=a(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){var n;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),53>t.version&&Ds(n=["setLocalDescription","setRemoteDescription","addIceCandidate"]).call(n,function(t){let n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}}[t]});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?68>t.version&&arguments[0]&&""===arguments[0].candidate?Ga.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Ga.resolve())};var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,n,r]=arguments;return s.apply(this,[e||null]).then(e=>{if(53>t.version&&!n)try{Ds(e).call(e,e=>{e.type=i[e.type]||e.type})}catch(r){if("TypeError"!==r.name)throw r;Ds(e).call(e,(t,n)=>{e.set(n,Us({},t,{type:i[t.type]||t.type}))})}return e}).then(n,r)}}}function D(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return Ds(e).call(e,e=>e._pc=this),e});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Ga.resolve(new _s)}}}function P(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return Ds(e).call(e,e=>e._pc=this),e}),n(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function L(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t;o("removeStream","removeTrack"),Ds(t=this.getSenders()).call(t,t=>{var n;t.track&&Rc(n=e.getTracks()).call(n,t.track)&&this.removeTrack(t)})})}function M(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function U(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n,r,i;this._localStreams||(this._localStreams=[]),Rc(n=this._localStreams).call(n,e)||this._localStreams.push(e),Ds(r=e.getAudioTracks()).call(r,n=>t.call(this,n,e)),Ds(i=e.getVideoTracks()).call(i,n=>t.call(this,n,e))},e.RTCPeerConnection.prototype.addTrack=function(e,n){var r;return n&&(this._localStreams?Rc(r=this._localStreams).call(r,n)||this._localStreams.push(n):this._localStreams=[n]),t.call(this,e,n)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t,n,r;this._localStreams||(this._localStreams=[]);let i=nc(t=this._localStreams).call(t,e);if(-1!==i){Qa(n=this._localStreams).call(n,i,1);var s=e.getTracks();Ds(r=this.getSenders()).call(r,e=>{Rc(s).call(s,e.track)&&this.removeTrack(e)})}})}}function x(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Ks(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{var t;Ds(t=e.streams).call(t,e=>{var t;this._remoteStreams||(this._remoteStreams=[]),Rc(t=this._remoteStreams).call(t,e)||(this._remoteStreams.push(e),(t=new Event("addstream")).stream=e,this.dispatchEvent(t))})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){var n;Ds(n=t.streams).call(n,t=>{var n;e._remoteStreams||(e._remoteStreams=[]),0<=nc(n=e._remoteStreams).call(n,t)||(e._remoteStreams.push(t),(n=new Event("addstream")).stream=t,e.dispatchEvent(n))})}),t.apply(e,arguments)}}}function V(e){if("object"==typeof e&&e.RTCPeerConnection){var t=(e=e.RTCPeerConnection.prototype).createOffer,n=e.createAnswer,r=e.setLocalDescription,i=e.setRemoteDescription,s=e.addIceCandidate;e.createOffer=function(e,n){let r=t.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);return n?(r.then(e,n),Ga.resolve()):r},e.createAnswer=function(e,t){let r=n.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);return t?(r.then(e,t),Ga.resolve()):r};var o=function(e,t,n){return e=r.apply(this,[e]),n?(e.then(t,n),Ga.resolve()):e};e.setLocalDescription=o,e.setRemoteDescription=o=function(e,t,n){return e=i.apply(this,[e]),n?(e.then(t,n),Ga.resolve()):e},e.addIceCandidate=o=function(e,t,n){return e=s.apply(this,[e]),n?(e.then(t,n),Ga.resolve()):e}}}function F(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var n;let r=gc(n=(e=t.mediaDevices).getUserMedia).call(n,e);t.mediaDevices.getUserMedia=e=>r(B(e))}var r;!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=gc(r=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}).call(r,t))}function B(e){return e&&void 0!==e.video?Us({},e,{video:c(e.video)}):e}function j(e){let t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){let t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(o("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(cr(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Ks(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function G(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Ks(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function H(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){var n,r;void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);let t=hc(n=this.getTransceivers()).call(n,e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo),n=hc(r=this.getTransceivers()).call(r,e=>"video"===e.receiver.track.kind),!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return t.apply(this,arguments)}}function W(e){if(e.RTCIceCandidate&&(!e.RTCIceCandidate||!("foundation"in e.RTCIceCandidate.prototype))){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){var n;if("object"==typeof e&&e.candidate&&0===nc(n=e.candidate).call(n,"a=")&&((e=JSON.parse(cr(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){n=new t(e),e=Bc.parseCandidate(e.candidate);let r=Us(n,e);return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,n(e,"icecandidate",t=>(t.candidate&&Ks(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}}function K(e){if(e.RTCPeerConnection){var t=a(e);"sctp"in e.RTCPeerConnection.prototype||Ks(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});var n=function(e){return!(!e||!e.sdp)&&((e=Bc.splitSections(e.sdp)).shift(),Cc(e).call(e,e=>{var t;return(e=Bc.parseMLine(e))&&"application"===e.kind&&-1!==nc(t=e.protocol).call(t,"SCTP")}))},r=function(e){return null===(e=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/))||2>e.length||(e=Zs(e[1],10))!=e?-1:e},i=function(e){let n=65536;return"firefox"===t.browser&&(n=57>t.version?-1===e?16384:2147483637:60>t.version?57===t.version?65535:65536:2147483637),n},s=function(e,n){let r=65536;return"firefox"===t.browser&&57===t.version&&(r=65535),0<(e=Bc.matchPrefix(e.sdp,"a=max-message-size:")).length?r=Zs(e[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&76<=t.version){var{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Ks(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){var a=r(arguments[0]);let t;e=i(a),a=s(arguments[0],a),t=0===e&&0===a?Number.POSITIVE_INFINITY:0===e||0===a?Math.max(e,a):Math.min(e,a),Ks(e={},"maxMessageSize",{get:()=>t}),this._sctp=e}return o.apply(this,arguments)}}}function Y(e){function t(e,t){let n=e.send;e.send=function(){var r=arguments[0];if(r=r.length||r.size||r.byteLength,"open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let e=r.apply(this,arguments);return t(e,this),e},n(e,"datachannel",e=>(t(e.channel,e.target),e))}}function q(e){var t;if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var n=e.RTCPeerConnection.prototype;Ks(n,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Ks(n,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),Ds(t=["setLocalDescription","setRemoteDescription"]).call(t,e=>{let t=n[e];n[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{let t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;let n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),t.apply(this,arguments)}})}}function z(e){if(e.RTCPeerConnection){var t=a(e);if(!("chrome"===t.browser&&71<=t.version)){var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){var t,r;return e&&e.sdp&&-1!==nc(t=e.sdp).call(t,"\na=extmap-allow-mixed")&&(e.sdp=Io(r=e.sdp.split("\n")).call(r,e=>"a=extmap-allow-mixed"!==Fc(e).call(e)).join("\n")),n.apply(this,arguments)}}}}function X(e){return"string"==typeof e?Us({},Qc[e]):e}function Q(e){return"string"==typeof e?Us({},Jc[e]):e}function J(e){return"string"==typeof e?Us({},$c[e]):e}function $(e){return"string"==typeof e?Us({},Zc[e]):e}function Z(e,t){var n;Rc(n=Vs(el)).call(n,e)&&(el[e]=t)}function ee(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function te(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function ne(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function re(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}function ie(e){return"[object Array]"===fl.call(e)}function se(e){return null!==e&&"object"==typeof e}function oe(e){return"[object Function]"===fl.call(e)}function ae(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),ie(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.call(null,e[n],n,e)}function ce(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function le(){this.handlers=[]}function ue(e,t){!_l.isUndefined(e)&&_l.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}function de(e){this.defaults=e,this.interceptors={request:new El,response:new El}}function he(e){this.message=e}function pe(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var n=this;e(function(e){n.reason||(n.reason=new kl(e),t(n.reason))})}function fe(e){e=new Nl(e);var t=pl(Nl.prototype.request,e);return _l.extend(t,Nl.prototype,e),_l.extend(t,e),t}function _e(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function me(e,t){if("boolean"!=typeof e)throw new xl(dl.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function ge(e,t,n){var r;if(!Rc(n).call(n,e))throw new xl(dl.INVALID_PARAMS,To(r="".concat(t," can only be set as ")).call(r,cr(n)))}function Ee(e,t,n=1,r=1e4,i=!0){var s,o;if(e<n||e>r||i&&("number"!=typeof e||0!=e%1))throw new xl(dl.INVALID_PARAMS,To(s=To(o="invalid ".concat(t,": the value range is [")).call(o,n,", ")).call(s,r,"]. integer only"))}function ve(e,t,n=1,r=255,i=!0){if(null==e)throw new xl(dl.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));var s,o,a;if(!ye(e,n,r,i))throw new xl(dl.INVALID_PARAMS,To(s=To(o=To(a="Invalid ".concat(t||"string param",": Length of the string: [")).call(a,n,",")).call(o,r,"].")).call(s,i?" ASCII characters only.":""))}function Se(e,t){if(!hl(e))throw new xl(dl.INVALID_PARAMS,"".concat(t," should be an array"))}function Te(e){if("string"!=typeof e||!/^[a-zA-Z0-9 !#\$%&\(\)\+\-:;<=\.>\?@\[\]\^_\{\}\|~,]{1,64}$/.test(e))throw Ul.error("Invalid Channel Name ".concat(e)),new xl(dl.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Re(e){var t;if(!("number"==typeof e&&Math.floor(e)===e&&0<=e&&4294967295>=e||ye(e,1,255)))throw Ul.error(To(t="Invalid UID ".concat(e," ")).call(t,typeof e)),new xl(dl.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]")}function ye(e,t=1,n=255,r=!0){if(t="string"==typeof e&&e.length<=n&&e.length>=t){if(!(r=!r))e:if("string"!=typeof e)r=!1;else{for(r=0;r<e.length;r+=1)if(0>(t=e.charCodeAt(r))||255<t){r=!1;break e}r=!0}t=r}return t}function Ie(e){return ve(e.reportId,"params.reportId",0,100,!1),ve(e.category,"params.category",0,100,!1),ve(e.event,"params.event",0,100,!1),ve(e.label,"params.label",0,100,!1),Ee(e.value,"params.value",-9007199254740991,9007199254740991,!1),!0}function Ce(e){return Ee(e.timeout,"config.timeout",0,1e5),Ee(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Ee(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Ee(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function Ae(e){if(!hl(e)||1>e.length)return!1;try{Ds(e).call(e,e=>{if(!e.urls)throw Error()})}catch(t){return!1}return!0}function we(e){return ve(e.turnServerURL,"turnServerURL"),ve(e.username,"username"),ve(e.password,"password"),e.udpport&&Ee(e.udpport,"udpport",1,99999,!0),e.forceturn&&me(e.forceturn,"forceturn"),e.security&&me(e.security,"security"),e.tcpport&&Ee(e.tcpport,"tcpport",1,99999,!0),!0}function be(e){return void 0!==e.level&&ge(e.level,"level",[1,2]),!0}function Oe(e,t){ve(e.url,"".concat(t,".url"),1,1e3,!1),null==e.x||Ee(e.x,"".concat(t,".x"),0,1e4),null==e.y||Ee(e.y,"".concat(t,".y"),0,1e4),null==e.width||Ee(e.width,"".concat(t,".width"),0,1e4),null==e.height||Ee(e.height,"".concat(t,".height"),0,1e4),null==e.zOrder||Ee(e.zOrder,"".concat(t,".zOrder"),0,255),null==e.alpha||Ee(e.alpha,"".concat(t,".alpha"),0,1,!1)}function Ne(e){if(!e.channelName)throw new xl(dl.INVALID_PARAMS,"invalid channelName in info");if(!e.uid||"number"!=typeof e.uid)throw new xl(dl.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&ve(e.token,"info.token",1,2047),Re(e.uid),Te(e.channelName),!0}function ke(e){return ge(e,"mediaSource",["screen","window","application"]),!0}function De(e){var t,n,r,i;let s=(e=e||navigator.userAgent).match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if("Chrome"===s[1]){var o=e.match(/(OPR(?=\/))\/?(\d+)/i);null!==o&&(s=o)}"Safari"===s[1]&&null!==(o=e.match(/version\/(\d+)/i))&&(s[2]=o[1]),-1!==nc(t=e.toLowerCase()).call(t,"qqbrowser")&&null!==(t=e.match(/(qqbrowser(?=\/))\/?(\d+)/i))&&(s=t),-1!==nc(n=e.toLowerCase()).call(n,"micromessenger")&&null!==(n=e.match(/(micromessenger(?=\/))\/?(\d+)/i))&&(s=n),-1!==nc(r=e.toLowerCase()).call(r,"edge")&&null!==(r=e.match(/(edge(?=\/))\/?(\d+)/i))&&(s=r),-1!==nc(i=e.toLowerCase()).call(i,"trident")&&null!==(i=/\brv[ :]+(\d+)/g.exec(e)||[])&&(s=["","IE",i[1]]),i=null,r=[{s:Lc.WIN_10,r:/(Windows 10.0|Windows NT 10.0)/},{s:Lc.WIN_81,r:/(Windows 8.1|Windows NT 6.3)/},{s:Lc.WIN_8,r:/(Windows 8|Windows NT 6.2)/},{s:Lc.WIN_7,r:/(Windows 7|Windows NT 6.1)/},{s:Lc.WIN_VISTA,r:/Windows NT 6.0/},{s:Lc.WIN_SERVER_2003,r:/Windows NT 5.2/},{s:Lc.WIN_XP,r:/(Windows NT 5.1|Windows XP)/},{s:Lc.WIN_2000,r:/(Windows NT 5.0|Windows 2000)/},{s:Lc.ANDROID,r:/Android/},{s:Lc.OPEN_BSD,r:/OpenBSD/},{s:Lc.SUN_OS,r:/SunOS/},{s:Lc.LINUX,r:/(Linux|X11)/},{s:Lc.IOS,r:/(iPhone|iPad|iPod)/},{s:Lc.MAC_OS_X,r:/Mac OS X/},{s:Lc.MAC_OS,r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:Lc.QNX,r:/QNX/},{s:Lc.UNIX,r:/UNIX/},{s:Lc.BEOS,r:/BeOS/},{s:Lc.OS_2,r:/OS\/2/},{s:Lc.SEARCH_BOT,r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(let a in r)if((n=r[a]).r.test(e)){i=n.s;break}return{name:s[1],version:s[2],os:i}}function Pe(){return De().name===Mc.CHROME}function Le(){return De().name===Mc.FIREFOX}function Me(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&35>=window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]}function Ue(){let e=De();return e.name!==Mc.EDGE&&e.name!==Mc.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function xe(e,t){var n=Vs(e);if(vd){var r=vd(e);t&&(r=Io(r).call(r,function(t){return oo(e,t).enumerable})),n.push.apply(n,r)}return n}function Ve(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Ds(n=xe(Object(r),!0)).call(n,function(t){Sd(e,t,r[t])});else if(Vu)Lu(e,Vu(r));else{var i;Ds(i=xe(Object(r))).call(i,function(t){Ks(e,t,oo(r,t))})}}return e}function Fe(e){if(!e.address||!e.tcp)throw new xl(dl.UNEXPECTED_RESPONSE,"Invalid address format ".concat(e));return e.address.match(/^[\.:\d]+$/)?"".concat(e.address.replace(/[^\d]/g,"-"),".edge.agora.io"):(Ul.info("Cannot recognized as IP address ".concat(e.address,". Used As Host instead")),To(t="".concat(e.address,":")).call(t,e.tcp));var t}function Be(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function je(e,t){let n=e.videoSend[0];return n?(t=t&&t.videoSend[0]?t.videoSend[0].inputFrame:void 0,e={id:Xe(10,""),timestamp:new Date(e.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:n.ssrc.toString()},n.inputFrame&&(t&&n.inputFrame.height===t.height||(e.A_fhi=n.inputFrame.height?n.inputFrame.height.toString():"0"),t&&n.inputFrame.width===t.width||(e.A_fwi=n.inputFrame.width?n.inputFrame.width.toString():"0"),t&&n.inputFrame.frameRate===t.frameRate||(e.A_fri=n.inputFrame.frameRate?n.inputFrame.frameRate.toString():"0")),e):null}function Ge(e){return 0<=e&&.17>e?1:.17<=e&&.36>e?2:.36<=e&&.59>e?3:.59<=e&&1>=e?4:1<e?5:0}function He(e,t){let n={};return e.height&&e.width&&(t=t._videoHeight||t.getMediaStreamTrack(!0).getSettings().height,n.scaleResolutionDownBy=t?t/Be(e.height):4),n.maxFramerate=e.framerate?Be(e.framerate):void 0,n.maxBitrate=e.bitrate?1e3*e.bitrate:void 0,n}function We(e,t){var n=Vs(e);if(vd){var r=vd(e);t&&(r=Io(r).call(r,function(t){return oo(e,t).enumerable})),n.push.apply(n,r)}return n}function Ke(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Ds(n=We(Object(r),!0)).call(n,function(t){Sd(e,t,r[t])});else if(Vu)Lu(e,Vu(r));else{var i;Ds(i=We(Object(r))).call(i,function(t){Ks(e,t,oo(r,t))})}}return e}function Ye(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function qe(e){return new Ga(t=>{window.setTimeout(t,e)})}function ze(e){let t=new xl(dl.TIMEOUT,"timeout");return new Ga((n,r)=>{window.setTimeout(()=>r(t),e)})}function Xe(e=7,t){var n,r;let i=Math.random().toString(16).substr(2,e).toLowerCase();return i.length===e?To(n="".concat(t)).call(n,i):To(r="".concat(t)).call(r,i)+Xe(e-i.length,"")}function Qe(e){return new Ga((t,n)=>{let r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.muted=!0,r.autoplay=!0,r.setAttribute("playsinline",""),r.setAttribute("style","position: absolute; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(r),r.addEventListener("playing",()=>{!r.videoWidth&&Le()||(document.body.removeChild(r),t([r.videoWidth,r.videoHeight]))}),r.srcObject=new MediaStream([e])})}function Je(e){return Ga.all(Ka(e).call(e,e=>e.then(e=>{throw e},e=>e))).then(e=>{throw e},e=>e)}function $e(e,t,...n){return 0===e.getListeners(t).length?Ga.reject(new xl(dl.UNEXPECTED_ERROR,"can not emit promise")):new Ga((r,i)=>{e.emit(t,...n,r,i)})}function Ze(e,t,...n){return 0===e.getListeners(t).length?Ga.resolve():$e(e,t,...n)}function et(e,t,...n){return 0===e.getListeners(t).length?null:tt(e,t,...n)}function tt(e,t,...n){let r=null,i=null;if(e.emit(t,...n,e=>{r=e},e=>{i=e}),null!==i)throw i;if(null===r)throw new xl(dl.UNEXPECTED_ERROR,"handler is not sync");return r}function nt(e,t){-1!==(t=nc(e).call(e,t))&&Qa(e).call(e,t,1)}function rt(e){let t=[];return Ds(e).call(e,e=>{-1===nc(t).call(t,e)&&t.push(e)}),t}function it(e){Ga.resolve().then(e)}function st(e,t){Ld[t]||(Ld[t]=!0,e())}function ot(e){e=window.atob(e);let t=new Uint8Array(new ArrayBuffer(e.length));for(let n=0;n<e.length;n+=1)t[n]=e.charCodeAt(n);return t}function at(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}async function ct(e,t){let n=(e,t)=>e?"number"!=typeof e?e.max||e.exact||e.ideal||e.min||t:e:t;return e={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:n(t.height,1080),maxWidth:n(t.width,1920)}}},t.frameRate&&"number"!=typeof t.frameRate?(e.video.mandatory.maxFrameRate=t.frameRate.max,e.video.mandatory.minFrameRate=t.frameRate.min):"number"==typeof t.frameRate&&(e.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(e)}async function lt(e){let t=["window","screen"];"application"!==e&&"window"!==e||(t=["window"]),"screen"===e&&(t=["screen"]);let n=ut();if(!n)throw new xl(dl.ELECTRON_IS_NULL);e=null;try{e=n.desktopCapturer.getSources({types:t})}catch(r){e=null}e&&e.then||(e=new Ga((e,r)=>{n.desktopCapturer.getSources({types:t},(t,n)=>{t?r(t):e(n)})}));try{return await e}catch(r){throw new xl(dl.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,r.toString())}}function ut(){if(Vd)return Vd;try{return Vd=window.require("electron"),Vd}catch(Uc){return null}}async function dt(e,t){let n=0,r=null;for(;2>n;)try{r=await ht(e,t,0<n);break}catch(o){var i,s;if(o instanceof xl)throw Ul.error(To(s="[".concat(t,"] ")).call(s,o.toString())),o;let e=pt(o.name||o.code||o,o.message);if(e.code!==dl.MEDIA_OPTION_INVALID)throw Ul.error(To(i="[".concat(t,"] ")).call(i,e.toString())),e;Ul.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await qe(500)}if(!r)throw new xl(dl.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function ht(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new xl(dl.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));var r,i,s=Pu;if(n=new MediaStream,e.audioSource&&n.addTrack(e.audioSource),e.videoSource&&n.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return Ul.debug("Using Video Source/ Audio Source"),n;if(e.screen)if(ut())ft(n,e.screen.sourceId?await ct(e.screen.sourceId,e.screen):await async function(e){let t=await(n=await lt(e.mediaSource),new Ga((e,t)=>{const r=document.createElement("div");r.innerText="share screen",r.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const i=document.createElement("div");i.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const s=document.createElement("div");s.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",s.setAttribute("style","height: 12%;");const o=document.createElement("div");o.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const a=document.createElement("div");a.setAttribute("style","text-align: right; padding: 16px 0;");const c=document.createElement("button");c.innerHTML="cancel",c.setAttribute("style","width: 85px;"),c.onclick=()=>{document.body.removeChild(l);const e=Error("NotAllowedError");e.name="NotAllowedError",t(e)},a.appendChild(c),i.appendChild(s),i.appendChild(o),i.appendChild(a);const l=document.createElement("div");l.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),l.appendChild(r),l.appendChild(i),document.body.appendChild(l),Ka(n).call(n,t=>{if(t.id){const n=document.createElement("div");n.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let r=t.thumbnail;const{width:i}=r.getSize();1920<i&&(r=r.resize({width:1920})),n.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+r.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+t.name.replace(/[\u00A0-\u9999<>&]/g,function(e){return"&#"+e.charCodeAt(0)+";"})+"</span>",n.onclick=()=>{document.body.removeChild(l),e(t.id)},o.appendChild(n)}})}));var n;return await ct(t,e)}(e.screen));else if(Pe()&&e.screen.extensionId&&e.screen.mandatory){if(!s.getStreamFromExtension)throw new xl(dl.NOT_SUPPORTED,"This browser does not support screen sharing");Ul.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));var o=await(r=e.screen.extensionId,i=t,new Ga((e,t)=>{try{chrome.runtime.sendMessage(r,{getStream:!0},n=>{if(!n||!n.streamId)return Ul.error("[".concat(i,"] No response from Chrome Plugin. Plugin not installed properly"),n),void t(new xl(dl.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));e(n.streamId)})}catch(s){var n;Ul.error(To(n="[".concat(i,"] AgoraRTC screensharing plugin is not accessible(")).call(n,r,")"),s.toString()),t(new xl(dl.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=o,ft(n,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(s.getDisplayMedia)e.screen.mediaSource&&ke(e.screen.mediaSource),o={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:"screen"===e.screen.mediaSource?"monitor":e.screen.mediaSource},Ul.debug("[".concat(t,"] getDisplayMedia:"),cr({video:o,audio:!!e.screenAudio})),ft(n,await navigator.mediaDevices.getDisplayMedia({video:o,audio:!!e.screenAudio}));else{if(!Le())throw Ul.error("[".concat(t,"] This browser does not support screenSharing")),new xl(dl.NOT_SUPPORTED,"This browser does not support screen sharing");e.screen.mediaSource&&ke(e.screen.mediaSource),s={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}},Ul.debug(To(o="[".concat(t,"] getUserMedia: ")).call(o,cr(s))),ft(n,await navigator.mediaDevices.getUserMedia(s))}if(!e.video&&!e.audio)return n;let a;e={video:e.video,audio:e.audio},Ul.debug("[".concat(t,"] GetUserMedia"),cr(e)),o=null,(t=De()).name!==Mc.SAFARI&&t.os!==Lc.IOS||(o=await jd.lock());try{a=await navigator.mediaDevices.getUserMedia(e)}catch(c){throw o&&o(),c}return e.audio&&(Gd=!0),e.video&&(Hd=!0),ft(n,a),o&&o(),n}function pt(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":var n;return new xl(dl.MEDIA_OPTION_INVALID,To(n="".concat(e,": ")).call(n,t));case"NotFoundError":case"DevicesNotFoundError":var r;return new xl(dl.DEVICE_NOT_FOUND,To(r="".concat(e,": ")).call(r,t));case"NotSupportedError":var i;return new xl(dl.NOT_SUPPORTED,To(i="".concat(e,": ")).call(i,t));case"NotReadableError":var s;return new xl(dl.NOT_READABLE,To(s="".concat(e,": ")).call(s,t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":var o;return new xl(dl.PERMISSION_DENIED,To(o="".concat(e,": ")).call(o,t));case"ConstraintNotSatisfiedError":var a;return new xl(dl.CONSTRAINT_NOT_SATISFIED,To(a="".concat(e,": ")).call(a,t));default:var c;return Ul.error("getUserMedia unexpected error",e),new xl(dl.UNEXPECTED_ERROR,To(c="".concat(e,": ")).call(c,t))}}function ft(e,t){let n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0];(t=t.getAudioTracks()[0])&&(r&&e.removeTrack(r),e.addTrack(t)),i&&(n&&e.removeTrack(n),e.addTrack(i))}function _t(e,t){var n=Vs(e);if(vd){var r=vd(e);t&&(r=Io(r).call(r,function(t){return oo(e,t).enumerable})),n.push.apply(n,r)}return n}function mt(e,t,n){return new Ga((r,i)=>{t.timeout=t.timeout||el.HTTP_CONNECT_TIMEOUT,t.responseType=t.responseType||"json",t.data&&!n?(t.data=cr(t.data),Xd+=Ye(t.data)):n&&(Xd+=t.data.size),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Pl.request(t).then(e=>{"string"==typeof e.data?Qd+=Ye(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?Qd+=e.data.byteLength:Qd+=Ye(cr(e.data)),r(e.data)}).catch(e=>{Pl.isCancel(e)?i(new xl(dl.OPERATION_ABORTED,"cancel token canceled")):i("ECONNABORTED"===e.code?new xl(dl.NETWORK_TIMEOUT,e.message):e.response?new xl(dl.NETWORK_RESPONSE_ERROR,e.response.status):new xl(dl.NETWORK_ERROR,e.message))})})}async function gt(e,t){let n=new Blob([t.data],{type:"buffer"});return await mt(e,function(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Ds(n=_t(Object(r),!0)).call(n,function(t){Sd(e,t,r[t])});else if(Vu)Lu(e,Vu(r));else{var i;Ds(i=_t(Object(r))).call(i,function(t){Ks(e,t,oo(r,t))})}}return e}({},t,{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}function Et(e,t){var n=Vs(e);if(vd){var r=vd(e);t&&(r=Io(r).call(r,function(t){return oo(e,t).enumerable})),n.push.apply(n,r)}return n}function vt(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Ds(n=Et(Object(r),!0)).call(n,function(t){Sd(e,t,r[t])});else if(Vu)Lu(e,Vu(r));else{var i;Ds(i=Et(Object(r))).call(i,function(t){Ks(e,t,oo(r,t))})}}return e}function St(e={report:Jd}){return function(t,n,r){let i=t[n];if("function"==typeof i){let s="AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name;r.value=function(...t){var r;let o=e.report.reportApiInvoke(this._sessionId||null,{name:To(r="".concat(s,".")).call(r,n),options:t,tag:Kl.TRACER});try{let e=i.apply(this,t);return o.onSuccess(),e}catch(a){throw o.onError(a),a}}}return r}}function Tt(e){var t=$d[Math.floor(e/1e4)];if(!t)return{desc:"unkonw error",retry:!1};if(!(t=t[e%1e4])){if(Math.floor(e/1e4)===zl.ACCESS_POINT){if("1"===(e%=1e4).toString()[0])return{desc:e.toString(),retry:!1};if("2"===e.toString()[0])return{desc:e.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return t}function Rt(e){return Zd[e]||{desc:"UNKNOW_ERROR_".concat(e),action:"failed"}}function yt(e,t,n,r){let i=Us({},eh,r),s=i.timeout,o=async()=>{await qe(s),s*=i.timeoutFactor,s=Math.min(i.maxRetryTimeout,s)},a=!1;return(r=new Ga(async(r,s)=>{t=t||(()=>!1),n=n||(()=>!0);for(let l=0;l<i.maxRetryCount;l+=1){if(a)return s(new xl(dl.OPERATION_ABORTED));try{const n=await e();if(!t(n,l)||l+1===i.maxRetryCount)return r(n);await o()}catch(c){if(!n(c,l)||l+1===i.maxRetryCount)return s(c);await o()}}})).cancel=()=>a=!0,r}function It(){if(!ah&&(oh?(Ul.info("create audio context"),ah=new oh,ah.onstatechange=()=>{ch.emit("state-change")},function(e){function t(t){"running"===e.state?n(!1):"closed"!==e.state&&(n(!0),t?e.resume().then(r,r):n(!1))}function n(e){if(o!==e){o=e;for(let t=0,n=s;t<n.length;t+=1){let r=n[t];e?window.addEventListener(r,i,{capture:!0,passive:!0}):window.removeEventListener(r,i,{capture:!0,passive:!0})}}}function r(){t(!1)}function i(){t(!0)}let s="click contextmenu auxclick dblclick mousedown mouseup touchend keydown keyup".split(" "),o=!1;e.onstatechange=function(){t(!0)},t(!1)}(ah)):Ul.error("your browser is not support web audio"),!ah))throw new xl(dl.NOT_SUPPORTED,"can not create audio context");return ah}function Ct(e){if(!function(){if(null!==lh)return lh;var e=It();let t=e.createBufferSource(),n=e.createGain();e=e.createGain(),t.connect(n),t.connect(e),t.disconnect(n),e=!1;try{t.disconnect(n)}catch(r){e=!0}return t.disconnect(),lh=e,e}()){Ul.debug("polyfill audio node");var t=e.connect,n=e.disconnect;e.connect=(n,r,i)=>{var s;return e._inputNodes||(e._inputNodes=[]),Rc(s=e._inputNodes).call(s,n)||(n instanceof AudioNode?(e._inputNodes.push(n),t.call(e,n,r,i)):t.call(e,n,r)),e},e.disconnect=(r,i,s)=>{n.call(e),r?nt(e._inputNodes,r):e._inputNodes=[];for(let n of e._inputNodes)t.call(e,n)}}}function At(e,t){let n=1/t,r=It(),i=r.createGain();i.gain.value=0,i.connect(r.destination);let s=!1,o=()=>{if(s)return void(i=null);const t=r.createOscillator();t.onended=o,t.connect(i),t.start(0),t.stop(r.currentTime+n),e(r.currentTime)};return o(),()=>{s=!0}}function wt(e,t){var n=Vs(e);if(vd){var r=vd(e);t&&(r=Io(r).call(r,function(t){return oo(e,t).enumerable})),n.push.apply(n,r)}return n}function bt(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Ds(n=wt(Object(r),!0)).call(n,function(t){Sd(e,t,r[t])});else if(Vu)Lu(e,Vu(r));else{var i;Ds(i=wt(Object(r))).call(i,function(t){Ks(e,t,oo(r,t))})}}return e}function Ot(e,t){var n=Vs(e);if(vd){var r=vd(e);t&&(r=Io(r).call(r,function(t){return oo(e,t).enumerable})),n.push.apply(n,r)}return n}function Nt(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Ds(n=Ot(Object(r),!0)).call(n,function(t){Sd(e,t,r[t])});else if(Vu)Lu(e,Vu(r));else{var i;Ds(i=Ot(Object(r))).call(i,function(t){Ks(e,t,oo(r,t))})}}return e}function kt(e,t){var n=Vs(e);if(vd){var r=vd(e);t&&(r=Io(r).call(r,function(t){return oo(e,t).enumerable})),n.push.apply(n,r)}return n}function Dt({url:e,areaCode:t},n,r,i){let s=wd(),o={opid:133,flag:4096,ts:wd(),key:n.token,cname:n.cname,sid:n.sid,detail:{6:n.stringUid,11:t},uid:n.uid||0};return n.multiIP&&n.multiIP.gateway_ip&&(o.detail[5]=cr({vocs_ip:[n.multiIP.uni_lbs_ip],vos_ip:[n.multiIP.gateway_ip]})),yt(async()=>{let t=await mt(e+"".concat(-1===nc(e).call(e,"?")?"?":"&","action=wrtc_gateway"),{data:o,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":69}});if(t.addresses&&0===t.addresses.length&&0===t.code)throw new xl(dl.VOID_GATEWAY_ADDRESS,"",{retry:!0,csIp:t.detail&&t.detail[502]});if(el.GATEWAY_ADDRESS&&0<el.GATEWAY_ADDRESS.length){var n;console.log(el.GATEWAY_ADDRESS);let e=Ka(n=el.GATEWAY_ADDRESS).call(n,(e,n)=>({ip:e.ip,port:e.port,ticket:t.addresses[0]&&t.addresses[0].ticket}));t.addresses=e}return function(e,t){var n;let r=[".agora.io",".sd-rtn.com"],i=r[1]&&-1!==nc(t).call(t,r[1])?1:0;return e.addresses=e.addresses||[],{gatewayAddrs:Ka(n=e.addresses).call(n,e=>{var t,n,s;return e.ip.match(/^[\.:\d]+$/)?To(t=To(n="".concat(e.ip.replace(/[^\d]/g,"-"),".edge")).call(n,r[i++%r.length],":")).call(t,e.port):(Ul.info("Cannot recognized as IP address ".concat(e.ip,". Used As Host instead")),To(s="".concat(e.ip,":")).call(s,e.port))}),uid:e.uid,cid:e.cid,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}(t,e)},t=>{if(0===t.res.code)return Jd.joinChooseServer(n.sid,{lts:s,succ:!0,csAddr:e,serverList:t.gatewayAddrs,ec:null,cid:t.res.cid.toString(),uid:t.res.uid.toString(),csIp:t.csIp}),!1;let r=Tt(t.res.code);throw new xl(dl.CAN_NOT_GET_GATEWAY_SERVER,r.desc,{retry:r.retry,csIp:t.csIp})},t=>{return t.code!==dl.OPERATION_ABORTED&&(t.code===dl.CAN_NOT_GET_GATEWAY_SERVER||t.code===dl.VOID_GATEWAY_ADDRESS?(Jd.joinChooseServer(n.sid,{lts:s,succ:!1,csAddr:e,serverList:null,ec:t.message,csIp:t.data&&t.data.csIp}),Ul.warning(To(r=To(i=To(o="[".concat(n.clientId,"] Choose server ")).call(o,e," failed, message: ")).call(i,t.message,", retry: ")).call(r,t.data.retry)),t.data.retry):(Jd.joinChooseServer(n.sid,{lts:s,succ:!1,csAddr:e,serverList:null,ec:t.code,csIp:t.data&&t.data.csIp}),Ul.warning("[".concat(n.clientId,"] Choose server network error, retry"),t),!0));var r,i,o},i)}async function Pt(e,t,n){return{gatewayInfo:await async function(e,t,n){var r,i;const s=Ka(r=cc(i=el.WEBCS_DOMAIN).call(i,0,el.AJAX_REQUEST_CONCURRENT)).call(r,t=>{var n;return{url:e.proxyServer?To(n="https://".concat(e.proxyServer,"/ap/?url=")).call(n,t+"/api/v1"):"https://".concat(t,"/api/v1"),areaCode:Th()}});let o=null;return o=await Je([(async()=>await xd({fragementLength:el.FRAGEMENT_LENGTH,referenceList:s,asyncMapHandler:r=>(Ul.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),Dt(r,e,t,n)),allFailedhandler:e=>{throw e[0]}}))(),(async()=>{var r;if(await qe(1e3),null!==o)return o;const i=Ka(r=el.WEBCS_DOMAIN_BACKUP_LIST).call(r,t=>{var n;return{url:e.proxyServer?To(n="https://".concat(e.proxyServer,"/ap/?url=")).call(n,t+"/api/v1"):"https://".concat(t,"/api/v1"),areaCode:Th()}});return await xd({fragementLength:el.FRAGEMENT_LENGTH,referenceList:i,asyncMapHandler:r=>(Ul.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),Dt(r,e,t,n)),allFailedhandler:e=>{throw e[0]}})})()]),o}(e,t,n)}}async function Lt(e,t,n,r){var i;let s=cc(i=el.ACCOUNT_REGISTER).call(i,0,el.AJAX_REQUEST_CONCURRENT);return i=[],i=t.proxyServer?Ka(s).call(s,e=>{var n;return To(n="https://".concat(t.proxyServer,"/ap/?url=")).call(n,e+"/api/v1")}):Ka(s).call(s,e=>"https://".concat(e,"/api/v1")),(await async function(e,t,n,r,i){let s=wd(),o={sid:n.sid,opid:10,appid:n.appId,string_uid:t},a=e[0];if(0!==(n=await yt(()=>mt(a+"".concat(-1===nc(a).call(a,"?")?"?":"&","action=stringuid"),{data:o,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(n,r)=>{if(0===n.code){var i;if(0>=n.uid||n.uid>=Math.pow(2,32))throw Ul.error(To(i="Invalid Uint Uid ".concat(t," => ")).call(i,n.uid),n),Jd.reqUserAccount(o.sid,{lts:s,success:!1,serverAddr:a,stringUid:o.string_uid,uid:n.uid,errorCode:dl.INVALID_UINT_UID_FROM_STRING_UID,extend:o}),new xl(dl.INVALID_UINT_UID_FROM_STRING_UID);return Jd.reqUserAccount(o.sid,{lts:s,success:!0,serverAddr:a,stringUid:o.string_uid,uid:n.uid,errorCode:null,extend:o}),!1}return(i=Tt(n.code)).retry&&(a=e[(r+1)%e.length]),Jd.reqUserAccount(o.sid,{lts:s,success:!1,serverAddr:a,stringUid:o.string_uid,uid:n.uid,errorCode:i.desc,extend:o}),i.retry},(t,n)=>t.code!==dl.OPERATION_ABORTED&&(Jd.reqUserAccount(o.sid,{lts:s,success:!1,serverAddr:a,stringUid:o.string_uid,uid:null,errorCode:t.code,extend:o}),a=e[(n+1)%e.length],!0),i)).code)throw n=Tt(n.code),new xl(dl.UNEXPECTED_RESPONSE,n.desc);return n}(i,e,t,n,r)).uid}async function Mt(e,t,n,r){var i,s;let o=Ka(i=cc(s=el.UAP_AP).call(s,0,el.AJAX_REQUEST_CONCURRENT)).call(i,e=>{var n;return t.proxyServer?To(n="https://".concat(t.proxyServer,"/ap/?url=")).call(n,e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap")});return await function(e,t,n,r,i){vh+=1;let s,o,a={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(wd()/1e3),seq:vh,requestId:vh,version:Yc,cname:n.cname},c={service_name:t,json_body:cr(a)},l=e[0];return yt(async()=>{s=wd();var e=await mt(l,{data:c,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(o=wd()-s,0!==e.code){var n=new xl(dl.UNEXPECTED_RESPONSE,"live streaming ap error, code"+e.code,{retry:!0,responseTime:o});throw Ul.error(n.toString()),n}if(200!==(e=JSON.parse(e.json_body)).code)throw e=new xl(dl.UNEXPECTED_RESPONSE,To(n="live streaming app center error, code: ".concat(e.code,", reason: ")).call(n,e.reason),{code:e.code,responseTime:o}),Ul.error(e.toString()),e;if(!e.servers||0===e.servers.length)throw n=new xl(dl.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:e.code,responseTime:o}),Ul.error(n.toString()),n;return n=function(e,t){var n;return{addressList:Ka(n=e.servers).call(n,e=>{var n,r;return To(n=To(r="wss://".concat(e.address.replace(/\./g,"-"),".edge.agora.io:")).call(r,e.wss,"?serviceName=")).call(n,encodeURIComponent(t))}),workerToken:e.workerToken,vid:e.vid}}(e,t),el.LIVE_STREAMING_ADDRESS&&(n.addressList=el.LIVE_STREAMING_ADDRESS instanceof Array?el.LIVE_STREAMING_ADDRESS:[el.LIVE_STREAMING_ADDRESS]),function(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Ds(n=kt(Object(r),!0)).call(n,function(t){Sd(e,t,r[t])});else if(Vu)Lu(e,Vu(r));else{var i;Ds(i=kt(Object(r))).call(i,function(t){Ks(e,t,oo(r,t))})}}return e}({},n,{responseTime:o})},(r,i)=>(Jd.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:cr(r.addressList),firstSuccess:0===i,responseTime:o,serverIp:e[i%e.length]}),!1),(r,i)=>(Jd.apworkerEvent(n.sid,{success:!1,sc:r.data&&r.data.code||200,serviceName:t,responseTime:o,serverIp:e[i%e.length]}),!!(r.code!==dl.OPERATION_ABORTED&&r.code!==dl.UNEXPECTED_RESPONSE||r.data&&r.data.retry)&&(l=e[(i+1)%e.length],!0)),i)}(o,e,t,n,r)}function Ut(e,t){var n=Vs(e);if(vd){var r=vd(e);t&&(r=Io(r).call(r,function(t){return oo(e,t).enumerable})),n.push.apply(n,r)}return n}function xt(e){if(Array.isArray(e))return e.map(function(e){return e});if(!Vt(e))return e;var t,n={};for(t in e)n[t]=Vt(e[t])||Array.isArray(e[t])?xt(e[t]):e[t];return n}function Vt(e){return!("object"!=typeof e||Array.isArray(e)||!e)}function Ft(e,t){function n(){this.constructor=e}bh(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function Bt(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{c(r.next(e))}catch(t){s(t)}}function a(e){try{c(r.throw(e))}catch(t){s(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,a)}c((r=r.apply(e,t||[])).next())})}function jt(e,t){function n(n){return function(o){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,i=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!((s=0<(s=a.trys).length&&s[s.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3]))a.label=n[1];else if(6===n[0]&&a.label<s[1])a.label=s[1],s=n;else{if(!(s&&a.label<s[2])){s[2]&&a.ops.pop(),a.trys.pop();continue}a.label=s[2],a.ops.push(n)}}n=t.call(e,a)}catch(o){n=[6,o],i=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,o])}}var r,i,s,o,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o}function Gt(e,t,n){return(n=e.createShader(n))?(e.shaderSource(n,t),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?n:(t=e.getShaderInfoLog(n),e.deleteShader(n),new xl(dl.WEBGL_INTERNAL_ERROR,"error compiling shader:"+t).throw())):new xl(dl.WEBGL_INTERNAL_ERROR,"can not create shader").throw()}function Ht(e){var t=new Uint8Array([99,114,121,112,116,105,105]),n=t.length;let r=e.length,i=new Uint8Array(r),s=new Uint8Array(256);for(var o=0;256>o;o++)s[o]=o;o=0;for(var a=0;256>a;a++)o=(o+s[a]+t[a%n])%256,[s[a],s[o]]=[s[o],s[a]];for(o=n=0,a=0;a<0+r;a++)o=(o+s[n=(n+1)%256])%256,[s[n],s[o]]=[s[o],s[n]],t=s[(s[n]+s[o])%256],0<=a&&(i[a-0]=e[a-0]^t);return e=String.fromCharCode.apply(null,Ad(i)),Function("var winSize = 5; return `"+e+"`")()}function Wt(e){let t={};return e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId}),e.encoderConfig?(e=X(e.encoderConfig),t.width=e.width,t.height=e.height,!Me()&&e.frameRate&&(t.frameRate=e.frameRate),De().name===Mc.EDGE&&"object"==typeof t.frameRate&&(t.frameRate.max=60),Le()&&(t.frameRate={ideal:30,max:30}),t):t}function Kt(e){let t={};if(Me()||(void 0!==e.AGC&&(t.autoGainControl=e.AGC,Pe()&&(t.googAutoGainControl=e.AGC,t.googAutoGainControl2=e.AGC)),void 0!==e.AEC&&(t.echoCancellation=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,Pe()&&(t.googNoiseSuppression=e.ANS))),e.encoderConfig){let n=$(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),Pe()&&2===t.channelCount&&(t.googAutoGainControl=!1,t.googAutoGainControl2=!1,t.echoCancellation=!1,t.googNoiseSuppression=!1),t}function Yt(e,t){var n=Vs(e);if(vd){var r=vd(e);t&&(r=Io(r).call(r,function(t){return oo(e,t).enumerable})),n.push.apply(n,r)}return n}function qt(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Ds(n=Yt(Object(r),!0)).call(n,function(t){Sd(e,t,r[t])});else if(Vu)Lu(e,Vu(r));else{var i;Ds(i=Yt(Object(r))).call(i,function(t){Ks(e,t,oo(r,t))})}}return e}function zt(e){let t={video:[],audio:[]};return e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ VP9/i)&&t.video.push("VP9"),e.match(/ AV1X/i)&&t.video.push("AV1"),e.match(/ H264/i)&&t.video.push("H264"),e.match(/ opus/i)&&t.audio.push("OPUS"),t}function Xt(e,t){var n=e.match(/a=rtpmap:(\d+) opus/);if(!n||!n[0]||!n[1])return e;var r,i=n[1];return(n=e.match("a=fmtp:".concat(i,".*\r\n")))&&n[0]?(i="a=fmtp:".concat(i," minptime=10;useinbandfec=1;"),t.bitrate&&(i+="maxaveragebitrate=".concat(Math.floor(1e3*t.bitrate),";")),t.sampleRate&&(i+=To(r="maxplaybackrate=".concat(t.sampleRate,";sprop-maxcapturerate=")).call(r,t.sampleRate,";")),t.stereo&&(i+="stereo=1;sprop-stereo-1;"),e.replace(n[0],i+="\r\n")):e}function Qt(e){return e.replace("minptime=10","minptime=10;stereo=1; sprop-stereo=1")}function Jt(e,t,n){var r=!1;switch(t){case"h264":case"vp8":return e;case"vp9":case"av1":r=!0}if(r){var i;let v,S,T=gc(i=RegExp.prototype.test).call(i,/^([a-z])=(.*)/),R=e.split("m="),y=null,I=null,C=null,A=[];var s;i=[],t=[];let w=r=null;var o;let b=[],O=[];for(var a=0;a<R.length;++a)if(y=R[a].match(/a=msid-semantic:/),y){y=R[a];break}for(a=0;a<R.length;++a)if(I=R[a].match(/audio /),I){v=a,I="m="+R[a];break}for(a=0;a<R.length;++a)if(C=R[a].match(/video /),C){S=a,C="m="+R[a];break}if(y&&(A=Io(s=y.split(/(\r\n|\r|\n)/)).call(s,T)),0<A.length&&(t=To(t).call(t,A)),I&&(i=Io(o=I.split(/(\r\n|\r|\n)/)).call(o,T)),!C)return e;var c;for(s=Io(c=C.split(/(\r\n|\r|\n)/)).call(c,T),c=0;c<s.length;++c)if(null===r&&null!==(r=s[c].match(/cname:/))){r="cname:"+s[c].split("cname:")[1];break}for(o=0;o<s.length;++o)if(null===w&&(w=s[o].match(/a=msid:/),null!==w&&(w="msid:"+s[o].split(":")[1])),s[o].match(/a=ssrc-group:FID/)){c=s[o].split(" "),b.push(Number(c[1])),c[2]&&O.push(Number(c[2])),s.length=o;break}for(c=1;c<n.numSpatialLayers;++c)b.push(b[0]+c),0<O.length&&O.push(O[0]+c);for(c="a=ssrc-group:SIM ",o=0;o<b.length;++o)c=To(c).call(c,String(b[o])),o<b.length-1&&(c=To(c).call(c," "));for(s.push(c),c=0;c<n.numSpatialLayers;++c){var l,u;o=To(l=To(u=To("a=ssrc-group:FID ").call("a=ssrc-group:FID ",String(b[c]))).call(u," ")).call(l,String(O[c])),s.push(o)}for(l=0;l<n.numSpatialLayers;++l){var d,h,p,f;if(null===r||null===w)return e;u=To(d=To(h="a=ssrc:".concat(String(b[l]))).call(h," ")).call(d,r),c=To(p=To(f="a=ssrc:".concat(String(b[l]))).call(f," ")).call(p,w),s.push(u),s.push(c)}for(d=0;d<n.numSpatialLayers;++d){var _,m,g,E;if(null===r||null===w)return e;h=To(_=To(m="a=ssrc:".concat(String(O[d]))).call(m," ")).call(_,r),p=To(g=To(E="a=ssrc:".concat(String(O[d]))).call(E," ")).call(g,w),s.push(h),s.push(p)}v&&S&&v>S?(t=To(t).call(t,s),t=To(t).call(t,i)):(t=To(t).call(t,i),t=To(t).call(t,s)),e=t.join("\r\n")+"\r\n"}return e}function $t(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=Be(t.width),r.height=Be(t.height),t=Be(t.framerate||15),document.body.append(n),document.body.append(r);let i=e._mediaStreamTrack;n.srcObject=new MediaStream([i]),n.play();let s=r.getContext("2d");if(!s)throw new xl(dl.UNEXPECTED_ERROR,"can not get canvas context");let o=r.captureStream(Pu.supportRequestFrame?0:t).getVideoTracks()[0],a=At(()=>{if(n.paused&&n.play(),2<n.videoHeight&&2<n.videoWidth){const e=n.videoHeight/n.videoWidth*r.width;var t,a,c;2<=Math.abs(e-r.height)&&(Ul.debug("adjust low stream resolution",To(t=To(a=To(c="".concat(r.width,"x")).call(c,r.height," -> ")).call(a,r.width,"x")).call(t,e)),r.height=e)}s.drawImage(n,0,0,r.width,r.height),o.requestFrame&&o.requestFrame(),i!==e._mediaStreamTrack&&(i=e._mediaStreamTrack,n.srcObject=new MediaStream([i]))},t),c=o.stop;return o.stop=()=>{c.call(o),a(),n.remove(),r.width=0,r.remove(),n=r=null,Ul.debug("clean low stream renderer")},o}function Zt(e,t){var n=Vs(e);if(vd){var r=vd(e);t&&(r=Io(r).call(r,function(t){return oo(e,t).enumerable})),n.push.apply(n,r)}return n}function en(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Ds(n=Zt(Object(r),!0)).call(n,function(t){Sd(e,t,r[t])});else if(Vu)Lu(e,Vu(r));else{var i;Ds(i=Zt(Object(r))).call(i,function(t){Ks(e,t,oo(r,t))})}}return e}function tn(e,t){var n=Vs(e);if(vd){var r=vd(e);t&&(r=Io(r).call(r,function(t){return oo(e,t).enumerable})),n.push.apply(n,r)}return n}function nn(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Ds(n=tn(Object(r),!0)).call(n,function(t){Sd(e,t,r[t])});else if(Vu)Lu(e,Vu(r));else{var i;Ds(i=tn(Object(r))).call(i,function(t){Ks(e,t,oo(r,t))})}}return e}function rn(e,t){var n=Vs(e);if(vd){var r=vd(e);t&&(r=Io(r).call(r,function(t){return oo(e,t).enumerable})),n.push.apply(n,r)}return n}function sn(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Ds(n=rn(Object(r),!0)).call(n,function(t){Sd(e,t,r[t])});else if(Vu)Lu(e,Vu(r));else{var i;Ds(i=rn(Object(r))).call(i,function(t){Ks(e,t,oo(r,t))})}}return e}function on(e,t){var n=Vs(e);if(vd){var r=vd(e);t&&(r=Io(r).call(r,function(t){return oo(e,t).enumerable})),n.push.apply(n,r)}return n}function an(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Ds(n=on(Object(r),!0)).call(n,function(t){Sd(e,t,r[t])});else if(Vu)Lu(e,Vu(r));else{var i;Ds(i=on(Object(r))).call(i,function(t){Ks(e,t,oo(r,t))})}}return e}function cn(e){if(!(e instanceof Ap))return new xl(dl.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t=e.getSrcChannelMediaInfo();return e=e.getDestChannelMediaInfo(),t?0===e.size?new xl(dl.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new xl(dl.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}function ln(e,t){var n=Vs(e);if(vd){var r=vd(e);t&&(r=Io(r).call(r,function(t){return oo(e,t).enumerable})),n.push.apply(n,r)}return n}function un(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Ds(n=ln(Object(r),!0)).call(n,function(t){Sd(e,t,r[t])});else if(Vu)Lu(e,Vu(r));else{var i;Ds(i=ln(Object(r))).call(i,function(t){Ks(e,t,oo(r,t))})}}return e}function dn(e,t){var n=Vs(e);if(vd){var r=vd(e);t&&(r=Io(r).call(r,function(t){return oo(e,t).enumerable})),n.push.apply(n,r)}return n}function hn(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Ds(n=dn(Object(r),!0)).call(n,function(t){Sd(e,t,r[t])});else if(Vu)Lu(e,Vu(r));else{var i;Ds(i=dn(Object(r))).call(i,function(t){Ks(e,t,oo(r,t))})}}return e}function pn(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=hn({},r,{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),"motion"!==n.optimizationMode&&"detail"!==n.optimizationMode||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?Ul.debug("[".concat(e,"] set content hint to"),n.optimizationMode):Ul.debug("[".concat(e,"] set content hint failed")))):Ul.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var fn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},_n=function(e){return e&&e.Math==Math&&e},mn=_n("object"==typeof globalThis&&globalThis)||_n("object"==typeof window&&window)||_n("object"==typeof self&&self)||_n("object"==typeof fn&&fn)||Function("return this")(),gn=function(e){try{return!!e()}catch(t){return!0}},En=!gn(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),vn={}.propertyIsEnumerable,Sn=Object.getOwnPropertyDescriptor,Tn=Sn&&!vn.call({1:2},1)?function(e){return!!(e=Sn(this,e))&&e.enumerable}:vn,Rn=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},yn={}.toString,In=function(e){return yn.call(e).slice(8,-1)},Cn="".split,An=gn(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return"String"==In(e)?Cn.call(e,""):Object(e)}:Object,wn=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},bn=function(e){return An(wn(e))},On=function(e){return"object"==typeof e?null!==e:"function"==typeof e},Nn=function(e,t){if(!On(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!On(r=n.call(e))||"function"==typeof(n=e.valueOf)&&!On(r=n.call(e))||!t&&"function"==typeof(n=e.toString)&&!On(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},kn={}.hasOwnProperty,Dn=function(e,t){return kn.call(e,t)},Pn=mn.document,Ln=On(Pn)&&On(Pn.createElement),Mn=!En&&!gn(function(){return 7!=Object.defineProperty(Ln?Pn.createElement("div"):{},"a",{get:function(){return 7}}).a}),Un=Object.getOwnPropertyDescriptor,xn=En?Un:function(e,t){if(e=bn(e),t=Nn(t,!0),Mn)try{return Un(e,t)}catch(gl){}if(Dn(e,t))return Rn(!Tn.call(e,t),e[t])},Vn=/#|\.prototype\./,Fn=function(e,t){return(e=jn[Bn(e)])==Hn||e!=Gn&&("function"==typeof t?gn(t):!!t)},Bn=Fn.normalize=function(e){return String(e).replace(Vn,".").toLowerCase()},jn=Fn.data={},Gn=Fn.NATIVE="N",Hn=Fn.POLYFILL="P",Wn={},Kn=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},Yn=function(e,t,n){if(Kn(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},qn=function(e){if(!On(e))throw TypeError(String(e)+" is not an object");return e},zn=Object.defineProperty,Xn={f:En?zn:function(e,t,n){if(qn(e),t=Nn(t,!0),qn(n),Mn)try{return zn(e,t,n)}catch(r){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},Qn=En?function(e,t,n){return Xn.f(e,t,Rn(1,n))}:function(e,t,n){return e[t]=n,e},Jn=xn,$n=function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t},Zn=function(e,t){var n,r,i,s,o,a=e.target,c=e.global,l=e.stat,u=e.proto,d=c?mn:l?mn[a]:(mn[a]||{}).prototype,h=c?Wn:Wn[a]||(Wn[a]={}),p=h.prototype;for(r in t){var f=!Fn(c?r:a+(l?".":"#")+r,e.forced)&&d&&Dn(d,r),_=h[r];f&&(i=e.noTargetGet?(o=Jn(d,r))&&o.value:d[r]);var m=f&&i?i:t[r];f&&typeof _==typeof m||(s=e.bind&&f?Yn(m,mn):e.wrap&&f?$n(m):u&&"function"==typeof m?Yn(Function.call,m):m,(e.sham||m&&m.sham||_&&_.sham)&&Qn(s,"sham",!0),h[r]=s,u&&(Dn(Wn,n=a+"Prototype")||Qn(Wn,n,{}),Wn[n][r]=m,e.real&&p&&!p[r]&&Qn(p,r,m)))}},er=function(e){return"function"==typeof e?e:void 0},tr=function(e,t){return 2>arguments.length?er(Wn[e])||er(mn[e]):Wn[e]&&Wn[e][t]||mn[e]&&mn[e][t]},nr=tr("JSON","stringify"),rr=/[\uD800-\uDFFF]/g,ir=/^[\uD800-\uDBFF]$/,sr=/^[\uDC00-\uDFFF]$/,or=function(e,t,n){var r=n.charAt(t-1);return t=n.charAt(t+1),ir.test(e)&&!sr.test(t)||sr.test(e)&&!ir.test(r)?"\\u"+e.charCodeAt(0).toString(16):e},ar=gn(function(){return'"\\udf06\\ud834"'!==nr("\udf06\ud834")||'"\\udead"'!==nr("\udead")});nr&&Zn({target:"JSON",stat:!0,forced:ar},{stringify:function(e,t,n){var r=nr.apply(null,arguments);return"string"==typeof r?r.replace(rr,or):r}}),Wn.JSON||(Wn.JSON={stringify:JSON.stringify});var cr=function(e,t,n){return Wn.JSON.stringify.apply(null,arguments)},lr={},ur=0,dr=Math.random(),hr=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++ur+dr).toString(36)},pr=!gn(function(){return Object.isExtensible(Object.preventExtensions({}))}),fr=e(function(e){var t=Xn.f,n=hr("meta"),r=0,i=Object.isExtensible||function(){return!0},s=function(e){t(e,n,{value:{objectID:"O"+ ++r,weakData:{}}})},o=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!On(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!Dn(e,n)){if(!i(e))return"F";if(!t)return"E";s(e)}return e[n].objectID},getWeakData:function(e,t){if(!Dn(e,n)){if(!i(e))return!0;if(!t)return!1;s(e)}return e[n].weakData},onFreeze:function(e){return pr&&o.REQUIRED&&i(e)&&!Dn(e,n)&&s(e),e}};lr[n]=!0}),_r=mn["__core-js_shared__"]||function(e,t){try{Qn(mn,e,t)}catch(gl){mn[e]=t}return t}("__core-js_shared__",{}),mr=e(function(e){(e.exports=function(e,t){return _r[e]||(_r[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.4.3",mode:"pure",copyright:"\xa9 2019 Denis Pushkarev (zloirock.ru)"})}),gr=!!Object.getOwnPropertySymbols&&!gn(function(){return!String(Symbol())}),Er=gr&&!Symbol.sham&&"symbol"==typeof Symbol(),vr=mr("wks"),Sr=mn.Symbol,Tr=Er?Sr:hr,Rr=function(e){return Dn(vr,e)||(vr[e]=gr&&Dn(Sr,e)?Sr[e]:Tr("Symbol."+e)),vr[e]},yr={},Ir=Rr("iterator"),Cr=Array.prototype,Ar=function(e){return void 0!==e&&(yr.Array===e||Cr[Ir]===e)},wr=Math.ceil,br=Math.floor,Or=function(e){return isNaN(e=+e)?0:(0<e?br:wr)(e)},Nr=Math.min,kr=function(e){return 0<e?Nr(Or(e),9007199254740991):0},Dr={};Dr[Rr("toStringTag")]="z";var Pr="[object z]"===String(Dr),Lr=Rr("toStringTag"),Mr="Arguments"==In(function(){return arguments}()),Ur=Pr?In:function(e){var t;if(void 0===e)var n="Undefined";else{if(null===e)var r="Null";else{e:{var i=e=Object(e);try{r=i[Lr];break e}catch(s){}r=void 0}r="string"==typeof(n=r)?n:Mr?In(e):"Object"==(t=In(e))&&"function"==typeof e.callee?"Arguments":t}n=r}return n},xr=Rr("iterator"),Vr=function(e){if(null!=e)return e[xr]||e["@@iterator"]||yr[Ur(e)]},Fr=function(e,t,n,r){try{return r?t(qn(n)[0],n[1]):t(n)}catch(i){throw void 0!==(t=e.return)&&qn(t.call(e)),i}},Br=e(function(e){var t=function(e,t){this.stopped=e,this.result=t};(e.exports=function(e,n,r,i,s){var o,a;if(n=Yn(n,r,i?2:1),!s){if("function"!=typeof(s=Vr(e)))throw TypeError("Target is not iterable");if(Ar(s)){for(s=0,r=kr(e.length);r>s;s++)if((o=i?n(qn(a=e[s])[0],a[1]):n(e[s]))&&o instanceof t)return o;return new t(!1)}e=s.call(e)}for(s=e.next;!(a=s.call(e)).done;)if("object"==typeof(o=Fr(e,n,a.value,i))&&o&&o instanceof t)return o;return new t(!1)}).stop=function(e){return new t(!0,e)}}),jr=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},Gr=Pr?{}.toString:function(){return"[object "+Ur(this)+"]"},Hr=Xn.f,Wr=Rr("toStringTag"),Kr=function(e,t,n,r){e&&(Dn(e=n?e:e.prototype,Wr)||Hr(e,Wr,{configurable:!0,value:t}),r&&!Pr&&Qn(e,"toString",Gr))},Yr=function(e){return Object(wn(e))},qr=Array.isArray||function(e){return"Array"==In(e)},zr=Rr("species"),Xr=function(e,t){var n;return qr(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!qr(n.prototype)?On(n)&&null===(n=n[zr])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)},Qr=[].push,Jr=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,s=6==e,o=5==e||s;return function(a,c,l,u){var d,h,p=Yr(a),f=An(p);c=Yn(c,l,3),l=kr(f.length);var _=0;for(u=u||Xr,a=t?u(a,l):n?u(a,0):void 0;l>_;_++)if((o||_ in f)&&(h=c(d=f[_],_,p),e))if(t)a[_]=h;else if(h)switch(e){case 3:return!0;case 5:return d;case 6:return _;case 2:Qr.call(a,d)}else if(i)return!1;return s?-1:r||i?i:a}},$r=Jr(0),Zr=Jr(1),ei=Jr(2),ti=Jr(3);Jr(4);var ni=Jr(5),ri=Jr(6),ii=mr("native-function-to-string",Function.toString),si=mn.WeakMap,oi="function"==typeof si&&/native code/.test(ii.call(si)),ai=mr("keys"),ci=function(e){return ai[e]||(ai[e]=hr(e))};if(oi)var li=new(0,mn.WeakMap),ui=li.get,di=li.has,hi=li.set,pi=function(e,t){return hi.call(li,e,t),t},fi=function(e){return ui.call(li,e)||{}},_i=function(e){return di.call(li,e)};else{var mi=ci("state");lr[mi]=!0,pi=function(e,t){return Qn(e,mi,t),t},fi=function(e){return Dn(e,mi)?e[mi]:{}},_i=function(e){return Dn(e,mi)}}var gi={set:pi,get:fi,has:_i,enforce:function(e){return _i(e)?fi(e):pi(e,{})},getterFor:function(e){return function(t){var n;if(!On(t)||(n=fi(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},Ei=Xn.f,vi=gi.set,Si=gi.getterFor,Ti=Math.max,Ri=Math.min,yi=function(e,t){return 0>(e=Or(e))?Ti(e+t,0):Ri(e,t)},Ii=function(e){return function(t,n,r){var i;t=bn(t);var s=kr(t.length);if(r=yi(r,s),e&&n!=n){for(;s>r;)if((i=t[r++])!=i)return!0}else for(;s>r;r++)if((e||r in t)&&t[r]===n)return e||r||0;return!e&&-1}},Ci=Ii(!0),Ai=Ii(!1),wi=function(e,t){var n;e=bn(e);var r=0,i=[];for(n in e)!Dn(lr,n)&&Dn(e,n)&&i.push(n);for(;t.length>r;)Dn(e,n=t[r++])&&(~Ai(i,n)||i.push(n));return i},bi="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),Oi=Object.keys||function(e){return wi(e,bi)},Ni=En?Object.defineProperties:function(e,t){qn(e);for(var n,r=Oi(t),i=r.length,s=0;i>s;)Xn.f(e,n=r[s++],t[n]);return e},ki=tr("document","documentElement"),Di=ci("IE_PROTO"),Pi=function(){},Li=function(){var e=Ln?Pn.createElement("iframe"):{},t=bi.length;for(e.style.display="none",ki.appendChild(e),e.src="javascript:",(e=e.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),Li=e.F;t--;)delete Li.prototype[bi[t]];return Li()},Mi=Object.create||function(e,t){var n;return null!==e?(Pi.prototype=qn(e),n=new Pi,Pi.prototype=null,n[Di]=e):n=Li(),void 0===t?n:Ni(n,t)};lr[Di]=!0;var Ui,xi,Vi,Fi=function(e,t,n,r){r&&r.enumerable?e[t]=n:Qn(e,t,n)},Bi=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:Fi(e,r,t[r],n);return e},ji=!gn(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),Gi=ci("IE_PROTO"),Hi=Object.prototype,Wi=ji?Object.getPrototypeOf:function(e){return e=Yr(e),Dn(e,Gi)?e[Gi]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Hi:null},Ki=(Rr("iterator"),!1);[].keys&&("next"in(Vi=[].keys())?(xi=Wi(Wi(Vi)))!==Object.prototype&&(Ui=xi):Ki=!0),null==Ui&&(Ui={});var Yi=Ui,qi=Ki,zi=function(){return this},Xi=(Object.setPrototypeOf||"__proto__"in{}&&function(){try{Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set.call({},[])}catch(e){}}(),Yi),Qi=Rr("iterator"),Ji=function(){return this},$i=function(e,t,n,r,i,s,o){var a,c,l;!function(e,t,n){t+=" Iterator",e.prototype=Mi(Yi,{next:Rn(1,n)}),Kr(e,t,!1,!0),yr[t]=zi}(n,t,r),r=function(e){if(e===i&&f)return f;if(!qi&&e in h)return h[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}};var u=t+" Iterator",d=!1,h=e.prototype,p=h[Qi]||h["@@iterator"]||i&&h[i],f=!qi&&p||r(i),_="Array"==t&&h.entries||p;if(_&&(a=Wi(_.call(new e)),Xi!==Object.prototype&&a.next&&(Kr(a,u,!0,!0),yr[u]=Ji)),"values"==i&&p&&"values"!==p.name&&(d=!0,f=function(){return p.call(this)}),o&&h[Qi]!==f&&Qn(h,Qi,f),yr[t]=f,i)if(c={values:r("values"),keys:s?f:r("keys"),entries:r("entries")},o)for(l in c)!qi&&!d&&l in h||Fi(h,l,c[l]);else Zn({target:t,proto:!0,forced:qi||d},c);return c},Zi=Rr("species"),es=function(e){e=tr(e),En&&e&&!e[Zi]&&(0,Xn.f)(e,Zi,{configurable:!0,get:function(){return this}})},ts=Xn.f,ns=fr.fastKey,rs=gi.set,is=gi.getterFor,ss=(function(e,t,n){var r=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),s=r?"set":"add",o=mn[e],a=o&&o.prototype,c={};if(En&&"function"==typeof o&&(i||a.forEach&&!gn(function(){(new o).entries().next()}))){var l=t(function(t,n){vi(jr(t,l,e),{type:e,collection:new o}),null!=n&&Br(n,t[s],t,r)}),u=Si(e);$r("add clear delete forEach get has set keys values entries".split(" "),function(e){var t="add"==e||"set"==e;!(e in a)||i&&"clear"==e||Qn(l.prototype,e,function(n,r){var s=u(this).collection;return t||!i||On(n)?(n=s[e](0===n?0:n,r),t?this:n):"get"==e&&void 0})}),i||Ei(l.prototype,"size",{configurable:!0,get:function(){return u(this).collection.size}})}else l=n.getConstructor(t,e,r,s),fr.REQUIRED=!0;Kr(l,e,!1,!0),c[e]=l,Zn({global:!0,forced:!0},c),i||n.setStrong(l,e,r)}("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(e,t,n,r){var i=e(function(e,s){jr(e,i,t),rs(e,{type:t,index:Mi(null),first:void 0,last:void 0,size:0}),En||(e.size=0),null!=s&&Br(s,e[r],e,n)}),s=is(t),o=function(e,t,n){var r,i,o=s(e),c=a(e,t);return c?c.value=n:(o.last=c={index:i=ns(t,!0),key:t,value:n,previous:r=o.last,next:void 0,removed:!1},o.first||(o.first=c),r&&(r.next=c),En?o.size++:e.size++,"F"!==i&&(o.index[i]=c)),e},a=function(e,t){e=s(e);var n=ns(t);if("F"!==n)return e.index[n];for(e=e.first;e;e=e.next)if(e.key==t)return e};return Bi(i.prototype,{clear:function(){for(var e=s(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,En?e.size=0:this.size=0},delete:function(e){var t=s(this);if(e=a(this,e)){var n=e.next,r=e.previous;delete t.index[e.index],e.removed=!0,r&&(r.next=n),n&&(n.previous=r),t.first==e&&(t.first=n),t.last==e&&(t.last=r),En?t.size--:this.size--}return!!e},forEach:function(e){for(var t,n=s(this),r=Yn(e,1<arguments.length?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!a(this,e)}}),Bi(i.prototype,n?{get:function(e){return(e=a(this,e))&&e.value},set:function(e,t){return o(this,0===e?0:e,t)}}:{add:function(e){return o(this,e=0===e?0:e,e)}}),En&&ts(i.prototype,"size",{get:function(){return s(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=is(t),s=is(r);$i(e,t,function(e,t){rs(this,{type:r,target:e,state:i(e),kind:t,last:void 0})},function(){for(var e=s(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})},n?"entries":"values",!n,!0),es(t)}}),function(e){return function(t,n){var r,i;t=String(wn(t)),n=Or(n);var s=t.length;return 0>n||n>=s?e?"":void 0:55296>(r=t.charCodeAt(n))||56319<r||n+1===s||56320>(i=t.charCodeAt(n+1))||57343<i?e?t.charAt(n):r:e?t.slice(n,n+2):i-56320+(r-55296<<10)+65536}}),os=(ss(!1),ss(!0)),as=gi.set,cs=gi.getterFor("String Iterator");$i(String,"String",function(e){as(this,{type:"String Iterator",string:String(e),index:0})},function(){var e,t=cs(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=os(n,r),t.index+=e.length,{value:e,done:!1})});var ls=gi.set,us=gi.getterFor("Array Iterator");$i(Array,"Array",function(e,t){ls(this,{type:"Array Iterator",target:bn(e),index:0,kind:t})},function(){var e=us(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}},"values"),yr.Arguments=yr.Array;var ds,hs=Rr("toStringTag");for(ds in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var ps=mn[ds],fs=ps&&ps.prototype;fs&&!fs[hs]&&Qn(fs,hs,ds),yr[ds]=yr.Array}var _s=Wn.Map,ms=Rr("match"),gs=function(e){var t;if(On(e)&&(void 0!==(t=e[ms])?t:"RegExp"==In(e)))throw TypeError("The method doesn't accept regular expressions");return e},Es=Rr("match"),vs=function(e){var t=/./;try{"/./"[e](t)}catch(gl){try{return t[Es]=!1,"/./"[e](t)}catch(n){}}return!1},Ss="".endsWith,Ts=Math.min,Rs=vs("endsWith");Zn({target:"String",proto:!0,forced:!Rs},{endsWith:function(e){var t=String(wn(this));gs(e);var n=1<arguments.length?arguments[1]:void 0,r=kr(t.length);return n=void 0===n?r:Ts(kr(n),r),r=String(e),Ss?Ss.call(t,r,n):t.slice(n-r.length,n)===r}});var ys=function(e){return Wn[e+"Prototype"]},Is=ys("String").endsWith,Cs=String.prototype,As=function(e){var t=e.endsWith;return"string"==typeof e||e===Cs||e instanceof String&&t===Cs.endsWith?Is:t},ws=function(e,t){var n=[][e];return!n||!gn(function(){n.call(null,t||function(){throw 1},1)})},bs=ws("forEach")?function(e){return $r(this,e,1<arguments.length?arguments[1]:void 0)}:[].forEach;Zn({target:"Array",proto:!0,forced:[].forEach!=bs},{forEach:bs});var Os=ys("Array").forEach,Ns=Array.prototype,ks={DOMTokenList:!0,NodeList:!0},Ds=function(e){var t=e.forEach;return e===Ns||e instanceof Array&&t===Ns.forEach||ks.hasOwnProperty(Ur(e))?Os:t},Ps={f:Object.getOwnPropertySymbols},Ls=Object.assign,Ms=!Ls||gn(function(){var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach(function(e){t[e]=e}),7!=Ls({},e)[n]||"abcdefghijklmnopqrst"!=Oi(Ls({},t)).join("")})?function(e,t){for(var n=Yr(e),r=arguments.length,i=1,s=Ps.f,o=Tn;r>i;)for(var a,c=An(arguments[i++]),l=s?Oi(c).concat(s(c)):Oi(c),u=l.length,d=0;u>d;)a=l[d++],En&&!o.call(c,a)||(n[a]=c[a]);return n}:Ls;Zn({target:"Object",stat:!0,forced:Object.assign!==Ms},{assign:Ms});var Us=Wn.Object.assign,xs=gn(function(){Oi(1)});Zn({target:"Object",stat:!0,forced:xs},{keys:function(e){return Oi(Yr(e))}});var Vs=Wn.Object.keys,Fs=function(e){return function(t,n,r,i){Kn(n),t=Yr(t);var s=An(t),o=kr(t.length),a=e?o-1:0,c=e?-1:1;if(2>r)for(;;){if(a in s){i=s[a],a+=c;break}if(a+=c,e?0>a:o<=a)throw TypeError("Reduce of empty array with no initial value")}for(;e?0<=a:o>a;a+=c)a in s&&(i=n(i,s[a],a,t));return i}},Bs=[Fs(!1),Fs(!0)][0];Zn({target:"Array",proto:!0,forced:ws("reduce")},{reduce:function(e){return Bs(this,e,arguments.length,1<arguments.length?arguments[1]:void 0)}});var js=ys("Array").reduce,Gs=Array.prototype,Hs=function(e){var t=e.reduce;return e===Gs||e instanceof Array&&t===Gs.reduce?js:t};Zn({target:"Object",stat:!0,forced:!En,sham:!En},{defineProperty:Xn.f});var Ws=e(function(e){var t=Wn.Object;e=e.exports=function(e,n,r){return t.defineProperty(e,n,r)},t.defineProperty.sham&&(e.sham=!0)}),Ks=Ws,Ys=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,qs=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,zs=function(e){return function(t){return t=String(wn(t)),1&e&&(t=t.replace(Ys,"")),2&e&&(t=t.replace(qs,"")),t}};zs(1),zs(2);var Xs=zs(3),Qs=mn.parseInt,Js=/^[+-]?0[Xx]/,$s=8!==Qs("\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff08")||22!==Qs("\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff0x16")?function(e,t){return e=Xs(String(e)),Qs(e,t>>>0||(Js.test(e)?16:10))}:Qs;Zn({global:!0,forced:parseInt!=$s},{parseInt:$s});var Zs=Wn.parseInt;let eo=!0,to=!0;var no=xn,ro=gn(function(){no(1)});Zn({target:"Object",stat:!0,forced:!En||ro,sham:!En},{getOwnPropertyDescriptor:function(e,t){return no(bn(e),t)}});var io,so,oo=e(function(e){var t=Wn.Object;e=e.exports=function(e,n){return t.getOwnPropertyDescriptor(e,n)},t.getOwnPropertyDescriptor.sham&&(e.sham=!0)}),ao=function(e,t,n){(t=Nn(t))in e?Xn.f(e,t,Rn(0,n)):e[t]=n},co=tr("navigator","userAgent")||"",lo=mn.process,uo=lo&&lo.versions,ho=uo&&uo.v8;ho?so=(io=ho.split("."))[0]+io[1]:co&&(!(io=co.match(/Edge\/(\d+)/))||74<=io[1])&&(io=co.match(/Chrome\/(\d+)/))&&(so=io[1]);var po=so&&+so,fo=Rr("species"),_o=function(e){return 51<=po||!gn(function(){var t=[];return(t.constructor={})[fo]=function(){return{foo:1}},1!==t[e](Boolean).foo})},mo=Rr("isConcatSpreadable"),go=51<=po||!gn(function(){var e=[];return e[mo]=!1,e.concat()[0]!==e}),Eo=_o("concat");Zn({target:"Array",proto:!0,forced:!go||!Eo},{concat:function(e){var t,n,r=Yr(this),i=Xr(r,0),s=0,o=-1;for(t=arguments.length;o<t;o++){var a=n=-1===o?r:arguments[o];if(On(a)){var c=a[mo];a=void 0!==c?!!c:qr(a)}else a=!1;if(a){if(9007199254740991<s+(c=kr(n.length)))throw TypeError("Maximum allowed index exceeded");for(a=0;a<c;a++,s++)a in n&&ao(i,s,n[a])}else{if(9007199254740991<=s)throw TypeError("Maximum allowed index exceeded");ao(i,s++,n)}}return i.length=s,i}});var vo=ys("Array").concat,So=Array.prototype,To=function(e){var t=e.concat;return e===So||e instanceof Array&&t===So.concat?vo:t};Zn({target:"Array",proto:!0,forced:!_o("filter")},{filter:function(e){return ei(this,e,1<arguments.length?arguments[1]:void 0)}});var Ro=ys("Array").filter,yo=Array.prototype,Io=function(e){var t=e.filter;return e===yo||e instanceof Array&&t===yo.filter?Ro:t},Co=mn.Promise,Ao=Rr("iterator"),wo=!1;try{var bo=0,Oo={next:function(){return{done:!!bo++}},return:function(){wo=!0}};Oo[Ao]=function(){return this},Array.from(Oo,function(){throw 2})}catch(Uc){}var No,ko,Do,Po=function(e,t){if(!t&&!wo)return!1;var n=!1;try{(t={})[Ao]=function(){return{next:function(){return{done:n=!0}}}},e(t)}catch(r){}return n},Lo=Rr("species"),Mo=function(e,t){var n;return void 0===(e=qn(e).constructor)||null==(n=qn(e)[Lo])?t:Kn(n)},Uo=/(iphone|ipod|ipad).*applewebkit/i.test(co),xo=mn.location,Vo=mn.setImmediate,Fo=mn.clearImmediate,Bo=mn.process,jo=mn.MessageChannel,Go=mn.Dispatch,Ho=0,Wo={},Ko=function(e){if(Wo.hasOwnProperty(e)){var t=Wo[e];delete Wo[e],t()}},Yo=function(e){return function(){Ko(e)}},qo=function(e){Ko(e.data)},zo=function(e){mn.postMessage(e+"",xo.protocol+"//"+xo.host)};Vo&&Fo||(Vo=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return Wo[++Ho]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},No(Ho),Ho},Fo=function(e){delete Wo[e]},"process"==In(Bo)?No=function(e){Bo.nextTick(Yo(e))}:Go&&Go.now?No=function(e){Go.now(Yo(e))}:jo&&!Uo?(Do=(ko=new jo).port2,ko.port1.onmessage=qo,No=Yn(Do.postMessage,Do,1)):!mn.addEventListener||"function"!=typeof postMessage||mn.importScripts||gn(zo)?No="onreadystatechange"in(Ln?Pn.createElement("script"):{})?function(e){ki.appendChild(Ln?Pn.createElement("script"):{}).onreadystatechange=function(){ki.removeChild(this),Ko(e)}}:function(e){setTimeout(Yo(e),0)}:(No=zo,mn.addEventListener("message",qo,!1)));var Xo,Qo,Jo,$o,Zo,ea,ta,na,ra=Vo,ia=xn,sa=mn.MutationObserver||mn.WebKitMutationObserver,oa=mn.process,aa=mn.Promise,ca="process"==In(oa),la=ia(mn,"queueMicrotask"),ua=la&&la.value;ua||(Xo=function(){var e;for(ca&&(e=oa.domain)&&e.exit();Qo;){var t=Qo.fn;Qo=Qo.next;try{t()}catch(gl){throw Qo?$o():Jo=void 0,gl}}Jo=void 0,e&&e.enter()},ca?$o=function(){oa.nextTick(Xo)}:sa&&!Uo?(Zo=!0,ea=document.createTextNode(""),new sa(Xo).observe(ea,{characterData:!0}),$o=function(){ea.data=Zo=!Zo}):aa&&aa.resolve?(ta=aa.resolve(void 0),na=ta.then,$o=function(){na.call(ta,Xo)}):$o=function(){ra.call(mn,Xo)});var da,ha,pa=ua||function(e){e={fn:e,next:void 0},Jo&&(Jo.next=e),Qo||(Qo=e,$o()),Jo=e},fa=function(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=Kn(t),this.reject=Kn(n)},_a={f:function(e){return new fa(e)}},ma=function(e,t){return qn(e),On(t)&&t.constructor===e?t:((0,(e=_a.f(e)).resolve)(t),e.promise)},ga=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Ea=Rr("species"),va=gi.get,Sa=gi.set,Ta=gi.getterFor("Promise"),Ra=Co,ya=mn.TypeError,Ia=mn.document,Ca=mn.process,Aa=mr("inspectSource"),wa=(tr("fetch"),_a.f),ba=wa,Oa="process"==In(Ca),Na=!!(Ia&&Ia.createEvent&&mn.dispatchEvent),ka=Fn("Promise",function(){if(Aa(Ra)===String(Ra)&&(66===po||!Oa&&"function"!=typeof PromiseRejectionEvent)||!Ra.prototype.finally)return!0;if(51<=po&&/native code/.test(Ra))return!1;var e=Ra.resolve(1),t=function(e){e(function(){},function(){})};return(e.constructor={})[Ea]=t,!(e.then(function(){})instanceof t)}),Da=ka||!Po(function(e){Ra.all(e).catch(function(){})}),Pa=function(e){var t;return!(!On(e)||"function"!=typeof(t=e.then))&&t},La=function(e,t,n){if(!t.notified){t.notified=!0;var r=t.reactions;pa(function(){for(var i=t.value,s=1==t.state,o=0;r.length>o;){var a,c,l,u=r[o++],d=s?u.ok:u.fail,h=u.resolve,p=u.reject,f=u.domain;try{d?(s||(2===t.rejection&&xa(e,t),t.rejection=1),!0===d?a=i:(f&&f.enter(),a=d(i),f&&(f.exit(),l=!0)),a===u.promise?p(ya("Promise-chain cycle")):(c=Pa(a))?c.call(a,h,p):h(a)):p(i)}catch(_){f&&!l&&f.exit(),p(_)}}t.reactions=[],t.notified=!1,n&&!t.rejection&&Ua(e,t)})}},Ma=function(e,t,n){var r,i;Na?((r=Ia.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),mn.dispatchEvent(r)):r={promise:t,reason:n},(i=mn["on"+e])?i(r):"unhandledrejection"===e&&function(e,t){var n=mn.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}("Unhandled promise rejection",n)},Ua=function(e,t){ra.call(mn,function(){var n,r=t.value;if(1!==t.rejection&&!t.parent&&(n=ga(function(){Oa?Ca.emit("unhandledRejection",r,e):Ma("unhandledrejection",e,r)}),t.rejection=Oa||1!==t.rejection&&!t.parent?2:1,n.error))throw n.value})},xa=function(e,t){ra.call(mn,function(){Oa?Ca.emit("rejectionHandled",e):Ma("rejectionhandled",e,t.value)})},Va=function(e,t,n,r){return function(i){e(t,n,i,r)}},Fa=function(e,t,n,r){t.done||(t.done=!0,r&&(t=r),t.value=n,t.state=2,La(e,t,!0))},Ba=function(e,t,n,r){if(!t.done){t.done=!0,r&&(t=r);try{if(e===n)throw ya("Promise can't be resolved itself");var i=Pa(n);i?pa(function(){var r={done:!1};try{i.call(n,Va(Ba,e,r,t),Va(Fa,e,r,t))}catch(s){Fa(e,r,s,t)}}):(t.value=n,t.state=1,La(e,t,!1))}catch(s){Fa(e,{done:!1},s,t)}}};ka&&(Ra=function(e){jr(this,Ra,"Promise"),Kn(e),da.call(this);var t=va(this);try{e(Va(Ba,this,t),Va(Fa,this,t))}catch(gl){Fa(this,t,gl)}},(da=function(e){Sa(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=Bi(Ra.prototype,{then:function(e,t){var n=Ta(this),r=wa(Mo(this,Ra));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=Oa?Ca.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&La(this,n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),ha=function(){var e=new da,t=va(e);this.promise=e,this.resolve=Va(Ba,e,t),this.reject=Va(Fa,e,t)},_a.f=wa=function(e){return e===Ra||e===ja?new ha(e):ba(e)}),Zn({global:!0,wrap:!0,forced:ka},{Promise:Ra}),Kr(Ra,"Promise",!1,!0),es("Promise");var ja=tr("Promise");Zn({target:"Promise",stat:!0,forced:ka},{reject:function(e){var t=wa(this);return t.reject.call(void 0,e),t.promise}}),Zn({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return ma(this===ja?Ra:this,e)}}),Zn({target:"Promise",stat:!0,forced:Da},{all:function(e){var t=this,n=wa(t),r=n.resolve,i=n.reject,s=ga(function(){var n=Kn(t.resolve),s=[],o=0,a=1;Br(e,function(e){var c=o++,l=!1;s.push(void 0),a++,n.call(t,e).then(function(e){l||(l=!0,s[c]=e,--a||r(s))},i)}),--a||r(s)});return s.error&&i(s.value),n.promise},race:function(e){var t=this,n=wa(t),r=n.reject,i=ga(function(){var i=Kn(t.resolve);Br(e,function(e){i.call(t,e).then(n.resolve,r)})});return i.error&&r(i.value),n.promise}}),Zn({target:"Promise",stat:!0},{allSettled:function(e){var t=this,n=_a.f(t),r=n.resolve,i=n.reject,s=ga(function(){var n=Kn(t.resolve),i=[],s=0,o=1;Br(e,function(e){var a=s++,c=!1;i.push(void 0),o++,n.call(t,e).then(function(e){c||(c=!0,i[a]={status:"fulfilled",value:e},--o||r(i))},function(e){c||(c=!0,i[a]={status:"rejected",reason:e},--o||r(i))})}),--o||r(i)});return s.error&&i(s.value),n.promise}}),Zn({target:"Promise",proto:!0,real:!0},{finally:function(e){var t=Mo(this,tr("Promise")),n="function"==typeof e;return this.then(n?function(n){return ma(t,e()).then(function(){return n})}:e,n?function(n){return ma(t,e()).then(function(){throw n})}:e)}});var Ga=Wn.Promise;Zn({target:"Array",proto:!0,forced:!_o("map")},{map:function(e){return Zr(this,e,1<arguments.length?arguments[1]:void 0)}});var Ha=ys("Array").map,Wa=Array.prototype,Ka=function(e){var t=e.map;return e===Wa||e instanceof Array&&t===Wa.map?Ha:t},Ya=Math.max,qa=Math.min;Zn({target:"Array",proto:!0,forced:!_o("splice")},{splice:function(e,t){var n,r,i,s,o=Yr(this),a=kr(o.length),c=yi(e,a),l=arguments.length;if(0===l?n=r=0:1===l?(n=0,r=a-c):(n=l-2,r=qa(Ya(Or(t),0),a-c)),9007199254740991<a+n-r)throw TypeError("Maximum allowed length exceeded");for(l=Xr(o,r),i=0;i<r;i++)(s=c+i)in o&&ao(l,i,o[s]);if(l.length=r,n<r){for(i=c;i<a-r;i++){var u=i+n;(s=i+r)in o?o[u]=o[s]:delete o[u]}for(i=a;i>a-r+n;i--)delete o[i-1]}else if(n>r)for(i=a-r;i>c;i--)u=i+n-1,(s=i+r-1)in o?o[u]=o[s]:delete o[u];for(i=0;i<n;i++)o[i+c]=arguments[i+2];return o.length=a-r+n,l}});var za=ys("Array").splice,Xa=Array.prototype,Qa=function(e){var t=e.splice;return e===Xa||e instanceof Array&&t===Xa.splice?za:t},Ja=[].indexOf,$a=!!Ja&&0>1/[1].indexOf(1,-0),Za=ws("indexOf");Zn({target:"Array",proto:!0,forced:$a||Za},{indexOf:function(e){return $a?Ja.apply(this,arguments)||0:Ai(this,e,1<arguments.length?arguments[1]:void 0)}});var ec=ys("Array").indexOf,tc=Array.prototype,nc=function(e){var t=e.indexOf;return e===tc||e instanceof Array&&t===tc.indexOf?ec:t},rc=Rr("species"),ic=[].slice,sc=Math.max;Zn({target:"Array",proto:!0,forced:!_o("slice")},{slice:function(e,t){var n,r=bn(this),i=kr(r.length);if(e=yi(e,i),t=yi(void 0===t?i:t,i),qr(r)&&("function"!=typeof(n=r.constructor)||n!==Array&&!qr(n.prototype)?On(n)&&null===(n=n[rc])&&(n=void 0):n=void 0,n===Array||void 0===n))return ic.call(r,e,t);for(n=new(void 0===n?Array:n)(sc(t-e,0)),i=0;e<t;e++,i++)e in r&&ao(n,i,r[e]);return n.length=i,n}});var oc=ys("Array").slice,ac=Array.prototype,cc=function(e){var t=e.slice;return e===ac||e instanceof Array&&t===ac.slice?oc:t},lc=!0;"find"in[]&&Array(1).find(function(){lc=!1}),Zn({target:"Array",proto:!0,forced:lc},{find:function(e){return ni(this,e,1<arguments.length?arguments[1]:void 0)}});var uc=ys("Array").find,dc=Array.prototype,hc=function(e){var t=e.find;return e===dc||e instanceof Array&&t===dc.find?uc:t},pc=[].slice,fc={};Zn({target:"Function",proto:!0},{bind:Function.bind||function(e){var t=Kn(this),n=pc.call(arguments,1),r=function(){var i=n.concat(pc.call(arguments));if(this instanceof r){var s=i.length;if(!(s in fc)){for(var o=[],a=0;a<s;a++)o[a]="a["+a+"]";fc[s]=Function("C,a","return new C("+o.join(",")+")")}i=fc[s](t,i)}else i=t.apply(e,i);return i};return On(t.prototype)&&(r.prototype=t.prototype),r}});var _c=ys("Function").bind,mc=Function.prototype,gc=function(e){var t=e.bind;return e===mc||e instanceof Function&&t===mc.bind?_c:t};Zn({target:"Array",proto:!0},{includes:function(e){return Ci(this,e,1<arguments.length?arguments[1]:void 0)}});var Ec=ys("Array").includes;Zn({target:"String",proto:!0,forced:!vs("includes")},{includes:function(e){return!!~String(wn(this)).indexOf(gs(e),1<arguments.length?arguments[1]:void 0)}});var vc=ys("String").includes,Sc=Array.prototype,Tc=String.prototype,Rc=function(e){var t=e.includes;return e===Sc||e instanceof Array&&t===Sc.includes?Ec:"string"==typeof e||e===Tc||e instanceof String&&t===Tc.includes?vc:t};Zn({target:"Array",proto:!0,forced:ws("some")},{some:function(e){return ti(this,e,1<arguments.length?arguments[1]:void 0)}});var yc=ys("Array").some,Ic=Array.prototype,Cc=function(e){var t=e.some;return e===Ic||e instanceof Array&&t===Ic.some?yc:t};let Ac=s;var wc=Object.freeze({__proto__:null,shimMediaStream:d,shimOnTrack:h,shimGetSendersWithDtmf:p,shimGetStats:f,shimSenderReceiverGetStats:_,shimAddTrackRemoveTrackWithNative:m,shimAddTrackRemoveTrack:g,shimPeerConnection:E,fixNegotiationNeeded:v,shimGetUserMedia:u,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(t=>{let r=n.video&&n.video.width,i=n.video&&n.video.height;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:n.video&&n.video.frameRate||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}),bc="".startsWith,Oc=Math.min,Nc=vs("startsWith");Zn({target:"String",proto:!0,forced:!Nc},{startsWith:function(e){var t=String(wn(this));gs(e);var n=kr(Oc(1<arguments.length?arguments[1]:void 0,t.length)),r=String(e);return bc?bc.call(t,r,n):t.slice(n,n+r.length)===r}});var kc=ys("String").startsWith,Dc=String.prototype,Pc=function(e){var t=e.startsWith;return"string"==typeof e||e===Dc||e instanceof String&&t===Dc.startsWith?kc:t};Zn({target:"String",proto:!0,forced:gn(function(){return"trim"!=="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff".trim.name})},{trim:function(){return Xs(this)}});var Lc,Mc,Uc,xc=ys("String").trim,Vc=String.prototype,Fc=function(e){var t=e.trim;return"string"==typeof e||e===Vc||e instanceof String&&t===Vc.trim?xc:t},Bc=e(function(e){var t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){var t;return Ka(t=Fc(e).call(e).split("\n")).call(t,function(e){return Fc(e).call(e)})},t.splitSections=function(e){return e=e.split("\nm="),Ka(e).call(e,function(e,t){var n;return Fc(n=0<t?"m="+e:e).call(n)+"\r\n"})},t.getDescription=function(e){return(e=t.splitSections(e))&&e[0]},t.getMediaSections=function(e){return(e=t.splitSections(e)).shift(),e},t.matchPrefix=function(e,n){var r;return Io(r=t.splitLines(e)).call(r,function(e){return 0===nc(e).call(e,n)})},t.parseCandidate=function(e){var t;e={foundation:(t=0===nc(e).call(e,"a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:Zs(t[1],10),protocol:t[2].toLowerCase(),priority:Zs(t[3],10),ip:t[4],address:t[4],port:Zs(t[5],10),type:t[7]};for(var n=8;n<t.length;n+=2)switch(t[n]){case"raddr":e.relatedAddress=t[n+1];break;case"rport":e.relatedPort=Zs(t[n+1],10);break;case"tcptype":e.tcpType=t[n+1];break;case"ufrag":e.ufrag=t[n+1],e.usernameFragment=t[n+1];break;default:e[t[n]]=t[n+1]}return e},t.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){e=e.substr(9).split(" ");var t={payloadType:Zs(e.shift(),10)};return e=e[0].split("/"),t.name=e[0],t.clockRate=Zs(e[1],10),t.channels=3===e.length?Zs(e[2],10):1,t.numChannels=t.channels,t},t.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){var t;return e=e.substr(9).split(" "),{id:Zs(e[0],10),direction:0<nc(t=e[0]).call(t,"/")?e[0].split("/")[1]:"sendrecv",uri:e[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){for(var t={},n=e.substr(nc(e).call(e," ")+1).split(";"),r=0;r<n.length;r++){var i,s;e=Fc(i=n[r]).call(i).split("="),t[Fc(s=e[0]).call(s)]=e[1]}return t},t.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Vs(e.parameters).length){var r,i=[];Ds(r=Vs(e.parameters)).call(r,function(t){i.push(e.parameters[t]?t+"="+e.parameters[t]:t)}),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){return{type:(e=e.substr(nc(e).call(e," ")+1).split(" ")).shift(),parameter:e.join(" ")}},t.writeRtcpFb=function(e){var t,n="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&Ds(t=e.rtcpFeedback).call(t,function(e){n+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),n},t.parseSsrcMedia=function(e){var t=nc(e).call(e," "),n={ssrc:Zs(e.substr(7,t-7),10)},r=nc(e).call(e,":",t);return-1<r?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},t.parseSsrcGroup=function(e){return{semantics:(e=e.substr(13).split(" ")).shift(),ssrcs:Ka(e).call(e,function(e){return Zs(e,10)})}},t.getMid=function(e){if(e=t.matchPrefix(e,"a=mid:")[0])return e.substr(6)},t.parseFingerprint=function(e){return{algorithm:(e=e.substr(14).split(" "))[0].toLowerCase(),value:e[1]}},t.getDtlsParameters=function(e,n){return e=t.matchPrefix(e+n,"a=fingerprint:"),{role:"auto",fingerprints:Ka(e).call(e,t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){var n,r="a=setup:"+t+"\r\n";return Ds(n=e.fingerprints).call(n,function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},t.getIceParameters=function(e,n){return e=t.splitLines(e),e=To(e).call(e,t.splitLines(n)),{usernameFragment:Io(e).call(e,function(e){return 0===nc(e).call(e,"a=ice-ufrag:")})[0].substr(12),password:Io(e).call(e,function(e){return 0===nc(e).call(e,"a=ice-pwd:")})[0].substr(10)}},t.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},t.parseRtpParameters=function(e){for(var n,r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" "),s=3;s<i.length;s++){var o=i[s],a=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var c;a=t.parseRtpMap(a);var l=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(a.parameters=l.length?t.parseFmtp(l[0]):{},a.rtcpFeedback=Ka(c=t.matchPrefix(e,"a=rtcp-fb:"+o+" ")).call(c,t.parseRtcpFb),r.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(a.name.toUpperCase())}}}return Ds(n=t.matchPrefix(e,"a=extmap:")).call(n,function(e){r.headerExtensions.push(t.parseExtmap(e))}),r},t.writeRtpDescription=function(e,n){var r,i,s,o="";o+="m="+e+" ",o+=0<n.codecs.length?"9":"0",o+=" UDP/TLS/RTP/SAVPF ",o+=Ka(r=n.codecs).call(r,function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",o+="c=IN IP4 0.0.0.0\r\n",o+="a=rtcp:9 IN IP4 0.0.0.0\r\n",Ds(i=n.codecs).call(i,function(e){o+=t.writeRtpMap(e),o+=t.writeFmtp(e),o+=t.writeRtcpFb(e)});var a,c=0;return Ds(s=n.codecs).call(s,function(e){e.maxptime>c&&(c=e.maxptime)}),0<c&&(o+="a=maxptime:"+c+"\r\n"),o+="a=rtcp-mux\r\n",n.headerExtensions&&Ds(a=n.headerExtensions).call(a,function(e){o+=t.writeExtmap(e)}),o},t.parseRtpEncodingParameters=function(e){var n,r,i,s,o,a,c,l=[],u=t.parseRtpParameters(e),d=-1!==nc(n=u.fecMechanisms).call(n,"RED"),h=-1!==nc(r=u.fecMechanisms).call(r,"ULPFEC"),p=0<(n=Io(i=Ka(s=t.matchPrefix(e,"a=ssrc:")).call(s,function(e){return t.parseSsrcMedia(e)})).call(i,function(e){return"cname"===e.attribute})).length&&n[0].ssrc;0<(i=Ka(o=t.matchPrefix(e,"a=ssrc-group:FID")).call(o,function(e){return e=e.substr(17).split(" "),Ka(e).call(e,function(e){return Zs(e,10)})})).length&&1<i[0].length&&i[0][0]===p&&(c=i[0][1]),Ds(a=u.codecs).call(a,function(e){"RTX"===e.name.toUpperCase()&&e.parameters.apt&&(e={ssrc:p,codecPayloadType:Zs(e.parameters.apt,10)},p&&c&&(e.rtx={ssrc:c}),l.push(e),d&&((e=JSON.parse(cr(e))).fec={ssrc:p,mechanism:h?"red+ulpfec":"red"},l.push(e)))}),0===l.length&&p&&l.push({ssrc:p});var f,_,m=t.matchPrefix(e,"b=");return m.length&&(m=0===nc(f=m[0]).call(f,"b=TIAS:")?Zs(m[0].substr(7),10):0===nc(_=m[0]).call(_,"b=AS:")?950*Zs(m[0].substr(5),10)-16e3:void 0,Ds(l).call(l,function(e){e.maxBitrate=m})),l},t.parseRtcpParameters=function(e){var n,r,i={},s=Io(n=Ka(r=t.matchPrefix(e,"a=ssrc:")).call(r,function(e){return t.parseSsrcMedia(e)})).call(n,function(e){return"cname"===e.attribute})[0];return s&&(i.cname=s.value,i.ssrc=s.ssrc),n=t.matchPrefix(e,"a=rtcp-rsize"),i.reducedSize=0<n.length,i.compound=0===n.length,e=t.matchPrefix(e,"a=rtcp-mux"),i.mux=0<e.length,i},t.parseMsid=function(e){var n,r,i,s=t.matchPrefix(e,"a=msid:");return 1===s.length?{stream:(i=s[0].substr(7).split(" "))[0],track:i[1]}:0<(e=Io(n=Ka(r=t.matchPrefix(e,"a=ssrc:")).call(r,function(e){return t.parseSsrcMedia(e)})).call(n,function(e){return"msid"===e.attribute})).length?{stream:(i=e[0].value.split(" "))[0],track:i[1]}:void 0},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,n,r){return n=void 0!==n?n:2,"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||t.generateSessionId())+" "+n+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.writeMediaSection=function(e,n,r,i){return n=t.writeRtpDescription(e.kind,n),n+=t.writeIceParameters(e.iceGatherer.getLocalParameters()),n+=t.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),n+="a=mid:"+e.mid+"\r\n",n+=e.direction?"a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender&&(n=n+"a="+(r="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n")+"a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+r,e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+r,n+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")),n+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+t.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+t.localCName+"\r\n"),n},t.getDirection=function(e,n){e=t.splitLines(e);for(var r=0;r<e.length;r++)switch(e[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return e[r].substr(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){return{kind:(e=t.splitLines(e)[0].substr(2).split(" "))[0],port:Zs(e[1],10),protocol:e[2],fmt:cc(e).call(e,3).join(" ")}},t.parseOLine=function(e){return{username:(e=t.matchPrefix(e,"o=")[0].substr(2).split(" "))[0],sessionId:e[1],sessionVersion:Zs(e[2],10),netType:e[3],addressType:e[4],address:e[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;e=t.splitLines(e);for(var n=0;n<e.length;n++)if(2>e[n].length||"="!==e[n].charAt(1))return!1;return!0},e.exports=t}),jc=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function r(t,n,r,i){var s=new Event("track");s.track=n,s.receiver=r,s.transceiver={receiver:r},s.streams=i,e.setTimeout(function(){t._dispatchEvent("track",s)})}var i=function(n){var r=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){r[e]=i[e].bind(i)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw I("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&14393<=t&&-1===e.indexOf("?transport=udp"):(n=!0,!0)}),delete e.url,e.urls=i?r[0]:r,!!r.length}})}(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var s=n.iceCandidatePoolSize;0<s;s--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=Bc.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(i.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(i.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),i.prototype.onicecandidate=null,i.prototype.onaddstream=null,i.prototype.ontrack=null,i.prototype.onremovestream=null,i.prototype.onsignalingstatechange=null,i.prototype.oniceconnectionstatechange=null,i.prototype.onconnectionstatechange=null,i.prototype.onicegatheringstatechange=null,i.prototype.onnegotiationneeded=null,i.prototype.ondatachannel=null,i.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},i.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},i.prototype.getConfiguration=function(){return this._config},i.prototype.getLocalStreams=function(){return this.localStreams},i.prototype.getRemoteStreams=function(){return this.remoteStreams},i.prototype._createTransceiver=function(e,t){var n=0<this.transceivers.length;return e={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0},this.usingBundle&&n?(e.iceTransport=this.transceivers[0].iceTransport,e.dtlsTransport=this.transceivers[0].dtlsTransport):(n=this._createIceAndDtlsTransports(),e.iceTransport=n.iceTransport,e.dtlsTransport=n.dtlsTransport),t||this.transceivers.push(e),e},i.prototype.addTrack=function(t,n){if(this._isClosed)throw I("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find(function(e){return e.track===t}))throw I("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(r=this.transceivers[i]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},i.prototype.addStream=function(e){var n=this;if(15025<=t)e.getTracks().forEach(function(t){n.addTrack(t,e)});else{var r=e.clone();e.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),r.getTracks().forEach(function(e){n.addTrack(e,r)})}},i.prototype.removeTrack=function(t){if(this._isClosed)throw I("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find(function(e){return e.rtpSender===t});if(!n)throw I("InvalidAccessError","Sender was not created by this connection.");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(r)&&-1<this.localStreams.indexOf(r)&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},i.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var n=t.getSenders().find(function(t){return t.track===e});n&&t.removeTrack(n)})},i.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},i.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},i.prototype._createIceGatherer=function(t,n){var r=this;if(n&&0<t)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},i.prototype._gather=function(t,n){var r=this,i=this.transceivers[n].iceGatherer;if(!i.onlocalcandidate){var s=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,i.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),i.onlocalcandidate=function(e){if(!(r.usingBundle&&0<n)){var s=new Event("icecandidate");s.candidate={sdpMid:t,sdpMLineIndex:n};var o=e.candidate;(e=!o||0===Object.keys(o).length)?"new"!==i.state&&"gathering"!==i.state||(i.state="completed"):("new"===i.state&&(i.state="gathering"),o.component=1,o.ufrag=i.getLocalParameters().usernameFragment,o=Bc.writeCandidate(o),s.candidate=Object.assign(s.candidate,Bc.parseCandidate(o)),s.candidate.candidate=o,s.candidate.toJSON=function(){return{candidate:s.candidate.candidate,sdpMid:s.candidate.sdpMid,sdpMLineIndex:s.candidate.sdpMLineIndex,usernameFragment:s.candidate.usernameFragment}}),(o=Bc.getMediaSections(r._localDescription.sdp))[s.candidate.sdpMLineIndex]+=e?"a=end-of-candidates\r\n":"a="+s.candidate.candidate+"\r\n",r._localDescription.sdp=Bc.getDescription(r._localDescription.sdp)+o.join(""),o=r.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}),"gathering"!==r.iceGatheringState&&(r.iceGatheringState="gathering",r._emitGatheringStateChange()),e||r._dispatchEvent("icecandidate",s),o&&(r._dispatchEvent("icecandidate",new Event("icecandidate")),r.iceGatheringState="complete",r._emitGatheringStateChange())}},e.setTimeout(function(){s.forEach(function(e){i.onlocalcandidate(e)})},0)}},i.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},i.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer),(t=this.transceivers[e].iceTransport)&&(delete t.onicestatechange,delete this.transceivers[e].iceTransport),(t=this.transceivers[e].dtlsTransport)&&(delete t.ondtlsstatechange,delete t.onerror,delete this.transceivers[e].dtlsTransport)},i.prototype._transceive=function(e,n,r){var i=T(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:Bc.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),r&&e.rtpReceiver&&0<i.codecs.length&&("video"===e.kind&&e.recvEncodingParameters&&15019>t&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),i.encodings=e.recvEncodingParameters.length?e.recvEncodingParameters:[{}],i.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(i.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},i.prototype.setLocalDescription=function(e){var t=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(I("TypeError",'Unsupported type "'+e.type+'"'));if(!R("setLocalDescription",e.type,t.signalingState)||t._isClosed)return Promise.reject(I("InvalidStateError","Can not set local "+e.type+" in state "+t.signalingState));if("offer"===e.type){var n=Bc.splitSections(e.sdp),r=n.shift();n.forEach(function(e,n){e=Bc.parseRtpParameters(e),t.transceivers[n].localCapabilities=e}),t.transceivers.forEach(function(e,n){t._gather(e.mid,n)})}else if("answer"===e.type){n=Bc.splitSections(t._remoteDescription.sdp),r=n.shift();var i=0<Bc.matchPrefix(r,"a=ice-lite").length;n.forEach(function(e,n){var s=t.transceivers[n],o=s.iceGatherer,a=s.iceTransport,c=s.dtlsTransport,l=s.localCapabilities,u=s.remoteCapabilities;if(!(Bc.isRejected(e)&&0===Bc.matchPrefix(e,"a=bundle-only").length||s.rejected)){var d=Bc.getIceParameters(e,r);e=Bc.getDtlsParameters(e,r),i&&(e.role="server"),t.usingBundle&&0!==n||(t._gather(s.mid,n),"new"===a.state&&a.start(o,d,i?"controlling":"controlled"),"new"===c.state&&c.start(e)),n=T(l,u),t._transceive(s,0<n.codecs.length,!1)}})}return t._localDescription={type:e.type,sdp:e.sdp},t._updateSignalingState("offer"===e.type?"have-local-offer":"stable"),Promise.resolve()},i.prototype.setRemoteDescription=function(i){var s=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(I("TypeError",'Unsupported type "'+i.type+'"'));if(!R("setRemoteDescription",i.type,s.signalingState)||s._isClosed)return Promise.reject(I("InvalidStateError","Can not set remote "+i.type+" in state "+s.signalingState));var o={};s.remoteStreams.forEach(function(e){o[e.id]=e});var a=[],c=Bc.splitSections(i.sdp),l=c.shift(),u=0<Bc.matchPrefix(l,"a=ice-lite").length,d=0<Bc.matchPrefix(l,"a=group:BUNDLE ").length;s.usingBundle=d;var h=Bc.matchPrefix(l,"a=ice-options:")[0];return s.canTrickleIceCandidates=!!h&&0<=h.substr(14).split(" ").indexOf("trickle"),c.forEach(function(r,c){var h=Bc.splitLines(r),p=Bc.getKind(r),f=Bc.isRejected(r)&&0===Bc.matchPrefix(r,"a=bundle-only").length,_=h[0].substr(2).split(" ")[2];h=Bc.getDirection(r,l);var m=Bc.parseMsid(r),g=Bc.getMid(r)||Bc.generateIdentifier();if(f||"application"===p&&("DTLS/SCTP"===_||"UDP/DTLS/SCTP"===_))s.transceivers[c]={mid:g,kind:p,protocol:_,rejected:!0};else{var E,v;!f&&s.transceivers[c]&&s.transceivers[c].rejected&&(s.transceivers[c]=s._createTransceiver(p,!0));var S,R,I=Bc.parseRtpParameters(r);f||(S=Bc.getIceParameters(r,l),(R=Bc.getDtlsParameters(r,l)).role="client"),_=Bc.parseRtpEncodingParameters(r);var C=Bc.parseRtcpParameters(r),A=0<Bc.matchPrefix(r,"a=end-of-candidates",l).length;if(r=Bc.matchPrefix(r,"a=candidate:").map(function(e){return Bc.parseCandidate(e)}).filter(function(e){return 1===e.component}),("offer"===i.type||"answer"===i.type)&&!f&&d&&0<c&&s.transceivers[c]&&(s._disposeIceAndDtlsTransports(c),s.transceivers[c].iceGatherer=s.transceivers[0].iceGatherer,s.transceivers[c].iceTransport=s.transceivers[0].iceTransport,s.transceivers[c].dtlsTransport=s.transceivers[0].dtlsTransport,s.transceivers[c].rtpSender&&s.transceivers[c].rtpSender.setTransport(s.transceivers[0].dtlsTransport),s.transceivers[c].rtpReceiver&&s.transceivers[c].rtpReceiver.setTransport(s.transceivers[0].dtlsTransport)),"offer"!==i.type||f){if("answer"===i.type&&!f){p=(E=s.transceivers[c]).iceGatherer;var w=E.iceTransport,b=E.dtlsTransport,O=E.rtpReceiver;f=E.sendEncodingParameters,g=E.localCapabilities,s.transceivers[c].recvEncodingParameters=_,s.transceivers[c].remoteCapabilities=I,s.transceivers[c].rtcpParameters=C,r.length&&"new"===w.state&&(!u&&!A||d&&0!==c?r.forEach(function(e){y(E.iceTransport,e)}):w.setRemoteCandidates(r)),d&&0!==c||("new"===w.state&&w.start(p,S,"controlling"),"new"===b.state&&b.start(R)),!T(E.localCapabilities,E.remoteCapabilities).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&E.sendEncodingParameters[0].rtx&&delete E.sendEncodingParameters[0].rtx,s._transceive(E,"sendrecv"===h||"recvonly"===h,"sendrecv"===h||"sendonly"===h),!O||"sendrecv"!==h&&"sendonly"!==h?delete E.rtpReceiver:(v=O.track,m?(o[m.stream]||(o[m.stream]=new e.MediaStream),n(v,o[m.stream]),a.push([v,O,o[m.stream]])):(o.default||(o.default=new e.MediaStream),n(v,o.default),a.push([v,O,o.default])))}}else(E=s.transceivers[c]||s._createTransceiver(p)).mid=g,E.iceGatherer||(E.iceGatherer=s._createIceGatherer(c,d)),r.length&&"new"===E.iceTransport.state&&(!A||d&&0!==c?r.forEach(function(e){y(E.iceTransport,e)}):E.iceTransport.setRemoteCandidates(r)),g=e.RTCRtpReceiver.getCapabilities(p),15019>t&&(g.codecs=g.codecs.filter(function(e){return"rtx"!==e.name})),f=E.sendEncodingParameters||[{ssrc:1001*(2*c+2)}],S=!1,"sendrecv"===h||"sendonly"===h?(S=!E.rtpReceiver,O=E.rtpReceiver||new e.RTCRtpReceiver(E.dtlsTransport,p),S&&(v=O.track,m&&"-"===m.stream||(m?(o[m.stream]||(o[m.stream]=new e.MediaStream,Object.defineProperty(o[m.stream],"id",{get:function(){return m.stream}})),Object.defineProperty(v,"id",{get:function(){return m.track}}),w=o[m.stream]):(o.default||(o.default=new e.MediaStream),w=o.default)),w&&(n(v,w),E.associatedRemoteMediaStreams.push(w)),a.push([v,O,w]))):E.rtpReceiver&&E.rtpReceiver.track&&(E.associatedRemoteMediaStreams.forEach(function(t){var n=t.getTracks().find(function(e){return e.id===E.rtpReceiver.track.id});n&&function(t,n){n.removeTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(n,t)}),E.associatedRemoteMediaStreams=[]),E.localCapabilities=g,E.remoteCapabilities=I,E.rtpReceiver=O,E.rtcpParameters=C,E.sendEncodingParameters=f,E.recvEncodingParameters=_,s._transceive(s.transceivers[c],!1,S)}}),void 0===s._dtlsRole&&(s._dtlsRole="offer"===i.type?"active":"passive"),s._remoteDescription={type:i.type,sdp:i.sdp},s._updateSignalingState("offer"===i.type?"have-remote-offer":"stable"),Object.keys(o).forEach(function(t){var n=o[t];if(n.getTracks().length){if(-1===s.remoteStreams.indexOf(n)){s.remoteStreams.push(n);var i=new Event("addstream");i.stream=n,e.setTimeout(function(){s._dispatchEvent("addstream",i)})}a.forEach(function(e){n.id===e[2].id&&r(s,e[0],e[1],[n])})}}),a.forEach(function(e){e[2]||r(s,e[0],e[1],[])}),e.setTimeout(function(){s&&s.transceivers&&s.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&0<e.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},i.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},i.prototype._updateSignalingState=function(e){this.signalingState=e,e=new Event("signalingstatechange"),this._dispatchEvent("signalingstatechange",e)},i.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},i.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++}),e="new",0<t.failed?e="failed":0<t.checking?e="checking":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected?e="connected":0<t.completed&&(e="completed"),e!==this.iceConnectionState&&(this.iceConnectionState=e,e=new Event("iceconnectionstatechange"),this._dispatchEvent("iceconnectionstatechange",e))},i.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)}),t.connected+=t.completed,e="new",0<t.failed?e="failed":0<t.connecting?e="connecting":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected&&(e="connected"),e!==this.connectionState&&(this.connectionState=e,e=new Event("connectionstatechange"),this._dispatchEvent("connectionstatechange",e))},i.prototype.createOffer=function(n){var r=this;if(r._isClosed)return Promise.reject(I("InvalidStateError","Can not call createOffer after close"));var i=r.transceivers.filter(function(e){return"audio"===e.kind}).length,s=r.transceivers.filter(function(e){return"video"===e.kind}).length;if(n){if(n.mandatory||n.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==n.offerToReceiveAudio&&(i=!0===n.offerToReceiveAudio?1:!1===n.offerToReceiveAudio?0:n.offerToReceiveAudio),void 0!==n.offerToReceiveVideo&&(s=!0===n.offerToReceiveVideo?1:!1===n.offerToReceiveVideo?0:n.offerToReceiveVideo)}for(r.transceivers.forEach(function(e){"audio"===e.kind?0>--i&&(e.wantReceive=!1):"video"===e.kind&&0>--s&&(e.wantReceive=!1)});0<i||0<s;)0<i&&(r._createTransceiver("audio"),i--),0<s&&(r._createTransceiver("video"),s--);var o=Bc.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);return r.transceivers.forEach(function(n,i){var s=n.track,o=n.kind,a=n.mid||Bc.generateIdentifier();n.mid=a,n.iceGatherer||(n.iceGatherer=r._createIceGatherer(i,r.usingBundle)),a=e.RTCRtpSender.getCapabilities(o),15019>t&&(a.codecs=a.codecs.filter(function(e){return"rtx"!==e.name})),a.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),n.remoteCapabilities&&n.remoteCapabilities.codecs&&n.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),a.headerExtensions.forEach(function(e){(n.remoteCapabilities&&n.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})}),i=n.sendEncodingParameters||[{ssrc:1001*(2*i+1)}],s&&15019<=t&&"video"===o&&!i[0].rtx&&(i[0].rtx={ssrc:i[0].ssrc+1}),n.wantReceive&&(n.rtpReceiver=new e.RTCRtpReceiver(n.dtlsTransport,o)),n.localCapabilities=a,n.sendEncodingParameters=i}),"max-compat"!==r._config.bundlePolicy&&(o+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),o+="a=ice-options:trickle\r\n",r.transceivers.forEach(function(e,t){o+=S(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),o+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,o+="a="+Bc.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(o+="a=end-of-candidates\r\n"))}),n=new e.RTCSessionDescription({type:"offer",sdp:o}),Promise.resolve(n)},i.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(I("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(I("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var r=Bc.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(r+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),r+="a=ice-options:trickle\r\n";var i=Bc.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach(function(e,s){if(!(s+1>i)){if(e.rejected)return"application"===e.kind?r+="DTLS/SCTP"===e.protocol?"m=application 0 DTLS/SCTP 5000\r\n":"m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?r+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(r+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(r+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var o;e.stream&&("audio"===e.kind?o=e.stream.getAudioTracks()[0]:"video"===e.kind&&(o=e.stream.getVideoTracks()[0]),o&&15019<=t&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1})),!(s=T(e.localCapabilities,e.remoteCapabilities)).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,r+=S(e,s,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(r+="a=rtcp-rsize\r\n")}});var s=new e.RTCSessionDescription({type:"answer",sdp:r});return Promise.resolve(s)},i.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(r,i){if(!n._remoteDescription)return i(I("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var s=e.sdpMLineIndex;if(e.sdpMid)for(var o=0;o<n.transceivers.length;o++)if(n.transceivers[o].mid===e.sdpMid){s=o;break}var a=n.transceivers[s];if(!a)return i(I("OperationError","Can not add ICE candidate"));if(a.rejected)return r();if("tcp"===(o=0<Object.keys(e.candidate).length?Bc.parseCandidate(e.candidate):{}).protocol&&(0===o.port||9===o.port)||o.component&&1!==o.component)return r();if((0===s||0<s&&a.iceTransport!==n.transceivers[0].iceTransport)&&!y(a.iceTransport,o))return i(I("OperationError","Can not add ICE candidate"));0===(i=e.candidate.trim()).indexOf("a=")&&(i=i.substr(2)),(t=Bc.getMediaSections(n._remoteDescription.sdp))[s]+="a="+(o.type?i:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=Bc.getDescription(n._remoteDescription.sdp)+t.join("")}else for(s=0;s<n.transceivers.length&&(n.transceivers[s].rejected||(n.transceivers[s].iceTransport.addRemoteCandidate({}),(t=Bc.getMediaSections(n._remoteDescription.sdp))[s]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=Bc.getDescription(n._remoteDescription.sdp)+t.join(""),!n.usingBundle));s++);r()})},i.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)}),!n)throw I("InvalidAccessError","Invalid selector.");return n.getStats()}var r=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&r.push(e[t].getStats())})}),Promise.all(r).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){if((t=e[t])&&t.prototype&&t.prototype.getStats){var n=t.prototype.getStats;t.prototype.getStats=function(){return n.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(n){var r;e[n].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(r=e[n]).type]||r.type,t.set(n,e[n])}),t})}}});var s=["createOffer","createAnswer"];return s.forEach(function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(s=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),i},Gc=Object.freeze({__proto__:null,shimPeerConnection:w,shimReplaceTrack:b,shimGetUserMedia:C,shimGetDisplayMedia:A}),Hc=Object.freeze({__proto__:null,shimOnTrack:N,shimPeerConnection:k,shimSenderGetStats:D,shimReceiverGetStats:P,shimRemoveStream:L,shimRTCDataChannel:M,shimGetUserMedia:O,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){return n&&n.video?(!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)):((n=new DOMException("getDisplayMedia without video constraints is undefined")).name="NotFoundError",n.code=8,Ga.reject(n))})}}),Wc=Object.freeze({__proto__:null,shimLocalStreamsAPI:U,shimRemoteStreamsAPI:x,shimCallbacksAPI:V,shimGetUserMedia:F,shimConstraints:B,shimRTCIceServerUrls:j,shimTrackEventTransceiver:G,shimCreateOfferLegacy:H}),Kc=Object.freeze({__proto__:null,shimRTCIceCandidate:W,shimMaxMessageSize:K,shimSendThrowTypeError:Y,shimConnectionState:q,removeAllowExtmapMixed:z});!function({window:e}={},n={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){let o=a(e),c={browserDetails:o,commonShim:Kc,extractVersion:t,disableLog:r,disableWarnings:i};switch(o.browser){case"chrome":if(!wc||!E||!n.shimChrome)return s("Chrome shim is not included in this adapter release."),c;s("adapter.js shimming chrome."),c.browserShim=wc,u(e),d(e),E(e),h(e),g(e),p(e),f(e),_(e),v(e),W(e),q(e),K(e),Y(e),z(e);break;case"firefox":if(!Hc||!k||!n.shimFirefox)return s("Firefox shim is not included in this adapter release."),c;s("adapter.js shimming firefox."),c.browserShim=Hc,O(e),k(e),N(e),L(e),D(e),P(e),M(e),W(e),q(e),K(e),Y(e);break;case"edge":if(!Gc||!w||!n.shimEdge)return s("MS edge shim is not included in this adapter release."),c;s("adapter.js shimming edge."),c.browserShim=Gc,C(e),A(e),w(e),b(e),K(e),Y(e);break;case"safari":if(!Wc||!n.shimSafari)return s("Safari shim is not included in this adapter release."),c;s("adapter.js shimming safari."),c.browserShim=Wc,j(e),H(e),V(e),U(e),x(e),G(e),F(e),W(e),K(e),Y(e),z(e);break;default:s("Unsupported browser!")}}({window:window}),(Uc=Lc||(Lc={})).WIN_10="Windows 10",Uc.WIN_81="Windows 8.1",Uc.WIN_8="Windows 8",Uc.WIN_7="Windows 7",Uc.WIN_VISTA="Windows Vista",Uc.WIN_SERVER_2003="Windows Server 2003",Uc.WIN_XP="Windows XP",Uc.WIN_2000="Windows 2000",Uc.ANDROID="Android",Uc.OPEN_BSD="Open BSD",Uc.SUN_OS="Sun OS",Uc.LINUX="Linux",Uc.IOS="iOS",Uc.MAC_OS_X="Mac OS X",Uc.MAC_OS="Mac OS",Uc.QNX="QNX",Uc.UNIX="UNIX",Uc.BEOS="BeOS",Uc.OS_2="OS/2",Uc.SEARCH_BOT="Search Bot",function(e){e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger"}(Mc||(Mc={}));let Yc=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;var t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){var n,r=t[2];return To(n="".concat(t[1],".")).call(n,r)}return(t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/))&&t[1]&&t[2]?(n=t[2],To(r="".concat(t[1],".")).call(r,100*(Number(n)+1))):"4.0.0.999"}("4.5.0");try{var qc=!0===JSON.parse("true")}catch(Uc){qc=!0}let zc=qc,Xc={username:"test",password:"111111",turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1},Qc={"90p":te(160,90),"90p_1":te(160,90),"120p":te(160,120,15,30,65),"120p_1":te(160,120,15,30,65),"120p_3":te(120,120,15,30,50),"120p_4":te(212,120),"180p":te(320,180,15,30,140),"180p_1":te(320,180,15,30,140),"180p_3":te(180,180,15,30,100),"180p_4":te(240,180,15,30,120),"240p":te(320,240,15,40,200),"240p_1":te(320,240,15,40,200),"240p_3":te(240,240,15,40,140),"240p_4":te(424,240,15,40,220),"360p":te(640,360,15,80,400),"360p_1":te(640,360,15,80,400),"360p_3":te(360,360,15,80,260),"360p_4":te(640,360,30,80,600),"360p_6":te(360,360,30,80,400),"360p_7":te(480,360,15,80,320),"360p_8":te(480,360,30,80,490),"360p_9":te(640,360,15,80,800),"360p_10":te(640,360,24,80,800),"360p_11":te(640,360,24,80,1e3),"480p":te(640,480,15,100,500),"480p_1":te(640,480,15,100,500),"480p_2":te(640,480,30,100,1e3),"480p_3":te(480,480,15,100,400),"480p_4":te(640,480,30,100,750),"480p_6":te(480,480,30,100,600),"480p_8":te(848,480,15,100,610),"480p_9":te(848,480,30,100,930),"480p_10":te(640,480,10,100,400),"720p":te(1280,720,15,120,1130),"720p_1":te(1280,720,15,120,1130),"720p_2":te(1280,720,30,120,2e3),"720p_3":te(1280,720,30,120,1710),"720p_5":te(960,720,15,120,910),"720p_6":te(960,720,30,120,1380),"1080p":te(1920,1080,15,120,2080),"1080p_1":te(1920,1080,15,120,2080),"1080p_2":te(1920,1080,30,120,3e3),"1080p_3":te(1920,1080,30,120,3150),"1080p_5":te(1920,1080,60,120,4780),"1440p":te(2560,1440,30,120,4850),"1440p_1":te(2560,1440,30,120,4850),"1440p_2":te(2560,1440,60,120,7350),"4k":te(3840,2160,30,120,8910),"4k_1":te(3840,2160,30,120,8910),"4k_3":te(3840,2160,60,120,13500)},Jc={"480p":ne(640,480,5),"480p_1":ne(640,480,5),"480p_2":ne(640,480,30),"480p_3":ne(640,480,15),"720p":ne(1280,720,5),"720p_1":ne(1280,720,5),"720p_2":ne(1280,720,30),"720p_3":ne(1280,720,15),"1080p":ne(1920,1080,5),"1080p_1":ne(1920,1080,5),"1080p_2":ne(1920,1080,30),"1080p_3":ne(1920,1080,15)},$c={"1SL1TL":re(1,1),"3SL3TL":re(3,3),"2SL3TL":re(2,3)},Zc={speech_low_quality:ee(16e3,!1),speech_standard:ee(32e3,!1,18),music_standard:ee(48e3,!1),standard_stereo:ee(48e3,!0,56),high_quality:ee(48e3,!1,128),high_quality_stereo:ee(48e3,!0,192)},el={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,HTTP_CONNECT_TIMEOUT:5e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_TIMEOUT:1e4,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],FILEPATH_LENMAX:255,SUBSCRIBE_TCC:!0,PING_PONG_TIME_OUT:10,DUALSTREAM_OPERATION_CHECK:!0,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,MEDIA_ELEMENT_EXISTS_DEPTH:3,CANDIDATE_TIMEOUT:5e3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,SHOW_REPORT_INVOKER_LOG:!1,STATS_FILTER:{transportId:!0,googTrackId:!0},JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:"webrtc-cloud-proxy.sd-rtn.com",CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3};zc||(el.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],el.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],el.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],el.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],el.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],el.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],el.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",el.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",el.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",el.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",el.AREAS=["NORTH_AMERICA","OVERSEA"]);let tl=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],nl=[];var rl=[],il=rl.sort,sl=gn(function(){rl.sort(void 0)}),ol=gn(function(){rl.sort(null)}),al=ws("sort");Zn({target:"Array",proto:!0,forced:sl||!ol||al},{sort:function(e){return void 0===e?il.call(Yr(this)):il.call(Yr(this),Kn(e))}});var cl=ys("Array").sort,ll=Array.prototype,ul=function(e){var t=e.sort;return e===ll||e instanceof Array&&t===ll.sort?cl:t};Zn({target:"Array",stat:!0},{isArray:qr});var dl,hl=Wn.Array.isArray;!function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR"}(dl||(dl={}));var pl=function(e,t){return function(){for(var n=Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}},fl=Object.prototype.toString,_l={isArray:ie,isArrayBuffer:function(e){return"[object ArrayBuffer]"===fl.call(e)},isBuffer:function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:se,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===fl.call(e)},isFile:function(e){return"[object File]"===fl.call(e)},isBlob:function(e){return"[object Blob]"===fl.call(e)},isFunction:oe,isStream:function(e){return se(e)&&oe(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:ae,merge:function e(){function t(t,r){n[r]="object"==typeof n[r]&&"object"==typeof t?e(n[r],t):t}for(var n={},r=0,i=arguments.length;r<i;r++)ae(arguments[r],t);return n},deepMerge:function e(){function t(t,r){n[r]="object"==typeof n[r]&&"object"==typeof t?e(n[r],t):"object"==typeof t?e({},t):t}for(var n={},r=0,i=arguments.length;r<i;r++)ae(arguments[r],t);return n},extend:function(e,t,n){return ae(t,function(t,r){e[r]=n&&"function"==typeof t?pl(t,n):t}),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}},ml=function(e,t,n){if(!t)return e;if(n)t=n(t);else if(_l.isURLSearchParams(t))t=t.toString();else{var r=[];_l.forEach(t,function(e,t){null!=e&&(_l.isArray(e)?t+="[]":e=[e],_l.forEach(e,function(e){_l.isDate(e)?e=e.toISOString():_l.isObject(e)&&(e=JSON.stringify(e)),r.push(ce(t)+"="+ce(e))}))}),t=r.join("&")}return t&&(-1!==(n=e.indexOf("#"))&&(e=e.slice(0,n)),e+=(-1===e.indexOf("?")?"?":"&")+t),e};le.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},le.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},le.prototype.forEach=function(e){_l.forEach(this.handlers,function(t){null!==t&&e(t)})};var gl,El=le,vl=function(e,t,n){return _l.forEach(n,function(n){e=n(e,t)}),e},Sl=function(e){return!(!e||!e.__CANCEL__)},Tl=function(e,t){_l.forEach(e,function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])})},Rl=function(e,t,n,r,i){return function(e,t,n,r,i){return e.config=t,n&&(e.code=n),e.request=r,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}(Error(e),t,n,r,i)},yl="age authorization content-length content-type etag expires from host if-modified-since if-unmodified-since last-modified location max-forwards proxy-authorization referer retry-after user-agent".split(" "),Il=_l.isStandardBrowserEnv()?function(){function e(e){return n&&(r.setAttribute("href",e),e=r.href),r.setAttribute("href",e),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}var t,n=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");return t=e(window.location.href),function(n){return(n=_l.isString(n)?e(n):n).protocol===t.protocol&&n.host===t.host}}():function(){return!0},Cl=_l.isStandardBrowserEnv()?{write:function(e,t,n,r,i,s){var o=[];o.push(e+"="+encodeURIComponent(t)),_l.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),_l.isString(r)&&o.push("path="+r),_l.isString(i)&&o.push("domain="+i),!0===s&&o.push("secure"),document.cookie=o.join("; ")},read:function(e){return(e=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)")))?decodeURIComponent(e[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},Al={"Content-Type":"application/x-www-form-urlencoded"},wl={adapter:(("undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process)||"undefined"!=typeof XMLHttpRequest)&&(gl=function(e){return new Promise(function(t,n){var r=e.data,i=e.headers;_l.isFormData(r)&&delete i["Content-Type"];var s=new XMLHttpRequest;if(e.auth&&(i.Authorization="Basic "+btoa((e.auth.username||"")+":"+(e.auth.password||""))),s.open(e.method.toUpperCase(),ml(e.url,e.params,e.paramsSerializer),!0),s.timeout=e.timeout,s.onreadystatechange=function(){if(s&&4===s.readyState&&(0!==s.status||s.responseURL&&0===s.responseURL.indexOf("file:"))){var r,i,o,a,c,l="getAllResponseHeaders"in s?(r=s.getAllResponseHeaders(),c={},r?(_l.forEach(r.split("\n"),function(e){a=e.indexOf(":"),i=_l.trim(e.substr(0,a)).toLowerCase(),o=_l.trim(e.substr(a+1)),!i||c[i]&&0<=yl.indexOf(i)||(c[i]="set-cookie"===i?(c[i]?c[i]:[]).concat([o]):c[i]?c[i]+", "+o:o)}),c):c):null;!function(e,t,n){var r=n.config.validateStatus;!r||r(n.status)?e(n):t(Rl("Request failed with status code "+n.status,n.config,null,n.request,n))}(t,n,{data:e.responseType&&"text"!==e.responseType?s.response:s.responseText,status:s.status,statusText:s.statusText,headers:l,config:e,request:s}),s=null}},s.onabort=function(){s&&(n(Rl("Request aborted",e,"ECONNABORTED",s)),s=null)},s.onerror=function(){n(Rl("Network Error",e,null,s)),s=null},s.ontimeout=function(){n(Rl("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",s)),s=null},_l.isStandardBrowserEnv()){var o=(e.withCredentials||Il(e.url))&&e.xsrfCookieName?Cl.read(e.xsrfCookieName):void 0;o&&(i[e.xsrfHeaderName]=o)}if("setRequestHeader"in s&&_l.forEach(i,function(e,t){void 0===r&&"content-type"===t.toLowerCase()?delete i[t]:s.setRequestHeader(t,e)}),e.withCredentials&&(s.withCredentials=!0),e.responseType)try{s.responseType=e.responseType}catch(a){if("json"!==e.responseType)throw a}"function"==typeof e.onDownloadProgress&&s.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&s.upload&&s.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then(function(e){s&&(s.abort(),n(e),s=null)}),void 0===r&&(r=null),s.send(r)})}),gl),transformRequest:[function(e,t){return Tl(t,"Accept"),Tl(t,"Content-Type"),_l.isFormData(e)||_l.isArrayBuffer(e)||_l.isBuffer(e)||_l.isStream(e)||_l.isFile(e)||_l.isBlob(e)?e:_l.isArrayBufferView(e)?e.buffer:_l.isURLSearchParams(e)?(ue(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):_l.isObject(e)?(ue(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(t){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return 200<=e&&300>e},headers:{common:{Accept:"application/json, text/plain, */*"}}};_l.forEach(["delete","get","head"],function(e){wl.headers[e]={}}),_l.forEach(["post","put","patch"],function(e){wl.headers[e]=_l.merge(Al)});var bl=function(e){var t,n;return e.cancelToken&&e.cancelToken.throwIfRequested(),e.baseURL&&!/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e.url)&&(e.url=(t=e.baseURL,(n=e.url)?t.replace(/\/+$/,"")+"/"+n.replace(/^\/+/,""):t)),e.headers=e.headers||{},e.data=vl(e.data,e.headers,e.transformRequest),e.headers=_l.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),_l.forEach("delete get head post put patch common".split(" "),function(t){delete e.headers[t]}),(e.adapter||wl.adapter)(e).then(function(t){return e.cancelToken&&e.cancelToken.throwIfRequested(),t.data=vl(t.data,t.headers,e.transformResponse),t},function(t){return Sl(t)||(e.cancelToken&&e.cancelToken.throwIfRequested(),t&&t.response&&(t.response.data=vl(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})},Ol=function(e,t){t=t||{};var n={};return _l.forEach(["url","method","params","data"],function(e){void 0!==t[e]&&(n[e]=t[e])}),_l.forEach(["headers","auth","proxy"],function(r){_l.isObject(t[r])?n[r]=_l.deepMerge(e[r],t[r]):void 0!==t[r]?n[r]=t[r]:_l.isObject(e[r])?n[r]=_l.deepMerge(e[r]):void 0!==e[r]&&(n[r]=e[r])}),_l.forEach("baseURL transformRequest transformResponse paramsSerializer timeout withCredentials adapter responseType xsrfCookieName xsrfHeaderName onUploadProgress onDownloadProgress maxContentLength validateStatus maxRedirects httpAgent httpsAgent cancelToken socketPath".split(" "),function(r){void 0!==t[r]?n[r]=t[r]:void 0!==e[r]&&(n[r]=e[r])}),n};de.prototype.request=function(e,t){"string"==typeof e?(e=t||{}).url=e:e=e||{},(e=Ol(this.defaults,e)).method=e.method?e.method.toLowerCase():"get";var n=[bl,void 0];for(e=Promise.resolve(e),this.interceptors.request.forEach(function(e){n.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){n.push(e.fulfilled,e.rejected)});n.length;)e=e.then(n.shift(),n.shift());return e},de.prototype.getUri=function(e){return e=Ol(this.defaults,e),ml(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},_l.forEach(["delete","get","head","options"],function(e){de.prototype[e]=function(t,n){return this.request(_l.merge(n||{},{method:e,url:t}))}}),_l.forEach(["post","put","patch"],function(e){de.prototype[e]=function(t,n,r){return this.request(_l.merge(r||{},{method:e,url:t,data:n}))}});var Nl=de;he.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},he.prototype.__CANCEL__=!0;var kl=he;pe.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},pe.source=function(){var e;return{token:new pe(function(t){e=t}),cancel:e}};var Dl=fe(wl);Dl.Axios=Nl,Dl.create=function(e){return fe(Ol(Dl.defaults,e))},Dl.Cancel=kl,Dl.CancelToken=pe,Dl.isCancel=Sl,Dl.all=function(e){return Promise.all(e)},Dl.spread=function(e){return function(t){return e.apply(null,t)}};var Pl=Dl.default=Dl;let Ll={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Ml=e=>{for(const t in Ll)if(Ll[t]===e)return t;return"DEFAULT"},Ul=new class{constructor(){this.logLevel=Ll.DEBUG,this.uploadState="collecting",this.uploadLogWaitingList=[],this.uploadLogUploadingList=[],this.currentLogID=this.uploadErrorCount=0}debug(...e){var t;e=To(t=[Ll.DEBUG]).call(t,e),this.log.apply(this,e)}info(...e){var t;e=To(t=[Ll.INFO]).call(t,e),this.log.apply(this,e)}warning(...e){var t;e=To(t=[Ll.WARNING]).call(t,e),this.log.apply(this,e)}error(...e){var t;e=To(t=[Ll.ERROR]).call(t,e),this.log.apply(this,e)}setLogLevel(e){this.logLevel=e=Math.min(Math.max(0,e),4)}enableLogUpload(){Z("UPLOAD_LOG",!0)}disableLogUpload(){Z("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}log(...e){var t,n,r,i;const s=Math.max(0,Math.min(4,e[0]));if(e[0]=_e()+" Agora-SDK [".concat(Ml(s),"]:"),this.appendLogToWaitingList(s,e),!(s<this.logLevel)){var o=_e()+" %cAgora-SDK [".concat(Ml(s),"]:");switch(s){case Ll.DEBUG:e=To(t=[o,"color: #64B5F6;"]).call(t,cc(e).call(e,1)),console.log.apply(console,e);break;case Ll.INFO:e=To(n=[o,"color: #1E88E5; font-weight: bold;"]).call(n,cc(e).call(e,1)),console.log.apply(console,e);break;case Ll.WARNING:e=To(r=[o,"color: #FB8C00; font-weight: bold;"]).call(r,cc(e).call(e,1)),console.warn.apply(console,e);break;case Ll.ERROR:e=To(i=[o,"color: #B00020; font-weight: bold;"]).call(i,cc(e).call(e,1)),console.error.apply(console,e)}}}appendLogToWaitingList(e,...t){if(el.UPLOAD_LOG){var n="";Ds(t).call(t,e=>{"object"==typeof e&&(e=cr(e)),n+="".concat(e," ")}),this.uploadLogWaitingList.push({payload_str:n,log_level:e,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}async uploadLogs(){var e,t={sdk_version:Yc,process_id:el.PROCESS_ID,payload:cr(this.uploadLogUploadingList)};if("OK"!==(t=await Pl.post(this.url||(this.proxyServerURL?To(e="https://".concat(this.proxyServerURL,"/ls/?h=")).call(e,el.LOG_UPLOAD_SERVER,"&p=443&d=upload/v1"):"https://".concat(el.LOG_UPLOAD_SERVER,"/upload/v1")),t,{responseType:"text"})).data)throw Error("unexpected upload log response: "+t.data);this.uploadLogUploadingList=[]}uploadLogInterval(){var e;0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=Qa(e=this.uploadLogWaitingList).call(e,0,10)),this.uploadLogs().then(()=>{this.uploadErrorCount=0,0<this.uploadLogWaitingList.length&&window.setTimeout(()=>this.uploadLogInterval(),3e3)}).catch(e=>{this.uploadErrorCount+=1,2>this.uploadErrorCount?window.setTimeout(()=>this.uploadLogInterval(),200):window.setTimeout(()=>this.uploadLogInterval(),1e3)}))}};class xl{constructor(e,t="",n){var r;this.name="AgoraRTCException",this.code=e,this.message=To(r="AgoraRTCError ".concat(this.code,": ")).call(r,t),this.data=n}toString(){var e;return this.data?To(e="".concat(this.message," data: ")).call(e,cr(this.data)):this.message}print(){return Ul.error(this.toString()),this}throw(){throw this.print(),this}}var Vl,Fl;!function(e){e.FREE="free",e.UPLOADING="uploading"}(Vl||(Vl={})),function(e){e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied"}(Fl||(Fl={})),Zn({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),Zn({target:"Number",stat:!0},{MIN_SAFE_INTEGER:-9007199254740991});let Bl={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var jl,Gl,Hl,Wl,Kl,Yl,ql,zl,Xl,Ql,Jl,$l,Zl,eu,tu,nu,ru,iu,su,ou,au;!function(e){e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics"}(jl||(jl={})),function(e){e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAT="io.agora.pb.Wrtc.JoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics"}(Gl||(Gl={})),function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(Hl||(Hl={})),function(e){e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",e.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange"}(Wl||(Wl={})),(Kl||(Kl={})).TRACER="tracer",function(e){e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND"}(Yl||(Yl={})),function(e){e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(ql||(ql={})),function(e){e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(zl||(zl={})),function(e){e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(Xl||(Xl={})),function(e){e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(Ql||(Ql={})),function(e){e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(Jl||(Jl={})),function(e){e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}($l||($l={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.INJECT_STREAM_STATUS="stream-inject-status",e.EXCEPTION="exception",e.ERROR="error"}(Zl||(Zl={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE"}(eu||(eu={})),function(e){e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed"}(tu||(tu={})),function(e){e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success"}(nu||(nu={})),function(e){e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v2",e.REJOIN="rejoin",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.SUBSCRIBE="subscribe",e.UNSUBSCRIBE="unsubscribe",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer"}(ru||(ru={})),function(e){e.PUBLISH_STATS="publish_stats",e.PUBLISH_RELATED_STATS="publish_related_stats",e.SUBSCRIBE_STATS="subscribe_stats",e.SUBSCRIBE_RELATED_STATS="subscribe_related_stats"}(iu||(iu={})),function(e){e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio"}(su||(su={})),function(e){e.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",e.NEED_ANSWER="NEED_ANSWER",e.NEED_RENEGOTIATE="NEED_RENEGOTIATE",e.P2P_LOST="P2P_LOST",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NEED_UNPUB="NEED_UNPUB",e.NEED_UNSUB="NEED_UNSUB",e.NEED_UPLOAD="NEED_UPLOAD",e.START_RECONNECT="START_RECONNECT",e.END_RECONNECT="END_RECONNECT",e.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(ou||(ou={})),function(e){e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer"}(au||(au={}));let cu={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0},lu={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0},uu={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,publishDuration:-1},du={uplinkNetworkQuality:0,downlinkNetworkQuality:0},hu={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,publishDuration:-1};var pu,fu;!function(e){e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls"}(pu||(pu={})),function(e){e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e.INJECT="inject_streaming"}(fu||(fu={}));let _u={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},mu={x:0,y:0,width:160,height:160,zOrder:255,alpha:1},gu={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},Eu={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var vu,Su,Tu,Ru,yu,Iu,Cu,Au,wu,bu;!function(e){e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.INJECT_STREAM_STATUS="@live_uap-inject-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address"}(vu||(vu={})),(Su||(Su={})).REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",function(e){e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(Tu||(Tu={})),function(e){e.CONNECT_FAILED="connect failed",e.CONNECT_TIMEOUT="connect timeout",e.WS_DISCONNECTED="websocket disconnected",e.REQUEST_TIMEOUT="request timeout",e.REQUEST_FAILED="request failed",e.WAIT_STATUS_TIMEOUT="wait status timeout",e.WAIT_STATUS_ERROR="wait status error",e.BAD_STATE="bad state",e.WS_ABORT="ws abort",e.AP_REQUEST_TIMEOUT="AP request timeout",e.AP_JSON_PARSE_ERROR="AP json parse error",e.AP_REQUEST_ERROR="AP request error",e.AP_REQUEST_ABORT="AP request abort"}(Ru||(Ru={})),function(e){e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile"}(yu||(yu={})),function(e){e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid"}(Iu||(Iu={})),function(e){e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_CLOSE="@need_close",e.NEED_ADD_TRACK="@need_add_track",e.NEED_REMOVE_TRACK="@need_remove_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp"}(Cu||(Cu={})),function(e){e.SCREEN_TRACK="screen_track",e.LOW_STREAM="low_stream"}(Au||(Au={})),function(e){e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload"}(wu||(wu={})),(bu||(bu={})).FIRST_FRAME_DECODED="first-frame-decoded";let Ou="AFRICA ASIA CHINA EUROPE GLOBAL INDIA JAPAN NORTH_AMERICA OCEANIA OVERSEA SOUTH_AMERICA".split(" ");var Nu;!function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL"}(Nu||(Nu={}));let ku={CHINA:{},ASIA:{CODE:Nu.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Nu.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Nu.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Nu.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","\tuap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Nu.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Nu.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Nu.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Nu.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Nu.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Nu.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]}};var Du;zc&&(ku.CHINA={CODE:Nu.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),(Du||(Du={})).UPDATE_BITRATE_LIMIT="update_bitrate_limit";let Pu={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1};Zn({target:"Object",stat:!0,forced:!En,sham:!En},{defineProperties:Ni});var Lu=e(function(e){var t=Wn.Object;e=e.exports=function(e,n){return t.defineProperties(e,n)},t.defineProperties.sham&&(e.sham=!0)}),Mu=bi.concat("length","prototype"),Uu={f:Object.getOwnPropertyNames||function(e){return wi(e,Mu)}},xu=tr("Reflect","ownKeys")||function(e){var t=Uu.f(qn(e)),n=Ps.f;return n?t.concat(n(e)):t};Zn({target:"Object",stat:!0,sham:!En},{getOwnPropertyDescriptors:function(e){var t,n;e=bn(e);for(var r=xn,i=xu(e),s={},o=0;i.length>o;)void 0!==(n=r(e,t=i[o++]))&&ao(s,t,n);return s}});var Vu=Wn.Object.getOwnPropertyDescriptors,Fu=Uu.f,Bu={}.toString,ju="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Gu=function(e){if(ju&&"[object Window]"==Bu.call(e))try{var t=Fu(e)}catch(n){t=ju.slice()}else t=Fu(bn(e));return t},Hu={f:Rr},Wu=Xn.f,Ku=ci("hidden"),Yu=Rr("toPrimitive"),qu=gi.set,zu=gi.getterFor("Symbol"),Xu=Object.prototype,Qu=mn.Symbol,Ju=tr("JSON","stringify"),$u=xn,Zu=Xn.f,ed=Gu,td=Tn,nd=mr("symbols"),rd=mr("op-symbols"),id=mr("string-to-symbol-registry"),sd=mr("symbol-to-string-registry"),od=mr("wks"),ad=mn.QObject,cd=!ad||!ad.prototype||!ad.prototype.findChild,ld=En&&gn(function(){return 7!=Mi(Zu({},"a",{get:function(){return Zu(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=$u(Xu,t);r&&delete Xu[t],Zu(e,t,n),r&&e!==Xu&&Zu(Xu,t,r)}:Zu,ud=function(e,t){var n=nd[e]=Mi(Qu.prototype);return qu(n,{type:"Symbol",tag:e,description:t}),En||(n.description=t),n},dd=gr&&"symbol"==typeof Qu.iterator?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof Qu},hd=function(e,t,n){return e===Xu&&hd(rd,t,n),qn(e),t=Nn(t,!0),qn(n),Dn(nd,t)?(n.enumerable?(Dn(e,Ku)&&e[Ku][t]&&(e[Ku][t]=!1),n=Mi(n,{enumerable:Rn(0,!1)})):(Dn(e,Ku)||Zu(e,Ku,Rn(1,{})),e[Ku][t]=!0),ld(e,t,n)):Zu(e,t,n)},pd=function(e,t){qn(e);var n=bn(t);return t=Oi(n).concat(gd(n)),$r(t,function(t){En&&!fd.call(n,t)||hd(e,t,n[t])}),e},fd=function(e){e=Nn(e,!0);var t=td.call(this,e);return!(this===Xu&&Dn(nd,e)&&!Dn(rd,e))&&(!(t||!Dn(this,e)||!Dn(nd,e)||Dn(this,Ku)&&this[Ku][e])||t)},_d=function(e,t){if(e=bn(e),t=Nn(t,!0),e!==Xu||!Dn(nd,t)||Dn(rd,t)){var n=$u(e,t);return!n||!Dn(nd,t)||Dn(e,Ku)&&e[Ku][t]||(n.enumerable=!0),n}},md=function(e){e=ed(bn(e));var t=[];return $r(e,function(e){Dn(nd,e)||Dn(lr,e)||t.push(e)}),t},gd=function(e){var t=e===Xu;e=ed(t?rd:bn(e));var n=[];return $r(e,function(e){!Dn(nd,e)||t&&!Dn(Xu,e)||n.push(nd[e])}),n};if(gr||(Fi((Qu=function(){if(this instanceof Qu)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=hr(e),n=function(e){this===Xu&&n.call(rd,e),Dn(this,Ku)&&Dn(this[Ku],t)&&(this[Ku][t]=!1),ld(this,t,Rn(1,e))};return En&&cd&&ld(Xu,t,{configurable:!0,set:n}),ud(t,e)}).prototype,"toString",function(){return zu(this).tag}),Tn=fd,Xn.f=hd,xn=_d,Uu.f=Gu=md,Ps.f=gd,En&&Zu(Qu.prototype,"description",{configurable:!0,get:function(){return zu(this).description}})),Er||(Hu.f=function(e){return ud(Rr(e),e)}),Zn({global:!0,wrap:!0,forced:!gr,sham:!gr},{Symbol:Qu}),$r(Oi(od),function(e){var t=Wn.Symbol||(Wn.Symbol={});Dn(t,e)||Wu(t,e,{value:Hu.f(e)})}),Zn({target:"Symbol",stat:!0,forced:!gr},{for:function(e){if(e=String(e),Dn(id,e))return id[e];var t=Qu(e);return id[e]=t,sd[t]=e,t},keyFor:function(e){if(!dd(e))throw TypeError(e+" is not a symbol");if(Dn(sd,e))return sd[e]},useSetter:function(){cd=!0},useSimple:function(){cd=!1}}),Zn({target:"Object",stat:!0,forced:!gr,sham:!En},{create:function(e,t){return void 0===t?Mi(e):pd(Mi(e),t)},defineProperty:hd,defineProperties:pd,getOwnPropertyDescriptor:_d}),Zn({target:"Object",stat:!0,forced:!gr},{getOwnPropertyNames:md,getOwnPropertySymbols:gd}),Zn({target:"Object",stat:!0,forced:gn(function(){Ps.f(1)})},{getOwnPropertySymbols:function(e){return Ps.f(Yr(e))}}),Ju){var Ed=!gr||gn(function(){var e=Qu();return"[null]"!=Ju([e])||"{}"!=Ju({a:e})||"{}"!=Ju(Object(e))});Zn({target:"JSON",stat:!0,forced:Ed},{stringify:function(e,t,n){for(var r,i=[e],s=1;arguments.length>s;)i.push(arguments[s++]);if(r=t,(On(t)||void 0!==e)&&!dd(e))return qr(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!dd(t))return t}),i[1]=t,Ju.apply(null,i)}})}Qu.prototype[Yu]||Qn(Qu.prototype,Yu,Qu.prototype.valueOf),Kr(Qu,"Symbol"),lr[Ku]=!0;var vd=Wn.Object.getOwnPropertySymbols,Sd=function(e,t,n){return t in e?Ws(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},Td=ys("Array").values,Rd=Array.prototype,yd={DOMTokenList:!0,NodeList:!0},Id=function(e){var t=e.values;return e===Rd||e instanceof Array&&t===Rd.values||yd.hasOwnProperty(Ur(e))?Td:t},Cd=!Po(function(e){Array.from(e)});Zn({target:"Array",stat:!0,forced:Cd},{from:function(e){var t=Yr(e),n="function"==typeof this?this:Array,r=arguments.length,i=1<r?arguments[1]:void 0,s=void 0!==i,o=0,a=Vr(t);if(s&&(i=Yn(i,2<r?arguments[2]:void 0,2)),null==a||n==Array&&Ar(a))for(n=new n(r=kr(t.length));r>o;o++)ao(n,o,s?i(t[o],o):t[o]);else for(r=(t=a.call(t)).next,n=new n;!(a=r.call(t)).done;o++)ao(n,o,s?Fr(t,i,[a.value,o],!0):a.value);return n.length=o,n}});var Ad=Wn.Array.from;Zn({target:"Date",stat:!0},{now:function(){return(new Date).getTime()}});var wd=Wn.Date.now;class bd{constructor(){this._events={},this.addListener=this.on}getListeners(e){var t;return this._events[e]?Ka(t=this._events[e]).call(t,e=>e.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]),-1===this._indexOfListener(e=this._events[e],t)&&e.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]),-1===this._indexOfListener(e=this._events[e],t)&&e.push({listener:t,once:!0})}off(e,t){if(this._events[e]){var n=this._events[e];-1!==(t=this._indexOfListener(n,t))&&Qa(n).call(n,t,1),0===this._events[e].length&&delete this._events[e]}}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e,...t){var n;this._events[e]||(this._events[e]=[]);let r=Ka(n=this._events[e]).call(n,e=>e);for(n=0;n<r.length;n+=1){let i=r[n];i.once&&this.off(e,i.listener),i.listener.apply(this,t||[])}}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}}class Od extends bd{constructor(){super(...arguments),this.resultStorage=new _s}setLocalAudioStats(e,t,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(n))}setLocalVideoStats(e,t,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(n)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(n,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(n))}setRemoteAudioStats(e,t){e=e.getUserId(),this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",e,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){e=e.getUserId(),this.record("RECV_VIDEO_DECODE_FAILED",e,this.checkVideoDecode(t))}record(e,t,n){this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});let r=this.resultStorage.get(e);var i;r&&(r.result.push(n),5<=r.result.length)&&(n=Rc(i=r.result).call(i,!0),r.isPrevNormal&&!n&&this.emit("exception",Nd[e],e,t),!r.isPrevNormal&&n&&this.emit("exception",Nd[e]+2e3,e+"_RECOVER",t),r.isPrevNormal=n,r.result=[])}checkAudioOutputLevel(e){return!(0<e.receiveBitrate&&0===e.receiveLevel)}checkAudioInputLevel(e){return 0!==e.sendVolumeLevel}checkFramerateInput(e,t){let n=null;return t._encoderConfig&&t._encoderConfig.frameRate&&(n=Be(t._encoderConfig.frameRate)),e=e.captureFrameRate,!n||!e||!(10<n&&5>e||10>n&&5<=n&&1>=e)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&5<e.captureFrameRate&&1>=e.sendFrameRate)}checkSendVideoBitrate(e){return 0!==e.sendBitrate}checkSendAudioBitrate(e){return 0!==e.sendBitrate}checkVideoDecode(e){return 0===e.receiveBitrate||0!==e.decodeFrameRate}}let Nd={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003};class kd{constructor(e){this.localConnectionsMap=new _s,this.remoteConnectionsMap=new _s,this.trafficStatsPeerList=[],this.updateStats=()=>{var e,t;Ds(e=this.remoteConnectionsMap).call(e,e=>{var t;let n=e.audioStats;var r=e.videoStats,i=e.pcStats;let s=Ve({},uu),o=Ve({},hu),a=Ve({},du),c=e.connection.pc.getStats(),l=c.audioRecv[0],u=c.videoRecv[0];i=i?i.videoRecv[0]:void 0;let d=!0===e.connection.pc._statsFilter.videoIsReady,h=this.trafficStats&&hc(t=this.trafficStats.peer_delay).call(t,t=>t.peer_uid===e.connection.getUserId());l&&("opus"!==l.codec&&"aac"!==l.codec||(s.codecType=l.codec),l.outputLevel?s.receiveLevel=Math.round(32767*l.outputLevel):e.connection.user.audioTrack&&(s.receiveLevel=Math.round(32767*e.connection.user.audioTrack.getVolumeLevel())),s.receiveBytes=l.bytes,s.receivePackets=l.packets,s.receivePacketsLost=l.packetsLost,s.packetLossRate=s.receivePacketsLost/(s.receivePackets+s.receivePacketsLost),s.receiveBitrate=n?8*Math.max(0,s.receiveBytes-n.receiveBytes):0,s.totalDuration=n?n.totalDuration+1:1,s.totalFreezeTime=n?n.totalFreezeTime:0,s.freezeRate=s.totalFreezeTime/s.totalDuration,s.receiveDelay=l.jitterBufferMs,t=e.connection.user.audioTrack,10<s.totalDuration&&kd.isRemoteAudioFreeze(t)&&(s.totalFreezeTime+=1)),u&&("H264"!==u.codec&&"VP8"!==u.codec&&"VP9"!==u.codec&&"AV1X"!==u.codec||(o.codecType=u.codec),o.receiveBytes=u.bytes,o.receiveBitrate=r?8*Math.max(0,o.receiveBytes-r.receiveBytes):0,o.decodeFrameRate=u.decodeFrameRate,o.renderFrameRate=u.decodeFrameRate,u.outputFrame&&(o.renderFrameRate=u.outputFrame.frameRate),u.receivedFrame?(o.receiveFrameRate=u.receivedFrame.frameRate,o.receiveResolutionHeight=u.receivedFrame.height,o.receiveResolutionWidth=u.receivedFrame.width):e.connection.user.videoTrack&&(o.receiveResolutionHeight=e.connection.user.videoTrack._videoHeight||0,o.receiveResolutionWidth=e.connection.user.videoTrack._videoWidth||0),void 0!==u.framesRateFirefox&&(o.receiveFrameRate=Math.round(u.framesRateFirefox)),o.receivePackets=u.packets,o.receivePacketsLost=u.packetsLost,o.packetLossRate=o.receivePacketsLost/(o.receivePackets+o.receivePacketsLost),o.totalDuration=r?r.totalDuration+1:1,o.totalFreezeTime=r?r.totalFreezeTime:0,o.receiveDelay=u.jitterBufferMs||0,r=e.connection.user.videoTrack,e.connection.subscribeOptions.video&&d&&kd.isRemoteVideoFreeze(r,u,i)&&(o.totalFreezeTime+=1),o.freezeRate=o.totalFreezeTime/o.totalDuration),h&&(s.end2EndDelay=h.B_ad,o.end2EndDelay=h.B_vd,s.transportDelay=h.B_ed,o.transportDelay=h.B_ed,a.uplinkNetworkQuality=h.B_punq?h.B_punq:0,a.downlinkNetworkQuality=h.B_pdnq?h.B_punq:0),e.audioStats=s,e.videoStats=o,e.pcStats=c,e.networkStats=a,e.connection.user.audioTrack&&this.exceptionMonitor.setRemoteAudioStats(e.connection.user.audioTrack,s),e.connection.user.videoTrack&&this.exceptionMonitor.setRemoteVideoStats(e.connection.user.videoTrack,o)}),Ds(t=this.localConnectionsMap).call(t,e=>{let t=e.audioStats,n=e.videoStats,r=Ve({},cu),i=Ve({},lu);var s=e.connection.pc.getStats();let o=s.audioSend[0];s=s.videoSend[0];let a=e.connection.getUserId();o&&("opus"!==o.codec&&"aac"!==o.codec||(r.codecType=o.codec),o.inputLevel?r.sendVolumeLevel=Math.round(32767*o.inputLevel):e.connection.audioTrack&&(r.sendVolumeLevel=Math.round(32767*e.connection.audioTrack.getVolumeLevel())),r.sendBytes=o.bytes,r.sendPackets=o.packets,r.sendPacketsLost=o.packetsLost,r.sendBitrate=t?8*Math.max(0,r.sendBytes-t.sendBytes):0),s&&("H264"!==s.codec&&"VP8"!==s.codec&&"VP9"!==s.codec&&"AV1X"!==s.codec||(i.codecType=s.codec),i.sendBytes=s.bytes,i.sendBitrate=n?8*Math.max(0,i.sendBytes-n.sendBytes):0,s.inputFrame?(i.captureFrameRate=s.inputFrame.frameRate,i.captureResolutionHeight=s.inputFrame.height,i.captureResolutionWidth=s.inputFrame.width):e.connection.videoTrack&&(i.captureResolutionWidth=e.connection.videoTrack._videoWidth||0,i.captureResolutionHeight=e.connection.videoTrack._videoHeight||0),s.sentFrame?(i.sendFrameRate=s.sentFrame.frameRate,i.sendResolutionHeight=s.sentFrame.height,i.sendResolutionWidth=s.sentFrame.width):e.connection.videoTrack&&(i.sendResolutionWidth=e.connection.videoTrack._videoWidth||0,i.sendResolutionHeight=e.connection.videoTrack._videoHeight||0),s.avgEncodeMs&&(i.encodeDelay=s.avgEncodeMs),e.connection.videoTrack&&e.connection.videoTrack._encoderConfig&&e.connection.videoTrack._encoderConfig.bitrateMax&&(i.targetSendBitrate=1e3*e.connection.videoTrack._encoderConfig.bitrateMax),i.sendPackets=s.packets,i.sendPacketsLost=s.packetsLost,i.totalDuration=n?n.totalDuration+1:1,i.totalFreezeTime=n?n.totalFreezeTime:0,this.isLocalVideoFreeze(s)&&(i.totalFreezeTime+=1)),e.audioStats=r,e.videoStats=i,e.audioStats&&e.connection.audioTrack&&this.exceptionMonitor.setLocalAudioStats(a,e.connection.audioTrack,e.audioStats),e.videoStats&&e.connection.videoTrack&&this.exceptionMonitor.setLocalVideoStats(a,e.connection.videoTrack,e.videoStats)})},this.clientId=e,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new Od,this.exceptionMonitor.on("exception",(e,t,n)=>{this.onStatsException&&this.onStatsException(e,t,n)})}reset(){this.localConnectionsMap=new _s,this.remoteConnectionsMap=new _s,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(e){return(e=this.localConnectionsMap.get(e))&&e.audioStats?e.audioStats:Ve({},cu)}getLocalVideoTrackStats(e){return(e=this.localConnectionsMap.get(e))&&e.videoStats?e.videoStats:Ve({},lu)}getRemoteAudioTrackStats(e){var t;let n=this.remoteConnectionsMap.get(e);return n&&n.audioStats?this.trafficStats?((e=hc(t=this.trafficStats.peer_delay).call(t,e=>e.peer_uid===n.connection.user.uid))&&(n.audioStats.publishDuration=e.B_ppad+(wd()-this.trafficStats.timestamp)),n.audioStats):n.audioStats:Ve({},uu)}getRemoteNetworkQualityStats(e){return(e=this.remoteConnectionsMap.get(e))&&e.networkStats?e.networkStats:Ve({},du)}getRemoteVideoTrackStats(e){var t;let n=this.remoteConnectionsMap.get(e);return n&&n.videoStats?this.trafficStats?((e=hc(t=this.trafficStats.peer_delay).call(t,e=>e.peer_uid===n.connection.user.uid))&&(n.videoStats.publishDuration=e.B_ppvd+(wd()-this.trafficStats.timestamp)),n.videoStats):n.videoStats:Ve({},hu)}getRTCStats(){var e,t;let n=0,r=0,i=0,s=0;return Ds(e=this.localConnectionsMap).call(e,e=>{e.audioStats&&(n+=e.audioStats.sendBytes,r+=e.audioStats.sendBitrate),e.videoStats&&(n+=e.videoStats.sendBytes,r+=e.videoStats.sendBitrate)}),Ds(t=this.remoteConnectionsMap).call(t,e=>{e.audioStats&&(i+=e.audioStats.receiveBytes,s+=e.audioStats.receiveBitrate),e.videoStats&&(i+=e.videoStats.receiveBytes,s+=e.videoStats.receiveBitrate)}),e=1,this.trafficStats&&(e+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:e,SendBitrate:r,SendBytes:n,RecvBytes:i,RecvBitrate:s,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}removeConnection(e){this.localConnectionsMap.delete(e),this.remoteConnectionsMap.delete(e)}addLocalConnection(e){let t=e.connectionId;this.localConnectionsMap.has(t)||this.localConnectionsMap.set(t,{connection:e})}addRemoteConnection(e){let t=e.connectionId;this.remoteConnectionsMap.has(t)||this.remoteConnectionsMap.set(t,{connection:e})}updateTrafficStats(e){var t;let n=Io(t=e.peer_delay).call(t,e=>{var t;return-1===nc(t=this.trafficStatsPeerList).call(t,e.peer_uid)});Ds(n).call(n,e=>{var t,n;let r=hc(t=Ad(Id(n=this.remoteConnectionsMap).call(n))).call(t,t=>t.connection._userId===e.peer_uid);void 0!==e.B_ppad&&void 0!==e.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,r?wd()-r.connection.startTime:0),this.trafficStatsPeerList.push(e.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){var t;this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&Ul.debug(To(t="[".concat(this.clientId,"]: Period fir changes to ")).call(t,e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,t,n){return!!e&&(e=!n||t.framesDecodeCount>n.framesDecodeCount,!!n&&t.framesDecodeFreezeTime>n.framesDecodeFreezeTime||!e)}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&5<e.inputFrame.frameRate&&3>e.sentFrame.frameRate}}var Dd;let Pd=()=>{},Ld={},Md=new class{constructor(){this.fnMap=new _s}throttleByKey(e,t,n,r,...i){if(this.fnMap.has(t)){var s=this.fnMap.get(t);s.threshold!==n?(s.fn(...s.args),clearTimeout(s.timer),s=window.setTimeout(()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)},n),this.fnMap.set(t,{fn:e,threshold:n,timer:s,args:i,skipFn:r})):(s.skipFn&&s.skipFn(...s.args),this.fnMap.set(t,Ke({},s,{fn:e,args:i,skipFn:r})))}else s=window.setTimeout(()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)},n),this.fnMap.set(t,{fn:e,threshold:n,timer:s,args:i,skipFn:r})}},Ud=gc(Dd=Md.throttleByKey).call(Dd,Md),xd=async({fragementLength:e,referenceList:t,asyncMapHandler:n,allFailedhandler:r})=>{let i,s=0,o=0;const a=async()=>{const c=(()=>{var r=s*e;const i=r+e;return r=cc(t).call(t,r,i),Ka(r).call(r,n)})();try{i=await Je(c)}catch(l){if(o+=e,s++,!(o>=t.length))return void(await a());r(l)}Ds(c).call(c,e=>e.cancel())};return await a(),i},Vd=null,Fd=1;class Bd{constructor(e){var t;this.lockingPromise=Ga.resolve(),this.locks=0,this.name="",this.lockId=Fd++,e&&(this.name=e),Ul.debug(To(t="[lock-".concat(this.name,"-")).call(t,this.lockId,"] is created."))}get isLocked(){return 0<this.locks}lock(){var e,t;let n;this.locks+=1,Ul.debug(To(e=To(t="[lock-".concat(this.name,"-")).call(t,this.lockId,"] is locked, current queue ")).call(e,this.locks,"."));let r=new Ga(e=>{n=()=>{var t,n;--this.locks,Ul.debug(To(t=To(n="[lock-".concat(this.name,"-")).call(n,this.lockId,"] is not locked, current queue ")).call(t,this.locks,".")),e()}});return e=this.lockingPromise.then(()=>n),this.lockingPromise=this.lockingPromise.then(()=>r),e}}let jd=new Bd("safari"),Gd=!1,Hd=!1,Wd=new class extends bd{constructor(){super(),this._state=Yl.IDLE,this.lastAccessCameraPermission=this.lastAccessMicrophonePermission=this.isAccessCameraPermission=this.isAccessMicrophonePermission=!1,this.deviceInfoMap=new _s,this.init().then(()=>{var e,t;navigator.mediaDevices&&navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",gc(t=this.updateDevicesInfo).call(t,this)),window.setInterval(gc(e=this.updateDevicesInfo).call(e,this),2500)}).catch(e=>Ul.error(e.toString()))}get state(){return this._state}set state(e){e!==this._state&&(this.emit(ql.STATE_CHANGE,e),this._state=e)}async enumerateDevices(e,t,n=!1){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new xl(dl.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();var r=await navigator.mediaDevices.enumerateDevices();r=this.checkMediaDeviceInfoIsOk(r);let i=!this.isAccessMicrophonePermission&&e,s=!this.isAccessCameraPermission&&t;r.audio&&(i=!1),r.video&&(s=!1);let o=r=null,a=null;if(!n&&(i||s)){if(jd.isLocked&&(Ul.debug("[device manager] wait GUM lock"),(await jd.lock())(),Ul.debug("[device manager] GUM unlock")),Gd&&(i=!1,this.isAccessMicrophonePermission=!0),Hd&&(s=!1,this.isAccessCameraPermission=!0),Ul.debug("[device manager] check media device permissions",e,t,i,s),i&&s){try{a=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(f){if((n=pt(f.name||f.code||f,f.message)).code===dl.PERMISSION_DENIED)throw n;Ul.warning("getUserMedia failed in getDevices",n)}this.isAccessMicrophonePermission=this.isAccessCameraPermission=!0}else if(i){try{r=await navigator.mediaDevices.getUserMedia({audio:e})}catch(f){if((n=pt(f.name||f.code||f,f.message)).code===dl.PERMISSION_DENIED)throw n;Ul.warning("getUserMedia failed in getDevices",n)}this.isAccessMicrophonePermission=!0}else if(s){try{o=await navigator.mediaDevices.getUserMedia({video:t})}catch(f){if((n=pt(f.name||f.code||f,f.message)).code===dl.PERMISSION_DENIED)throw n;Ul.warning("getUserMedia failed in getDevices",n)}this.isAccessCameraPermission=!0}Ul.debug("[device manager] mic permission",e,"cam permission",t)}try{var c,l,u;const e=await navigator.mediaDevices.enumerateDevices();return r&&Ds(c=r.getTracks()).call(c,e=>e.stop()),o&&Ds(l=o.getTracks()).call(l,e=>e.stop()),a&&Ds(u=a.getTracks()).call(u,e=>e.stop()),r=null,o=null,a=null,e}catch(f){var d,h,p;return r&&Ds(d=r.getTracks()).call(d,e=>e.stop()),o&&Ds(h=o.getTracks()).call(h,e=>e.stop()),a&&Ds(p=a.getTracks()).call(p,e=>e.stop()),a=o=r=null,new xl(dl.ENUMERATE_DEVICES_FAILED,f.toString()).throw()}}async getRecordingDevices(e=!1){return e=await this.enumerateDevices(!0,!1,e),Io(e).call(e,e=>"audioinput"===e.kind)}async getCamerasDevices(e=!1){return e=await this.enumerateDevices(!1,!0,e),Io(e).call(e,e=>"videoinput"===e.kind)}async getSpeakers(e=!1){return e=await this.enumerateDevices(!0,!1,e),Io(e).call(e,e=>"audiooutput"===e.kind)}searchDeviceNameById(e){return(e=this.deviceInfoMap.get(e))?e.device.label||e.device.deviceId:null}searchDeviceIdByName(e){var t;let n=null;return Ds(t=this.deviceInfoMap).call(t,t=>{t.device.label===e&&(n=t.device.deviceId)}),n}async getDeviceById(e){var t=await this.enumerateDevices(!0,!0,!0);if(!(t=hc(t).call(t,t=>t.deviceId===e)))throw new xl(dl.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Yl.INITING;try{await this.updateDevicesInfo(),this.state=Yl.INITEND}catch(gl){throw Ul.warning("Device Detection functionality cannot start properly.",gl.toString()),this.state=Yl.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new xl(dl.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),gl}}async updateDevicesInfo(){var e;const t=await this.enumerateDevices(!0,!0,!0),n=wd(),r=[],i=this.checkMediaDeviceInfoIsOk(t);if(Ds(t).call(t,e=>{if(e.deviceId){var t=this.deviceInfoMap.get(e.deviceId);if("ACTIVE"!==(t?t.state:"INACTIVE")){const t={initAt:n,updateAt:n,device:e,state:"ACTIVE"};this.deviceInfoMap.set(e.deviceId,t),r.push(t)}t&&(t.updateAt=n)}}),Ds(e=this.deviceInfoMap).call(e,(e,t)=>{"ACTIVE"===e.state&&e.updateAt!==n&&(e.state="INACTIVE",r.push(e))}),this.state!==Yl.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));Ds(r).call(r,e=>{switch(e.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(ql.RECORDING_DEVICE_CHANGED,e);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(ql.CAMERA_DEVICE_CHANGED,e);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(ql.PLAYOUT_DEVICE_CHANGED,e)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=Io(e).call(e,e=>"audioinput"===e.kind);e=Io(e).call(e,e=>"videoinput"===e.kind);const n={audio:!1,video:!1};for(const r of t)if(r.label&&r.deviceId){n.audio=!0;break}for(const r of e)if(r.label&&r.deviceId){n.video=!0;break}return n}};var Kd=[].slice,Yd=/MSIE .\./.test(co),qd=function(e){return function(t,n){var r=2<arguments.length,i=r?Kd.call(arguments,2):void 0;return e(r?function(){("function"==typeof t?t:Function(t)).apply(this,i)}:t,n)}};Zn({global:!0,bind:!0,forced:Yd},{setTimeout:qd(mn.setTimeout),setInterval:qd(mn.setInterval)});var zd=Wn.setTimeout;let Xd=0,Qd=0,Jd=new class{constructor(){var e,t;this.baseInfoMap=new _s,this.clientList=nl,this.keyEventUploadPendingItems=[],this.normalEventUploadPendingItems=[],this.apiInvokeUploadPendingItems=[],this.apiInvokeCount=0,this.ltsList=[],this.lastSendNormalEventTime=wd(),this.customReportCount=0,this.eventUploadTimer=window.setInterval(gc(e=this.doSend).call(e,this),el.EVENT_REPORT_SEND_INTERVAL),this.setSessionIdTimer=window.setInterval(gc(t=this.appendSessionId).call(t,this),el.EVENT_REPORT_SEND_INTERVAL)}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=void 0===t.reportResult||t.reportResult;const r=wd(),i=this.apiInvokeCount+=1,s=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options}),o=!!el.SHOW_REPORT_INVOKER_LOG;o&&Ul.info("".concat(t.name," start"),t.options);let a=!1;qe(t.timeout).then(()=>{a||(this.sendApiInvoke(vt({},s(),{error:dl.API_INVOKE_TIMEOUT,success:!1})),Ul.debug("".concat(t.name," timeout")))});const c=new xl(dl.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:e=>{const r=()=>{if(a)throw c;return a=!0,this.sendApiInvoke(vt({},s(),{success:!0},t.reportResult&&{result:e})),o&&Ul.info("".concat(t.name," onSuccess")),e};return n?Ud(r,t.name+"Success",n,()=>a=!0):r()},onError:e=>{const r=()=>{if(a)throw e;a=!0,this.sendApiInvoke(vt({},s(),{success:!1,error:e.toString()})),o&&Ul.info("".concat(t.name," onFailure"),e.toString())};return n?Ud(r,t.name+"Error",n,()=>a=!0):r()}}}sessionInit(e,t){if(!this.baseInfoMap.has(e)){var n=wd();(e=this.createBaseInfo(e,n)).cname=t.cname;var r=Us({},{willUploadConsoleLog:el.UPLOAD_LOG,maxTouchPoints:navigator.maxTouchPoints,areaVersion:zc?"global":"oversea",areas:el.AREAS&&el.AREAS.join(",")},t.extend),i=wd();t=vt({},e,{eventType:jl.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,build:"v4.5.0-0-g87245ad6(5/25/2021, 3:25:26 PM)",lts:i,elapse:i-n,extend:cr(r),mode:t.mode,process:el.PROCESS_ID,success:!0,version:Yc}),this.send({type:Gl.SESSION,data:t},!0)}}joinChooseServer(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=wd();t=vt({},n,{eventType:jl.JOIN_CHOOSE_SERVER,lts:r,eventElapse:r-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:r-e.startTime,success:t.succ,chooseServerAddrList:cr(t.serverList),uid:t.uid?Zs(t.uid):null,cid:t.cid?Zs(t.cid):null,chooseServerIp:t.csIp||""}),this.send({type:Gl.JOIN_CHOOSE_SERVER,data:t},!0)}}reqUserAccount(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=wd();t=vt({},n,{eventType:jl.REQ_USER_ACCOUNT,lts:r,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:r-e.startTime,eventElapse:r-t.lts,extend:cr(t.extend)}),this.send({type:Gl.REQ_USER_ACCOUNT,data:t},!0)}}joinGateway(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info;t.vid&&(n.vid=t.vid),n.uid=t.uid,n.cid=t.cid;var r=wd();n=vt({},n,{eventType:jl.JOIN_GATEWAY,lts:r,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,elapse:r-e.startTime,eventElapse:r-t.lts}),t.succ&&(e.lastJoinSuccessTime=r),this.send({type:Gl.JOIN_GATEWAT,data:n},!0)}}joinChannelTimeout(e,t){if(e=this.baseInfoMap.get(e)){var n=wd();t=vt({},e.info,{lts:n,timeout:t,elapse:n-e.startTime}),this.send({type:Gl.JOIN_CHANNEL_TIMEOUT,data:t},!0)}}publish(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=wd();t=vt({},n,{eventType:jl.PUBLISH,lts:r,eventElapse:r-t.lts,elapse:r-e.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid}),this.send({type:Gl.PUBLISH,data:t},!0)}}subscribe(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=wd();e=vt({},n,{eventType:jl.SUBSCRIBE,lts:r,eventElapse:r-t.lts,elapse:r-e.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid}),"string"==typeof t.peerid?e.peerSuid=t.peerid:e.peer=t.peerid,this.send({type:Gl.SUBSCRIBE,data:e},!0)}}firstRemoteFrame(e,t,n,r){if(e=this.baseInfoMap.get(e)){var i=e.info,s=wd();t=vt({},i,{},r,{elapse:s-e.startTime,eventType:t,lts:s}),this.send({type:n,data:t},!0)}}onGatewayStream(e,t,n,r){(e=this.baseInfoMap.get(e))&&(t=vt({},e.info,{},r,{eventType:t,lts:wd()}),this.send({type:n,data:t},!0))}streamSwitch(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=wd();t=vt({},n,{eventType:jl.STREAM_SWITCH,lts:r,isDual:t.isdual,elapse:r-e.startTime,success:t.succ}),this.send({type:Gl.STREAM_SWITCH,data:t},!0)}}requestProxyAppCenter(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=wd();t=vt({},n,{eventType:jl.REQUEST_PROXY_APPCENTER,lts:r,eventElapse:r-t.lts,elapse:r-e.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ}),this.send({type:Gl.REQUEST_PROXY_APPCENTER,data:t},!0)}}requestProxyWorkerManager(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=wd();t=vt({},n,{eventType:jl.REQUEST_PROXY_WORKER_MANAGER,lts:r,eventElapse:r-t.lts,elapse:r-e.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ}),this.send({type:Gl.REQUEST_PROXY_WORKER_MANAGER,data:t},!0)}}setProxyServer(e){(this.proxyServer=e)?Ul.debug("reportProxyServerurl: ".concat(e)):Ul.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=wd();t=vt({},n,{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:0<t.audioPublishDuration?1:-1,videotag:0<t.videoPublishDuration?1:-1,lts:r,elapse:r-e.startTime,joinChannelSuccessElapse:r-(e.lastJoinSuccessTime||r)}),this.send({type:Gl.PEER_PUBLISH_STATUS,data:t},!0)}}workerEvent(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=wd();t=function(e,t,n){const r=e[t];if(!r||"string"!=typeof r)return[e];e[t]="";const i=Ye(cr(e));let s=0;const o=[];let a=0;for(let c=0;c<r.length;c++)a+=127>=r.charCodeAt(c)?1:3,a<=1300-i||(o[o.length]=Ke({},e,{[t]:r.substring(s,c)}),s=c,a=127>=r.charCodeAt(c)?1:3);return s!==r.length-1&&(o[o.length]=Ke({},e,{[t]:r.substring(s)})),o}(vt({},n,{},t,{elapse:r-e.startTime,lts:r,productType:"WebRTC"}),"payload"),Ds(t).call(t,e=>this.send({type:Gl.WORKER_EVENT,data:e},!0))}}apworkerEvent(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=wd();t=vt({},n,{},t,{elapse:r-e.startTime,lts:r}),this.send({type:Gl.AP_WORKER_EVENT,data:t},!0)}}joinWebProxyAP(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=wd();t=vt({},n,{},t,{elapse:r-e.startTime,lts:r}),this.send({type:Gl.JOIN_WEB_PROXY_AP,data:t},!0)}}WebSocketQuit(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=wd();t=vt({},n,{},t,{elapse:r-e.startTime,lts:r}),this.send({type:Gl.WEBSOCKET_QUIT,data:t},!0)}}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>el.CUSTOM_REPORT_LIMIT)throw new xl(dl.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3)),t=Ka(t).call(t,t=>({type:Gl.USER_ANALYTICS,data:vt({sid:e},t)})),t={msgType:"EventMessages",sentTs:Math.round(wd()/1e3),payloads:Ka(t).call(t,e=>cr(e))};try{await this.postDataToStatsCollector(t)}catch(n){throw Ul.error("send custom report message failed",n.toString()),new xl(dl.CUSTOM_REPORT_SEND_FAILED,n.message)}}sendApiInvoke(e){var t=el.NOT_REPORT_EVENT;if(e.tag&&Rc(t)&&Rc(t).call(t,e.tag))return!1;if(null===e.sid)return this.apiInvokeUploadPendingItems.push(e),!1;if(!(t=this.baseInfoMap.get(e.sid)))return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:n,uid:r,cid:i}=t.info;return e.lts=e.lts||wd(),e={invokeId:e.invokeId,sid:e.sid,cname:n,cid:i,uid:r,lts:e.lts,success:e.success,elapse:e.lts-t.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?cr(e.options):void 0,execStates:e.states?cr(e.states):void 0,execResult:e.result?cr(e.result):void 0,errorCode:e.error?cr(e.error):void 0},this.send({type:Gl.API_INVOKE,data:e},!1),!0}appendSessionId(){var e;Ds(e=this.clientList).call(e,e=>{if(e._sessionId){const t=this.apiInvokeUploadPendingItems.length;for(let n=0;n<t;n++){const t=this.apiInvokeUploadPendingItems.shift();t&&(t.sid=e._sessionId,this.sendApiInvoke(Us({},t)))}}})}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);var n;this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>el.NORMAL_EVENT_QUEUE_CAPACITY&&Qa(n=this.normalEventUploadPendingItems).call(n,0,1),10<=this.normalEventUploadPendingItems.length&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){0<this.keyEventUploadPendingItems.length&&this.sendItems(this.keyEventUploadPendingItems,!0),0<this.normalEventUploadPendingItems.length&&5e3<=wd()-this.lastSendNormalEventTime&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[];for(var r=[];e.length;){const t=e.shift();20>n.length?n.push(t):r.push(t)}e.push(...r);for(const o of[...n]){var i,s;-1!==nc(i=this.ltsList).call(i,o.data.lts)?(o.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(o.data.lts)):(this.ltsList.push(o.data.lts),ul(s=this.ltsList).call(s,(e,t)=>e-t))}return t||(this.lastSendNormalEventTime=wd()),r={msgType:"EventMessages",sentTs:Math.round(wd()/1e3),payloads:Ka(n).call(n,e=>cr(e)),vid:(e=>(e=e&&e.data.sid&&this.baseInfoMap.get(e.data.sid))&&e.info.vid&&+e.info.vid||0)(n[0])},n.length&&this.postDataToStatsCollector(r).catch((e=>n=>{var r,i,s;t?this.keyEventUploadPendingItems=To(r=this.keyEventUploadPendingItems).call(r,e):(this.normalEventUploadPendingItems=To(i=this.normalEventUploadPendingItems).call(i,e),this.normalEventUploadPendingItems.length>el.NORMAL_EVENT_QUEUE_CAPACITY&&(Qa(s=this.normalEventUploadPendingItems).call(s,0,this.normalEventUploadPendingItems.length-el.NORMAL_EVENT_QUEUE_CAPACITY),Ul.warning("report: drop normal events")))})(n)),e}async postDataToStatsCollector(e,t=!1){var n,r,i;const s=t?"/events/proto-raws":"/events/messages";let o=this.url||(this.proxyServer?To(n=To(r="https://".concat(this.proxyServer,"/rs/?h=")).call(r,el.EVENT_REPORT_DOMAIN,"&p=6443&d=")).call(n,s):To(i="https://".concat(el.EVENT_REPORT_DOMAIN,":6443")).call(i,s));for(n=0;2>n;n+=1){var a,c,l;1===n&&(o=this.backupUrl||(this.proxyServer?To(a=To(c="https://".concat(this.proxyServer,"/rs/?h=")).call(c,el.EVENT_REPORT_BACKUP_DOMAIN,"&p=6443&d=")).call(a,s):To(l="https://".concat(el.EVENT_REPORT_BACKUP_DOMAIN,":6443")).call(l,s)));try{t?await gt(o,{timeout:1e4,data:e}):await mt(o,{timeout:1e4,data:e})}catch(u){if(1===n)throw u;continue}break}}createBaseInfo(e,t){const n=Us({},Bl);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}},$d={[zl.ACCESS_POINT]:{[Jl.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Jl.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Jl.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Jl.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Jl.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Jl.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voice service available",retry:!0},[Jl.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Jl.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Jl.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Jl.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Jl.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Jl.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Jl.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Jl.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Jl.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Jl.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[zl.UNILBS]:{[Ql.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Ql.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Ql.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Ql.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Ql.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Ql.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Ql.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Ql.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Ql.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Ql.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Ql.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Ql.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[zl.STRING_UID_ALLOCATOR]:{[Xl.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Xl.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Xl.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}},Zd={[$l.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[$l.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[$l.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[$l.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[$l.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[$l.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[$l.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[$l.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[$l.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[$l.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[$l.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[$l.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[$l.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[$l.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[$l.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[$l.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[$l.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[$l.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[$l.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[$l.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[$l.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[$l.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[$l.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[$l.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[$l.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[$l.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[$l.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[$l.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[$l.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[$l.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[$l.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[$l.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[$l.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[$l.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[$l.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[$l.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[$l.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[$l.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[$l.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[$l.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[$l.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[$l.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[$l.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[$l.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[$l.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[$l.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[$l.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[$l.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[$l.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[$l.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[$l.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[$l.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[$l.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[$l.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[$l.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[$l.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"}},eh={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};class th extends bd{constructor(e,t){super(),this.currentURLIndex=this.connectionID=0,this.reconnectMode="tryNext",this._state="closed",this.reconnectCount=0,this.name=e,this.retryConfig=t}get url(){return this.websocket?this.websocket.url:null}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(pu.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(pu.CONNECTED):"closed"===this._state?this.emit(pu.CLOSED):"failed"===this._state&&this.emit(pu.FAILED))}init(e){return new Ga((t,n)=>{this.urls=e;let r=this.urls[this.currentURLIndex];this.state="connecting",this.createWebSocketConnection(r).then(t).catch(n),this.once(pu.CLOSED,()=>n(new xl(dl.WS_DISCONNECT))),this.once(pu.CONNECTED,()=>t())})}close(e,t){if(this.currentURLIndex=0,this.reconnectCount=0,this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let e=this.websocket;t?zd(()=>e.close(),500):e.close(),this.websocket=void 0}this.state=e?"failed":"closed"}reconnect(e,t){this.websocket?(void 0!==e&&(this.reconnectMode=e),Ul.debug("[".concat(this.name,"] reconnect is triggered initiative")),e=this.websocket.onclose,this.websocket.onclose=null,this.websocket.close(),e&&gc(e).call(e,this.websocket)({code:9999,reason:t})):Ul.warning("[".concat(this.name,"] can not reconnect, no websocket"))}sendMessage(e){if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new xl(dl.WS_ABORT,"websocket is not ready");e=cr(e);try{this.websocket.send(e)}catch(t){throw new xl(dl.WS_ERR,"send websocket message error"+t.toString())}}async createWebSocketConnection(e){let t=this.connectionID+=1;return new Ga((n,r)=>{var i,s;this.websocket&&(this.websocket.onclose=null,this.websocket.close()),el.GATEWAY_WSS_ADDRESS&&Pc(i=this.name).call(i,"gateway")&&(e=el.GATEWAY_WSS_ADDRESS),Ul.debug(To(s="[".concat(this.name,"] start connect, url: ")).call(s,e));try{this.websocket=new WebSocket(e),this.websocket.binaryType="arraybuffer"}catch(a){var o;return i=new xl(dl.WS_ERR,"init websocket failed! Error: ".concat(a.toString())),Ul.error(To(o="[".concat(this.name,"]")).call(o,i)),void r(i)}qe(5e3).then(()=>{t===this.connectionID&&this.websocket&&this.websocket.readyState!==WebSocket.OPEN&&this.websocket&&this.websocket.close()}),this.websocket.onopen=()=>{Ul.debug("[".concat(this.name,"] websocket opened:"),e),this.reconnectMode="retry",this.state="connected",this.reconnectCount=0,n()},this.websocket.onclose=async e=>{var t,i,s,o;if(Ul.debug(To(t=To(i=To(s=To(o="[".concat(this.name,"] websocket close ")).call(o,this.websocket&&this.websocket.url,", code: ")).call(s,e.code,", reason: ")).call(i,e.reason,", current mode: ")).call(t,this.reconnectMode)),this.reconnectCount<this.retryConfig.maxRetryCount){if("connected"===this.state&&(this.reconnectReason=e.reason,this.state="reconnecting"),t=et(this,pu.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,t=await this.reconnectWithAction(t),"closed"===this.state)return void Ul.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!t)return r(new xl(dl.WS_DISCONNECT,"websocket reconnect failed: ".concat(e.code))),void this.close(!0);n()}else r(new xl(dl.WS_DISCONNECT,"websocket close: ".concat(e.code))),this.close()},this.websocket.onmessage=e=>{this.emit(pu.ON_MESSAGE,e)}})}async reconnectWithAction(e,t){var n,r;if(!t&&this.reconnectCount>=this.retryConfig.maxRetryCount||!this.urls||"closed"===this.state)return!1;if(this.onlineReconnectListener||!navigator||void 0===navigator.onLine||navigator.onLine||(this.onlineReconnectListener=new Ga(e=>{let t=()=>{this.onlineReconnectListener=void 0,window.removeEventListener("online",t),e()};window.addEventListener("online",t)})),t=function(e,t){return Math.min(t.maxRetryTimeout,t.timeout*Math.pow(t.timeoutFactor,e))}(this.reconnectCount,this.retryConfig),Ul.debug(To(n=To(r="[".concat(this.name,"] wait ")).call(r,t,"ms to reconnect websocket, mode: ")).call(n,e)),await Ga.race([qe(t),this.onlineReconnectListener||new Ga(()=>{})]),"closed"===this.state)return!1;this.reconnectCount+=1;try{if("retry"===e)await this.createWebSocketConnection(this.urls[this.currentURLIndex]);else if("tryNext"===e){var i,s;if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return await this.reconnectWithAction("recover");Ul.debug(To(i=To(s="[".concat(this.name,"] websocket url length: ")).call(s,this.urls.length," current index: ")).call(i,this.currentURLIndex)),await this.createWebSocketConnection(this.urls[this.currentURLIndex])}else"recover"===e&&(Ul.debug("[".concat(this.name,"] request new urls")),this.urls=await $e(this,pu.REQUEST_NEW_URLS),this.currentURLIndex=0,await this.createWebSocketConnection(this.urls[this.currentURLIndex]));return!0}catch(o){return Ul.error("[".concat(this.name,"] reconnect failed"),o.toString()),await this.reconnectWithAction(e)}}}class nh{constructor(e){this.input=[],this.size=e}add(e){var t;this.input.push(e),this.input.length>this.size&&Qa(t=this.input).call(t,0,1)}mean(){var e;return 0===this.input.length?0:Hs(e=this.input).call(e,(e,t)=>e+t)/this.input.length}}class rh extends bd{constructor(e){super(),this._connectionState=tu.CLOSED,this.openConnectionTime=wd(),this.lastMsgTime=wd(),this.uploadCache=[],this.rttRolling=new nh(5),this.pingpongTimeoutCount=0,this.onWebsocketMessage=e=>{if(e.data instanceof ArrayBuffer)this.emit(nu.ON_BINARY_DATA,e.data);else if(e=JSON.parse(e.data),this.lastMsgTime=wd(),Object.prototype.hasOwnProperty.call(e,"_id")){let t="res-@".concat(e._id);this.emit(t,e._result,e._message)}else if(Object.prototype.hasOwnProperty.call(e,"_type")&&(this.emit(e._type,e._message),e._type===su.ON_NOTIFICATION&&this.handleNotification(e._message),e._type===su.ON_USER_BANNED))switch(e._message.error_code){case 14:this.close("UID_BANNED");break;case 15:this.close("IP_BANNED");break;case 16:this.close("CHANNEL_BANNED")}},this.clientId=e.clientId,this.spec=e,this.websocket=new th("gateway-".concat(this.clientId),this.spec.retryConfig),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===tu.CONNECTED&&this.reconnect("retry",eu.OFFLINE)})}get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===tu.CONNECTED?this.emit(nu.WS_CONNECTED):e===tu.RECONNECTING?this.emit(nu.WS_RECONNECTING,this._websocketReconnectReason):e===tu.CLOSED&&this.emit(nu.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}async request(e,t,n){var r,i,s,o,a;let c=Xe(6,"");var l={_id:c,_type:e,_message:t};let u=this.websocket.connectionID;var d=()=>new Ga((e,t)=>{if(this.connectionState===tu.CONNECTED)return e();const n=()=>{this.off(nu.WS_CLOSED,r),e()},r=()=>{this.off(nu.WS_CONNECTED,n),t(new xl(dl.WS_ABORT))};this.once(nu.WS_CONNECTED,n),this.once(nu.WS_CLOSED,r)});this.connectionState!==tu.CONNECTING&&this.connectionState!==tu.RECONNECTING||e===ru.JOIN||e===ru.REJOIN||await d();var h=new Ga((n,r)=>{let i=!1;const s=(r,s)=>{i=!0,n({isSuccess:"success"===r,message:s||{}}),this.off(nu.WS_CLOSED,o),this.off(nu.WS_RECONNECTING,o),this.emit(nu.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(c),s);const o=()=>{r(new xl(dl.WS_ABORT,"type: ".concat(e))),this.off(nu.WS_CLOSED,o),this.off(nu.WS_RECONNECTING,o),this.off("res-@".concat(c),s)};this.once(nu.WS_CLOSED,o),this.once(nu.WS_RECONNECTING,o),qe(el.SIGNAL_REQUEST_TIMEOUT).then(()=>{this.websocket.connectionID!==u||i||(Ul.warning("ws request timeout, type: ".concat(e)),this.emit(nu.REQUEST_TIMEOUT,e,t))})});this.websocket.sendMessage(l),l=null;try{l=await h}catch(p){if(this.connectionState===tu.CLOSED||e===ru.LEAVE)throw new xl(dl.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?p.throw():e===ru.JOIN||e===ru.REJOIN?null:(await d(),await this.request(e,t))}return l.isSuccess?l.message:(d=Rt(n=Number(l.message.error_code||l.message.code)),h=new xl(dl.UNEXPECTED_RESPONSE,To(r="".concat(d.desc,": ")).call(r,l.message.error_str),{code:n,data:l.message}),"success"===d.action?l.message:(Ul.warning(To(i=To(s=To(o=To(a="[".concat(this.websocket.connectionID,"] unexpected response from type ")).call(a,e,", error_code: ")).call(o,n,", message: ")).call(s,d.desc,", action: ")).call(i,d.action)),"failed"===d.action?h.throw():"quit"===d.action?(this.initError=h,this.close(),h.throw()):(n===$l.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,Ul.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",eu.MULTI_IP)):this.reconnect(d.action,eu.SERVER_ERROR),e===ru.JOIN||e===ru.REJOIN?null:await this.request(e,t))))}waitMessage(e,t){return new Ga(n=>{let r=i=>{t&&!t(i)||(this.off(e,r),n(i))};this.on(e,r)})}upload(e,t){e={_type:e,_message:t};try{this.websocket.sendMessage(e)}catch(r){var n;Ul.info("[".concat(this.clientId,"] upload failed, cache message"),r),t=el.MAX_UPLOAD_CACHE||50,this.uploadCache.push(e),this.uploadCache.length>t&&Qa(n=this.uploadCache).call(n,0,1),0<this.uploadCache.length&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{var e;if(this.connectionState===tu.CONNECTED){var t=Qa(e=this.uploadCache).call(e,0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(t._type,t._message)}},el.UPLOAD_CACHE_INTERVAL||2e3))}}send(e,t){this.websocket.sendMessage({_type:e,_message:t})}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,new Ga((t,n)=>{this.once(nu.WS_CONNECTED,()=>t(this.joinResponse)),this.once(nu.WS_CLOSED,()=>n(this.initError||new xl(dl.WS_ABORT))),this.connectionState=tu.CONNECTING,this.websocket.init(e).catch(n)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.joinResponse=this.reconnectToken=void 0,this._disconnectedReason=e||"LEAVE",this.connectionState=tu.CLOSED,this.websocket.close()}async join(){var e;if(!this.joinResponse){var t=tt(this,nu.REQUEST_JOIN_INFO);if(!(t=await this.request(ru.JOIN,t)))return this.emit(nu.REPORT_JOIN_GATEWAY,dl.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=tu.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(gc(e=this.handlePingPong).call(e,this),3e3),!0}async rejoin(){var e,t;if(!this.reconnectToken)throw new xl(dl.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");var n=tt(this,nu.REQUEST_REJOIN_INFO);return n.token=this.reconnectToken,!!(n=await this.request(ru.REJOIN,n))&&(this.connectionState=tu.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(gc(e=this.handlePingPong).call(e,this),3e3),n.peers&&Ds(t=n.peers).call(t,e=>{this.emit(su.ON_USER_ONLINE,{uid:e.uid}),this.emit(e.audio_mute?su.MUTE_AUDIO:su.UNMUTE_AUDIO,{uid:e.uid}),this.emit(e.video_mute?su.MUTE_VIDEO:su.UNMUTE_VIDEO,{uid:e.uid}),this.emit(e.audio_enable_local?su.ENABLE_LOCAL_AUDIO:su.DISABLE_LOCAL_AUDIO,{uid:e.uid}),this.emit(e.video_enable_local?su.ENABLE_LOCAL_VIDEO:su.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||this.emit(su.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id}),e.audio&&this.emit(su.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0}),e.video&&this.emit(su.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0})}),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){if(Ul.debug("[".concat(this.clientId,"] receive notification: "),e),"success"!==(e=Rt(e.code)).action){if("failed"!==e.action)return"quit"===e.action?("ERR_REPEAT_JOIN_CHANNEL"===e.desc&&this.close("UID_BANNED"),void this.close()):void this.reconnect(e.action,eu.SERVER_ERROR);Ul.error("[".concat(this.clientId,"] ignore error: "),e.desc)}}handlePingPong(){if(this.websocket&&"connected"===this.websocket.state){0<this.pingpongTimeoutCount&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;var e=el.PING_PONG_TIME_OUT,t=wd();this.pingpongTimeoutCount>=e&&(Ul.warning("PINGPONG Timeout. Last Socket Message: ".concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>el.WEBSOCKET_TIMEOUT_MIN)?this.reconnect("retry",eu.TIMEOUT):this.request(ru.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let e=wd()-t;this.rttRolling.add(e),el.REPORT_STATS&&this.send(ru.PING_BACK,{pingpongElapse:e})}).catch(e=>{})}}handleWebsocketEvents(){this.websocket.on(pu.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(pu.CLOSED,()=>{this.connectionState=tu.CLOSED}),this.websocket.on(pu.FAILED,()=>{this._disconnectedReason="NETWORK_ERROR",this.connectionState=tu.CLOSED}),this.websocket.on(pu.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState=this.connectionState===tu.CONNECTED?tu.RECONNECTING:tu.CONNECTING}),this.websocket.on(pu.WILL_RECONNECT,(e,t)=>{if(tt(this,nu.IS_P2P_DISCONNECTED)&&"retry"===e)return this.reconnectToken=void 0,this.emit(nu.NEED_RENEW_SESSION),this.emit(nu.DISCONNECT_P2P),t("tryNext");"retry"!==e&&(this.reconnectToken=void 0,this.emit(nu.NEED_RENEW_SESSION),this.emit(nu.DISCONNECT_P2P)),t(e)}),this.websocket.on(pu.CONNECTED,()=>{this.openConnectionTime=wd(),this.reconnectToken?this.rejoin().catch(e=>{var t;Ul.warning(To(t="[".concat(this.clientId,"] rejoin failed ")).call(t,e)),this.reconnect("tryNext",eu.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(nu.REPORT_JOIN_GATEWAY,e.message||e.code,this.url||""),e instanceof xl&&e.code===dl.UNEXPECTED_RESPONSE&&e.data.code===$l.ERR_NO_AUTHORIZED)return Ul.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",eu.SERVER_ERROR);Ul.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",eu.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(pu.REQUEST_NEW_URLS,(e,t)=>{$e(this,nu.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})}}class ih extends bd{constructor(e,t){super(),this._hints=[],this._ID=t||Xe(8,"track-"),this._mediaStreamTrack=this._originMediaStreamTrack=e}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||(e=Jd.reportApiInvoke(null,{name:Wl.GET_MEDIA_STREAM_TRACK,options:[],tag:Kl.TRACER})).onSuccess(this._mediaStreamTrack&&"string"==typeof this._mediaStreamTrack.label?this._mediaStreamTrack.label:""),this._mediaStreamTrack}}class sh extends ih{constructor(e,t){super(e,t),this._enabled=!0,this._isClosed=!1,this._trackProcessors=[],this._handleTrackEnded=()=>{Ul.debug("[".concat(this.getTrackId,"] track ended")),this.emit(wu.TRACK_ENDED)},this._enabledMutex=new Bd("".concat(t)),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){return this._originMediaStreamTrack.label}close(){var e;this._isClosed||(this.stop(),Ds(e=this._trackProcessors).call(e,e=>e.destroy()),this._trackProcessors=[],this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,Ul.debug("[".concat(this.getTrackId(),"] close")),this.emit(Cu.NEED_CLOSE),this._isClosed=!0)}async _registerTrackProcessor(e){var t;if(-1===nc(t=this._trackProcessors).call(t,e)){var n=this._trackProcessors[this._trackProcessors.length-1];this._trackProcessors.push(e),e.onOutputChange=async()=>{this._mediaStreamTrack=e.output||this._originMediaStreamTrack,this._updatePlayerSource(),await Ze(this,Cu.NEED_REPLACE_TRACK,this._mediaStreamTrack)},n?(n.onOutputChange=async()=>{n.output&&await e.setInput(n.output)},await e.setInput(n.output||n.input||this._originMediaStreamTrack)):await e.setInput(this._originMediaStreamTrack)}}_getOutputFromProcessors(){if(0===this._trackProcessors.length)return this._originMediaStreamTrack;let e=this._trackProcessors[this._trackProcessors.length-1];return e.output||e.input||this._originMediaStreamTrack}async _updateOriginMediaStreamTrack(e,t){e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop(),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,0<this._trackProcessors.length?(await this._trackProcessors[0].setInput(e),this._mediaStreamTrack=this._getOutputFromProcessors()):this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ze(this,Cu.NEED_REPLACE_TRACK,this._mediaStreamTrack))}_getDefaultPlayerConfig(){return{}}}let oh=window.AudioContext||window.webkitAudioContext,ah=null,ch=new bd,lh=null;class uh extends bd{constructor(){super(),this.isPlayed=!1,this.audioOutputLevel=this.audioLevelBase=0,this.audioOutputLevelCache=null,this.audioOutputLevelCacheMaxLength=el.AUDIO_SOURCE_AVG_VOLUME_DURATION/el.AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL||15,this.isDestroyed=!1,this._noAudioInputCount=0,this.context=It(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Ct(this.outputNode),this.analyserNode=this.context.createAnalyser()}get isNoAudioInput(){return 3<=this.noAudioInputCount}get noAudioInputCount(){return this._noAudioInputCount}set noAudioInputCount(e){3>this._noAudioInputCount&&3<=e?this.onNoAudioInput&&this.onNoAudioInput():3<=this._noAudioInputCount&&0==this._noAudioInputCount%10&&this.onNoAudioInput&&this.onNoAudioInput(),this._noAudioInputCount=e}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=e=>{this.emit(au.ON_AUDIO_BUFFER,function(e){for(let t=0;t<e.outputBuffer.numberOfChannels;t+=1){let n=e.outputBuffer.getChannelData(t);for(let e=0;e<n.length;e+=1)n[e]=0}return e.inputBuffer}(e))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Pu.webAudioMediaStreamDest)throw new xl(dl.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){"running"!==this.context.state&&it(()=>{ch.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(gl){}this.isPlayed=!1}getAudioLevel(){return this.audioOutputLevel}getAccurateVolumeLevel(){let e=new Uint8Array(this.analyserNode.frequencyBinCount);this.analyserNode.getByteFrequencyData(e);let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}getAudioAvgLevel(){var e;return null===this.audioOutputLevelCache&&(this.audioOutputLevelCache=[this.audioOutputLevel]),Hs(e=this.audioOutputLevelCache).call(e,(e,t)=>e+t)/this.audioOutputLevelCache.length}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}setMute(e){e?(this.disconnect(),this.audioLevelBase=0,this.audioOutputLevel=0):this.connect()}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){this.sourceNode&&this.sourceNode.disconnect(),this.outputNode&&this.outputNode.disconnect(),window.clearInterval(this.updateAudioOutputLevelInterval)}connect(){var e;this.sourceNode&&this.sourceNode.connect(this.outputNode),this.outputNode.connect(this.analyserNode),this.updateAudioOutputLevelInterval=window.setInterval(gc(e=this.updateAudioOutputLevel).call(e,this),el.AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL||400)}updateAudioOutputLevel(){if(this.context&&"running"!==this.context.state&&this.context.resume(),this.analyserNode){if(this.analyserNode.getFloatTimeDomainData){var e=new Float32Array(this.analyserNode.frequencyBinCount);this.analyserNode.getFloatTimeDomainData(e)}else{var t;e=new Uint8Array(this.analyserNode.frequencyBinCount),this.analyserNode.getByteTimeDomainData(e);let n=!0;e=new Float32Array(Ka(t=Ad(e)).call(t,e=>(128!==e&&(n=!1),.0078125*(e-128)))),n?this.noAudioInputCount+=1:this.noAudioInputCount=0}for(t=0;t<e.length;t+=1)Math.abs(e[t])>this.audioLevelBase&&(this.audioLevelBase=Math.abs(e[t]),1<this.audioLevelBase&&(this.audioLevelBase=1));this.audioOutputLevel=this.audioLevelBase,this.audioLevelBase/=4,null!==this.audioOutputLevelCache&&(this.audioOutputLevelCache.push(this.audioOutputLevel),this.audioOutputLevelCache.length>this.audioOutputLevelCacheMaxLength&&this.audioOutputLevelCache.shift())}}}class dh extends uh{constructor(e,t){if(super(),this.isCurrentTrackCloned=!1,this.isRemoteTrack=!1,this.rebuildWebAudio=()=>{if(Ul.debug("ready to rebuild web audio, state:",this.context.state),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void Ul.debug("rebuild web audio success, current volume",this.getAudioLevel());this.context.resume().then(()=>Ul.info("resume success")),Ul.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();var e=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?e.stop():this.isCurrentTrackCloned=!0,e=new MediaStream([this.track]),this.sourceNode=this.context.createMediaStreamSource(e),Ct(this.sourceNode),this.analyserNode=this.context.createAnalyser();let t=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(t,this.context.currentTime),Ct(this.outputNode),this.connect(),this.audioElement.srcObject=e,this.isPlayed&&this.play(this.playNode)},"audio"!==e.kind)throw new xl(dl.UNEXPECTED_ERROR);this.track=e,e=new MediaStream([this.track]),this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(e),Ct(this.sourceNode),this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=e,e=De(),t&&e.os===Lc.IOS&&(ch.on("state-change",this.rebuildWebAudio),this.onNoAudioInput=()=>{document.body.addEventListener("click",this.rebuildWebAudio,!0)})}get isFreeze(){return!1}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1,e=new MediaStream([e]),this.sourceNode=this.context.createMediaStreamSource(e),Ct(this.sourceNode),this.sourceNode.connect(this.outputNode),this.audioElement.srcObject=e}destroy(){this.audioElement.remove(),ch.off("state-change",this.rebuildWebAudio),super.destroy()}}let hh=new class{constructor(){this.elementMap=new _s,this.elementsNeedToResume=[],this.sinkIdMap=new _s,this.autoResumeAudioElement()}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(r){throw new xl(dl.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(e,t,n){if(!this.elementMap.has(t)){var r=document.createElement("audio");r.autoplay=!0,r.srcObject=new MediaStream([e]),this.elementMap.set(t,r),this.setVolume(t,n),(e=this.sinkIdMap.get(t))&&r.setSinkId(e).catch(e=>{Ul.warning("[".concat(t,"] set sink id failed"),e.toString())}),(e=r.play())&&e.then&&e.catch(e=>{Ul.warning("audio element play warning",e.toString()),this.elementMap.has(t)&&"NotAllowedError"===e.name&&(Ul.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(r),it(()=>{this.onAutoplayFailed&&this.onAutoplayFailed()}))})}}updateTrack(e,t){(e=this.elementMap.get(e))&&(e.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)}setVolume(e,t){(e=this.elementMap.get(e))&&(t=Math.max(0,Math.min(100,t)),e.volume=t/100)}stop(e){var t,n;const r=this.elementMap.get(e);if(this.sinkIdMap.delete(e),r){var i=nc(t=this.elementsNeedToResume).call(t,r);Qa(n=this.elementsNeedToResume).call(n,i,1),r.srcObject=null,r.remove(),this.elementMap.delete(e)}}autoResumeAudioElement(){const e=()=>{var e;Ds(e=this.elementsNeedToResume).call(e,e=>{e.play().then(e=>{Ul.debug("Auto resume audio element success")}).catch(e=>{Ul.warning("Auto resume audio element failed!",e)})}),this.elementsNeedToResume=[]};new Ga(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)})}};class ph extends sh{constructor(e,t,n){super(e,n),this.trackMediaType="audio",this._enabled=!0,this._volume=100,this._useAudioElement=!0,this._encoderConfig=t,this._source=new dh(e)}get isPlaying(){return this._useAudioElement?hh.isPlaying(this.getTrackId()):this._source.isPlayed}setVolume(e){Ee(e,"volume",0,1e3);let t=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.LOCAL_AUDIO_TRACK_SET_VOLUME,options:[this.getTrackId(),e]},300);this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&hh.setVolume(this.getTrackId(),e);try{let e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,Ze(this,Cu.NEED_REPLACE_TRACK,this._mediaStreamTrack).then(()=>{Ul.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(e=>{Ul.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),e)}))}catch(n){}t.onSuccess()}getVolumeLevel(){return this._source.getAudioLevel()}async setPlaybackDevice(e){let t=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.REMOTE_AUDIO_SET_OUTPUT_DEVICE,options:[this.getTrackId(),e]});if(!this._useAudioElement)throw new xl(dl.NOT_SUPPORTED,"your browser does not support setting the audio output device");try{await hh.setSinkID(this.getTrackId(),e)}catch(n){throw t.onError(n),n}t.onSuccess()}async setEnabled(e){var t;if(e!==this._enabled){Ul.info("[".concat(this.getTrackId(),"] start setEnabled"),e);var n=await this._enabledMutex.lock();if(!e){this._originMediaStreamTrack.enabled=!1;try{await Ze(this,Cu.NEED_REMOVE_TRACK,this)}catch(r){throw Ul.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),n(),r}return this._enabled=!1,n()}this._originMediaStreamTrack.enabled=!0;try{await Ze(this,Cu.NEED_ADD_TRACK,this)}catch(r){throw Ul.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),n(),r}Ul.info(To(t="[".concat(this.getTrackId(),"] setEnabled to ")).call(t,e," success")),this._enabled=!0,n()}}getStats(){return st(()=>{Ul.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),et(this,Cu.GET_STATS)||bt({},cu)}setAudioFrameCallback(e,t=4096){if(!e)return this._source.removeAllListeners(au.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(au.ON_AUDIO_BUFFER),this._source.on(au.ON_AUDIO_BUFFER,t=>e(t))}play(){let e=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.LOCAL_AUDIO_TRACK_PLAY,options:[this.getTrackId()]});Ul.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(Ul.debug("[".concat(this.getTrackId(),"] start audio playback in element")),hh.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play(),e.onSuccess()}stop(){let e=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.LOCAL_AUDIO_TRACK_STOP,options:[this.getTrackId()]});Ul.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?hh.stop(this.getTrackId()):this._source.stop(),e.onSuccess()}close(){super.close(),this._source.destroy()}_updatePlayerSource(){Ul.debug("[track-".concat(this.getTrackId(),"] update player source track")),this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&hh.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e.addEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop(),this._originMediaStreamTrack=e,this._source.updateTrack(this._originMediaStreamTrack),this._mediaStreamTrack!==this._source.outputTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ze(this,Cu.NEED_REPLACE_TRACK,this._mediaStreamTrack)))}}class fh extends ph{constructor(e,t,n,r){super(e,t.encoderConfig?$(t.encoderConfig):{},r),this._deviceName="default",this._enabled=!0,this._config=t,this._constraints=n,this._deviceName=e.label}async setDevice(e){var t,n;let r=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.MIC_AUDIO_TRACK_SET_DEVICE,options:[this.getTrackId(),e]});if(Ul.info(To(t="[".concat(this.getTrackId,"] start set device to ")).call(t,e)),this._enabled)try{let n=await Wd.getDeviceById(e);(t={}).audio=bt({},this._constraints),t.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await dt(t,this.getTrackId())}catch(i){throw Ul.error("[track-".concat(this.getTrackId(),"] setDevice failed"),i.toString()),r=await dt({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=n.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(s){throw r.onError(s),Ul.error("[track-".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{this._deviceName=(await Wd.getDeviceById(e)).label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(s){throw r.onError(s),Ul.error("[track-".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}r.onSuccess(),Ul.info(To(n="[".concat(this.getTrackId,"] set device to ")).call(n,e," success"))}async setEnabled(e,t){if(t)return Ul.debug("[".concat(this.getTrackId,"] setEnabled false (do not close microphone)")),await super.setEnabled(e);if(e!==this._enabled){if(Ul.info("[".concat(this.getTrackId(),"] start setEnabled"),e),t=await this._enabledMutex.lock(),!e){this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),this._enabled=!1;try{await Ze(this,Cu.NEED_REMOVE_TRACK,this)}catch(r){throw Ul.error("[".concat(this.getTrackId(),"] setEnabled false failed"),r.toString()),t(),r}return void t()}e=bt({},this._constraints);var n=Wd.searchDeviceIdByName(this._deviceName);n&&!e.deviceId&&(e.deviceId=n);try{let e=await dt({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!1),await Ze(this,Cu.NEED_ADD_TRACK,this)}catch(r){throw t(),Ul.error("[".concat(this.getTrackId(),"] setEnabled true failed"),r.toString()),r}this._enabled=!0,Ul.info("[".concat(this.getTrackId(),"] setEnabled success")),t()}}}class _h extends ph{constructor(e,t,n,r){super(t.createOutputTrack(),n,r),this.source=e,this._bufferSource=t,this._bufferSource.on(au.AUDIO_SOURCE_STATE_CHANGE,e=>{this.emit(wu.SOURCE_STATE_CHANGE,e)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(i){}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){let t=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.BUFFER_AUDIO_TRACK_START,options:[this.getTrackId(),e,this.duration]});e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer(),t.onSuccess()}pauseProcessAudioBuffer(){let e=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.BUFFER_AUDIO_TRACK_PAUSE,options:[this.getTrackId()]});this._bufferSource.pauseProcessAudioBuffer(),e.onSuccess()}seekAudioBuffer(e){let t=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.BUFFER_AUDIO_TRACK_SEEK,options:[this.getTrackId()]});this._bufferSource.seekAudioBuffer(e),t.onSuccess()}resumeProcessAudioBuffer(){let e=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.BUFFER_AUDIO_TRACK_RESUME,options:[this.getTrackId()]});this._bufferSource.resumeProcessAudioBuffer(),e.onSuccess()}stopProcessAudioBuffer(){let e=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.BUFFER_AUDIO_TRACK_STOP,options:[this.getTrackId()]});this._bufferSource.stopProcessAudioBuffer(),e.onSuccess()}}class mh extends ph{constructor(){let e=It().createMediaStreamDestination();super(e.stream.getAudioTracks()[0]);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(t){}this.destNode=e,this.trackList=[]}hasAudioTrack(e){var t;return-1!==nc(t=this.trackList).call(t,e)}addAudioTrack(e){var t;-1===nc(t=this.trackList).call(t,e)?(Ul.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):Ul.warning("track is already added")}removeAudioTrack(e){var t;if(-1!==nc(t=this.trackList).call(t,e)){Ul.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch(n){}nt(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){var e;let t={};Ds(e=this.trackList).call(e,e=>{e._encoderConfig&&((e._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=e._encoderConfig.bitrate),(e._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=e._encoderConfig.sampleRate),(e._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=e._encoderConfig.sampleSize),e._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}}let gh=new _s;class Eh extends bd{constructor(e){super(),this.inChannelInfo={joinAt:null,duration:0},this._state="DISCONNECTED",this.needToSendUnpubUnsub=new _s,this.hasChangeBGPAddress=this.isSignalRecover=!1,this.joinGatewayStartTime=0,this._signalTimeout=!1,this.clientId=e.clientId,this.spec=e,this.signal=new rh(Nt({},e,{retryConfig:e.websocketRetryConfig})),this._statsCollector=e.statsCollector,this.role=e.role||"audience",this._clientRoleOptions=e.clientRoleOptions,this.handleSignalEvents()}get state(){return this._state}set state(e){if(e!==this._state){var t=this._state;this._state=e,"DISCONNECTED"===e&&this._disconnectedReason?this.emit(Iu.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(Iu.CONNECTION_STATE_CHANGE,e,t)}}async join(e,t){var n,r;"disabled"!==e.cloudProxyServer&&(this.hasChangeBGPAddress=!0);let i=wd();var s=gh.get(e.cname);if(s||(s=new _s,gh.set(e.cname,s)),s.has(e.uid))throw s=new xl(dl.UID_CONFLICT),Jd.joinGateway(e.sid,{lts:i,succ:!1,ec:s.message,addr:null,uid:e.uid,cid:e.cid}),s;s.set(e.uid,!0),this.joinInfo=e,this.key=t,t=e.proxyServer?Ka(n=e.gatewayAddrs).call(n,t=>{var n,r;return t=t.split(":"),To(n=To(r="wss://".concat(e.proxyServer,"/ws/?h=")).call(r,t[0],"&p=")).call(n,t[1])}):Ka(r=e.gatewayAddrs).call(r,e=>"wss://".concat(e)),n=0,this.joinGatewayStartTime=i;try{n=(await this.signal.init(t)).uid}catch(o){throw Ul.error("[".concat(this.clientId,"] User join failed"),o.toString()),Jd.joinGateway(e.sid,{lts:i,succ:!1,ec:o.message,addr:this.signal.url,uid:e.uid,cid:e.cid}),s.delete(e.uid),this.signal.close(),o}return this.state="CONNECTED",this.inChannelInfo.joinAt=wd(),Ul.debug("[".concat(this.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(e=>{Ul.warning("[".concat(this.clientId,"] get traffic stats error"),e.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?this.emit(Iu.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this.emit(Iu.NETWORK_QUALITY,this._signalTimeout?{downlinkNetworkQuality:5,uplinkNetworkQuality:5}:"CONNECTED"===this.state&&this._statsCollector.trafficStats?{uplinkNetworkQuality:Ge(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:Ge(this._statsCollector.trafficStats.B_dnq)}:{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),n}async leave(e=!1){if("DISCONNECTED"!==this.state){this.state="DISCONNECTING";try{if(!e&&this.signal.connectionState===tu.CONNECTED){var t=this.signal.request(ru.LEAVE,void 0,!0);await Ga.race([t,ze(3e3)])}}catch(n){Ul.warning("[".concat(this.clientId,"] leave request failed, ignore"),n)}this.signal.close(),this.reset(),this.state="DISCONNECTED"}}async publish(e,t){if(!this.joinInfo)throw new xl(dl.UNEXPECTED_ERROR,"publish no joinInfo");let n=e.getUserId(),r=e.videoTrack?function(e){var t;if(!(e=e._encoderConfig))return{};const n={resolution:e.width&&e.height?To(t="".concat(Be(e.width),"x")).call(t,Be(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return"number"==typeof e.frameRate?(n.maxFrameRate=e.frameRate,n.minFrameRate=e.frameRate):e.frameRate&&(n.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,n.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),n}(e.videoTrack):{};if(e.on(ou.NEED_ANSWER,(i,s,o)=>{var a;let c={state:"offer",stream_type:t,p2p_id:e.pc.ID,sdp:cr(i),audio:!!e.audioTrack,video:!!e.videoTrack,screen:e.videoTrack&&-1!==nc(a=e.videoTrack._hints).call(a,Au.SCREEN_TRACK),attributes:r,dtx:e.audioTrack instanceof fh&&e.audioTrack._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1,mode:this.spec.mode,codec:this.spec.codec,extend:el.PUB_EXTEND};this.signal.request(ru.PUBLISH,c,!0).then(e=>{n&&this.needToSendUnpubUnsub.set(n,!0),s(JSON.parse(e.sdp))}).catch(t=>{if(i.retry&&t.data&&t.data.code===$l.ERR_PUBLISH_REQUEST_INVALID)return Ul.warning("[".concat(this.clientId,"] receiver publish error code, retry"),t.toString()),$e(e,ou.NEED_UNPUB).then(()=>{i.retry=!1,$e(e,ou.NEED_ANSWER,i).then(s).catch(o)});t.code!==dl.WS_ABORT&&o(t)})}),e.on(ou.NEED_RENEGOTIATE,(n,r,i)=>{this.signal.request(ru.PUBLISH,{state:"negotiation",stream_type:t,p2p_id:e.pc.ID,sdp:n},!0).then(e=>{r(JSON.parse(e.sdp))}).catch(e=>{e.code!==dl.WS_ABORT&&i(e)})}),e.on(ou.NEED_UNPUB,r=>n&&!this.needToSendUnpubUnsub.has(n)?r(!1):"RECONNECTING"===this.state?r(!0):void this.signal.request(ru.UNPUBLISH,{stream_id:e.getUserId(),stream_type:t},!0).then(()=>r(!1)).catch(e=>{Ul.warning("unpublish warning: ",e),r(!0)})),e.on(ou.NEED_UPLOAD,(e,n)=>{this.signal.upload(e,{stream_type:t,stats:n})}),e.on(ou.NEED_SIGNAL_RTT,e=>{e(this.signal.rtt)}),"RECONNECTING"!==this.state){if("CONNECTED"!==this.state)return new xl(dl.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state)).throw();await e.startP2PConnection()}else e.readyToReconnectPC()}async subscribe(e){if(!this.joinInfo)throw new xl(dl.UNEXPECTED_ERROR,"subscribe no joinInfo");let t=e.getUserId();if(e.on(ou.NEED_ANSWER,(n,r,i)=>{var s=e.subscribeOptions;s={stream_id:e.getUserId(),audio:!!s.audio,video:!!s.video,mode:this.spec.mode,codec:this.spec.codec,p2p_id:e.pc.ID,sdp:cr(n),tcc:!!el.SUBSCRIBE_TCC,extend:el.SUB_EXTEND},this.signal.request(ru.SUBSCRIBE,s,!0).then(e=>{this.needToSendUnpubUnsub.set(t,!0),r(JSON.parse(e.sdp))}).catch(t=>{if(n.retry&&t.data&&t.data.code===$l.ERR_SUBSCRIBE_REQUEST_INVALID)return Ul.warning("[".concat(this.clientId,"] receiver subscribe error code, retry"),t.toString()),$e(e,ou.NEED_UNSUB).then(()=>{n.retry=!1,$e(e,ou.NEED_ANSWER,n).then(r).catch(i)});t.code!==dl.WS_ABORT&&i(t)})}),e.on(ou.NEED_UNSUB,n=>this.needToSendUnpubUnsub.has(t)?"RECONNECTING"===this.state?n(!0):void this.signal.request(ru.UNSUBSCRIBE,{stream_id:e.getUserId()},!0).then(()=>n(!1)).catch(e=>{Ul.warning("unsubscribe warning",e),n(!0)}):n(!1)),e.on(ou.NEED_UPLOAD,(t,n)=>{this.signal.upload(t,{stream_id:e.getUserId(),stats:n})}),e.on(ou.NEED_SIGNAL_RTT,e=>{e(this.signal.rtt)}),"RECONNECTING"!==this.state){if("CONNECTED"!==this.state)return new xl(dl.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state)).throw();await e.startP2PConnection()}else e.readyToReconnectPC()}async subscribeChange(e,t){var n,r;if(!this.joinInfo)throw new xl(dl.UNEXPECTED_ERROR,"subscribe no joinInfo");if(await e.setSubscribeOptions(t),"RECONNECTING"!==this.state){if("CONNECTED"!==this.state)return new xl(dl.INVALID_OPERATION,"can not subscribe change when connection state is ".concat(this.state)).throw();Ul.debug(To(n=To(r="[".concat(this.clientId,"] send subscribe change, audio: ")).call(r,t.audio,", video: ")).call(n,t.video)),await this.signal.request(ru.SUBSCRIBE_CHANGE,{stream_id:e.getUserId(),audio:!!t.audio,video:!!t.video},!0)}}async unsubscribe(e){await e.closeP2PConnection()}getGatewayInfo(){return this.signal.request(ru.GATEWAY_INFO)}renewToken(e){return this.signal.request(ru.RENEW_TOKEN,{token:e})}async setClientRole(e,t){t&&(this._clientRoleOptions=Us({},t)),"CONNECTED"===this.state?(await this.signal.request(ru.SET_CLIENT_ROLE,{role:e,level:"audience"===e?this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:0}),this.role=e):this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request(ru.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setStreamFallbackOption(e,t){await this.signal.request(ru.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request(ru.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=wd()-this.inChannelInfo.joinAt),Nt({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(ru.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=wd()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let e=gh.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.needToSendUnpubUnsub=new _s,this.key=this.joinInfo=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(this.joinInfo){var e=(e=(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex])||"").match(/(wss:\/\/)?([^:]+):(\d+)/))?{username:Xc.username,password:Xc.password,turnServerURL:e[2],tcpport:Zs(e[3])+30,udpport:Zs(e[3])+30,forceturn:!1}:null;this.joinInfo.turnServer.serversFromGateway=[],e&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(Nt({},Xc,{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}}async updateTrafficStats(){var e;if("CONNECTED"===this.state){var t=await this.signal.request(ru.TRAFFIC_STATS,void 0,!0);t.timestamp=wd(),Ds(e=t.peer_delay).call(e,e=>{var t;let n=this._statsCollector.trafficStats&&hc(t=this._statsCollector.trafficStats.peer_delay).call(t,t=>t.peer_uid===e.peer_uid);n&&n.B_st!==e.B_st&&it(()=>{this.emit(Iu.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)})}),this._statsCollector.updateTrafficStats(t)}}getJoinMessage(){if(!this.joinInfo||!this.key)throw new xl(dl.UNEXPECTED_ERROR,"can not generate join message, no join info");let e=Us({},this.joinInfo.apResponse);var t=el.REPORT_APP_SCENARIO;if("string"!=typeof t)try{t=cr(t)}catch(n){t=void 0}return t&&128<t.length&&(t=void 0),t={session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Yc,browser:navigator.userAgent,process_id:el.PROCESS_ID,mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:e,extends:el.JOIN_EXTEND,details:{6:this.joinInfo.stringUid},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:t},this.joinInfo.stringUid&&(t.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(t.aes_mode=this.joinInfo.aesmode,el.ENCRYPT_AES?(t.aes_secret=this.joinInfo.aespassword,t.aes_encrypt=!0):t.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(t.aes_salt=this.joinInfo.aessalt)),e.addresses[this.signal.websocket.currentURLIndex]&&(t.ap_response.ticket=e.addresses[this.signal.websocket.currentURLIndex].ticket,delete e.addresses),t}getRejoinMessage(){if(!this.joinInfo)throw new xl(dl.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(nu.WS_RECONNECTING,e=>{this.joinInfo&&Jd.WebSocketQuit(this.joinInfo.sid,{lts:wd(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||eu.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Jd.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=wd())}),this.signal.on(nu.WS_CLOSED,e=>{let t;switch(e){case"LEAVE":t=eu.LEAVE;break;case"UID_BANNED":case"IP_BANNED":case"CHANNEL_BANNED":case"SERVER_ERROR":t=eu.SERVER_ERROR;break;default:t=eu.NETWORK_ERROR}Ul.debug("[signal] websocket closed, reason: ".concat(t||"undefined -> "+eu.NETWORK_ERROR)),this.joinInfo&&Jd.WebSocketQuit(this.joinInfo.sid,{lts:wd(),succ:"LEAVE"===e?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this.reset(),this._disconnectedReason=e,this.state="DISCONNECTED"}),this.signal.on(nu.WS_CONNECTED,()=>{var e,t;this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&("audience"===this.role&&this._clientRoleOptions&&this._clientRoleOptions.level&&(Ul.debug(To(e=To(t="[".concat(this.clientId,"] patch to send set client role, role: ")).call(t,this.role,", type: ")).call(e,this._clientRoleOptions.level)),this.setClientRole(this.role,this._clientRoleOptions)),Jd.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid}))}),this.signal.on(su.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(nu.REQUEST_RECOVER,(e,t,n)=>{if(!this.joinInfo)return n(new xl(dl.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,$e(this,Iu.REQUEST_NEW_GATEWAY_LIST).then(t).catch(n)}),this.signal.on(nu.REQUEST_JOIN_INFO,e=>{e(this.getJoinMessage())}),this.signal.on(nu.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(nu.REPORT_JOIN_GATEWAY,(e,t)=>{this.joinInfo&&Jd.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:e,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid})}),this.signal.on(nu.IS_P2P_DISCONNECTED,e=>{e(tt(this,Iu.IS_P2P_DISCONNECTED))}),this.signal.on(nu.DISCONNECT_P2P,()=>{this.needToSendUnpubUnsub=new _s,this.emit(Iu.DISCONNECT_P2P)}),this.signal.on(nu.NEED_RENEW_SESSION,()=>{this.emit(Iu.NEED_RENEW_SESSION)}),this.signal.on(nu.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(nu.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0})}}let vh=1,Sh=1,Th=()=>{const e=el.AREAS;return 0===e.length&&e.push("GLOBAL"),Hs(e).call(e,(e,t,n)=>{var r,i,s,o,a,c;return(t="OVERSEA"===t?To(r=To(i=To(s=To(o=To(a="".concat(Nu.ASIA,",")).call(a,Nu.EUROPE,",")).call(o,Nu.AFRICA,",")).call(s,Nu.NORTH_AMERICA,",")).call(i,Nu.SOUTH_AMERICA,",")).call(r,Nu.OCEANIA):Nu[t])?0===n?t:To(c="".concat(e,",")).call(c,t):e},"")};var Rh={ASIA:["CHINA","JAPAN","INDIA"],EUROPE:[],NORTH_AMERICA:[],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]};let yh=Vs(Rh),Ih="CHINA NORTH_AMERICA EUROPE ASIA JAPAN INDIA OCEANIA SOUTH_AMERICA AFRICA".split(" "),Ch=new class extends bd{constructor(){super(),this.retryConfig={timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4},this.mutex=new Bd("config-distribute")}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},el.CONFIG_DISTRIBUTE_INTERVAL)}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.cancelToken=this.joinInfo=this.interval=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(!this.joinInfo||!this.cancelToken||!this.retryConfig)return void Ul.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const t=await this.mutex.lock();try{e=await async function(e,t,n){var r,i,s=Ka(r=cc(i=el.CDS_AP).call(i,0,el.AJAX_REQUEST_CONCURRENT)).call(r,t=>{var n;return e.proxyServer?To(n="https://".concat(e.proxyServer,"/ap/?url=")).call(n,t+"/api/v1"):"https://".concat(t,"/api/v1?action=config")});r=Ka(s).call(s,r=>function(e,t,n,r){const i=De(),s={flag:64,cipher_method:0,features:{device:i.name,system:i.os,vendor:t.appId,version:Yc,cname:t.cname,sid:t.sid,session_id:t.sid,detail:"",proxyServer:t.proxyServer}};return yt(()=>mt(e,{data:s,timeout:1e3,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,e=>e.code!==dl.OPERATION_ABORTED,r)}(r,e,t,n)),s=i=null;let o={};try{i=await Je(r)}catch(a){if(a.code===dl.OPERATION_ABORTED)throw a;s=a}if(Ds(r).call(r,e=>e.cancel()),Jd.reportApiInvoke(e.sid,{name:Wl.REQUEST_CONFIG_DISTRIBUTE,options:{error:s,res:i}}).onSuccess(),i&&i.test_tags)try{o=function(e){if(!e.test_tags)return{};let t=e.test_tags;e=Vs(t);let n={};return Ds(e).call(e,e=>{var r;let i=Fc(r=cc(e).call(e,4)).call(r);e=JSON.parse(t[e])[1],n[i]=e}),n}(i)}catch(a){}return o}(this.joinInfo,this.cancelToken,this.retryConfig),Ul.debug("[config-distribute] get config distribute",cr(e)),e.limit_bitrate&&this.handleBitrateLimit(e.limit_bitrate),this.configs=e}catch(n){const e=new xl(dl.NETWORK_RESPONSE_ERROR,n);Ul.warning("[config-distribute] ".concat(e.toString()))}finally{t()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(e){e&&e.uplink&&e.id&&void 0!==e.uplink.max_bitrate&&void 0!==e.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==e.id&&this.emit(Du.UPDATE_BITRATE_LIMIT,e):this.emit(Du.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&function(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Ds(n=Ut(Object(r),!0)).call(n,function(t){Sd(e,t,r[t])});else if(Vu)Lu(e,Vu(r));else{var i;Ds(i=Ut(Object(r))).call(i,function(t){Ks(e,t,oo(r,t))})}}return e}({},this.configs.limit_bitrate.low_stream_uplink)}};var Ah,wh=function(){function e(e){this.input=[],this.size=e}return e.prototype.add=function(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)},e.prototype.diffMean=function(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length},e}(),bh=function(e,t){return(bh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},Oh=function(){return(Oh=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Nh={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[]},kh={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0},Dh={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},Ph={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},Lh={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0},Mh=function(){function e(e,t){var n=this;this.videoIsReady=!1,this.stats=xt(Nh),this.isFirstAudioDecoded=this.isFirstAudioReceived=this.isFirstVideoDecoded=this.isFirstVideoReceived=!1,this.lossRateWindowStats=[],this.pc=e,this.options=t,this.intervalTimer=window.setInterval(function(){return Bt(n,void 0,void 0,function(){return jt(this,function(e){return this.updateStats(),[2]})})},this.options.updateInterval)}return e.prototype.getStats=function(){return this.stats},e.prototype.setVideoIsReady=function(e){this.videoIsReady=e},e.prototype.setIsFirstAudioDecoded=function(e){this.isFirstAudioDecoded=e},e.prototype.destroy=function(){window.clearInterval(this.intervalTimer)},e.prototype.calcLossRate=function(e){var t=this;this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);for(var n=this.lossRateWindowStats.length,r=0,i=0,s=0,o=0,a=function(a){e[a].forEach(function(e,c){if(t.lossRateWindowStats[n-1][a][c]&&t.lossRateWindowStats[0][a][c]){var l=t.lossRateWindowStats[n-1][a][c].packets-t.lossRateWindowStats[0][a][c].packets;c=t.lossRateWindowStats[n-1][a][c].packetsLost-t.lossRateWindowStats[0][a][c].packetsLost,"videoSend"===a||"audioSend"===a?(r+=l,s+=c):(i+=l,o+=c),e.packetLostRate=Number.isNaN(l)||Number.isNaN(l)||0>=l||0>=c?0:c/(l+c)}})},c=0,l=["videoSend","audioSend","videoRecv","audioRecv"];c<l.length;c++)a(l[c]);e.sendPacketLossRate=0>=r||0>=s?0:s/(r+s),e.recvPacketLossRate=0>=i||0>=o?0:o/(i+o)},e}(),Uh=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._stats=Nh,t.lastDecodeVideoReceiverStats=new Map,t}return Ft(t,e),t.prototype.updateStats=function(){return Bt(this,void 0,void 0,function(){var e,t,n,r;return jt(this,function(i){switch(i.label){case 0:return[4,this._getStats()];case 1:return e=i.sent(),t=this.statsResponsesToObjects(e),this._stats=xt(Nh),n=t.filter(function(e){return"ssrc"===e.type}),this.processSSRCStats(n),(r=t.find(function(e){return"VideoBwe"===e.type}))&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}})})},t.prototype.processBandwidthStats=function(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)},t.prototype.processSSRCStats=function(e){var t=this;e.forEach(function(e){var n=e.id.includes("send");switch(e.mediaType+"_"+(n?"send":"recv")){case"video_send":(n=xt(Dh)).codec=e.googCodecName,n.adaptionChangeReason="none",e.googCpuLimitedResolution&&(n.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(n.adaptionChangeReason="bandwidth"),n.avgEncodeMs=Number(e.googAvgEncodeMs),n.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},n.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},n.firsCount=Number(e.googFirReceived),n.nacksCount=Number(e.googNacksReceived),n.plisCount=Number(e.googPlisReceived),n.frameCount=Number(e.framesEncoded),n.bytes=Number(e.bytesSent),n.packets=Number(e.packetsSent),n.packetsLost=Number(e.packetsLost),n.ssrc=Number(e.ssrc),n.rttMs=Number(e.googRtt||0),t._stats.videoSend.push(n),t._stats.rtt=n.rttMs;break;case"video_recv":n=xt(kh);var r=t.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(n.codec=e.googCodecName,n.targetDelayMs=Number(e.googTargetDelayMs),n.renderDelayMs=Number(e.googRenderDelayMs),n.currentDelayMs=Number(e.googCurrentDelayMs),n.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),n.decodeMs=Number(e.googDecodeMs),n.maxDecodeMs=Number(e.googMaxDecodeMs),n.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},n.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},n.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},n.jitterBufferMs=Number(e.googJitterBufferMs),n.firsCount=Number(e.googFirsSent),n.nacksCount=Number(e.googNacksSent),n.plisCount=Number(e.googPlisSent),n.framesDecodeCount=Number(e.framesDecoded),n.bytes=Number(e.bytesReceived),n.packets=Number(e.packetsReceived),n.packetsLost=Number(e.packetsLost),n.ssrc=Number(e.ssrc),0<n.packets&&!t.isFirstVideoReceived&&(t.onFirstVideoReceived&&t.onFirstVideoReceived(),t.isFirstVideoReceived=!0),0<n.framesDecodeCount&&!t.isFirstVideoDecoded&&(t.onFirstVideoDecoded&&t.onFirstVideoDecoded(n.decodedFrame.width,n.decodedFrame.height),t.isFirstVideoDecoded=!0),r){e=r.stats;var i=Date.now()-r.lts;n.framesDecodeFreezeTime=e.framesDecodeFreezeTime,n.framesDecodeInterval=e.framesDecodeInterval,n.framesDecodeCount>e.framesDecodeCount&&t.isFirstVideoDecoded?(r.lts=Date.now(),n.framesDecodeInterval=i,n.framesDecodeInterval>=t.options.freezeRateLimit&&(t.videoIsReady?n.framesDecodeFreezeTime+=n.framesDecodeInterval:t.setVideoIsReady(!0))):n.framesDecodeCount<r.stats.framesDecodeCount&&(n.framesDecodeInterval=0)}t.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:Oh({},n),lts:Date.now()}),t._stats.videoRecv.push(n);break;case"audio_recv":(n=xt(Lh)).codec=e.googCodecName,n.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,n.decodingCNG=Number(e.googDecodingCNG),n.decodingCTN=Number(e.googDecodingCTN),n.decodingCTSG=Number(e.googDecodingCTSG),n.decodingNormal=Number(e.googDecodingNormal),n.decodingPLC=Number(e.googDecodingPLC),n.decodingPLCCNG=Number(e.googDecodingPLCCNG),n.expandRate=Number(e.googExpandRate),n.accelerateRate=Number(e.googAccelerateRate),n.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),n.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),n.speechExpandRate=Number(e.googSpeechExpandRate),n.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),n.jitterBufferMs=Number(e.googJitterBufferMs),n.jitterMs=Number(e.googJitterReceived),n.bytes=Number(e.bytesReceived),n.packets=Number(e.packetsReceived),n.packetsLost=Number(e.packetsLost),n.ssrc=Number(e.ssrc),n.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),n.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),0<n.receivedFrames&&!t.isFirstAudioReceived&&(t.onFirstAudioReceived&&t.onFirstAudioReceived(),t.isFirstAudioReceived=!0),0<n.decodingNormal&&!t.isFirstAudioDecoded&&(t.onFirstAudioDecoded&&t.onFirstAudioDecoded(),t.isFirstAudioDecoded=!0),t._stats.audioRecv.push(n);break;case"audio_send":(n=xt(Ph)).codec=e.googCodecName,n.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,n.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),n.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),n.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),n.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),n.bytes=Number(e.bytesSent),n.packets=Number(e.packetsSent),n.packetsLost=Number(e.packetsLost),n.ssrc=Number(e.ssrc),n.rttMs=Number(e.googRtt||0),t._stats.rtt=n.rttMs,t._stats.audioSend.push(n)}})},t.prototype._getStats=function(){var e=this;return new Promise(function(t,n){e.pc.getStats(t,n)})},t.prototype.statsResponsesToObjects=function(e){var t=[];return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp.valueOf().toString(),type:e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t.push(n)}),t},t}(Mh);!function(e){e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver"}(Ah||(Ah={}));var xh=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._stats=Nh,t.lastDecodeVideoReceiverStats=new Map,t.lastVideoFramesRecv=new Map,t.lastVideoFramesSent=new Map,t.lastVideoFramesDecode=new Map,t.lastVideoJBDelay=new Map,t.lastAudioJBDelay=new Map,t.mediaBytesSent=new Map,t.mediaBytesRetransmit=new Map,t.mediaBytesTargetEncode=new Map,t.lastEncoderMs=new Map,t}return Ft(t,e),t.prototype.updateStats=function(){return Bt(this,void 0,void 0,function(){var e,t=this;return jt(this,function(n){switch(n.label){case 0:return e=this,[4,this.pc.getStats()];case 1:return e.report=n.sent(),this._stats=xt(Nh),this.report.forEach(function(e){switch(e.type){case Ah.OUTBOUND:"audio"===e.mediaType?t.processAudioOutboundStats(e):"video"===e.mediaType&&t.processVideoOutboundStats(e);break;case Ah.INBOUND:"audio"===e.mediaType?t.processAudioInboundStats(e):"video"===e.mediaType&&t.processVideoInboundStats(e);break;case Ah.TRANSPORT:(e=t.report.get(e.selectedCandidatePairId))&&t.processCandidatePairStats(e);break;case Ah.CANDIDATE_PAIR:e.selected&&t.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}})})},t.prototype.processCandidatePairStats=function(e){this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(function(t){!t.rttMs&&e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(function(t){!t.rttMs&&e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})},t.prototype.processAudioInboundStats=function(e){var t=this._stats.audioRecv.find(function(t){return t.ssrc===e.ssrc});t||(t=xt(Lh),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,e.trackId&&this.processAudioTrackReceiverStats(e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),0<t.receivedFrames&&!this.isFirstAudioReceived&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(),this.isFirstAudioReceived=!0),t.outputLevel&&0<t.outputLevel&&!this.isFirstAudioDecoded&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(),this.isFirstAudioDecoded=!0)},t.prototype.processVideoInboundStats=function(e){var t=this._stats.videoRecv.find(function(t){return t.ssrc===e.ssrc});t||(t=xt(kh),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded;var n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=Date.now();if(0<t.framesDecodeCount&&!this.isFirstVideoDecoded){var s=t.decodedFrame?t.decodedFrame.width:0,o=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(s,o),this.isFirstVideoDecoded=!0}n&&(o=i-n.lts,t.framesDecodeFreezeTime=(s=n.stats).framesDecodeFreezeTime,t.framesDecodeInterval=s.framesDecodeInterval,t.framesDecodeCount>s.framesDecodeCount&&this.isFirstVideoDecoded?(n.lts=Date.now(),t.framesDecodeInterval=o,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.videoIsReady?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady(!0))):t.framesDecodeCount<s.framesDecodeCount&&(t.framesDecodeInterval=0)),r&&800<=i-r.lts?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((i-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:i,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:i,rate:0}),e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime),e.trackId&&this.processVideoTrackReceiverStats(e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),0<t.packets&&!this.isFirstVideoReceived&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(),this.isFirstVideoReceived=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:Oh({},t),lts:n?n.lts:Date.now()})},t.prototype.processVideoOutboundStats=function(e){var t=this._stats.videoSend.find(function(t){return t.ssrc===e.ssrc});t||(t=xt(Dh),this._stats.videoSend.push(t));var n,r=this.mediaBytesSent.get(e.ssrc);r?r.add(e.bytesSent):((n=new wh(10)).add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,n)),void 0!==e.retransmittedBytesSent&&((r=this.mediaBytesRetransmit.get(e.ssrc))?r.add(e.retransmittedBytesSent):((n=new wh(10)).add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,n))),e.totalEncodedBytesTarget&&((r=this.mediaBytesTargetEncode.get(e.ssrc))?r.add(e.totalEncodedBytesTarget):((n=new wh(10)).add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,n))),t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,e.totalEncodeTime&&e.framesEncoded&&(r=this.lastEncoderMs.get(e.ssrc),t.avgEncodeMs=!r||r.lastFrameCount>e.framesEncoded?1e3*e.totalEncodeTime/e.framesEncoded:1e3*(e.totalEncodeTime-r.lastEncoderTime)/(e.framesEncoded-r.lastFrameCount),this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lts:Date.now()})),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),e.trackId&&this.processVideoTrackSenderStats(e.trackId,t),e.remoteId?this.processRemoteInboundStats(e.remoteId,t):(r=this.findRemoteStatsId(e.ssrc,Ah.REMOTE_INBOUND))&&this.processRemoteInboundStats(r,t)},t.prototype.processAudioOutboundStats=function(e){var t=this._stats.audioSend.find(function(t){return t.ssrc===e.ssrc});if(t||(t=xt(Ph),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.trackId&&this.processAudioTrackSenderStats(e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{var n=this.findRemoteStatsId(e.ssrc,Ah.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}},t.prototype.findRemoteStatsId=function(e,t){var n=Array.from(this.report.values()).find(function(n){return n.type===t&&n.ssrc===e});return n?n.id:null},t.prototype.processVideoMediaSource=function(e,t){(e=this.report.get(e))&&e.width&&e.height&&e.framesPerSecond&&(t.inputFrame={width:e.width,height:e.height,frameRate:e.framesPerSecond})},t.prototype.processAudioMediaSource=function(e,t){(e=this.report.get(e))&&(t.inputLevel=e.audioLevel)},t.prototype.processVideoTrackSenderStats=function(e,t){if(e=this.report.get(e)){var n=0,r=Date.now(),i=this.lastVideoFramesSent.get(t.ssrc);i&&800<=r-i.lts?(n=Math.round((e.framesSent-i.count)/((r-i.lts)/1e3)),this.lastVideoFramesSent.set(t.ssrc,{count:e.framesSent,lts:r,rate:n})):i?n=i.rate:this.lastVideoFramesSent.set(t.ssrc,{count:e.framesSent,lts:r,rate:0}),t.sentFrame={width:e.frameWidth,height:e.frameHeight,frameRate:n}}},t.prototype.processVideoTrackReceiverStats=function(e,t){if(e=this.report.get(e)){var n=this.lastVideoFramesRecv.get(t.ssrc),r=Date.now();t.framesReceivedCount=e.framesReceived;var i=0;n&&800<=r-n.lts?(i=Math.round((e.framesReceived-n.count)/((r-n.lts)/1e3)),this.lastVideoFramesRecv.set(t.ssrc,{count:e.framesReceived,lts:r,rate:i})):n?i=n.rate:this.lastVideoFramesRecv.set(t.ssrc,{count:e.framesReceived,lts:r,rate:0}),t.receivedFrame={width:e.frameWidth||0,height:e.frameHeight||0,frameRate:i||0},t.decodedFrame={width:e.frameWidth||0,height:e.frameHeight||0,frameRate:t.decodeFrameRate||0},t.outputFrame={width:e.frameWidth||0,height:e.frameHeight||0,frameRate:t.decodeFrameRate||0},e.jitterBufferDelay&&e.jitterBufferEmittedCount&&(n=this.lastVideoJBDelay.get(t.ssrc),this.lastVideoJBDelay.set(t.ssrc,{jitterBufferDelay:e.jitterBufferDelay,jitterBufferEmittedCount:e.jitterBufferEmittedCount}),n||(n={jitterBufferDelay:0,jitterBufferEmittedCount:0}),t.jitterBufferMs=e=1e3*(e.jitterBufferDelay-n.jitterBufferDelay)/(e.jitterBufferEmittedCount-n.jitterBufferEmittedCount),t.currentDelayMs=Math.round(e))}},t.prototype.processAudioTrackSenderStats=function(e,t){(e=this.report.get(e))&&(t.aecReturnLoss=e.echoReturnLoss||0,t.aecReturnLossEnhancement=e.echoReturnLossEnhancement||0)},t.prototype.processAudioTrackReceiverStats=function(e,t){if(e=this.report.get(e)){if(e.removedSamplesForAcceleration&&e.totalSamplesReceived&&(t.accelerateRate=e.removedSamplesForAcceleration/e.totalSamplesReceived),e.jitterBufferDelay&&e.jitterBufferEmittedCount){var n=this.lastAudioJBDelay.get(t.ssrc);this.lastAudioJBDelay.set(t.ssrc,{jitterBufferDelay:e.jitterBufferDelay,jitterBufferEmittedCount:e.jitterBufferEmittedCount}),n||(n={jitterBufferDelay:0,jitterBufferEmittedCount:0}),t.jitterBufferMs=Math.round(1e3*(e.jitterBufferDelay-n.jitterBufferDelay)/(e.jitterBufferEmittedCount-n.jitterBufferEmittedCount))}t.outputLevel=e.audioLevel,n=1920,e.totalSamplesDuration&&e.totalSamplesReceived&&(n=e.totalSamplesReceived/e.totalSamplesDuration/50,t.receivedFrames=Math.round(e.totalSamplesReceived/n)),e.concealedSamples&&(t.droppedFrames=Math.round(e.concealedSamples/n))}},t.prototype.processRemoteInboundStats=function(e,t){(e=this.report.get(e))&&(t.packetsLost=e.packetsLost,e.roundTripTime&&(t.rttMs=1e3*e.roundTripTime))},t.prototype.getCodecFromCodecStats=function(e){return(e=this.report.get(e))&&(e=e.mimeType.match(/\/(.*)$/))&&e[1]?e[1]:""},t.prototype.updateSendBitrate=function(){var e=0,t=null,n=null;this.mediaBytesSent.forEach(function(t){e+=t.diffMean()}),this.mediaBytesRetransmit.forEach(function(e){t=null===t?e.diffMean():t+e.diffMean()}),this.mediaBytesTargetEncode.forEach(function(e){n=null===n?e.diffMean():n+e.diffMean()}),this._stats.bitrate={actualEncoded:8*(null!==t?e-t:e)/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},null!==t&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),null!==n&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))},t}(Mh),Vh=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ft(t,e),t.prototype.updateStats=function(){return Promise.resolve()},t}(Mh);class Fh{constructor(e){this.localCandidateCount=0,this.allCandidateReceived=!1,this.videoTrack=this.audioTrack=null,this.mediaStream=new MediaStream,this.ID=Gh,Gh+=1,this.spec=e,this.createPeerConnection(),e=this.pc;var t=void 0,n=void 0,r=Le()?1200:void 0;void 0===t&&(t=250),void 0===n&&(n=8),void 0===r&&(r=500);var i,s=(i=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i))&&i[0]?Number(i[0].split("/")[1]):null;this.statsFilter=s?76>s?new Uh(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r}):new xh(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r}):window.RTCStatsReport&&e.getStats()instanceof Promise?new xh(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r}):new Vh(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r})}get _statsFilter(){return this.statsFilter}getStats(){return this.statsFilter.getStats()}async createOfferSDP(){try{let e=await this.pc.createOffer(this.offerOptions);if(!e.sdp)throw Error("offer sdp is empty");return e.sdp}catch(gl){throw Ul.error("create offer error:",gl.toString()),new xl(dl.CREATE_OFFER_FAILED,gl.toString())}}async setOfferSDP(e){try{await this.pc.setLocalDescription({type:"offer",sdp:e})}catch(t){throw Ul.error("set local offer error",t.toString()),new xl(dl.CREATE_OFFER_FAILED,t.toString())}}async setAnswerSDP(e){try{await this.pc.setRemoteDescription({type:"answer",sdp:e})}catch(t){if("InvalidStateError"!==t.name||"stable"!==this.pc.signalingState)throw Ul.error("set remote answer error",t.toString()),new xl(dl.SET_ANSWER_FAILED,t.toString());Ul.debug("[pc-".concat(this.ID,"] ignore invalidstate error"))}}close(){this.onConnectionStateChange=this.onICEConnectionStateChange=void 0;try{this.pc.oniceconnectionstatechange=null,this.pc.onconnectionstatechange=null,this.pc.onsignalingstatechange=null,this.pc.onicecandidateerror=null,this.pc.onicecandidate=null,this.pc.close(),this.pc=null}catch(gl){}this.statsFilter.destroy()}createPeerConnection(){let e={iceServers:[{urls:"stun:webcs.agora.io:3478"}]},t=e=>{const t=[];return Ds(e).call(e,e=>{var n,r,i,s;e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:To(n="turns:".concat((s=e.turnServerURL,s.match(/^[\.:\d]+$/)?"".concat(s.replace(/[^\d]/g,"-"),".edge.agora.io"):(Ul.info("Cannot recognized as IP address ".concat(s,". Used As Host instead")),s)),":")).call(n,e.tcpport,"?transport=tcp")}):(e.udpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:To(r="turn:".concat(e.turnServerURL,":")).call(r,e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:To(i="turn:".concat(e.turnServerURL,":")).call(i,e.tcpport,"?transport=tcp")}))}),t};var n,r;this.spec.iceServers?e.iceServers=this.spec.iceServers:this.spec.turnServer&&"off"!==this.spec.turnServer.mode&&(Ae(this.spec.turnServer.servers)?e.iceServers=this.spec.turnServer.servers:(e.iceServers&&e.iceServers.push(...t(this.spec.turnServer.servers)),e.iceServers&&this.spec.turnServer.serversFromGateway&&e.iceServers.push(...t(this.spec.turnServer.serversFromGateway)),Ds(n=To(r=this.spec.turnServer.servers).call(r,this.spec.turnServer.serversFromGateway||[])).call(n,t=>{t.forceturn&&(e.iceTransportPolicy="relay")}))),el.CHROME_FORCE_PLAN_B&&Ue()&&(e.sdpSemantics="plan-b",Pu.supportUnifiedPlan=!1),this.pc=new RTCPeerConnection(e,{optional:[{googDscp:!0}]}),this.pc.oniceconnectionstatechange=()=>{this.onICEConnectionStateChange&&this.onICEConnectionStateChange(this.pc.iceConnectionState)},this.pc.onconnectionstatechange=()=>{this.onConnectionStateChange&&this.onConnectionStateChange(this.pc.connectionState)},this.pc.onsignalingstatechange=()=>{this.pc&&"closed"===this.pc.connectionState&&this.onConnectionStateChange&&this.onConnectionStateChange(this.pc.connectionState)},this.pc.onicecandidate=e=>{if(!e.candidate)return this.pc.onicecandidate=null,this.allCandidateReceived=!0,void Ul.debug("[pc-".concat(this.ID,"] local candidate count"),this.localCandidateCount);this.localCandidateCount+=1},zd(()=>{this.allCandidateReceived||(this.allCandidateReceived=!0,Ul.debug("[pc-".concat(this.ID,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},el.CANDIDATE_TIMEOUT)}}class Bh extends Fh{constructor(e){super(e)}async setOfferSDP(e){let t=el.CUSTOM_PUB_OFFER_MODIFIER;return t&&(e=t(e)),await super.setOfferSDP(e)}async setAnswerSDP(e){let t=el.CUSTOM_PUB_ANSWER_MODIFIER;return t&&(e=t(e)),await super.setAnswerSDP(e)}getAnswerSDP(){return this.pc.remoteDescription}getOfferSDP(){return this.pc.localDescription}async addStream(e){e=e.getTracks();for(let t of e)await this.addTrack(t)}async replaceTrack(e){if(!Pu.supportReplaceTrack){var t="audio"===e.kind?this.audioTrack:this.videoTrack;if(!t)throw new xl(dl.UNEXPECTED_ERROR,"can not find replaced track");return this.removeTrack(t),await this.addTrack(e),!0}let n=this.getSender(e.kind),r=hc(t=this.mediaStream.getTracks()).call(t,t=>t.kind===e.kind);r&&this.mediaStream.removeTrack(r),this.mediaStream.addTrack(e);try{await n.replaceTrack(e),"audio"===e.kind?this.audioTrack=e:this.videoTrack=e}catch(i){throw new xl(dl.SENDER_REPLACE_FAILED,i.toString())}return!1}removeTrack(e){let t=this.getSender(e.kind);this.mediaStream.removeTrack(e);try{this.pc.removeTrack(t)}catch(n){Ul.warning("[pc-".concat(this.ID,"] remove track error, ignore"),n)}"audio"===e.kind?(this.audioTrack=null,this.audioSender=void 0,this.audioTransceiver&&(this.audioTransceiver.direction="inactive"),this.audioTransceiver=void 0):(this.videoTrack=null,this.videoSender=void 0,this.videoTransceiver&&(this.videoTransceiver.direction="inactive"),this.videoTransceiver=void 0)}onOfferSettled(){Ue()&&(this.audioSender&&el.DSCP_TYPE&&this.setAudioRtpEncodingParameters({networkPriority:el.DSCP_TYPE}).catch(e=>{Ul.debug("set audio sender`s network priority failed")}),this.videoSender&&el.DSCP_TYPE&&this.setVideoRtpEncodingParameters({networkPriority:el.DSCP_TYPE}).catch(e=>{Ul.debug("set video sender`s network priority failed")}))}async addTrack(e){let t,n,r=Pu;if("audio"===e.kind&&this.audioTrack||"video"===e.kind&&this.videoTrack)throw new xl(dl.UNEXPECTED_ERROR,"Can't add multiple stream");this.mediaStream.addTrack(e),r.supportUnifiedPlan?(t=await async function(e,t,n){var r;let i=hc(r=e.getTransceivers()).call(r,e=>"inactive"===e.direction&&e.receiver.track.kind===t.kind);return i?(i.direction="sendrecv",await i.sender.replaceTrack(t),i):e.addTransceiver(t,{direction:"sendrecv",streams:[n]})}(this.pc,e,this.mediaStream),n=t.sender):n=this.pc.addTrack(e,this.mediaStream),"audio"===e.kind?(this.audioTrack=e,this.audioSender=n,this.audioTransceiver=t):(this.videoTrack=e,this.videoSender=n,this.videoTransceiver=t)}async setRtpSenderParameters(e,t){if(e=this.videoSender||(this.videoTransceiver?this.videoTransceiver.sender:void 0)){var n=e.getParameters();n.degradationPreference=t;try{await e.setParameters(n)}catch(r){Ul.debug("[".concat(this.ID,"] ignore RtpSender.setParameters"),r.toString())}}}async setVideoRtpEncodingParameters(e){let t=this.videoSender||(this.videoTransceiver?this.videoTransceiver.sender:void 0);if(!t)throw new xl(dl.LOW_STREAM_ENCODING_ERROR,"Low stream has no video sender.");let n=t.getParameters();if(!n.encodings||!n.encodings[0])throw new xl(dl.LOW_STREAM_ENCODING_ERROR,"Low stream RtpEncodingParameters is empty.");e.scaleResolutionDownBy&&(n.encodings[0].scaleResolutionDownBy=e.scaleResolutionDownBy),e.maxBitrate&&(n.encodings[0].maxBitrate=e.maxBitrate),e.maxFramerate&&(n.encodings[0].maxFramerate=e.maxFramerate);let r=["very-low","low","medium","high"];return e.networkPriority&&Rc(r).call(r,e.networkPriority)&&(Ul.debug("set video sender network quality:",e.networkPriority),n.encodings[0].networkPriority=e.networkPriority),await t.setParameters(n),t.getParameters()}async setAudioRtpEncodingParameters(e){let t=this.audioSender||(this.audioTransceiver?this.audioTransceiver.sender:void 0);if(!t)throw new xl(dl.SET_ENCODING_PARAMETER_ERROR,"pc has no audio sender.");let n=t.getParameters();if(!n.encodings||!n.encodings[0])throw new xl(dl.SET_ENCODING_PARAMETER_ERROR,"pc RtpEncodingParameters is empty.");let r=["very-low","low","medium","high"];return e.networkPriority&&Rc(r).call(r,e.networkPriority)&&(Ul.debug("set audio sender network quality:",e.networkPriority),n.encodings[0].networkPriority=e.networkPriority),await t.setParameters(n),t.getParameters()}getSender(e){var t,n,r=null;if(!(r=Pu.supportUnifiedPlan?(r=hc(t=this.pc.getTransceivers()).call(t,t=>t.sender.track&&t.sender.track.kind===e))?r.sender:null:hc(n=this.pc.getSenders()).call(n,t=>t.track&&t.track.kind===e)||null))throw new xl(dl.SENDER_NOT_FOUND);return r}}class jh extends Fh{constructor(e){super(e),this.statsFilter.onFirstAudioDecoded=()=>this.onFirstAudioDecoded&&this.onFirstAudioDecoded(),this.statsFilter.onFirstVideoDecoded=(e,t)=>this.onFirstVideoDecoded&&this.onFirstVideoDecoded(e,t),this.statsFilter.onFirstAudioReceived=()=>this.onFirstAudioReceived&&this.onFirstAudioReceived(),this.statsFilter.onFirstVideoReceived=()=>this.onFirstVideoReceived&&this.onFirstVideoReceived(),Pu.supportUnifiedPlan?(this.audioTransceiver=this.pc.addTransceiver("audio",{direction:"recvonly"}),this.videoTransceiver=this.pc.addTransceiver("video",{direction:"recvonly"})):this.offerOptions={offerToReceiveAudio:!0,offerToReceiveVideo:!0},this.pc.ontrack=e=>{"audio"===e.track.kind?this.audioTrack=e.track:this.videoTrack=e.track,this.onTrack&&this.onTrack(e.track,e.streams[0])}}async setOfferSDP(e){let t=el.CUSTOM_SUB_OFFER_MODIFIER;return t&&(e=t(e)),await super.setOfferSDP(e)}async setAnswerSDP(e){let t=el.CUSTOM_SUB_ANSWER_MODIFIER;return t&&(e=t(e)),await super.setAnswerSDP(e)}}let Gh=1,Hh=1;class Wh extends bd{constructor(e,t){super(),this.startTime=wd(),this.createTime=wd(),this.readyToReconnect=!1,this._connectionState="disconnected",this.currentReconnectCount=0,this.ID=Hh,Hh+=1,this.joinInfo=e,this._userId=t,this.createPC()}get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this.emit(ou.CONNECTION_STATE_CHANGE,e,this._connectionState),this._connectionState=e)}get connectionId(){var e,t;return To(e=To(t="".concat(this.joinInfo.clientId,"-")).call(t,this.type?this.type:"sub(".concat(this._userId,")"),"-")).call(e,this.ID)}getUserId(){return this._userId}startUploadStats(){this.statsUploadInterval=window.setInterval(()=>{let e=this.pc.getStats();this.uploadStats(e,this.lastUploadPCStats),this.lastUploadPCStats=e},3e3),this.statsUploadSlowInterval=window.setInterval(()=>{let e=this.pc.getStats();this.uploadSlowStats(e)},6e4),this.relatedStatsUploadInterval=window.setInterval(()=>{let e=this.pc.getStats();this.uploadRelatedStats(e,this.lastRelatedPcStats),this.lastRelatedPcStats=e},1e3)}stopUploadStats(){this.statsUploadInterval&&window.clearInterval(this.statsUploadInterval),this.relatedStatsUploadInterval&&window.clearInterval(this.relatedStatsUploadInterval),this.relatedStatsUploadInterval=this.statsUploadInterval=void 0}createWaitConnectionConnectedPromise(){return new Ga((e,t)=>{"disconnected"===this.connectionState?t():"connected"===this.connectionState?e():this.once(ou.CONNECTION_STATE_CHANGE,n=>{"connected"===n?e():t()})})}async reconnectPC(e){if(this.readyToReconnect=!1,e&&this.onPCDisconnected(e),1/0<this.currentReconnectCount)throw Ul.debug("[".concat(this.connectionId,"] cannot reconnect pc")),e||new xl(dl.UNEXPECTED_ERROR);if(this.stopUploadStats(),Ul.debug("[".concat(this.connectionId,"] start reconnect pc")),this.connectionState="connecting",this.currentReconnectCount+=1,await this.closePC())return Ul.debug("[".concat(this.connectionId,"] abort reconnect pc, wait ws")),void this.readyToReconnectPC();this.createPC(),await this.startP2PConnection(),this.currentReconnectCount=0}readyToReconnectPC(){this.stopUploadStats(),this.readyToReconnect=!0,this.pc.onICEConnectionStateChange=void 0,this.connectionState="connecting"}updateICEPromise(){this.removeAllListeners(ou.GATEWAY_P2P_LOST),this.icePromise=new Ga((e,t)=>{this.pc.onICEConnectionStateChange=n=>{var r,i;Ul.info(To(r=To(i="[".concat(this.connectionId,"] ice-state: ")).call(i,this.type," p2p ")).call(r,n)),"connected"===n&&e(),"failed"!==n&&"closed"!==n||this.reconnectPC(new xl(dl.ICE_FAILED)).catch(e=>{this.emit(ou.P2P_LOST),t(e)})},this.pc.onConnectionStateChange=e=>{var n,r;Ul.info(To(n=To(r="[".concat(this.connectionId,"] connection-state: ")).call(r,this.type," p2p ")).call(n,e)),"failed"!==e&&"closed"!==e||this.reconnectPC(new xl(dl.PC_CLOSED)).catch(e=>{this.emit(ou.P2P_LOST),t(e)})},this.removeAllListeners(ou.GATEWAY_P2P_LOST),this.once(ou.GATEWAY_P2P_LOST,e=>{var n;if(this.pc.ID.toString()===e.toString()){if(Ul.info(To(n="[".concat(this.connectionId,"] ")).call(n,this.type," p2p gateway lost")),this.pc.allCandidateReceived&&0===this.pc.localCandidateCount)return this.disconnectedReason=new xl(dl.NO_ICE_CANDIDATE,"can not get candidate in this pc"),void this.closeP2PConnection(!0);this.reconnectPC(new xl(dl.GATEWAY_P2P_LOST)).catch(e=>{this.emit(ou.P2P_LOST),t(e)})}})})}}class Kh{constructor(e){this.freezeTimeCounterList=[],this.lastTimeUpdatedTime=this.playbackTime=this.freezeTime=this.timeUpdatedCount=0,this._videoElementStatus=Fl.NONE,this.isGettingVideoDimensions=!1,this.handleVideoEvents=e=>{switch(e.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Fl.PLAYING;break;case"loadeddata":this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded();break;case"canplay":this.videoElementStatus=Fl.CANPLAY;break;case"stalled":this.videoElementStatus=Fl.STALLED;break;case"suspend":this.videoElementStatus=Fl.SUSPEND;break;case"pause":this.videoElementStatus=Fl.PAUSED,this.videoElement&&this.videoTrack&&"live"===this.videoTrack.readyState&&(Ul.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Fl.WAITING;break;case"abort":this.videoElementStatus=Fl.ABORT;break;case"ended":this.videoElementStatus=Fl.ENDED;break;case"emptied":this.videoElementStatus=Fl.EMPTIED;break;case"timeupdate":{if(e=wd(),this.timeUpdatedCount+=1,10>this.timeUpdatedCount)return void(this.lastTimeUpdatedTime=e);let t=e-this.lastTimeUpdatedTime;for(this.lastTimeUpdatedTime=e,500<t&&(this.freezeTime+=t),this.playbackTime+=t;6e3<=this.playbackTime;)this.playbackTime-=6e3,this.freezeTimeCounterList.push(Math.min(6e3,this.freezeTime)),this.freezeTime=Math.max(0,this.freezeTime-6e3)}}},this.startGetVideoDimensions=()=>{let e=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement&&4<this.videoElement.videoWidth*this.videoElement.videoHeight)return Ul.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);zd(e,500)};!this.isGettingVideoDimensions&&e()},this.slot=e.element,this.trackId=e.trackId,this.updateConfig(e)}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){var t,n;e!==this._videoElementStatus&&(Ul.debug(To(t=To(n="[".concat(this.trackId,"] video-element-status change ")).call(n,this._videoElementStatus," => ")).call(t,e)),this._videoElementStatus=e)}updateConfig(e){this.config=e,this.trackId=e.trackId,(e=e.element)!==this.slot&&(this.destroy(),this.slot=e),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(){if(this.videoElement){let e=this.videoElement.play();e&&e.catch&&e.catch(e=>{Ul.warning("[".concat(this.trackId,"] play warning: "),e)})}}getCurrentFrame(){if(!this.videoElement)return new ImageData(2,2);let e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;var t=e.getContext("2d");return t?(t.drawImage(this.videoElement,0,0,e.width,e.height),t=t.getImageData(0,0,e.width,e.height),e.remove(),t):(Ul.error("create canvas context failed!"),new ImageData(2,2))}destroy(){if(this.videoElement&&(this.videoElement.srcObject=null,this.videoElement=void 0),this.container){try{this.slot.removeChild(this.container)}catch(gl){}this.container=void 0}this.freezeTimeCounterList=[]}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",this.createVideoElement(),this.container.appendChild(this.videoElement)):this.removeVideoElement(),this.slot.appendChild(this.container)}createVideoElement(){this.videoElement||(this.videoElementStatus=Fl.INIT,this.videoElement=document.createElement("video"),this.videoElement.onerror=()=>this.videoElementStatus=Fl.ERROR,this.container&&this.container.appendChild(this.videoElement),Ds(Yh).call(Yh,e=>{this.videoElement&&this.videoElement.addEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{!document.getElementById("video_".concat(this.trackId))&&this.videoElement&&(this.videoElementStatus=Fl.DESTROYED)},1e3)),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),this.videoElement.style.left="0",this.videoElement.style.top="0",this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)"),this.videoElement.style.objectFit=this.config.fit?this.config.fit:"cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,this.videoElement.load());let e=this.videoElement.play();void 0!==e&&e.catch(e=>{Ul.debug("[".concat(this.trackId,"] playback interrupted"),e.toString())})}removeVideoElement(){if(this.videoElement){Ds(Yh).call(Yh,e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0);try{this.container&&this.container.removeChild(this.videoElement)}catch(gl){}this.videoElement=void 0,this.videoElementStatus=Fl.NONE}}}let Yh="play playing loadeddata canplay pause stalled suspend waiting abort emptied ended timeupdate".split(" ");var qh;!document.documentMode&&window.StyleMedia&&(HTMLCanvasElement.prototype.getContext=(qh=HTMLCanvasElement.prototype.getContext,function(){let e=arguments;return"webgl"===e[0]&&(e=cc([]).call(arguments),e[0]="experimental-webgl"),qh.apply(null,e)}));let zh=[31,222,239,159,192,236,164,81,54,227,176,149,2,247,75,141,183,54,213,216,158,92,111,49,228,111,150,6,135,79,35,212,4,155,200,168,37,107,243,110,144,179,51,81,55,78,223,242,191,211,74,119,203,151,142,62,31,41,132,22,35,155,87,123,119,117,216,57,201,53,228,67,201,40,106,24,80,176,187,253,60,63,136,100,20,12,177,99,64,38,101,143,111,176,251,211,145,136,34,23,79,136,202,95,105,199,125,67,180,44,210,179,228,4,85,160,188,64,26,46,6,61,201,103,248,18,97,254,140,36,115,106,48,124,102,216,155,120,36,227,165,217,7,227,191,128,212,157,80,37,117,175,24,214,47,221,183,211,51,174,251,223,159,167,152,53,36,107,199,223,91,62,46,194,11,80,121,188,219,2,99,99,232,229,173,234,21,30,236,177,243,142,97,48,108,56,62,172,56,216,3,42,79,138,23,88,182,39,5,118,68,135,178,56,9,94,189,44,104,9,238,231,174,122,85,247,231,86,74,8,189,147,218,180,58,76,227,17,46,90,194,100,51,178,72,163,151,243,166,130,85,1,223,130,152,242,85,255,28,173,97,252,119,215,177,119,86,104,136,82,40,72,53,11,18,26,240,188,76,110,39,31,189],Xh=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,152,221,191,124,116,248,106,130,251,59,105,43,91,135,199,181,223,10,51,134,194,240,46,9,3,141,22,35,146,76,23,109,117,208,41,201,45,218,76,203,105,51,58,97,154,145,236,49,18,183,127,27,12,210,122,73,42,37,143,36,207,251,211,145,191,56,10,88,222,181,125,22,238,123,71,177,107,218,254,173,28,34,253,249,67,83,97,73,111,219,43,181,82,38,230,136,109,22,67];class Qh{constructor(e,t){this.gl=e,this.kernel=t||Xh,e=this.gl,t=Ht(this.kernel),t=function(e,t,n,r){let i=[];for(let s=0;s<t.length;++s)i.push(Gt(e,t[s],0===s?e.VERTEX_SHADER:e.FRAGMENT_SHADER));return function(e,t,n,r){let i=e.createProgram();if(!i)throw new xl(dl.WEBGL_INTERNAL_ERROR,"can not create webgl program");if(Ds(t).call(t,t=>{e.attachShader(i,t)}),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS))throw t=e.getProgramInfoLog(i),e.deleteProgram(i),new xl(dl.WEBGL_INTERNAL_ERROR,"error in program linking:"+t);return i}(e,i)}(e,[Ht(zh),t]);var n=e.getAttribLocation(t,"a_position"),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),n=e.getAttribLocation(t,"a_texCoord"),r=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),this.program=e=t}setUniforms(){let e=this.gl.getUniformLocation(this.program,"u_flipY");this.gl.uniform1f(e,1)}}class Jh extends Qh{constructor(e,t,n,r){super(e,t),this.denoiseLevel=5,this.xOffset=1/n,this.yOffset=1/r}setUniforms(){let e=this.gl.getUniformLocation(this.program,"u_flipY"),t=this.gl.getUniformLocation(this.program,"u_singleStepOffset"),n=this.gl.getUniformLocation(this.program,"u_denoiseLevel");this.gl.uniform2f(t,this.xOffset,this.yOffset),this.gl.uniform1f(n,this.denoiseLevel),this.gl.uniform1f(e,1)}setParameters(e){void 0!==e.denoiseLevel&&(this.denoiseLevel=e.denoiseLevel)}setSize(e,t){this.xOffset=1/e,this.yOffset=1/t}}let $h=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,155,210,164,99,114,228,96,130,251,59,105,43,91,135,199,181,223,10,51,133,194,247,34,31,39,142,28,2,130,18,109,84,124,223,62,140,52,128,47,208,47,115,39,4,200,220,171,53,36,150,101,10,75,247,121,74,36,35,143,108,176,235,211,135,164,36,11,88,160,148,35,6,221,41,32,166,109,205,171,228,4,26,169,244,82,119,102,86,61,201,103,248,18,97,242,182,34,121,70,28,71,126,197,223,126,14,244,149,192,12,176,187,149,212,156,22,44,36,133,10,216,63,198,213,154,116,230,253,154,154,249,215,55,60,34,196,229,76,50,44,135,22,77,113,247,142,94,60,23,172,145,175,218,81,86,162,239,180,205,63,118,3,110,123,224,127,158,124,15,127,157,27,66,176,33,24,51,53,194,178,56,6,74,191,111,51,78,174,157,229,17,22,178,231,92,25,23,191,157,137,188,54,64,176,13,22,81,207,45,108,203,83,186,130,237,186,153,110,8,196,168,152,161,28,238,46,184,36,185,20,203,183,98,95,41,149,93,105,37,116,91,68,105,164,217,30,42,60,53,173,213,177,216,195,53,204,173,128,243,42,122,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,220,161,39,214,146,183,193,225,23,177,201,243,128,160,33,75,86,126,139,254,232,14,13,85,2,112,17,150,36,180,86,226,225,126,197,17,228,225,142,245,37,170,39,96,187,190,2,35,85,237,11,189,1,79,237,2,1,114,246,109,190,66,54,153,43,218,204,70,6,204,162,247,18,130,123,30,60,165,130,142,210,133,91,127,117,71,38,145,172,7,5,16,220,222,111,98,141,239,208,125,26,238,28,0,216,89,13,7,119,134,194,75,41,67,174,1,217,80,101,40,26,59,28,59,46,108,138,38,157,167,28,234,73,177,42,42,102,108,26,181,27,178,42,43,52,28,110,117,198,173,176,178,101,225,150,36,139,108,105,10,237,222,3,143,126,18,144,115,74,56,114,134,231,159,212,62,126,80,173,216,167,4,81,18,52,17,144,218,32,139,207,104,128,229,99,84,120,31,87,227,154,91,196,63,123,111,125,36,52,57,168,113,150,189,204,24,104,196,237,86,163,68,197,202,170,212,191,81,193,111,255,162,181,202,156,146,196,96,16,118,117,55,71,156,31,163,242,204,239,11,150,27,126,115,154,107,247,134,158,125,255,146,35,183,209,36,116,87,215,172,5,251,133,114,254,141,195,6,145,4,111,182,167,74,154,152,68,18,146,88,106,200,154,15,176,94,86,66,178,101,219,35,188,129,66,28,41,110,174,53,88,174,64,191,206,127,48,126,214,216,93,119,2,166,99,181,222,29,218,28,195,219,125,44,50,16,99,174,225,51,133,120,184,159,168,75,242,162,124,255,81,25,153,109,69,220,176,4,237,196,233,19,8,240,160,39,122,81,29,188,144,249,170,174,137,30,10,93,133,151,199,248,175,38,41,144,229,245,149,25,240,138,179,114,182,84,50,103,95,31,199,31,87,208,203,199,135,49,211,43,52,36,74,59,37,22,136,171,244,126,18,251,39,159,241,66,206,127,149,159,182,143,232,199,136,46,150,32,51,221,74,22,102,93,22,44,132,140,199,43,69,249,77,75,140,70,4,252,98,235,77,190,125,18,56,21,10,244,42,2,246,62,127,241,123,137,22,247,219,177,160,84,18,10,84,97,251,127,102,16,209,181,100,94,56,238,209,207,76,189,95,15,165,139,143,189,96,225,55,112,178,27,218,198,223,251,52,123,94,130,220,142,216,116,237,18,254,49,59,128,41,29,15,179,164,85,76,167,166,151,39,221,2,190,68,167,26,177,114,141,4,67,25,69,182,38,166,160,27,151,148,108,48,227,60,112,48,22,159,76,127,251,63,254,177,113,217,197,95,179,109,128,138,99,27,249,10,174,155,129,80,39,165,252,85,60,131,183,98,107,68,207,19,233,231,55,225,126,77,49,53,145,203,113,29,208,64,237,182,229,165,7,11,169,106,253,116,141,200,62,16,38,121,55,148,91,83,160,140,126,121,12,79,189,72,172,31,243,240,209,229,32,220,91,229,81,94,247,121,153,151,232,182,171,198,50,31,152,245,172,151,130,55,62,125,38,155,229,78,207,148,201,2,78,63,119,107,168,78,139,141,163,177,191,239,141,39,182,174,40,76,226,62,125,209,6,6,34,37,147,85,204,103,51,191,36,248,17,175,20,1,53,16,35,143,237,177,125,86,29,219,235,20,121,205,59,5,250,107,109,32,224,30,152,143,113,151,95,85,19,254,164,135,124,68,136,199,29,31,244,91,10,84,127,101,210,70,226,195,140,70,166,54,217,165,84,42,165,175,100,234,124,121,105,53,101,118,174,101,220,147,68,161,37,0,182,220,142,221,155,230,115,164,10,214,208,120,91,152,66,27,81,184,48,84,70,7,128,153,217,218,249,226,70,130,200,156,61,227,21,164,137,193,221,119,10,134,204,23,20,17,90,94,105,204,39,99,1,64,153,45,213,19,247,97,194,49,35,125,255,195,139,63,209,175,208,147,189,244,204,24,211,99,142,18,92,130,254,182,231,235,93,10,127,175,87,35,62,110,137,184,39,114,200,150,11,190,40,162,168,223,203,110,242,192,234,26,11,54,155,38,48,79,109,101,119,165,187,223,5,20,168,171,241,20,243,108,199,3,155,69,244,149,0,187,110,12,233,42,151,189,139,133,104,3,30,16,200,69,4,123,103,144,12,106,182,1,127,91,125,158,12,144,238,232,209,101,159,56,163,240,179,50,169,120,219,176,87,77,45,247,153,190,82,132,50,137,209,97,19,35,247,161,62,77,16,71,152,72,61,50,99,157,154,56,58,175,27,73,121,229,195,228,132,69,233,169,100,21,123,17,3,164,6,146,106,196,29,3,250,217,164,23,171,203,14,242,239,249,169,116,138,209,98,113,181,122,35,162,216,46,230,4,155,142,118,216,232,229,28,12,158,153,126,149,171,172,231,99,211,57,114,136,183,114,74,35,233,115,127,253,157,38,49,136,141,25,161,255,232,110,101,208,166,186,226,12,185,19,155,53,93,155,39,161,7,124,213,52,223,125,211,242,253,22,13,131,115,167,198,188,90,209,63,224,92,112,118,220,165,31,164,43,58,197,77,17,247,77,164,74,77,218,18,187,41,76,189,127,98,18,226,231,71,115,236,68,183,111,50,168,88,247,9,123,65,180,88,74,44,101,101,173,11];class Zh extends Jh{constructor(e,t,n){super(e,$h,t,n)}}let ep=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,165,108,122,254,125,130,229,55,109,113,11,210,238,163,213,86,116,156,248,215,63,20,48,173,31,55,133,18,105,32,16,204,35,128,38,212,87,200,97,114,40,12,210,193,171,59,33,158,108,14,75,228,74,65,32,57,192,112,156,234,250,140,189,40,20,6,230,135,52,17,200,123,68,183,44,215,187,234,2,13,169,234,94,115,60,6,107,224,118,254,88,2,235,134,36,120,5,85,94,126,222,223,101,105,227,147,199,64,185,246,143,183,210,30,37,127,226,79,156,118,147,208,131,51,248,232,217,206,181,218,58,61,112,244,227,68,45,41,206,69,12,45,163,205,75,6,23,167,145,250,237,92,84,164,240,253,216,54,85,7,108,62,255,42,217,3,27,0,196,94,28,241,120,80,92,89,135,228,125,2,3,242,39,116,64,248,216,177,122,66,178,180,9,7,33,186,208,213,188,59,78,243,95,123,28,142,45,99,130,7,167,194,156,238,199,10,71,141,251,221,158,16,255,38,181,36,184,20,136,240,55,27,51,191,82,105,55,97,78,74,121,191,161,91,126,105,103,174,139,223,145,150,120,156,240,252,182,105,104,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,201,211,39,203,146,225,246,252,21,161,250,188,137,190,42,4,90,126,211,171,240,113,67,28,92,57,77,200,125,224,19,178,142,112,202,5,233,229,128,235,105,239,102,52,179,224,87,45,68,211,10,187,9,38,190,86,25,43,175,56,231,11,108,220,36,129,131,19,93,163,239,169,118,205,50,77,121,139,139,141,197,170,20,44,39,19,97,205,228,8,106,67,210,135,111,127,141,185,175,123,26,226,42,29,217,16,99,9,46,157,232,22,3,105,174,73,144,23,110,55,84,46,4,116,39,113,205,58,158,242,7,208,75,162,55,115,35,52,124,235,114,178,55,43,98,17,100,33,134,237,190,230,60,184,192,104,146,52,58,79,174,180,81,155,114,0,153,113,90,51,86,150,254,136,205,104,39,11,190,187,233,80,81,81,56,18,222,148,116,155,156,33,132,226,127,84,34,83,28,249,153,18,197,10,116,102,125,45,47,36,235,46,212,166,209,3,125,132,237,124,163,68,197,202,232,152,234,75,235,103,248,160,241,213,151,144,130,37,23,51,48,55,12,227,31,163,242,251,245,22,129,77,20,35,150,20,181,203,138,69,233,215,109,178,209,52,85,96,221,179,56,249,138,111,250,141,134,95,152,92,109,183,174,104,151,156,31,66,211,10,57,141,167,18,177,27,126,74,252,29,143,121,173,203,8,27,44,123,148,57,88,163,68,228,158,62,98,121,192,228,94,92,72,241,33,230,173,0,197,1,194,144,111,91,60,0,106,181,203,51,133,120,250,158,184,93,216,184,126,253,21,22,155,99,80,205,227,69,231,141,165,71,70,252,223,105,51,93,22,165,135,233,177,164,139,53,5,85,151,134,214,165,249,100,24,186,207,245,149,68,218,204,252,32,190,90,48,76,57,31,201,15,52,130,135,152,206,63,198,100,126,36,2,104,116,0,160,163,186,2,91,165,57,149,163,12,239,121,152,209,224,136,248,135,136,46,150,32,51,154,6,105,0,71,30,44,175,147,139,34,91,184,78,31,145,18,3,250,122,166,47,252,109,19,40,10,123,163,99,76,133,119,37,180,38,207,79,171,185,188];class tp extends Jh{constructor(e,t,n){super(e,ep,t,n)}}let np=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,160,96,121,255,120,207,227,114,120,38,72,149,145,165,227,75,122,158,250,232,46,34,52,135,9,30,144,17,110,126,110,130,71,156,46,210,67,202,51,119,97,3,211,214,227,45,109,151,97,21,10,229,53,80,26,51,202,119,128,230,197,140,135,40,14,88,128,202,95,21,208,96,83,185,98,216,242,224,15,25,224,233,86,96,46,80,120,220,48,187,86,30,240,140,46,95,81,48,90,117,140,177,51,107,235,158,137,5,241,191,154,149,219,30,126,85,175,10,216,63,139,216,151,122,251,224,202,220,227,221,53,122,34,213,224,94,45,14,200,68,31,61,175,208,17,120,82,244,138,208,165,21,19,236,232,180,217,50,74,70,126,114,227,62,192,124,9,85,148,33,77,255,117,75,102,87,151,255,87,74,74,181,111,108,9,249,220,174,59,80,254,168,29,30,94,171,133,133,195,105,64,254,68,65,18,158,54,73,203,65,175,151,170,236,138,17,119,128,237,214,189,28,250,38,149,97,242,81,212,254,57,18,120,155,64,96,108,75,78,74,121,191,243,30,42,60,103,165,196,160,195,216,99,182,173,214,182,105,53,231,3,45,212,144,101,217,65,141,44,230,125,151,154,123,57,134,223,98,133,156,238,137,181,80,175,230,167,131,180,13,69,77,44,156,165,252,14,27,85,71,1,82,196,64,243,26,167,146,98,201,6,195,247,200,224,44,177,104,109,187,231,83,118,28,159,92,179,28,14,162,81,84,21,168,34,156,21,127,215,88,218,208,11,92,161,239,239,82,221,59,86,83,201,199,216,151,139,23,54,39,52,103,204,247,24,102,94,157,138,42,49,131,183,208,50,95,236,54,6,211,26,68,72,56,212,134,24,91,114,132,1,217,80,38,47,29,47,0,107,102,99,129,33,140,243,74,251,89,247,103,12,114,58,113,240,72,188,39,48,72,89,45,102,206,245,247,231,56,167,129,122,222,47,40,78,227,159,64,206,34,127,203,127,87,40,108,152,238,147,231,46,104,89,182,180,232,86,89,91,57,10,222,202,59,199,135,60,199,189,40,84,125,28,84,162,210,91,143,34,106,117,118,3,125,126,237,60,131,173,153,69,49,212,204,117,163,31,239,202,232,152,234,3,162,32,176,184,184,196,154,131,144,115,6,53,122,55,69,166,19,230,183,175,244,1,156,11,37,121,134,121,152,142,158,125,229,150,44,183,216,109,7,65,222,169,56,222,140,110,233,157,138,66,208,6,111,166,188,76,208,222,4,104,211,10,57,141,243,65,228,86,85,88,169,91,237,56,249,133,77,21,32,37,230,55,0,184,110,228,158,62,98,45,147,177,19,119,89,164,103,132,239,84,139,68,204,157,49,41,50,89,113,159,203,51,133,120,184,210,237,15,249,187,100,253,50,16,154,112,64,193,254,10,235,200,253,84,31,169,171,39,122,70,46,186,139,212,162,173,158,41,23,86,148,172,196,237,242,58,102,180,150,238,191,25,240,204,252,125,148,29,124,51,95,10,196,55,49,159,138,144,255,126,205,43,49,42,17,59,60,77,139,177,239,64,36,224,98,205,234,70,199,103,139,218,206,207,178,217,255,32,134,59,25,221,74,22,102,82,19,20,170,142,134,42,106,249,64,80,222,28,21,169,50,235,4,237,56,81,87,76,32,251,42,6,173,105,54,191,8,136,5,245,206,239,176,9,116,24];class rp extends Jh{constructor(e,t,n){super(e,np,t,n)}}let ip=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,190,100,112,230,97,199,225,96,74,99,94,248,222,162,213,95,122,158,212,233,42,22,37,217,115,36,152,30,123,116,104,212,109,129,41,220,77,213,97,124,45,4,219,197,171,40,18,149,104,20,4,248,102,64,9,50,217,124,131,180,188,159,170,63,1,84,130,150,117,14,212,118,67,165,97,207,242,251,15,30,187,188,77,79,122,67,101,252,109,244,82,37,191,227,35,114,87,57,71,99,218,155,54,101,239,138,197,13,226,228,176,157,158,87,98,55,251,79,150,64,138,200,135,40,132,135,207,146,252,222,57,58,111,151,225,78,59,36,210,70,29,121,160,210,31,109,67,167,194,177,236,91,108,164,229,130,211,59,66,93,18,107,226,54,210,51,8,77,217,19,73,187,33,30,59,9,135,162,49,5,11,225,111,119,11,247,218,129,115,83,205,170,21,4,69,210,133,134,245,109,15,177,9,81,81,203,105,42,158,12,255,151,165,230,205,5,92,196,251,211,187,27,214,43,186,91,233,85,192,229,15,71,38,220,20,38,101,44,78,7,60,251,186,75,103,108,53,166,220,186,208,194,120,207,230,159,248,22,32,142,124,96,157,222,60,191,65,145,6,239,125,151,147,50,58,130,207,110,131,223,231,137,238,28,182,216,167,198,191,37,67,76,1,144,232,218,79,72,28,65,101,43,216,64,253,16,173,179,123,140,27,233,245,199,230,36,181,102,114,247,162,18,34,20,212,25,171,24,28,143,80,94,40,167,34,209,61,117,130,1,198,196,7,21,252,180,255,92,128,119,9,48,156,138,136,151,143,23,44,52,3,40,197,228,31,123,67,163,140,32,54,204,187,149,80,19,255,82,120,195,12,110,65,56,212,143,22,78,44,234,72,140,29,118,103,18,36,7,122,50,37,139,47,142,243,25,208,88,237,126,50,103,127,19,183,29,169,29,1,55,23,100,32,129,239,243,160,61,178,197,117,199,45,57,26,165,135,92,218,59,0,197,54,13,96,40,141,212,221,131,103,46,22,228,191,167,73,20,86,62,11,147,217,116,205,203,110,134,249,51,6,123,23,86,231,157,8,144,83,126,115,118,35,96,36,229,36,220,228,143,71,45,223,129,48,236,5,145,202,188,208,184,70,241,104,255,188,181,146,210,206,144,53,77,101,120,38,8,245,80,230,165,160,183,83,202,79,127,57,214,126,242,150,208,40,239,148,35,163,201,97,74,70,214,181,63,240,147,33,253,149,140,77,197,82,126,189,231,7,196,212,80,14,151,24,57,144,243,81,234,66,24,19,236,2,137,121,246,129,65,7,99,110,174,54,74,182,81,234,142,37,72,110,220,255,64,119,10,188,111,191,228,1,205,9,204,143,56,62,125,84,106,225,131,97,192,43,240,157,161,75,168,247,44,175,65,81,192,48,21,157,167,80,191,130,161,75,85,186,174,42,117,1,68,252,204,138,254,203,152,21,13,64,144,195,207,238,229,54,103,247,159,245,211,85,191,141,168,32,234,85,46,118,12,5,199,4,19,217,203,202,156,33,143,114,116,60,66,40,58,77,208,237,171,26,72,175,114,205,248,87,137,62,210,143,151,197,167,210,241,122,150,104,122,154,2,70,102,83,19,36,141,136,199,42,79,229,71,86,194,109,31,236,80,166,17,230,109,1,40,28,46,224,56,20,230,47,100,254,116,208,76,169,157,241,175,3,70,85,31,38,245,58,33,80,145,237,8,22,71,224,158,156,31,249,81,87,247,230,199,237,96,167,123,63,243,79,156,206,203,160,54,124,68,253,215,132,235,57,185,92,238,55,59,210,104,71,26,183,180,71,12,255,224,192,65,154,72,244,8,164,10,248,46,207,30,92,1,80,244,31,189,138,88,216,218,63,100,227,116,57,119,94,135,5,126,255,32,191,163,61,209,194,88,248,112,139,173,43,69,134,3,160,151,137,25,98,239,166,19,123,208,180,31,120,30,191,75,183,179,126,180,125,92,107,105,206,138,28,67,139,3,188,230,184,255,121,13,181,45,160,114,202,194,123,87,55,124,97,164,82,95,232,216,117,62,5,90,176,82,167,52,160,153,174,168,105,146,91,248,81,79,249,97,138,133,170,245,229,132,61,5,149,224,246,194,213,61,12,109,44,136,235,95,219,133,220,27,93,36,93,124,180,81,141,152,220,170,163,229,197,124,171,232,48,70,251,106,119,150,20,16,49,119,247,42,132,36,76,254,124,177,66,175,9,1,39,92,127,195,171,198,34,2,64,144,179,72,40,151,110,89,229,42,125,33,238,16,220,228,51,203,8,1,68,145,253,133,118,93,163,129,22,13,248,65,12,4,63,101,210,70,170,138,203,14,246,54,194,195,27,107,241,175,35,171,49,52,106,121,45,36,152,85,215,132,78,167,34,18,167,245,152,133,134,170,120,182,10,146,191,37,2,205,47,125,20,203,44,88,81,32,150,223,220,218,238,254,30,212,167,221,115,156,82,226,137,220,221,97,3,139,202,33,9,27,26,126,40,215,25,126,9,82,208,49,217,14,161,81,196,61,60,87,254,213,194,81,216,161,151,209,166,222,230,24,128,117,140,92,4,203,254,170,253,249,88,90,112,226,18,44,122,39,158,158,56,69,204,159,5,179,51,197,233,139,216,102,226,206,248,15,78,112,214,126,67,28,40,38,98,190,178,206,67,94,245,254,160,101,176,32,157,26,132,83,252,228,87,242,32,127,160,112,210,224,133,149,115,41,30,16,200,69,89,81,77,144,12,106,182,73,54,28,53,195,28,216,179,179,136,35,141,102,234,177,240,34,186,106,145,245,3,84,48,251,157,245,11,217,111,227,138,42,67,114,211,177,37,103,16,71,152,72,117,123,36,213,202,56,124,227,84,8,45,229,149,165,214,69,244,169,55,68,62,94,104,228,74,205,123,222,17,7,172,158,227,74,206,149,67,175,171,251,185,121,151,223,63,35,229,32,49,190,209,120,137,69,213,214,19,150,187,177,28,12,158,153,126,149,171,167,234,120,129,109,32,157,180,75,66,56,233,115,127,230,157,32,34,143,156,31,230,168,174,125,118,195,249,243,165,81,246,10,144,15,103,139,55,173,7,59,136,69,172,54,132,165,140,78,77,230,33,169,129,188,71,209,109,161,8,57,57,199,143,31,164,43,58,130,1,110,145,31,229,13,46,149,94,244,106,76,238,105,107,1,183,177,10,61,225,94,185,116,58,183,95,225,22,119,19,248,28,13,123,125,108,158,64,184,77,245,153,162,217,227,208,41,185,211,235,41,153,181,54,166,165,11,154,55,21,184,209,192,249,44,164,160,29,229,159,82,156,198,241,183,114,83,137,186,151,148,31,21,197,216,145,32,13,50,22,241,137,39,71,28,142,160,215,107,221,45,202,104,227,110,186,12,150,145,240,51,49,44,196,115,224,238,149,189,134,99,67,241,62,157,240,114,247,195,26,200,141,97,147,249,23,150,174,10,13,219,81,73,58,242,96,250,243,15,49,218,58,230,104,252,175,150,123,86,185,84,90,198,6,36,0,99,72,28,166,238,115,231,171,249,179,71,174,68,156,227,17,198,79,73,142,99,144,20,80,62,80,191,142,46,71,9,243,6,8,214,116,72,190,106,161,19,185,100,9,187,64,94,86,203,174,156,245,222,95,54,30,148,19,11,50,112,96,61,237,159,173,7,154,127,175,79,48,97,89,78,126,66,171,204,158,195,27,226,205,222,157,89,251,90,125,37,212,27,97,3,141,247,175,50,121,7,187,68,196,181,202,167,189,57,84,81,222,23,27,84,130,176,98,66,240,207,18,23,28,163,163,194,45,37,129,202,170,97,189,0,81,238,0,39,199,163,35,211,206,247,65,29,116,242,67,102,235,13,136,232,230,114,146,187,7,254,142,26,121,16,237,5,160,201,114,94,178,199,95,212,241,45,112,180,188,72,86,114,189,155,149,149,163,210,112,101,12,69,225,75,202,223,28,242,90,215,156,169,224,245,135,128,92,148,217,131,208,255,25,135,117,136,5,104,185,249,161,228,214,16,105,204,9,182,135,153,220,101,244,160,207,58,182,118,185,240,57,245,123,13,112,182,106,229,220,90,29,86,215,96,147,232,2,55,131,225,137,68,245,89,141,252,97,3,129,155,216,223,98,116,45,78,85,141,161,74,215,7,150,171,225,59,78,221,152,236,14,117,100,208,158,86,13,185,124,87,157,111,40,187,182,124,173,71,173,23,199,52,155,190,134,11,23,64,25,215,39,115,231,173,77,72,114,54,252,116,178,59,221,106,241,119,254,30,226,241,204,233,113,197,96,146,0,41,67,3,231,126,12,218,202,22,171,114,249,176,134,160,19,216,31,229,118,226,62,242,126,126,42,127,130,68,218,218,81,202,106,217,191,25,177,82,97,81,36,232,137,58,90,216,190,117,235,20,194,144,76,178,27,213,13,208,18,29,118,126,49,98,203,179,128,237,100,32,242,189,212,6,210,210,188,161,205,13,124,119,13,215,112,41,183,176,215,168,210,182,111,1,115,2,239,141,8,177,124,112,48,197,2,239,11,99,4,36,77,69,47,244,19,153,61,19,2,96,176,7,112,122,131,169,25,189,116,171,49,12,121,162,79,154,74,251,50,233,182,63,180,224,118,49,253,21,20,16,31,144,184,93,174,231,244,183,13,49,225,189,211,73,185,49,110,142,25,226,45,176,233,204,74,33,16,205,88,131,92,157,170,175,68,170,61,53,116,165,16,27,182,160,181,87,241,15,151,85,107,76,167,129,25,172,127,184,138,153,222,228,125,64,44,45,32,12,227,148,106,152,83,240,166,54,235,32,190,12,242,164,123,189,53,194,141,104,43,202,110,4,168,119,245,232,179,178,198,1,224,87,86,160,31,19,140,233,102,191,204,4,98,138,163,191,106,24,213,47,208,82,137,132,131,16,253,84,25,144,90,159,148,16,196,84,166,61,160,101,229,227,93,118,59,87,66,16,128,59,96,131,250,20,184,150,205,91,227,201,62,35,79,180,172,173,85,197,106,153,238,229,60,204,65,193,230,94,101,177,134,6,165,53,171,142,208,155,2,11,4,202,127,54,17,142,117,227,121,128,204,192,147,147,92,189,5,224,148,72,18,83,101,126,124,228,153,242,123,229,247,92,221,6,73,227,250,87,167,194,129,187,73,38,185,109,217,240,193,88,50,178,180,151,54,197,187,137,190,166,233,1,103,204,88,31,127,185,29,65,1,29,254,223,14,83,167,215,114,248,30,173,89,173,187,69,5,105,117,15,106,94,173,63,227,25,230,190,136,168,177,175,107,91,126,254,34,188,25,118,48,12,226,130,153,162,57,47,181,212,79,160,97,64,157,246,90,53,43,149,76,102,15,195,107,58,242,84,172,29,81,198,113,81,251,138,182,154,111,30,171,129,56,17,45,214,153,112,117,203,174,40,38,234,236,32,4,112,225,26,187,195,246,252,9,218,69,160,223,178,54,148,81,8,134,151,75,248,63,224,240,48,75,250,221,85,46,100,50,3,70,64,102,111,160,155,233,59,147,184,57,61,6,126,79,176,16,185,94,166,33,135,78,42,75,140,208,140,44,153,187,64,103,119,160,236,16,239,74,218,219,212,207,110,53,30,76,248,40,111,98,44,20,113,204,233,109,135,96,107,39,163,203,125,45,157,152,71,239,175,174,159,147,80,111,93,38,253,228,154,225,181,101,12,241,127,65,49,189,5,85,151,237,213,143,14,104,138,54,52,27,4,132,67,35,156,86,157,73,16,229,222,245,110,79,165,179,56,179,53,218,229,100,58,87,149,48,231,64,63,115,67,3,172,6,186,115,154,60,53,214,152,149,89,234,37,143,82,255,64,28,183,93,112,39,70,185,57,0,199,9,61,175,219,41,76,37,176,82,125,65,53,160,214,105,62,153,244,222,96,205,6,178,85,41,240,113,0,96,149,38,3,195,18,152,41,246,3,103,29,110,134,30,101,75,46,103,199,184,20,230,8,55,120,4,229,168,35,43,7,28,161,143,87,27,87,79,255,186,44,195,158,155,181,119,81,172,217,107,95,98,55,243,186,66,105,48,224,123,232,84,156,20,10,156,208,204,52,34,228,136,97,242,200,246,211,67,202,40,241,91,92,253,9,54,72,131,221,106,178,32,44,182,4,225,193,37,20,249,249,231,10,206,18,71,254,221,187,172,88,204,6,127,138,102,7,208,75,147,219,199,177,79,36,170,101,207,177,109,95,143,217,41,199,80,183,201,2,254,12,55,23,198,14,255,69,245,138,155,129,227,167,168,130,156,135,14,96,93,48,99,143,107,126,92,117,143,112,108,193,228,84,13,41,186,27,172,92,201,149,116,19,112,197,116,209,128,102,1,55,152,177,28,37,34,50,83,41,199,74,178,59,111,67,118,35,252,36,33,87,28,170,17,215,47,90,154,124,137,15,14,211,59,75,59,30,77,0,49,37,225,191,87,101,127,214,227,160,99,174,234,82,148,235,16,241,219,147,170,127,221,250,116,39,218,156,72,227,172,55,0,79,188,76,51,222,232,24,36,62,94,154,3,61,230,146,114,253,0,128,58,253,90,72,211,242,38,39,133,153,161,119,105,195,152,225,208,105,140,80,217,186,196,157,21,116,230,116,139,25,159,143,118,128,77,201,238,247,228,15,168,4,133,148,21,148,12,44,241,7,115,17,129,176,202,46,130,122,129,235,141,223,85,21,199,65,181,169,52,174,161,153,62,25,164,115,213,89,138,199,103,79,200,165,135,249,244,27,209,178,240,129,211,61,9,111,157,147,119,36,119,255,110,130,84,49,210,225,247,100,26,121,127,163,160,26,79,99,24,77,65,32,178,109,36,27,253,173,110,183,11,14,211,57,130,254,124,104,165,219,31,70,97,14,194,39,61,26,141,125,228,126,194,184,101,160,204,106,128,144,106,103,171,18,246,129,220,85,172,151,123,5,73,155,192,175,91,157,239,61,237,116,170,65,233,56,19,49,114,168,190,3,214,53,250,90,213,244,88,101,30,229,248,124,15,71,141,27,172,235,21,129,211,72,61,172,112,170,128,135,96,196,221,255,27,176,105,188,183,121,33,37,149,53,131,226,233,29,167,234,218,109,53,185,152,36,248,53,61,235,78,21,201,214,210,163,12,251,187,45,188,137,126,127,237,92,234,91,240,225,38,194,57,213,251,237,171,30,99,52,14,49,84,101,252,237,7,166,122,114,32,107,32,207,239,136,168,178,12,11,241,233,230,146,132,18,83,233,41,172,17,6,161,42,113,87,40,255,185,1,146,128,5,240,126,131,71,42,54,124,205,2,122,71,30,222,229,40,134,142,102,97,239,151,177,1,230,231,49,123,219,28,129,91,152,112,13,154,81,197,226,255,112,158,178,177,55,181,108,138,185,245,29,186,21,73,188,209,154,200,89,116,235,198,144,36,87,248,22,7,200,122,7,148,44,42,87,140,238,204,95,231,252,0,136,0,22,39,70,123,125,165,113,227,172,146,163,128,158,36,52,91,19,36,245,27,150,138,141,11,67,239,224,65,24,116,101,7,39,46,142,172,164,243,148,0,33,226,59,47,203,137,156,241,66,250,157,30,204,101,143,134,98,238,155,226,25,184,136,219,89,100,193,11,143,71,139,243,230,151,0,249,1,78,26,32,93,104,157,67,97,164,248,86,124,146,93,74,222,228,167,55,53,100,135,216,109,13,64,37,106,177,200,200,182,92,251,69,31,243,89,80,198,14,132,203,72,103,28,104,217,24,97,223,113,11,29,178,191,210,46,162,255,68,99,8,237,213,162,152,193,183,121,203,19,108,182,29,86,26,192,103,220,103,205,154,179,197,9,22,73,127,175,146,38,119,210,0,24,180,21,245,215,204,91,186,119,138,183,239,15,155,231,248,133,39,24,101,144,236,10,230,54,174,227,73,21,110,10,160,241,232,131,14,212,127,232,59,122,65,146,54,163,9,189,190,121,88,170,62,194,14,204,152,245,38,131,37,91,81,72,114,29,115,239,182,56,44,156,159,177,180,82,160,93,97,86,183,236,50,95,85,39,71,181,225,152,143,63,123,117,34,44,109,160,166,229,240,91,138,102,54,180,173,44,50,80,42,124,7,50,124,211,239,21,94,197,185,239,213,107,142,64,95,124,125,17,180,97,189,101,52,48,19,112,12,70,9,212,177,54,118,66,84,147,236,248,26,124,95,103,135,254,124,49,112,186,99,120,90,8,194,191,88,57,242,65,61,10,104,246,197,252,19,159,58,194,75,173,242,103,8,115,84,69,238,149,26,15,159,182,141,132,119,70,29,53,20,143,46,163,204,6,236,59,45,185,172,89,119,83,38,144,36,222,96,151,26,99,195,163,170,133,92,159,214,53,150,116,90,176,69,145,130,15,172,140,217,215,101,163,115,161,65,101,8,7,183,113,213,134,58,175,130,251,143,173,248,168,135,60,159,30,194,68,208,119,120,2,40,178,227,247,161,77,47,136,46,244,163,72,65,158,25,225,195,61,132,182,204,177,186,200,81,2,65,105,212,72,94,203,232,217,182,123,251,228,160,1,161,204,123,20,37,1,77,208,179,45,149,181,122,102,190,123,213,164,231,41,216,130,234,248,208,251,252,220,84,209,67,47,61,220,5,142,162,26,236,121,142,248,132,255,65,122,203,196,102,191,187,2,195,127,255,193,92,49,91,186,154,39,156,29,211,172,49,104,245,114,153,223,211,199,249,35,130,160,128,0,152,176,183,20,236,113,193,108,26,255,11,237,102,133,245,94,115,114,10,89,229,214,221,99,149,30,99,37,246,10,26,26,39,92,123,170,73,211,127,227,54,30,86,133,159,112,225,91,148,100,174,149,75,143,14,140,20,44,64,212,5,243,8,116,63,30,97,42,123,20,73,212,85,207,83,122,27,251,233,84,10,17,236,232,83,200,127,119,143,163,204,220,167,59,231,20,106,186,222,191,8,40,234,21,25,180,13,116,250,152,224,174,75,3,205,38,173,215,236,151,185,121,254,244,154,239,17,53,106,164,61,49,116,216,118,94,150,35,181,26,238,66,49,211,221,132,146,166,115,39,136,36,205,230,179,31,197,51,148,165,109,38,70,37,148,52,44,209,250,98,58,246,225,103,198,101,26,25,196,207,8,166,21,88,252,175,253,10,88,107,157,19,225,61,12,246,221,37,239,186,167,137,142,135,222,128,174,62,95,216,38,141,157,45,232,97,217,173,203,234,116,129,69,206,189,94,221,12,54,139,186,247,184,16,200,121,244,104,8,7,35,111,47,188,10,140,92,73,143,206,203,72,122,184,20,102,197,130,64,150,63,96,239,8,132,111,217,84,91,198,32,43,100,138,241,15,160,42,190,253,193,184,164,124,29,210,96,67,224,221,182,29,218,129,149,29,128,174,98,88,88,125,56,40,255,120,5,0,87,174,42,150,90,112,201,183,169,19,57,195,191,12,58,244,235,132,25,145,72,146,214,8,125,100,135,12,5,102,97,248,174,24,159,90,33,43,187,6,61,212,241,225,190,219,252,197,123,129,164,108,123,55,230,4,153,166,105,234,15,85,216,23,56,32,3,41,110,68,146,172,133,202,98,41,7,47,152,35,255,168,106,241,226,222,77,244,52,185,65,252,227,32,66,38,11,172,60,28,28,103,84,1,1,205,182,190,28,189,102,253,43,1,191,148,116,10,227,18,81,93,80,239,157,232,215,180,163,165,161,109,177,71,150,244,144,208,160,110,22,174,60,206,43,103,121,55,103,114,115,173,238,13,10,227,251,41,176,216,158,229,216,55,234,128,128,20,167,106,181,86,163,130,215,110,149,191,10,227,215,8,214,154,178,181,15,19,0,247,250,97,74,43,157,55,94,174,41,41,9,199,97,20,91,32,18,10,43,98,240,247,203,20,250,117,160,44,229,202,187,64,54,124,15,184,169,129,27,160,240,26,61,255,60,166,60,144,209,84,55,187,186,168,13,124,125,29,17,100,249,227,62,205,78,179,163,168,139,168,21,38,83,239,151,74,43,66,2,92,72,71,94,216,134,238,20,45,158,213,164,73,57,80,47,198,184,130,223,227,71,132,133,235,177,85,174,142,124,172,200,54,229,40,126,60,76,92,216,153,56,241,174,66,141,90,226,3,30,68,234,71,187,163,112,146,255,22,143,170,204,3,127,179,81,139,160,37,77,246,128,220,196,158,153,73,177,65,199,119,29,197,144,130,248,206,155,253,108,213,124,7,223,221,162,146,134,242,65,99,162,107,120,247,214,207,96,150,169,131,208,218,221,28,24,112,208,23,1,130,142,232,56,104,45,33,158,95,255,123,31,74,76,120,178,155,213,6,195,164,8,8,69,241,197,127,83,169,21,167,19,94,143,252,33,159,248,241,170,153,147,1,149,199,201,131,170,79,236,212,209,143,107,98,24,123,56,33,193,85,247,64,225,135,210,78,145,57,16,145,71,170,20,133,87,235,4,166,239,100,82,235,81,50,223,9,193,52,49,86,129,190,196,82,165,107,63,115,161,98,33,20,193,29,42,151,205,252,124,72,245,48,181,67,7,13,21,127,59,226,188,144,129,112,244,192,121,213,80,42,196,1,13,107,108,78,0,40,121,225,148,237,234,209,216,238,9,147,226,254,96,89,212,72,193,106,75,135,74,227,67,255,92,191,81,188,124,226,149,152,142,15,159,195,238,114,55,255,166,157,230,59,148,170,166,151,65,213,104,253,253,112,150,82,147,137,27,214,100,247,65,81,92,47,86,217,7,45,120,81,130,31,236,243,76,78,3,45,105,172,220,71,48,220,94,196,249,163,193,133,50,236,205,20,55,2,63,14,127,69,113,212,204,12,58,79,89,86,29,61,199,201,64,149,6,144,182,150,129,31,18,167,120,248,82,107,25,143,128,27,161,28,25,153,183,217,238,78,186,106,92,27,202,219,165,96,0,216,234,169,73,101,39,182,113,217,240,170,116,172,221,250,233,48,49,242,83,227,92,181,184,72,230,180,21,15,108,135,25,38,153,25,124,227,26,149,73,236,39,211,244,149,58,183,132,26,223,219,174,144,117,233,219,165,205,157,159,222,184,52,47,241,201,123,65,24,44,55,215,177,168,250,179,115,190,227,123,158,163,179,224,69,196,66,207,254,243,101,221,193,140,250,4,28,222,52,96,138,160,33,218,64,118,214,234,201,152,148,91,178,111,107,144,142,6,182,102,72,188,34,213,181,26,223,58,255,103,81,17,47,169,11,245,224,123,148,215,237,186,107,75,152,90,202,166,22,149,197,5,246,238,78,76,229,106,199,94,127,195,0,45,82,6,159,103,96,138,231,71,46,107,59,216,39,43,12,221,27,214,56,155,145,66,187,169,250,235,78,211,179,239,183,198,163,93,5,196,24,174,143,225,106,139,89,98,13,127,207,184,194,30,1,165,198,169,8,197,118,86,163,221,138,23,209,61,116,79,99,233,43,130,60,244,85,229,243,172,123,148,200,120,192,127,211,52,11,159,41,95,212,230,188,169,156,137,29,212,12,148,168,148,133,243,44,241,139,127,24,246,220,227,125,209,97,60,52,162,192,146,49,161,92,138,112,189,128,59,126,125,46,207,60,79,231,174,152,209,68,223,205,2,38,14,91,116,159,255,28,27,178,248,164,104,158,79,69,214,234,157,12,75,163,83,253,245,202,61,213,176,6,197,230,29,208,166,253,194,254,235,29,141,241,70,249,15,62,0,148,163,135,52,122,40,96,87,31,179,152,51,216,133,184,122,198,203,60,115,218,191,193,16,178,25,148,252,112,104,103,252,36,92,221,28,179,43,199,198,151,128,100,252,217,161,249,34,201,172,118,52,180,252,104,7,223,44,116,102,212,21,40,224,184,55,163,210,21,207,161,239,51,54,155,41,133,18,67,48,3,165,130,251,4,79,214,57,72,130,157,212,144],sp=[0,1,3,4,6,7,9,10,12,13,15,16,18,19,21,22,24,26,29,31,34,36,39,41,44,46,49,51,54,56,59,61,64,65,66,67,68,69,70,72,73,74,75,76,77,79,80,81,82,83,84,85,87,88,89,90,91,92,94,95,96,97,98,99,101,102,103,104,105,106,107,109,110,111,112,113,114,116,117,118,119,120,121,123,124,125,126,127,128,129,131,132,133,134,135,136,138,139,140,141,142,143,145,146,147,148,149,150,151,153,154,155,156,157,158,160,161,162,163,164,165,166,168,169,170,171,172,173,175,176,177,178,179,180,182,183,184,185,186,187,188,190,191,192,193,194,195,197,198,199,200,201,202,204,205,206,207,208,209,210,212,213,214,215,216,217,219,220,221,222,223,224,226,226,226,227,227,227,228,228,228,229,229,229,230,230,231,231,231,232,232,232,233,233,233,234,234,235,235,235,236,236,236,237,237,237,238,238,239,239,239,240,240,240,241,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],op=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,35,36,37,39,40,42,43,44,46,47,49,50,51,53,54,56,57,58,59,61,62,63,64,66,67,68,69,71,72,73,74,76,77,78,79,81,82,83,84,86,87,88,90,91,92,93,95,96,97,98,100,101,102,103,105,106,107,108,110,111,112,113,115,116,117,118,120,121,122,124,125,126,127,129,130,131,132,134,135,136,137,139,140,141,142,144,145,146,147,149,150,151,152,154,155,156,158,159,160,161,163,164,165,166,168,169,170,171,173,174,175,176,178,179,180,181,183,184,185,186,188,189,190,192,193,194,195,197,198,199,200,202,203,204,205,207,208,209,210,212,213,214,215,217,218,219,220,222,223,224,226,226,226,227,227,228,228,229,229,230,230,231,231,232,232,233,233,234,234,234,235,235,236,236,237,237,238,238,239,239,240,240,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],ap=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,43,44,45,46,47,48,50,51,52,53,54,55,56,58,59,60,61,62,63,65,66,67,68,69,70,72,73,74,76,77,78,80,81,83,84,85,87,88,89,91,92,94,95,96,98,99,100,102,103,105,106,107,109,110,111,113,114,116,117,118,120,121,122,124,125,127,128,129,131,132,133,135,136,138,139,140,142,143,144,146,147,149,150,151,153,154,155,157,158,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,192,193,193,194,195,195,196,197,197,198,199,199,200,201,201,202,203,203,204,205,205,206,207,207,208,209,209,210,211,211,212,213,213,214,215,215,216,217,217,218,219,219,220,221,221,222,223,223,224,225,225,226,227,227,228,229,229,230,231,231,232,233,233,234,235,235,236,237,237,238,239,239,240,241,241,242,243,243,244,245,245,246,247,247,248,249,249,250,251,251,252,253,253,254,255];class cp extends Jh{constructor(e,t,n,r){super(e,ip,n,r),this.lightLevel=.1,this.rednessLevel=.5,this.mskin_he_max=175/180*3.141593,this.mskin_he_min=115/180*3.141593,this.mskin_hc_max=173/180*3.141593,this.mskin_hc_min=116/180*3.141593,this.mskin_hc_axis=2.04203545,this.mfacts_rotate_ge=this.mfacts_rotate_le=this.mfacts_rotate_c=0,this.tab_addr=null,this.lutTextures=[],this.inputTexture=t,this.init()}setUniforms(){var e=this.gl.getUniformLocation(this.program,"u_flipY"),t=this.gl.getUniformLocation(this.program,"u_denoiseLevel");this.gl.uniform1f(t,this.denoiseLevel),this.gl.uniform1f(e,1),e=this.gl.getUniformLocation(this.program,"light"),this.gl.uniform1f(e,this.lightLevel),e=this.gl.getUniformLocation(this.program,"redness"),this.gl.uniform1f(e,this.rednessLevel),e=this.gl.getUniformLocation(this.program,"skin_he_max"),t=this.gl.getUniformLocation(this.program,"skin_he_min");var n=this.gl.getUniformLocation(this.program,"skin_hc_max"),r=this.gl.getUniformLocation(this.program,"skin_hc_min");let i=this.gl.getUniformLocation(this.program,"skin_hc_axis"),s=this.gl.getUniformLocation(this.program,"facts_rotate_c"),o=this.gl.getUniformLocation(this.program,"facts_rotate_le"),a=this.gl.getUniformLocation(this.program,"facts_rotate_ge");for(this.gl.uniform1f(e,this.mskin_he_max),this.gl.uniform1f(t,this.mskin_he_min),this.gl.uniform1f(n,this.mskin_hc_max),this.gl.uniform1f(r,this.mskin_hc_min),this.gl.uniform1f(i,this.mskin_hc_axis),this.gl.uniform1f(s,this.mfacts_rotate_c),this.gl.uniform1f(o,this.mfacts_rotate_le),this.gl.uniform1f(a,this.mfacts_rotate_ge),e=this.gl.getUniformLocation(this.program,"u_originImage"),this.gl.activeTexture(this.gl.TEXTURE2),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.uniform1i(e,2),e=["lighten_lut"],t=[this.gl.TEXTURE3],n=0;n<e.length;n++)r=this.gl.getUniformLocation(this.program,e[n]),this.gl.activeTexture(t[n]),this.gl.bindTexture(this.gl.TEXTURE_2D,this.lutTextures[n]),this.gl.uniform1i(r,n+3)}setParameters(e){void 0!==e.denoiseLevel&&(this.denoiseLevel=e.denoiseLevel),void 0!==e.lightLevel&&(this.lightLevel=e.lightLevel),void 0!==e.rednessLevel&&(this.rednessLevel=e.rednessLevel,this.updateRedness(this.rednessLevel)),e.lighteningContrastLevel&&this.updateLut(e.lighteningContrastLevel)}init(){this.tab_addr=new Uint8Array(op);let e=[this.tab_addr],t=[256],n=[1];for(let r=0;r<e.length;r++){let i=this.gl.createTexture();if(!i)throw new xl(dl.WEBGL_INTERNAL_ERROR,"create lut texture failed");this.gl.bindTexture(this.gl.TEXTURE_2D,i),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.LUMINANCE,t[r],n[r],0,this.gl.LUMINANCE,this.gl.UNSIGNED_BYTE,e[r]),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.lutTextures.push(i)}}updateRedness(e){var t=e;1<e&&(e=1),0>e&&(e=0),1<t&&(t=1),0>t&&(t=0),this.mfacts_rotate_c=.8*e,.8>t&&(t=0),this.mskin_he_max=175/180*3.141593,this.mskin_hc_max=173/180*3.141593,this.mskin_he_min=(115-4*t)/180*3.141593,this.mskin_hc_min=(116-4*t)/180*3.141593,this.mskin_hc_axis=(117-4*t)/180*3.141593,this.mskin_hc_axis<this.mskin_hc_min&&(this.mskin_hc_axis=this.mskin_hc_min),1.5707965>this.mskin_hc_min&&(this.mskin_hc_min=1.5707965),1.5707965>this.mskin_hc_axis&&(this.mskin_hc_axis=1.5707965),1.5707965>this.mskin_he_min&&(this.mskin_he_min=1.5707965),3.141593<this.mskin_hc_max&&(this.mskin_hc_max=3.141593),3.141593<this.mskin_hc_axis&&(this.mskin_hc_axis=3.141593),3.141593<this.mskin_he_max&&(this.mskin_he_max=3.141593),t=this.mskin_hc_max-this.mskin_hc_axis,this.mfacts_rotate_ge=.01<(e=this.mskin_he_max-this.mskin_hc_max)?this.mfacts_rotate_c*t/e:this.mfacts_rotate_c,t=this.mskin_hc_axis-this.mskin_hc_min,this.mfacts_rotate_le=.01<(e=this.mskin_hc_min-this.mskin_he_min)?this.mfacts_rotate_c*t/e:this.mfacts_rotate_c}updateLut(e){var t=null;if(0===e&&(t=op),1===e&&(t=ap),2===e&&(t=sp),!t)throw new xl(dl.WEBGL_INTERNAL_ERROR,"invalid ylut_table value:"+e);this.tab_addr=new Uint8Array(t),e=[this.tab_addr],t=[256];let n=[1];for(let r=0;r<e.length;r++)this.gl.bindTexture(this.gl.TEXTURE_2D,this.lutTextures[r]),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.LUMINANCE,t[r],n[r],0,this.gl.LUMINANCE,this.gl.UNSIGNED_BYTE,e[r])}}class lp{constructor(){this.canvas=this.gl=null,this.programs=[],this.inputTexture=this.commonProgram=null,this.outputTextures=[],this.fbos=[],this.originalFrameHeight=this.originalFrameWidth=0,this.enableBeauty=!1,this.denoiseLevel=5,this.lightLevel=.35,this.rednessLevel=.5,this.lighteningContrastLevel=1}setEnableBeauty(e){this.enableBeauty=!!e}init(e,t,n){if(!Pu.supportWebGL)throw new xl(dl.NOT_SUPPORTED,"your browser is not support webGL");if(this.gl=n.getContext("webgl"),!this.gl)throw new xl(dl.WEBGL_INTERNAL_ERROR,"can not get webgl context");if(this.initGL(e,t),!this.inputTexture)throw new xl(dl.WEBGL_INTERNAL_ERROR,"can not find input texture");this.canvas=n,this.programs.push(new Qh(this.gl)),this.programs.push(new Zh(this.gl,e,t)),this.programs.push(new tp(this.gl,e,t)),this.programs.push(new rp(this.gl,e,t)),this.programs.push(new cp(this.gl,this.inputTexture,e,t)),this.commonProgram=this.programs[0].program,this.setDenoiseLevel(this.denoiseLevel),this.setLightLevel(this.lightLevel),this.setRednessLevel(this.rednessLevel),this.setContrastLevel(this.lighteningContrastLevel)}render(e){if(this.gl&&this.commonProgram&&this.canvas){var t=0;if(this.originalFrameHeight===e.videoWidth&&this.originalFrameWidth===e.videoHeight)t=2;else if(this.originalFrameHeight!==e.videoHeight||this.originalFrameWidth!==e.videoWidth){var n,r,i;if(Ul.debug(To(n=To(r=To(i="beauty effect: resolution changed ".concat(this.originalFrameWidth,"x")).call(i,this.originalFrameHeight," -> ")).call(r,e.videoWidth,"x")).call(n,e.videoHeight)),0===e.videoHeight||0===e.videoWidth)return void Ul.debug("beauty effect: skip 0 resolution frame");this.canvas.width=e.videoWidth,this.canvas.height=e.videoHeight,e.setAttribute("width",e.videoWidth.toString()),e.setAttribute("height",e.videoHeight.toString()),this.release(),this.init(e.videoWidth,e.videoHeight,this.canvas)}for(this.gl.viewport(0,0,e.videoWidth,e.videoHeight),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),e=this.enableBeauty?this.programs.length-1:0,n=0;n<=e;n++)this.gl.useProgram(r=this.programs[n].program),r=this.gl.getUniformLocation(r,"u_image"),this.programs[n].setUniforms(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbos[t+n%2]),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.outputTextures[t+n%2]),this.gl.uniform1i(r,0);this.gl.useProgram(this.commonProgram),t=this.gl.getUniformLocation(this.commonProgram,"u_flipY"),this.gl.uniform1f(t,-1),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}else Ul.warning("video effect manager is not init!")}setDenoiseLevel(e){var t;Ds(t=this.programs).call(t,t=>{t instanceof Jh&&t.setParameters({denoiseLevel:e})}),this.denoiseLevel=e}setLightLevel(e){var t;Ds(t=this.programs).call(t,t=>{t instanceof Jh&&t.setParameters({lightLevel:e})}),this.lightLevel=e}setRednessLevel(e){var t;Ds(t=this.programs).call(t,t=>{t instanceof Jh&&t.setParameters({rednessLevel:e})}),this.rednessLevel=e}setContrastLevel(e){var t;Ds(t=this.programs).call(t,t=>{t instanceof Jh&&t.setParameters({lighteningContrastLevel:e})}),this.lighteningContrastLevel=e}setSize(e,t){var n;Ds(n=this.programs).call(n,n=>{n instanceof Jh&&n.setSize(e,t)})}release(){this.inputTexture=this.commonProgram=this.gl=null,this.programs=[],this.outputTextures=[],this.fbos=[]}initGL(e,t){if(!this.gl)throw new xl(dl.WEBGL_INTERNAL_ERROR,"can not find webgl context");this.inputTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);for(let n=0;4>n;n++){let r=this.gl.createTexture();if(!r)throw new xl(dl.WEBGL_INTERNAL_ERROR,"create texture failed");this.gl.bindTexture(this.gl.TEXTURE_2D,r),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),2>n?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,t,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,t,e,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null);let i=this.gl.createFramebuffer();if(!i)throw new xl(dl.WEBGL_INTERNAL_ERROR,"create frame buffer failed");this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,i),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,r,0),this.outputTextures.push(r),this.fbos.push(i)}this.gl.viewport(0,0,e,t),this.originalFrameWidth=e,this.originalFrameHeight=t}}class up{constructor(){this.recordedFrameCount=this.targetFrameRate=0,this.recordingTime=2}async startRecordBeautyEffectOutput(e,t=4){if(this.recordID)throw new xl(dl.UNEXPECTED_ERROR,"another beauty effect recording is in progress");let n=Xe(6,"");return this.recordID=n,this.targetFrameRate=e,this.recordedFrameCount=0,this.recordingTime=t,await qe(1e3*this.recordingTime),this.recordID!==n?(this.recordID=void 0,!0):(this.recordID=void 0,this.recordedFrameCount<this.targetFrameRate*this.recordingTime/2?(Ul.warning("detect beauty effect overload, current framerate",this.recordedFrameCount/2),!1):(Ul.debug("beauty effect current framerate",this.recordedFrameCount/2),!0))}stopRecordBeautyEffectOutput(){this.recordedFrameCount=this.targetFrameRate=0,this.recordID=void 0}addFrame(){this.recordID&&(this.recordedFrameCount+=1)}}class dp extends class{get output(){return this._output}async setInput(e){if(e!==this.input){if(e.kind!==this.kind)throw new xl(dl.UNEXPECTED_ERROR);this.input&&this.removeInput(),this.input=e,await this._setInput(e)}}removeInput(){this.input=void 0,this._removeInput()}async updateOutput(e){this.output!==e&&(this._output=e,this.onOutputChange&&await this.onOutputChange())}replaceOriginMediaStream(e,t){var n,r;let i=hc(n=e.getTracks()).call(n,e=>e.kind===this.kind);i&&e.removeTrack(i),t=hc(r=t.getTracks()).call(r,e=>e.kind===this.kind),void 0===this.output&&t&&e.addTrack(t),this.output&&(Ul.debug("replace ".concat(this.output.kind," track to origin media stream")),e.addTrack(this.output))}}{constructor(){super(),this.kind="video",this.fps=15,this.overloadDetector=new up,this.enabled=!1,this.stopChromeBackgroundLoop=null,this.lastRenderTime=0,this.fps=30,this.manager=new lp}async setBeautyEffectOptions(e,t){void 0!==t.smoothnessLevel&&Ee(t.smoothnessLevel,"options.smoothnessLevel",0,1,!1),void 0!==t.lighteningLevel&&Ee(t.lighteningLevel,"options.lighteningLevel",0,1,!1),void 0!==t.rednessLevel&&Ee(t.rednessLevel,"options.rednessLevel",0,1,!1),void 0!==t.lighteningContrastLevel&&ge(t.lighteningContrastLevel,"options.lighteningContrastLevel",[0,1,2]),void 0!==t.smoothnessLevel&&this.manager.setDenoiseLevel(Math.max(.1,10*t.smoothnessLevel)),void 0!==t.lighteningLevel&&this.manager.setLightLevel(Math.max(.1,t.lighteningLevel/2)),void 0!==t.rednessLevel&&this.manager.setRednessLevel(Math.max(.01,t.rednessLevel)),void 0!==t.lighteningContrastLevel&&this.manager.setContrastLevel(t.lighteningContrastLevel),this.enabled!==e&&(this.manager.setEnableBeauty(e),this.enabled=e,e?this.input&&await this.startEffect():await this.stopEffect())}destroy(){this.onOutputChange=void 0,this.stopEffect(),this.enabled=!1}async startEffect(){let e=De();if(!this.input)return void Ul.warning("video track is null, fail to start video effect!");if(this.output)return void Ul.warning("video effect is already enabled");let t=await this.renderWithWebGL();await this.updateOutput(t),Ul.info("start video effect, output:",this.output),this.overloadDetector.startRecordBeautyEffectOutput(this.fps).then(e=>{e||this.onOverload&&this.onOverload()});let n=()=>{requestAnimationFrame(n);const e=wd(),t=1e3/this.fps,r=this.lastRenderTime?e-this.lastRenderTime:t;r<t||(this.lastRenderTime=e-(r-t),this.video&&this.video.paused&&this.video.play(),this.enabled&&this.video&&(this.manager.render(this.video),this.output&&this.output.requestFrame&&this.output.requestFrame(),this.overloadDetector.addFrame()))};requestAnimationFrame(n),e.name===Mc.CHROME&&document.addEventListener("visibilitychange",()=>{document.hidden?this.stopChromeBackgroundLoop=At(()=>{this.enabled&&this.video&&this.manager.render(this.video),this.output&&this.output.requestFrame&&this.output.requestFrame(),this.overloadDetector.addFrame()},this.fps):this.stopChromeBackgroundLoop&&(this.stopChromeBackgroundLoop(),this.stopChromeBackgroundLoop=null)},!1)}async stopEffect(){Ul.info("stop video effect"),this.overloadDetector.stopRecordBeautyEffectOutput(),this.manager.release(),this.canvas&&this.canvas.remove(),this.video&&this.video.remove(),this.video=this.canvas=void 0,await this.updateOutput(void 0)}async _setInput(e){this.enabled&&!this.video&&await this.startEffect()}_removeInput(){this.stopEffect()}async renderWithWebGL(){var e;if(!this.input)throw new xl(dl.BEAUTY_PROCESSOR_INTERNAL_ERROR,"can not renderWithWebGL, no input");this.canvas&&(this.canvas.remove(),this.canvas=void 0),this.video&&(this.video.remove(),this.video=void 0),this.canvas=document.createElement("canvas"),this.video=document.createElement("video"),this.video.setAttribute("autoplay",""),this.video.setAttribute("muted",""),this.video.muted=!0,this.video.setAttribute("playsinline",""),this.video.setAttribute("style","display:none"),this.video.srcObject=new MediaStream([this.input]);var t=new Ga(e=>{const t=()=>{this.video&&this.video.removeEventListener("playing",t),e(void 0)};this.video&&this.video.addEventListener("playing",t)});this.video.play(),await t;let n=(t=this.input.getSettings()).width||this.video.videoWidth,r=t.height||this.video.videoHeight;if(t.frameRate&&this.fps!==t.frameRate&&(this.fps=t.frameRate,Ul.debug("beauty video processor: set fps to",this.fps)),Ul.debug(To(e="beauty video processor: width ".concat(n," height ")).call(e,r)),!n||!r)throw new xl(dl.BEAUTY_PROCESSOR_INTERNAL_ERROR,"can not get track resolution");return this.canvas.width=n,this.canvas.height=r,this.video.setAttribute("width",n.toString()),this.video.setAttribute("height",r.toString()),this.manager.init(n,r,this.canvas),this.canvas.captureStream(Pu.supportRequestFrame?0:this.fps).getVideoTracks()[0]}}class hp extends sh{constructor(e,t,n,r,i){super(e,i),this.trackMediaType="video",this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1},this._enabled=!0,this.updateMediaStreamTrackResolution(),this._encoderConfig=t,this._scalabiltyMode=n,this._optimizationMode=r}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Fl.PLAYING)}play(e,t={}){let n=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.LOCAL_VIDEO_TRACK_PLAY,options:[this.getTrackId(),"string"==typeof e?e:"HTMLElement",t]});if(!(e instanceof HTMLElement)){let t=document.getElementById(e.toString());var r;t?e=t:(Ul.warning(To(r="[track-".concat(this.getTrackId(),'] can not find "#')).call(r,e,'" element, use document.body')),e=document.body)}Ul.debug("[track-".concat(this.getTrackId(),"] start video playback"),cr(t)),e=qt({},this._getDefaultPlayerConfig(),{},t,{trackId:this.getTrackId(),element:e}),this._player?this._player.updateConfig(e):(this._player=new Kh(e),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),n.onSuccess()}stop(){let e=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.LOCAL_VIDEO_TRACK_STOP,options:[this.getTrackId()]});if(!this._player)return e.onSuccess();this._player.destroy(),this._player=void 0,Ul.debug("[track-".concat(this.getTrackId(),"] stop video playback")),e.onSuccess()}async setEnabled(e){if(e!==this._enabled){Ul.info("[".concat(this.getTrackId(),"] start setEnabled"),e);var t=await this._enabledMutex.lock();if(!e){this._originMediaStreamTrack.enabled=!1;try{await Ze(this,Cu.NEED_REMOVE_TRACK,this)}catch(n){throw Ul.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),t(),n}return this._enabled=!1,Ul.info("[".concat(this.getTrackId(),"] setEnabled to false success")),t()}this._originMediaStreamTrack.enabled=!0;try{await Ze(this,Cu.NEED_ADD_TRACK,this)}catch(n){throw Ul.error("[".concat(this.getTrackId(),"] setEnabled to true error"),n.toString()),t(),n}Ul.info("[".concat(this.getTrackId(),"] setEnabled to true success")),this._enabled=!0,t()}}getStats(){return st(()=>{Ul.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),et(this,Cu.GET_STATS)||qt({},lu)}async setBeautyEffect(e,t={}){let n=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.LOCAL_VIDEO_TRACK_BEAUTY,options:[this.getTrackId(),e,t]});if(e||this._videoBeautyProcessor){if(De().os===Lc.IOS||De().os===Lc.ANDROID)throw e=new xl(dl.INVALID_OPERATION,"can not enable beauty effect on mobile device"),n.onError(e),e;if(!this._enabled&&e)throw e=new xl(dl.TRACK_IS_DISABLED,"can not enable beauty effect when track is disabled"),n.onError(e),e;Ul.info("[".concat(this.getTrackId(),"] start setBeautyEffect"),e,cr(t));try{this._videoBeautyProcessor?await this._videoBeautyProcessor.setBeautyEffectOptions(e,t):(this._videoBeautyProcessor=new dp,this._videoBeautyProcessor.onOverload=()=>{it(()=>this.emit(wu.BEAUTY_EFFECT_OVERLOAD))},await this._videoBeautyProcessor.setBeautyEffectOptions(e,t),await this._registerTrackProcessor(this._videoBeautyProcessor))}catch(r){throw Ul.error("[".concat(this.getTrackId(),"] setBeautyEffect error"),r.toString()),n.onError(r),r}Ul.info("[".concat(this.getTrackId(),"] setBeautyEffect success")),n.onSuccess()}}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}clone(e,t,n,r){let i=this._mediaStreamTrack.clone();return new hp(i,e,t,n,r)}async setBitrateLimit(e){var t;if(Ul.debug(To(t="[".concat(this.getTrackId(),"] set bitrate limit, ")).call(t,cr(e))),e){this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate,this._encoderConfig.bitrateMin=e.min_bitrate);try{await Ze(this,Cu.NEED_RESET_REMOTE_SDP)}catch(n){return n.throw()}}}async setOptimizationMode(e){var t;if("motion"===e||"detail"===e||"balanced"===e){try{this._optimizationMode=e,await Ze(this,Cu.SET_OPTIMIZATION_MODE,e)}catch(n){throw Ul.error("[".concat(this.getTrackId(),"] set optimization mode failed"),n.toString()),n}Ul.info(To(t="[".concat(this.getTrackId(),"] set optimization mode success (")).call(t,e,")"))}else Ul.error(dl.INVALID_PARAMS,"optimization mode must be motion, detail or balanced")}setScalabiltyMode(e){var t;if(1===e.numSpatialLayers&&1!==e.numTemporalLayers)return Ul.error(dl.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=e,Ul.info(To(t="[".concat(this.getTrackId(),"] set scalability mode success (")).call(t,e,")"))}updateMediaStreamTrackResolution(){Qe(this._originMediaStreamTrack).then(([e,t])=>{this._videoHeight=t,this._videoWidth=e}).catch(Pd)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}}class pp extends hp{constructor(e,t,n,r,i,s){super(e,t.encoderConfig?X(t.encoderConfig):{},r,i,s),this._enabled=!0,this._deviceName="default",this._config=t,this._constraints=n,this._deviceName=e.label,this._config.encoderConfig&&(this._encoderConfig=X(this._config.encoderConfig))}async setDevice(e){var t;let n=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.CAM_VIDEO_TRACK_SET_DEVICE,options:[this.getTrackId(),e]});if(Ul.info(To(t="[track-".concat(this.getTrackId(),"] set device to ")).call(t,e)),this._enabled)try{let n=await Wd.getDeviceById(e);(t={}).video=qt({},this._constraints),t.video.deviceId={exact:e},t.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await dt(t,this.getTrackId())}catch(r){throw Ul.error("[".concat(this.getTrackId(),"] setDevice failed"),r.toString()),i=await dt({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(i){throw n.onError(i),Ul.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{this._deviceName=(await Wd.getDeviceById(e)).label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(i){throw n.onError(i),Ul.error("[track-".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}Ul.info("[".concat(this.getTrackId(),"] setDevice success")),n.onSuccess()}async setEnabled(e){if(e!==this._enabled){Ul.info("[".concat(this.getTrackId(),"] start setEnabled"),e);var t=await this._enabledMutex.lock();if(!e){this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),this._enabled=!1;try{await Ze(this,Cu.NEED_REMOVE_TRACK,this)}catch(r){throw Ul.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),t(),r}return Ul.info("[".concat(this.getTrackId(),"] setEnabled to false success")),t()}e=qt({},this._constraints);var n=Wd.searchDeviceIdByName(this._deviceName);n&&!e.deviceId&&(e.deviceId={exact:n});try{let e=await dt({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),await Ze(this,Cu.NEED_ADD_TRACK,this)}catch(r){throw Ul.error("[".concat(this.getTrackId(),"] setEnabled true error"),r.toString()),t(),r}this.updateMediaStreamTrackResolution(),Ul.info("[".concat(this.getTrackId(),"] setEnabled to true success")),this._enabled=!0,t()}}async setEncoderConfiguration(e,t){if(t=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG,options:[this.getTrackId(),e]}),!this._enabled)throw e=new xl(dl.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled"),t.onError(e),e;e=X(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin);let n=(r=this._config,JSON.parse(cr(r)));var r;n.encoderConfig=e,r=Wt(n),Ul.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),cr(e),cr(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(i){throw e=new xl(dl.UNEXPECTED_ERROR,i.toString()),Ul.error("[track-".concat(this.getTrackId(),"] applyConstraints error"),e.toString()),t.onError(e),e}this._config=n,this._constraints=r,this._encoderConfig=e;try{await Ze(this,Cu.NEED_RENEGOTIATE)}catch(i){return t.onError(i),i.throw()}t.onSuccess()}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}}var fp=!0;"findIndex"in[]&&Array(1).findIndex(function(){fp=!1}),Zn({target:"Array",proto:!0,forced:fp},{findIndex:function(e){return ri(this,e,1<arguments.length?arguments[1]:void 0)}});var _p=ys("Array").findIndex,mp=Array.prototype,gp=function(e){var t=e.findIndex;return e===mp||e instanceof Array&&t===mp.findIndex?_p:t};let Ep=(e,t)=>{let n=null;if("h264"===t?n=e.match(/a=rtpmap:(\d+) H264.*\r\n/)||e.match(/a=rtpmap:(\d+) H264.*\n/):"vp8"===t?n=e.match(/a=rtpmap:(\d+) VP8.*\r\n/)||e.match(/a=rtpmap:(\d+) VP8.*\n/):"vp9"===t?n=e.match(/a=rtpmap:(\d+) VP9.*\r\n/)||e.match(/a=rtpmap:(\d+) VP9.*\n/):"av1"===t&&(n=e.match(/a=rtpmap:(\d+) AV1.*\r\n/)||e.match(/a=rtpmap:(\d+) AV1.*\n/)),n&&n[1])return n[1]};class vp extends Wh{constructor(e,t,n,r){super(t,t.stringUid||t.uid),this.type="pub",this._waitingSuccessResponse=this.detecting=!1,this.renegotiateWithGateway=async()=>(Ul.debug("[pc-".concat(this.pc.ID,"] renegotiate start")),new Ga(async(e,t)=>{this.connectionState="connecting";let n=r=>{"connected"===r&&(this.off(ou.CONNECTION_STATE_CHANGE,n),e()),"disconnected"===r&&(this.off(ou.CONNECTION_STATE_CHANGE,n),t(new xl(dl.OPERATION_ABORTED,"renegotiate abort")))};this.on(ou.CONNECTION_STATE_CHANGE,n);var r=await this.pc.createOfferSDP();this.audioTrack&&this.audioTrack._encoderConfig&&(r=Xt(r,this.audioTrack._encoderConfig)),this.videoTrack&&this.videoTrack._scalabiltyMode&&("vp9"!==this.codec?(this.videoTrack._scalabiltyMode.numSpatialLayers=1,this.videoTrack._scalabiltyMode.numTemporalLayers=1):r=Jt(r,this.codec,this.videoTrack._scalabiltyMode),Ul.debug("renegoation spatial layers: ",this.videoTrack._scalabiltyMode.numSpatialLayers)),await this.pc.setOfferSDP(r),this.pc.onOfferSettled();let i=await $e(this,ou.NEED_RENEGOTIATE,r);r=function(e,t){var n,r,i;const s=gc(n=RegExp.prototype.test).call(n,/^([a-z])=(.*)/);e=Io(r=e.split(/(\r\n|\r|\n)/)).call(r,s),t=Io(i=t.split(/(\r\n|\r|\n)/)).call(i,s);let o=null;const a=new _s;return Ds(e).call(e,e=>{const t=e.match(/m=(audio|video)/);t&&t[1]?o=t[1]:o&&(e=e.match(/=(sendrecv|recvonly|sendonly|inactive)/))&&e[1]&&a.set(o,e[1])}),o=null,Ka(t).call(t,e=>{var t=e.match(/m=(audio|video)/);if(t&&t[1])return o=t[1],e;if(!o)return e;if((t=e.match(/=(sendrecv|recvonly|sendonly|inactive)/))&&t[1]){const n=a.get(o);if(n&&n!==t[1])return e.replace(t[1],n)}return e}).join("\r\n")+"\r\n"}(r,this.updateAnswerSDP(i.sdp)),await this.pc.setAnswerSDP(r),Ul.debug("[pc-".concat(this.pc.ID,"] renegotiate success")),this.connectionState="connected"})),this.handleStreamRenegotiate=(e,t)=>{"connected"===this.connectionState?this.renegotiateWithGateway().then(e).catch(t):e()},this.handleReplaceTrack=(e,t,n)=>{if(this.audioTrack instanceof mh&&"audio"===e.kind)return Ga.resolve();this.pc.replaceTrack(e).then(e=>e?this.renegotiateWithGateway():Ga.resolve()).then(t).catch(n)},this.handleCloseAudioTrack=e=>{},this.handleCloseVideoTrack=()=>{this.lowStreamConnection&&this.lowStreamConnection.videoTrack&&this.lowStreamConnection.videoTrack.close()},this.handleGetSessionID=e=>{e(this.joinInfo.sid)},this.handleGetLocalVideoStats=e=>{e(this.statsCollector.getLocalVideoTrackStats(this.connectionId))},this.handleGetLocalAudioStats=e=>{e(this.statsCollector.getLocalAudioTrackStats(this.connectionId))},this.handleSetOptimizationMode=(e,t,n)=>{this.videoTrack&&this.setRtpSenderParametersByTrackConfig(this.videoTrack).then(t).catch(n)},this.isLowStreamConnection=!!r,this.codec=n,this.statsCollector=e,this.statsCollector.addLocalConnection(this)}getAllTracks(){let e=[];return this.videoTrack&&e.push(this.videoTrack),this.audioTrack&&this.audioTrack instanceof mh?e=To(e).call(e,this.audioTrack.trackList):this.audioTrack&&e.push(this.audioTrack),e}async addTracks(e){let t=Pu;if("connecting"===this.connectionState)try{return await this.createWaitConnectionConnectedPromise(),await this.addTracks(e)}catch(s){throw new xl(dl.OPERATION_ABORTED,"publish abort")}var n=!1;let r=this.getAllTracks();e=rt(e=Io(e).call(e,e=>-1===nc(r).call(r,e)));for(let o=0;o<e.length;o+=1){var i=e[o];if(!(i instanceof sh))return new xl(dl.INVALID_LOCAL_TRACK).throw();if(i instanceof hp&&this.disabledVideoTrack){if(this.disabledVideoTrack!==i)return new xl(dl.EXIST_DISABLED_VIDEO_TRACK).throw();this.disabledVideoTrack=void 0}if(i instanceof hp&&this.videoTrack)return new xl(dl.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw();if(i instanceof ph&&this.audioTrack)if(this.audioTrack instanceof mh)this.audioTrack.addAudioTrack(i);else{if(!t.webAudioMediaStreamDest)throw new xl(dl.NOT_SUPPORTED,"your browser is not support audio mixing");(n=new mh).addAudioTrack(this.audioTrack),n.addAudioTrack(i),n=await this.addTrackWithPC(n)}else i instanceof hp&&this.isLowStreamConnection?(n=en({},{width:160,height:120,framerate:15,bitrate:50},{},this.lowStreamParameter),t.supportDualStreamEncoding?(Ul.debug("[".concat(this.connectionId,"] creating low stream using rtp encoding.")),this.lowStreamEncoding=He(n,i),i=i.clone({bitrateMax:n.bitrate,bitrateMin:n.bitrate})):(Ul.debug("[".concat(this.connectionId,"] creating low stream using canvas.")),i=$t(i,n),i=new hp(i,{bitrateMax:n.bitrate,bitrateMin:n.bitrate})),i._hints.push(Au.LOW_STREAM),n=await this.addTrackWithPC(i),this.bindTrackEvents(i)):(this.detecting=!0,zd(()=>{this.detecting=!1},8e3),n=await this.addTrackWithPC(i))}n&&await this.renegotiateWithGateway(),Ds(e).call(e,e=>this.bindTrackEvents(e))}async removeTracks(e,t){let n=this.getAllTracks();e=rt(e=Io(e).call(e,e=>-1!==nc(n).call(n,e)||e===this.disabledVideoTrack));let r=[];for(let o=0;o<e.length;o+=1){let n=e[o];if(this.unbindTrackEvents(n),this.audioTrack instanceof mh&&n instanceof ph)this.audioTrack.removeAudioTrack(n),0===this.audioTrack.trackList.length&&(r.push(this.audioTrack),this.audioTrack=void 0);else if(n instanceof ph)r.push(n),this.audioTrack=void 0;else if(n instanceof hp){if(t){if(this.disabledVideoTrack===n)return void(this.disabledVideoTrack=void 0)}else this.disabledVideoTrack=this.videoTrack;r.push(n),this.isLowStreamConnection&&n.close(),this.videoTrack=void 0}}if(this.videoTrack||this.audioTrack){if(0!==r.length){if("connecting"===this.connectionState)try{await this.createWaitConnectionConnectedPromise()}catch(s){return}for(let e of r){var i;Ul.debug(To(i="[".concat(this.connectionId,"] remove ")).call(i,e.trackMediaType," from pc")),await this.pc.removeTrack(e._mediaStreamTrack)}await this.renegotiateWithGateway()}}else await this.closeP2PConnection()}startP2PConnection(){return new Ga(async(e,t)=>{if(!this.audioTrack&&!this.videoTrack)return t(new xl(dl.UNEXPECTED_ERROR,"no track to publish"));let n=r=>{if("connected"===r&&(this.off(ou.CONNECTION_STATE_CHANGE,n),e()),"disconnected"===r){if(this.off(ou.CONNECTION_STATE_CHANGE,n),this.disconnectedReason)return t(this.disconnectedReason);t(new xl(dl.OPERATION_ABORTED,"publish abort"))}};this.on(ou.CONNECTION_STATE_CHANGE,n),this.disconnectedReason=void 0,this.connectionState="connecting",this._waitingSuccessResponse=!0,this.startTime=wd();try{var r;!this.pc.audioTrack&&this.audioTrack&&await this.pc.addTrack(this.audioTrack._mediaStreamTrack),!this.pc.videoTrack&&this.videoTrack&&await this.pc.addTrack(this.videoTrack._mediaStreamTrack);let e=await this.pc.createOfferSDP();el.REMOVE_NEW_CODECS&&(e=function(e,t){let n=(e,t)=>{const i=Ep(e,t);return i?n(r(e,i),t):e},r=(e,t)=>{var n,r;const i=gc(n=RegExp.prototype.test).call(n,/^([a-z])=(.*)/),s=["a=rtpmap:".concat(t),"a=rtcp-fb:".concat(t),"a=fmtp:".concat(t)],o=Io(r=e.split(/(\r\n|\r|\n)/)).call(r,i),a=[];if(Ds(o).call(o,(e,t)=>{Ds(s).call(s,n=>{Rc(e).call(e,n)&&a.push(t)})}),e=gp(o).call(o,e=>Rc(e).call(e,"apt=".concat(t)))){a.push(e,e-1);var c=(c=o[e-1].match(/a=rtpmap:(\d+) rtx.*/))&&c[1]}return Ds(a).call(a,e=>{o[e]=""}),e=gp(o).call(o,e=>Rc(e).call(e,"m=video")),o[e]=o[e].replace(" ".concat(t),""),c&&(o[e]=o[e].replace(" ".concat(c),"")),Io(o).call(o,e=>!!e).join("\r\n")+"\r\n"};return Ds(t).call(t,t=>{e=n(e,t)}),e}(e,"vp9"===this.codec?["av1"]:"av1"===this.codec?["vp9"]:["vp9","av1"]));let t=zt(e);this.videoTrack&&!Rc(r=t.video).call(r,this.codec.toUpperCase())&&Ul.warning("current codec is not supported, support list: ".concat(t.video.join(","))),this.audioTrack&&this.audioTrack._encoderConfig&&(e=Xt(e,this.audioTrack._encoderConfig)),this.videoTrack&&this.videoTrack._scalabiltyMode&&("vp9"!==this.codec&&"av1"!==this.codec?(this.videoTrack._scalabiltyMode.numSpatialLayers=1,this.videoTrack._scalabiltyMode.numTemporalLayers=1):e=Jt(e,this.codec,this.videoTrack._scalabiltyMode),Ul.debug("spatial layers: ",this.videoTrack._scalabiltyMode.numSpatialLayers)),await this.pc.setOfferSDP(e),this.pc.onOfferSettled(),this.videoTrack&&this.setRtpSenderParametersByTrackConfig(this.videoTrack),Ul.debug("[".concat(this.connectionId,"] create and set offer success")),r={messageType:"OFFER",sdp:e,offererSessionId:104,retry:!0},Pu.supportDualStreamEncoding&&this.isLowStreamConnection&&this.lowStreamEncoding&&this.videoTrack&&await this.setLowStreamEncoding(this.lowStreamEncoding,this.videoTrack);let n=await $e(this,ou.NEED_ANSWER,r),i=this.updateAnswerSDP(n.sdp);await this.pc.setAnswerSDP(i),Ul.debug("[".concat(this.connectionId,"] set answer success")),await this.icePromise,this.connectionState="connected",this.startUploadStats()}catch(i){this.off(ou.CONNECTION_STATE_CHANGE,n),this.connectionState="disconnected",this.reportPublishEvent(!1,i.code),Ul.error("[".concat(this.connectionId,"] connection error"),i.toString()),t(i)}})}reportPublishEvent(e,t,n){var r;this._waitingSuccessResponse=!1,Jd.publish(this.joinInfo.sid,{lts:this.startTime,succ:e,ec:t,audioName:this.audioTrack&&this.audioTrack.getTrackLabel(),videoName:this.videoTrack&&this.videoTrack.getTrackLabel(),screenshare:!(!this.videoTrack||-1===nc(r=this.videoTrack._hints).call(r,Au.SCREEN_TRACK)),audio:!!this.audioTrack,video:!!this.videoTrack,p2pid:this.pc.ID,publishRequestid:this.ID,extend:n})}async closeP2PConnection(e){let t=this.getAllTracks();var n;Ds(t).call(t,e=>{this.unbindTrackEvents(e)}),this.isLowStreamConnection&&this.videoTrack&&this.videoTrack.close(),this.videoTrack=void 0,this.audioTrack instanceof mh&&Ds(n=this.audioTrack.trackList).call(n,e=>{this.audioTrack.removeAudioTrack(e)}),this.audioTrack=void 0,this.stopUploadStats(),this.statsCollector.removeConnection(this.connectionId),await this.closePC(e),this.connectionState="disconnected",this.removeAllListeners()}getNetworkQuality(){var e,t=this.pc.getStats();if(!t.videoSend[0]&&!t.audioSend[0])return 1;var n=et(this,ou.NEED_SIGNAL_RTT),r=t.videoSend[0]?t.videoSend[0].rttMs:void 0;let i=t.audioSend[0]?t.audioSend[0].rttMs:void 0;return n=.17>(n=70*t.sendPacketLossRate/50+.3*(((r=r&&i?(r+i)/2:r||i)&&n?(r+n)/2:r||n)||0)/1500)?1:.36>n?2:.59>n?3:.1>n?4:5,this.videoTrack&&this.videoTrack._encoderConfig&&-1===nc(e=this.videoTrack._hints).call(e,Au.SCREEN_TRACK)&&(t=t.bitrate.actualEncoded,(e=this.videoTrack._encoderConfig.bitrateMax)&&t)?tl[.15>(t=(1e3*e-t)/(1e3*e))?0:.3>t?1:.45>t?2:.6>t?3:4][n]:n}handleUpdateBitrateLimit(e){this.videoTrack&&this.videoTrack.setBitrateLimit(e)}uploadStats(e,t){let n=this.audioTrack?function(e,t){const n=e.audioSend[0];return n?((e={id:Xe(10,""),timestamp:new Date(e.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:n.ssrc.toString()}).A_astd=t._originMediaStreamTrack.enabled&&t._mediaStreamTrack.enabled?"0":"1",e.A_ail=n.inputLevel?Math.round(100*n.inputLevel).toString():Math.round(100*t._source.getAudioAvgLevel()).toString(),e.A_apil=Math.round(100*t._source.getAudioAvgLevel()).toString(),e):null}(e,this.audioTrack):void 0,r=this.videoTrack?function(e,t){const n=e.videoSend[0];if(!n)return null;switch((e={id:Xe(10,""),timestamp:new Date(e.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:n.ssrc.toString()}).A_vstd=t._originMediaStreamTrack&&!t._originMediaStreamTrack.enabled||!t._mediaStreamTrack.enabled?"1":"0",n.sentFrame&&(e.A_fhs=n.sentFrame.height.toString(),e.A_frs=n.sentFrame.frameRate.toString(),e.A_fws=n.sentFrame.width.toString()),n.adaptionChangeReason){case"none":e.A_ac="0";break;case"cpu":e.A_ac="1";break;case"bandwidth":e.A_ac="2";break;case"other":e.A_ac="3"}return e.A_nr=n.nacksCount.toString(),n.avgEncodeMs&&(e.A_aem=n.avgEncodeMs.toFixed(0).toString()),e}(e,this.videoTrack):void 0,i=je(e,t),s=function(e){const t={id:"bweforvideo",timestamp:new Date(e.timestamp).toISOString(),type:"VideoBwe"};return e.bitrate.retransmit&&(t.A_rb=e.bitrate.retransmit.toString()),e.bitrate.targetEncoded&&(t.A_teb=e.bitrate.targetEncoded.toString()),t.A_aeb=e.bitrate.actualEncoded.toString(),t.A_tb=e.bitrate.transmit.toString(),void 0!==e.sendBandwidth&&(t.A_asb=e.sendBandwidth.toString()),t}(e);n&&it(()=>this.emit(ou.NEED_UPLOAD,iu.PUBLISH_STATS,n)),r&&it(()=>this.emit(ou.NEED_UPLOAD,iu.PUBLISH_STATS,en({},r,{},i))),s&&it(()=>this.emit(ou.NEED_UPLOAD,iu.PUBLISH_STATS,s))}uploadSlowStats(e){let t=je(e);t&&it(()=>this.emit(ou.NEED_UPLOAD,iu.PUBLISH_STATS,t))}uploadRelatedStats(e){let t=function(e){return(e=e.videoSend[0])?{mediaType:"video",isVideoMute:!1,frameRateInput:e.inputFrame&&e.inputFrame.frameRate.toString(),frameRateSent:e.sentFrame&&e.sentFrame.frameRate.toString(),googRtt:e.rttMs.toString()}:null}(e);t&&it(()=>{this.emit(ou.NEED_UPLOAD,iu.PUBLISH_RELATED_STATS,t)})}bindTrackEvents(e){var t;e.addListener(Cu.NEED_RESET_REMOTE_SDP,gc(t=this.handleResetRemoteSdp).call(t,this)),this.isLowStreamConnection||(e instanceof ph?(e.addListener(Cu.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Cu.NEED_CLOSE,this.handleCloseAudioTrack)):e instanceof hp&&(e.addListener(Cu.GET_STATS,this.handleGetLocalVideoStats),e.addListener(Cu.NEED_CLOSE,this.handleCloseVideoTrack),e.addListener(Cu.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode)),e.addListener(Cu.NEED_RENEGOTIATE,this.handleStreamRenegotiate),e.addListener(Cu.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Cu.NEED_SESSION_ID,this.handleGetSessionID))}unbindTrackEvents(e){this.isLowStreamConnection||(e instanceof ph?(e.off(Cu.GET_STATS,this.handleGetLocalAudioStats),e.off(Cu.NEED_CLOSE,this.handleCloseAudioTrack)):e instanceof hp&&(e.off(Cu.GET_STATS,this.handleGetLocalVideoStats),e.off(Cu.NEED_CLOSE,this.handleCloseVideoTrack)),e.off(Cu.NEED_RENEGOTIATE,this.handleStreamRenegotiate),e.off(Cu.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Cu.NEED_SESSION_ID,this.handleGetSessionID))}async addTrackWithPC(e){if("connecting"===this.connectionState)return new xl(dl.INVALID_OPERATION,"last publish operation has not finished").throw();let t=this.videoTrack,n=!1;return this.audioTrack&&e instanceof ph?(this.audioTrack=e,Ul.debug("[".concat(this.connectionId,"] replace pc audio track")),n=await this.pc.replaceTrack(e._mediaStreamTrack)):this.videoTrack&&e instanceof hp?(this.videoTrack=e,Ul.debug("[".concat(this.connectionId,"] replace pc video track")),n=await this.pc.replaceTrack(e._mediaStreamTrack)):e instanceof ph?(this.audioTrack=e,Ul.debug("[".concat(this.connectionId,"] add audio track to pc")),await this.pc.addTrack(e._mediaStreamTrack),n=!0):e instanceof hp&&(this.videoTrack=e,Ul.debug("[".concat(this.connectionId,"] add video track to pc")),await this.pc.addTrack(e._mediaStreamTrack),n=!0),"connected"===this.connectionState&&this.videoTrack!==t&&this.videoTrack&&await this.setRtpSenderParametersByTrackConfig(this.videoTrack),"disconnected"!==this.connectionState&&n}handleResetRemoteSdp(){return new Ga((e,t)=>{var n;Ul.info("[pc-".concat(this.pc.ID,"] start reset remote sdp"));let r=this.pc.getOfferSDP();var i=this.pc.getAnswerSDP();if(!i||!r)return e();let s;i=i.sdp,this.videoTrack&&this.videoTrack._encoderConfig&&-1===nc(n=this.videoTrack._hints).call(n,Au.SCREEN_TRACK)&&(s=function(e,t){var n,r;let i=t.bitrateMin;t=t.bitrateMax;let s=gc(n=RegExp.prototype.test).call(n,/^([a-z])=(.*)/);if(e=Io(r=e.split(/(\r\n|\r|\n)/)).call(r,s),t){let n="AS";var o;De().name===Mc.FIREFOX&&(t=1e3*(t>>>0),n="TIAS"),0<(r=gp(e).call(e,e=>Rc(e).call(e,n)))&&(e[r]=To(o="b=".concat(n,":")).call(o,t))}return i&&0<(o=gp(e).call(e,e=>Rc(e).call(e,"x-google-min-bitrate")))&&(e[o]=e[o].replace(/x-google-min-bitrate=(.*)/,"x-google-min-bitrate=".concat(i))),e.join("\r\n")+"\r\n"}(i,this.videoTrack._encoderConfig)),i!==s?this.pc.setOfferSDP(r.sdp).then(()=>{if(s)return this.pc.setAnswerSDP(s)}).then(e).catch(e=>{var n;Ul.error(To(n="[pc-".concat(this.pc.ID,"] reset remote sdp error, ")).call(n,e)),t(e)}):Ul.debug("[pc-".concat(this.pc.ID,"] remote sdp have no not changed"))})}async setRtpSenderParametersByTrackConfig(e){if(!Pu.supportSetRtpSenderParameters)return void Ul.debug("[".concat(this.connectionId,"] do not support set pc rtp sender, skip"));let t={},n="balanced";"motion"===e._optimizationMode?n="maintain-framerate":"detail"===e._optimizationMode&&(n="maintain-resolution"),Ul.debug("[".concat(this.connectionId,"] set pc rtp sender"),t,n),await this.pc.setRtpSenderParameters(t,n)}updateAnswerSDP(e){var t,n;return e=e.replace(/a=x-google-flag:conference\r\n/g,""),this.videoTrack&&nc(t=this.videoTrack._hints).call(t,Au.SCREEN_TRACK),this.videoTrack&&this.videoTrack._encoderConfig&&-1===nc(n=this.videoTrack._hints).call(n,Au.SCREEN_TRACK)&&(e=function(e,t,n){let r=Pu;var i=n.bitrateMin;n=n.bitrateMax;let s=e.match(/m=video.*\r\n/)||e.match(/m=video.*\n/);var o,a,c,l;return s&&0<s.length&&r.supportMinBitrate&&i&&(t=Ep(e,t))&&(e=e.replace(s[0],To(o=To(a="".concat(s[0],"a=fmtp:")).call(a,t," x-google-min-bitrate=")).call(o,i,"\r\n"))),s&&0<s.length&&n&&(i="AS",De().name===Mc.FIREFOX&&(n=1e3*(n>>>0),i="TIAS"),e=e.replace(s[0],To(c=To(l="".concat(s[0],"b=")).call(l,i,":")).call(c,n,"\r\n"))),e}(e,this.codec,this.videoTrack._encoderConfig)),this.audioTrack&&this.audioTrack._encoderConfig&&(e=Xt(e,this.audioTrack._encoderConfig)),function(e){let t=De();return t.name!==Mc.SAFARI&&t.os!==Lc.IOS?e:e.replace(/a=.*video-orientation\r\n/g,"")}(e)}createPC(){this.pc=new Bh({turnServer:this.joinInfo.turnServer}),this.updateICEPromise()}async closePC(e){return this.pc.onICEConnectionStateChange=void 0,this.pc.close(),!e&&await $e(this,ou.NEED_UNPUB)}onPCDisconnected(e){this.reportPublishEvent(!1,e.code)}async setLowStreamEncoding(e,t){try{let n=await this.pc.setVideoRtpEncodingParameters(e),r=t.getMediaStreamTrack();if(e.scaleResolutionDownBy&&n.encodings[0].scaleResolutionDownBy!==e.scaleResolutionDownBy){let n=t._videoHeight||r.getSettings().height,i=t._videoWidth||r.getSettings().width;n&&i&&await r.applyConstraints({height:n/e.scaleResolutionDownBy,width:i/e.scaleResolutionDownBy})}e.maxFramerate&&n.encodings[0].maxFramerate!==e.maxFramerate&&await r.applyConstraints({frameRate:e.maxFramerate})}catch(n){if(n instanceof xl)throw n;throw new xl(dl.LOW_STREAM_ENCODING_ERROR,n.message)}}}class Sp extends ih{constructor(e,t,n){super(e),this._isDestroyed=!1,this._userId=t,this._uintId=n}getUserId(){return this._userId}_updateOriginMediaStreamTrack(e){this._mediaStreamTrack=this._originMediaStreamTrack=e,this._updatePlayerSource()}_destroy(){this._isDestroyed=!0,Ul.info("[track-".concat(this.getTrackId(),"] is destroyed")),this.stop()}}class Tp extends Sp{constructor(e,t,n){super(e,t,n),this.trackMediaType="video",this.updateMediaStreamTrackResolution()}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Fl.PLAYING)}getStats(){return st(()=>{Ul.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),et(this,Cu.GET_STATS)||nn({},hu)}play(e,t={}){let n=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.REMOTE_VIDEO_TRACK_PLAY,options:[this.getTrackId(),"string"==typeof e?e:"HTMLElement",t]});if("string"==typeof e){let t=document.getElementById(e);var r;t?e=t:(Ul.warning(To(r="[track-".concat(this.getTrackId(),'] can not find "#')).call(r,e,'" element, use document.body')),e=document.body)}Ul.debug("[track-".concat(this.getTrackId(),"] start video playback"),cr(t)),e=nn({fit:"cover"},t,{trackId:this.getTrackId(),element:e}),this._player?this._player.updateConfig(e):(this._player=new Kh(e),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.emit(bu.FIRST_FRAME_DECODED)}),this._player.play(),n.onSuccess()}stop(){let e=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.REMOTE_VIDEO_TRACK_STOP,options:[this.getTrackId()]});if(!this._player)return e.onSuccess();this._player.destroy(),this._player=void 0,Ul.debug("[track-".concat(this.getTrackId(),"] stop video playback")),e.onSuccess()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Qe(this._originMediaStreamTrack).then(([e,t])=>{this._videoHeight=t,this._videoWidth=e}).catch(Pd)}_updatePlayerSource(){Ul.debug("[track-".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}}class Rp extends Sp{constructor(e,t,n){super(e,t,n),this.trackMediaType="audio",this._useAudioElement=!0,this._volume=100,this._source=new dh(e,!0),this._source.once(au.RECEIVE_TRACK_BUFFER,()=>{this.emit(bu.FIRST_FRAME_DECODED)})}get isPlaying(){return this._useAudioElement?hh.isPlaying(this.getTrackId()):this._source.isPlayed}setAudioFrameCallback(e,t=4096){if(!e)return this._source.removeAllListeners(au.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(au.ON_AUDIO_BUFFER),this._source.on(au.ON_AUDIO_BUFFER,t=>e(t))}setVolume(e){let t=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.REMOTE_AUDIO_SET_VOLUME,options:[this.getTrackId(),e]},300);this._volume=e,this._useAudioElement?hh.setVolume(this.getTrackId(),e):this._source.setVolume(e/100),t.onSuccess()}async setPlaybackDevice(e){let t=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.REMOTE_AUDIO_SET_OUTPUT_DEVICE,options:[this.getTrackId(),e]});if(!this._useAudioElement)throw new xl(dl.NOT_SUPPORTED,"your browser does not support setting the audio output device");try{await hh.setSinkID(this.getTrackId(),e)}catch(n){throw t.onError(n),n}t.onSuccess()}getVolumeLevel(){return this._source.getAudioLevel()}getStats(){return st(()=>{Ul.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),et(this,Cu.GET_STATS)||nn({},uu)}play(){let e=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.REMOTE_AUDIO_TRACK_PLAY,options:[this.getTrackId()]});Ul.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(Ul.debug("[track-".concat(this.getTrackId(),"] use audio element to play")),hh.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play(),e.onSuccess()}stop(){let e=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.REMOTE_AUDIO_TRACK_STOP,options:[this.getTrackId()]});Ul.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?hh.stop(this.getTrackId()):this._source.stop(),e.onSuccess()}_destroy(){super._destroy(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){Ul.debug("[track-".concat(this.getTrackId(),"] update player source track")),this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&hh.updateTrack(this.getTrackId(),this._mediaStreamTrack)}}class yp extends Wh{constructor(e,t,n,r){super(n,e.uid),this.type="sub",this.unusedTracks=[],this.onTrack=e=>{var t,n,r,i;if("audio"===e.kind&&!this.subscribeOptions.audio||"video"===e.kind&&!this.subscribeOptions.video)return this.unusedTracks.push(e),void Ul.debug(To(n="[".concat(this.connectionId,"] unused ontrack event, kind: ")).call(n,e.kind));Ul.debug(To(t="[".concat(this.connectionId,"] emit pc ontrack after subscribe ")).call(t,e.kind),e),(t="audio"===e.kind?this.user._audioTrack:this.user._videoTrack)?t._updateOriginMediaStreamTrack(e):"audio"===e.kind?(this.pc._statsFilter.setIsFirstAudioDecoded(!1),this.user._audioTrack=new Rp(e,this.getUserId(),this.user._uintid),Ul.info(To(r="[".concat(this.connectionId,"] create remote audio track: ")).call(r,this.user._audioTrack.getTrackId())),this.bindTrackEvents(this.user._audioTrack)):(this.user._videoTrack=new Tp(e,this.getUserId(),this.user._uintid),Ul.info(To(i="[".concat(this.connectionId,"] create remote video track: ")).call(i,this.user._videoTrack.getTrackId())),this.bindTrackEvents(this.user._videoTrack))},this.handleGetRemoteAudioStats=e=>{e(this.statsCollector.getRemoteAudioTrackStats(this.connectionId))},this.handleGetRemoteVideoStats=e=>{e(this.statsCollector.getRemoteVideoTrackStats(this.connectionId))},this.handleGetSessionID=e=>{e(this.joinInfo.sid)},this.user=e,this.statsCollector=t,this.statsCollector.addRemoteConnection(this),this.subscribeOptions=r}async startP2PConnection(){return new Ga(async(e,t)=>{let n=r=>{if("connected"===r&&(Jd.subscribe(this.joinInfo.sid,{lts:this.startTime,succ:!0,video:this.subscribeOptions.video,audio:this.subscribeOptions.audio,peerid:this.user.uid,ec:null,subscribeRequestid:this.ID,p2pid:this.pc.ID}),this.off(ou.CONNECTION_STATE_CHANGE,n),e()),"disconnected"===r){if(this.off(ou.CONNECTION_STATE_CHANGE,n),this.disconnectedReason)return t(this.disconnectedReason);t(new xl(dl.OPERATION_ABORTED,"subscribe abort"))}};if(this.on(ou.CONNECTION_STATE_CHANGE,n),this.disconnectedReason=void 0,this.connectionState="connecting",this.startTime=wd(),!this.subscribeOptions)return void t(new xl(dl.UNEXPECTED_ERROR,"no subscribe options"));let r=new MediaStream,i=new Ga(e=>{this.pc.onTrack=(t,n)=>{var i,s;if("audio"===t.kind&&!this.subscribeOptions.audio||"video"===t.kind&&!this.subscribeOptions.video)return this.unusedTracks.push(t),void Ul.debug(To(s="[".concat(this.connectionId,"] unused ontrack event ")).call(s,t.kind));r.addTrack(t),s={audio:0<r.getAudioTracks().length,video:0<r.getVideoTracks().length},Ul.debug(To(i="[".concat(this.connectionId,"] subscribe ontrack: ")).call(i,t.kind),n,t);e:{var o,a;for(t=this.subscribeOptions,n=ul(o=Vs(s)).call(o),o=ul(a=Vs(t)).call(a),a=0;a<n.length;a+=1){if(n[a]!==o[a]){s=!1;break e}if(s[n[a]]!==t[n[a]]){s=!1;break e}}s=!0}s&&(this.pc.onTrack=this.onTrack,Ul.debug("[".concat(this.connectionId,"] get all subscribed tracks")),e(r))}});try{let e=function(e){return De().name!==Mc.FIREFOX?e:e.replace("/recvonly http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"," http://www.webrtc.org/experiments/rtp-hdrext/playout-delay")}(Qt(await this.pc.createOfferSDP()));await this.pc.setOfferSDP(e),Ul.debug("[".concat(this.connectionId,"] create and set offer success"));let t=await $e(this,ou.NEED_ANSWER,{messageType:"OFFER",sdp:e,offererSessionId:104,retry:!0});await this.pc.setAnswerSDP(Qt(t.sdp)),Ul.debug("[".concat(this.connectionId,"] set answer success"));let n=await Ga.all([i,this.icePromise]),r=n[0].getAudioTracks()[0],a=n[0].getVideoTracks()[0];var s,o;r&&(this.user._audioTrack?this.user._audioTrack._updateOriginMediaStreamTrack(r):(this.user._audioTrack=new Rp(r,this.getUserId(),this.user._uintid),Ul.info(To(s="[".concat(this.connectionId,"] create remote audio track: ")).call(s,this.user._audioTrack.getTrackId())),this.bindTrackEvents(this.user._audioTrack))),a&&(this.user._videoTrack?this.user._videoTrack._updateOriginMediaStreamTrack(a):(this.user._videoTrack=new Tp(a,this.getUserId(),this.user._uintid),Ul.info(To(o="[".concat(this.connectionId,"] create remote video track: ")).call(o,this.user._videoTrack.getTrackId())),this.bindTrackEvents(this.user._videoTrack))),this.connectionState="connected",this.startUploadStats()}catch(a){this.off(ou.CONNECTION_STATE_CHANGE,n),this.connectionState="disconnected",Jd.subscribe(this.joinInfo.sid,{lts:this.startTime,succ:!1,video:this.subscribeOptions.video,audio:this.subscribeOptions.audio,peerid:this.user.uid,ec:a.code,subscribeRequestid:this.ID,p2pid:this.pc.ID}),t(a)}})}async closeP2PConnection(e){"disconnected"!==this.connectionState&&(this.stopUploadStats(),this.statsCollector.removeConnection(this.connectionId),this.connectionState="disconnected",await this.setSubscribeOptions({audio:!1,video:!1}),await this.closePC(e),this.removeAllListeners())}getNetworkQuality(){var e=this.pc.getStats();if(!e.audioRecv[0]&&!e.videoRecv[0])return 1;var t=et(this,ou.NEED_SIGNAL_RTT),n=e.rtt;t=(n&&t?(n+t)/2:n||t)||0,n=e.audioRecv[0]?e.audioRecv[0].jitterMs:void 0;let r=70*(e=e.recvPacketLossRate)/50+.3*t/1500;return n&&(r=60*e/50+.2*t/1500+.2*n/400),.1>r?1:.17>r?2:.36>r?3:.59>r?4:5}uploadStats(e){let t=this.user.audioTrack?function(e,t){const n=e.audioRecv[0];return n?((e={id:Xe(10,""),timestamp:new Date(e.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:n.ssrc.toString()}).bytesReceived=n.bytes.toString(),e.packetsLost=n.packetsLost.toString(),e.packetsReceived=n.packets.toString(),e.A_aol=n.outputLevel?Math.round(100*n.outputLevel).toString():Math.round(100*t._source.getAudioAvgLevel()).toString(),e.A_apol=Math.round(100*t._source.getAudioAvgLevel()).toString(),t&&(e.A_artd=t._originMediaStreamTrack.enabled&&t._mediaStreamTrack.enabled?"0":"1"),e.A_jr=n.jitterMs.toString(),e.A_jbm=Math.floor(n.jitterBufferMs).toString(),e.A_cdm=Math.floor(n.jitterBufferMs).toString(),e):null}(e,this.user.audioTrack):void 0,n=this.user.videoTrack?function(e,t){const n=e.videoRecv[0];return n?((e={id:Xe(10,""),timestamp:new Date(e.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:n.ssrc.toString()}).bytesReceived=n.bytes.toString(),e.packetsLost=n.packetsLost.toString(),e.packetsReceived=n.packets.toString(),n.framesRateFirefox&&(e.A_frr=n.framesRateFirefox.toString()),n.receivedFrame&&(e.A_frr=n.receivedFrame.frameRate.toString()),e.A_frd=n.decodeFrameRate.toString(),n.outputFrame&&(e.A_fro=n.outputFrame.frameRate.toString()),void 0!==n.jitterBufferMs&&(e.A_jbm=Math.floor(n.jitterBufferMs).toString()),void 0!==n.currentDelayMs&&(e.A_cdm=Math.floor(n.currentDelayMs).toString()),e.A_fs=n.firsCount.toString(),e.A_ns=n.nacksCount.toString(),e.A_ps=n.plisCount.toString(),t&&(e.A_vrtd=t._originMediaStreamTrack.enabled&&t._mediaStreamTrack.enabled?"0":"1"),t._player&&0<t._player.freezeTimeCounterList.length&&(e.A_vrft=Qa(r=t._player.freezeTimeCounterList).call(r,0,1)[0].toString()),e):null;var r}(e,this.user.videoTrack):void 0;t&&it(()=>this.emit(ou.NEED_UPLOAD,iu.SUBSCRIBE_STATS,t)),n&&it(()=>this.emit(ou.NEED_UPLOAD,iu.SUBSCRIBE_STATS,n))}uploadSlowStats(e){}uploadRelatedStats(e,t){let n=!0===this.pc._statsFilter.videoIsReady,r=function(e,t,n){return(e=e.audioRecv[0])?(n=kd.isRemoteAudioFreeze(n),{mediaType:"audio",isAudioMute:!1,peerId:t,googJitterReceived:e.jitterMs.toString(),isFreeze:n,bytesReceived:e.bytes.toString(),packetsReceived:e.packets.toString(),packetsLost:e.packetsLost.toString(),frameReceived:e.receivedFrames.toString(),frameDropped:e.droppedFrames.toString()}):null}(e,this.getUserId(),this.user.audioTrack),i=function(e,t,n,r,i){return(t=t.videoRecv[0])?(e=kd.isRemoteVideoFreeze(i,t,r?r.videoRecv[0]:void 0)&&e,n={mediaType:"video",isVideoMute:!1,peerId:n,frameRateReceived:t.receivedFrame&&t.receivedFrame.frameRate.toString(),frameRateDecoded:t.decodedFrame&&t.decodedFrame.frameRate.toString(),isFreeze:e,bytesReceived:t.bytes.toString(),packetsReceived:t.packets.toString(),packetsLost:t.packetsLost.toString()},t.framesRateFirefox&&(n.frameRateDecoded=t.framesRateFirefox.toString(),n.frameRateReceived=t.framesRateFirefox.toString()),n):null}(n,e,this.getUserId(),t,this.user.videoTrack);r&&it(()=>{this.emit(ou.NEED_UPLOAD,iu.SUBSCRIBE_RELATED_STATS,r)}),i&&it(()=>{this.emit(ou.NEED_UPLOAD,iu.SUBSCRIBE_RELATED_STATS,i)})}emitOnTrackFromUnusedTracks(){if(this.subscribeOptions){var e,t=this.subscribeOptions.video;if(this.subscribeOptions.audio){var n;let e=hc(n=this.unusedTracks).call(n,e=>"audio"===e.kind&&"live"===e.readyState);nt(this.unusedTracks,e),e&&this.onTrack(e)}t&&(t=hc(e=this.unusedTracks).call(e,e=>"video"===e.kind&&"live"===e.readyState),nt(this.unusedTracks,t),t&&this.onTrack(t))}}async setSubscribeOptions(e){var t,n,r,i;if(e.audio!==this.subscribeOptions.audio||e.video!==this.subscribeOptions.video){if("connecting"===this.connectionState)try{await this.createWaitConnectionConnectedPromise()}catch(s){throw new xl(dl.OPERATION_ABORTED,"can not update subscribe options, operation abort")}e.audio===this.subscribeOptions.audio&&e.video===this.subscribeOptions.video||(Ul.debug(To(t=To(n=To(r=To(i="[".concat(this.connectionId,"] update subscribe options [a: ")).call(i,this.subscribeOptions.audio,", v: ")).call(r,this.subscribeOptions.video,"] -> [a: ")).call(n,e.audio,", v: ")).call(t,e.video,"]")),this.subscribeOptions=e,!e.audio&&this.user._audioTrack&&(this.unusedTracks.push(this.user._audioTrack._originMediaStreamTrack),this.user._audioTrack._destroy(),this.unbindTrackEvents(this.user._audioTrack),this.user._audioTrack=void 0),!e.video&&this.user._videoTrack&&(this.unusedTracks.push(this.user._videoTrack._originMediaStreamTrack),this.user._videoTrack._destroy(),this.unbindTrackEvents(this.user._videoTrack),this.user._videoTrack=void 0),this.emitOnTrackFromUnusedTracks())}}createPC(){this.pc=new jh({turnServer:this.joinInfo.turnServer}),this.pc.onFirstAudioDecoded=()=>{this.user.audioTrack&&this.user.audioTrack.emit(bu.FIRST_FRAME_DECODED),Jd.firstRemoteFrame(this.joinInfo.sid,jl.FIRST_AUDIO_DECODE,Gl.FIRST_AUDIO_DECODE,{peer:this.user._uintid,subscribeElapse:wd()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstAudioReceived=()=>{Jd.firstRemoteFrame(this.joinInfo.sid,jl.FIRST_AUDIO_RECEIVED,Gl.FIRST_AUDIO_RECEIVED,{peer:this.user._uintid,subscribeElapse:wd()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstVideoDecoded=(e,t)=>{Jd.firstRemoteFrame(this.joinInfo.sid,jl.FIRST_VIDEO_DECODE,Gl.FIRST_VIDEO_DECODE,{peer:this.user._uintid,videowidth:e,videoheight:t,subscribeElapse:wd()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstVideoReceived=()=>{Jd.firstRemoteFrame(this.joinInfo.sid,jl.FIRST_VIDEO_RECEIVED,Gl.FIRST_VIDEO_RECEIVED,{peer:this.user._uintid,subscribeElapse:wd()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.updateICEPromise()}async closePC(e){return this.pc.audioTrack&&this.pc.audioTrack.stop(),this.pc.videoTrack&&this.pc.videoTrack.stop(),this.pc.onTrack=void 0,this.pc.onICEConnectionStateChange=void 0,this.pc.close(),!e&&await $e(this,ou.NEED_UNSUB)}onPCDisconnected(e){Jd.subscribe(this.joinInfo.sid,{lts:this.startTime,succ:!1,video:this.subscribeOptions.video,audio:this.subscribeOptions.audio,peerid:this.user.uid,ec:e.code,subscribeRequestid:this.ID,p2pid:this.pc.ID})}bindTrackEvents(e){e instanceof Rp?e.addListener(Cu.GET_STATS,this.handleGetRemoteAudioStats):e instanceof Tp&&e.addListener(Cu.GET_STATS,this.handleGetRemoteVideoStats)}unbindTrackEvents(e){e instanceof Rp?e.off(Cu.GET_STATS,this.handleGetRemoteAudioStats):e instanceof Tp&&e.off(Cu.GET_STATS,this.handleGetRemoteVideoStats)}}class Ip extends bd{constructor(e,t,n,r){super(),this.reconnectMode="retry",this.commandReqId=this.reqId=0,this.handleWebSocketOpen=()=>{this.reconnectMode="retry",this.startPingPong()},this.handleWebSocketMessage=e=>{var t;e.data&&((e=JSON.parse(e.data)).requestId?this.emit(To(t="@".concat(e.requestId,"-")).call(t,e.sid),e):this.serviceMode===fu.INJECT?this.emit(vu.INJECT_STREAM_STATUS,e):(Jd.workerEvent(this.spec.sid,{actionType:"status",serverCode:e.code,workerType:this.serviceMode===fu.TRANSCODE?1:2}),this.emit(vu.PUBLISH_STREAM_STATUS,e)))},this.spec=t,this.token=e,this.serviceMode=r,this.websocket=new th("live-streaming",n),this.websocket.on(pu.CONNECTED,this.handleWebSocketOpen),this.websocket.on(pu.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(pu.REQUEST_NEW_URLS,(e,t)=>{$e(this,vu.REQUEST_NEW_ADDRESS).then(e).catch(t)}),this.websocket.on(pu.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,t,n,r){this.reqId+=1,"request"===e&&(this.commandReqId+=1);let i=this.commandReqId,s=this.reqId;if(!s||!this.websocket)throw new xl(dl.UNEXPECTED_ERROR);var o=sn({command:e,sdkVersion:"4.5.0"===Yc?"0.0.1":Yc,seq:s,requestId:s,allocate:n,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(wd()/1e3)},t);if("closed"===this.websocket.state)throw new xl(dl.WS_DISCONNECT);let a=()=>new Ga((e,t)=>{this.websocket.once(pu.CLOSED,()=>t(new xl(dl.WS_ABORT))),this.websocket.once(pu.CONNECTED,e)});"connected"!==this.websocket.state&&await a(),o.clientRequest&&(o.clientRequest.workerToken=this.token);let c=new Ga((e,t)=>{var n;const r=()=>{t(new xl(dl.WS_ABORT))};this.websocket.once(pu.RECONNECTING,r),this.websocket.once(pu.CLOSED,r),this.once(To(n="@".concat(s,"-")).call(n,this.spec.sid),t=>{e(t)})});r&&Jd.workerEvent(this.spec.sid,sn({},r,{requestId:i,actionType:"request",payload:cr(t.clientRequest),serverCode:0,code:0}));let l=wd();this.websocket.sendMessage(o),o=null;try{o=await c}catch(u){if("closed"===this.websocket.state)throw u;return await a(),await this.request(e,t,n)}return r&&Jd.workerEvent(this.spec.sid,sn({},r,{requestId:i,actionType:"response",payload:cr(o.serverResponse),serverCode:o.code,success:200===o.code,responseTime:wd()-l})),200!==o.code&&this.handleResponseError(o),o}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let e="4.5.0"===Yc?"0.0.1":Yc;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(wd()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case Tu.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void Ul.warning("live stream response already exists stream");case Tu.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Tu.LIVE_STREAM_RESPONSE_BAD_STREAM:case Tu.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new xl(dl.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case Tu.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)break;throw new xl(dl.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Tu.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new xl(dl.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case Tu.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:var t=new xl(dl.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(vu.WARNING,t,e.serverResponse.url);case Tu.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:return t=new xl(dl.LIVE_STREAMING_WARN_FREQUENT_REQUEST),this.emit(vu.WARNING,t,e.serverResponse.url);case Tu.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new xl(dl.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Tu.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new xl(dl.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case Tu.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:return t=new xl(dl.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT),this.emit(vu.WARNING,t,e.serverResponse.url);case Tu.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new xl(dl.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case Tu.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new xl(dl.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Tu.LIVE_STREAM_RESPONSE_WORKER_LOST:case Tu.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)break;throw new xl(dl.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Tu.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)break;if("UpdateTranscoding"===e.serverResponse.command||"ControlStream"===e.serverResponse.command)return new xl(dl.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new xl(dl.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Tu.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Tu.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Tu.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Tu.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new xl(dl.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(Pd)},6e3)}}class Cp extends bd{constructor(e,t=eh,n=eh){super(),this.retryTimeout=1e4,this.streamingTasks=new _s,this.isStartingStreamingTask=!1,this.taskMutex=new Bd("live-streaming"),this.cancelToken=Pl.CancelToken.source(),this.injectConfig=an({},Eu),this.injectLoopTimes=0,this.lastTaskId=1,this.statusError=new _s,this.spec=e,this.httpRetryConfig=n,this.wsRetryConfig=t}async setTranscodingConfig(e){var t;let n=an({},gu,{},e);var r,i,s,o;if(66!==n.videoCodecProfile&&77!==n.videoCodecProfile&&100!==n.videoCodecProfile&&(Ul.debug(To(r="[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ")).call(r,n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=Ka(i=n.transcodingUsers).call(i,e=>an({},_u,{},e,{zOrder:e.zOrder?e.zOrder+1:1}))),function(e){var t,n;null==e.width||Ee(e.width,"config.width",0,1e4),null==e.height||Ee(e.height,"config.height",0,1e4),null==e.videoBitrate||Ee(e.videoBitrate,"config.videoBitrate",1,1e6),null==e.videoFrameRate||Ee(e.videoFrameRate,"config.videoFrameRate"),null==e.lowLatency||me(e.lowLatency,"config.lowLatency"),null==e.audioSampleRate||ge(e.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),null==e.audioBitrate||Ee(e.audioBitrate,"config.audioBitrate",1,128),null==e.audioChannels||ge(e.audioChannels,"config.audioChannels",[1,2,3,4,5]),null==e.videoGop||Ee(e.videoGop,"config.videoGop"),null==e.videoCodecProfile||ge(e.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),null==e.userCount||Ee(e.userCount,"config.userCount",0,17),null==e.backgroundColor||Ee(e.backgroundColor,"config.backgroundColor",0,16777215),null==e.userConfigExtraInfo||ve(e.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),e.transcodingUsers&&null!=e.transcodingUsers&&(Se(e.transcodingUsers,"config.transcodingUsers"),Ds(t=e.transcodingUsers).call(t,(e,t)=>{Re(e.uid),null==e.x||Ee(e.x,"transcodingUser[".concat(t,"].x"),0,1e4),null==e.y||Ee(e.y,"transcodingUser[".concat(t,"].y"),0,1e4),null==e.width||Ee(e.width,"transcodingUser[".concat(t,"].width"),0,1e4),null==e.height||Ee(e.height,"transcodingUser[".concat(t,"].height"),0,1e4),null==e.zOrder||Ee(e.zOrder-1,"transcodingUser[".concat(t,"].zOrder"),0,100),null==e.alpha||Ee(e.alpha,"transcodingUser[".concat(t,"].alpha"),0,1,!1)})),null==e.watermark||Oe(e.watermark,"watermark"),null==e.backgroundImage||Oe(e.backgroundImage,"backgroundImage"),e.images&&null!=e.images&&(Se(e.images,"config.images"),Ds(n=e.images).call(n,(e,t)=>{Oe(e,"images[".concat(t,"]"))}))}(n),e=[],n.images&&e.push(...Ka(s=n.images).call(s,e=>an({},mu,{},e,{zOrder:255}))),n.backgroundImage&&(e.push(an({},mu,{},n.backgroundImage,{zOrder:0})),delete n.backgroundImage),n.watermark&&(e.push(an({},mu,{},n.watermark,{zOrder:255})),delete n.watermark),n.images=e,n.transcodingUsers&&(n.userConfigs=Ka(o=n.transcodingUsers).call(o,e=>an({},e)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers),s=Ka(t=n.userConfigs||[]).call(t,e=>"number"==typeof e.uid?Ga.resolve(e.uid):Lt(e.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)),t=await Ga.all(s),Ds(t).call(t,(e,t)=>{n.userConfigs&&n.userConfigs[t]&&(n.userConfigs[t].uid=e)}),this.transcodingConfig=n,this.connection)try{var a,c,l;let e=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Ka(a=Ad(Id(c=this.streamingTasks).call(c))).call(a,e=>e.taskId).join("#")});Ul.debug(To(l="[".concat(this.spec.clientId,"] update live transcoding config success, code: ")).call(l,e.code,", config:"),cr(this.transcodingConfig))}catch(d){var u;if(!d.data||!d.data.retry)throw d;d.data.changeAddress&&this.connection.tryNextAddress(),Ds(u=this.streamingTasks).call(u,e=>{Ul.warning("[".concat(this.spec.clientId,"] live streaming receive error"),d.toString(),"try to republish",e.url),this.startLiveStreamingTask(e.url,e.mode,d).then(()=>{var t;Ul.debug(To(t="[".concat(this.spec.clientId,"] live streaming republish ")).call(t,e.url," success"))}).catch(t=>{Ul.error("[".concat(this.spec.clientId,"] live streaming republish failed"),e.url,t.toString()),this.onLiveStreamError&&this.onLiveStreamError(e.url,t)})})}}setInjectStreamConfig(e,t){this.injectConfig=Us({},this.injectConfig,e),this.injectLoopTimes=t}async startLiveStreamingTask(e,t,n){var r,i,s,o;if(hc(r=Ad(Id(i=this.streamingTasks).call(i))).call(r,e=>e.mode===fu.INJECT)&&t===fu.INJECT)return new xl(dl.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&t===fu.TRANSCODE)throw new xl(dl.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");if(r={command:"PublishStream",ts:wd(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0},Ul.debug(To(s=To(o="[".concat(this.spec.clientId,"] start live streaming ")).call(o,e,", mode: ")).call(s,t)),s=await this.taskMutex.lock(),this.connection||!n){if(this.streamingTasks.get(e)&&!n)return s(),new xl(dl.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(c){throw s(),c}switch(t){case fu.TRANSCODE:r.transcodingConfig=an({},this.transcodingConfig);break;case fu.INJECT:r={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:wd(),url:e,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0,o=this.lastTaskId++;try{var a;let i=new Ga((t,r)=>{qe(this.retryTimeout).then(()=>{if(n)return r(n);const t=this.statusError.get(e);return t?(this.statusError.delete(e),r(t)):void 0})}),c=await Ga.race([this.connection.request("request",{clientRequest:r},!0,{url:e,command:"PublishStream",workerType:t===fu.TRANSCODE?1:2,requestByUser:!n,tid:o.toString()}),i]);this.isStartingStreamingTask=!1,Ul.debug(To(a="[".concat(this.spec.clientId,"] live streaming started, code: ")).call(a,c.code)),this.streamingTasks.set(e,{clientRequest:r,mode:t,url:e,taskId:o}),s()}catch(c){if(s(),this.isStartingStreamingTask=!1,!c.data||!c.data.retry||n)throw c;return c.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,c)):await this.startLiveStreamingTask(e,t,c)}}else s()}stopLiveStreamingTask(e){return new Ga((t,n)=>{let r=this.streamingTasks.get(e);if(!r||!this.connection)return new xl(dl.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let i=r.mode;r.abortTask=()=>{Ul.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:i===fu.INJECT?"UninjectStream":"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:i===fu.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(n=>{var r;Ul.debug(To(r="[".concat(this.spec.clientId,"] stop live streaming success, code: ")).call(r,n.code)),this.streamingTasks.delete(e),0===this.streamingTasks.size&&i!==fu.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),t(),i===fu.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(5,this.spec.uid,e)}).catch(n)})}async controlInjectStream(e,t,n,r){let i=this.streamingTasks.get(e);if(!i||!this.connection||i.mode!==fu.INJECT)throw new xl(dl.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:e,control:t,audioVolume:n,position:r}})).serverResponse}resetAllTask(){var e;let t=Ad(Id(e=this.streamingTasks).call(e));this.terminate();for(let n of t)this.startLiveStreamingTask(n.url,n.mode).catch(e=>{this.onLiveStreamError&&this.onLiveStreamError(n.url,e)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new _s,this.isStartingStreamingTask=!1,this.statusError=new _s,this.cancelToken=Pl.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new xl(dl.UNEXPECTED_ERROR,"live streaming connection has already connected");let t=await $e(this,Su.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new Ip(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(vu.WARNING,(e,t)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e)),this.connection.on(vu.PUBLISH_STREAM_STATUS,e=>this.handlePublishStreamServer(e)),this.connection.on(vu.INJECT_STREAM_STATUS,e=>this.handleInjectStreamServerStatus(e)),this.connection.on(vu.REQUEST_NEW_ADDRESS,(t,n)=>{if(!this.connection)return n(new xl(dl.UNEXPECTED_ERROR,"can not get new live streaming address list"));$e(this,Su.REQUEST_WORKER_MANAGER_LIST,e).then(e=>{this.uapResponse=e,t(e.addressList)}).catch(n)}),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){var t=e.serverStatus&&e.serverStatus.url||"empty_url";let n=this.streamingTasks.get(t),r=e.reason;switch(e.code){case Tu.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Tu.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Tu.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Tu.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:if(e=new xl(dl.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}),n)return Ul.error(e.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,e);if(!this.isStartingStreamingTask)break;this.statusError.set(t,e);case Tu.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:return e=new xl(dl.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r),this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e);case Tu.LIVE_STREAM_RESPONSE_WORKER_LOST:case Tu.LIVE_STREAM_RESPONSE_WORKER_QUIT:var i;if(this.connection){this.connection.tryNextAddress(),t=Ad(Id(i=this.streamingTasks).call(i));for(let n of t)n.abortTask?n.abortTask():(Ul.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",n.url),this.startLiveStreamingTask(n.url,n.mode,new xl(dl.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{Ul.debug("[".concat(this.spec.clientId,"] republish live stream success"),n.url)}).catch(e=>{Ul.error(e.toString()),this.onLiveStreamError&&this.onLiveStreamError(n.url,e)}))}}}handleInjectStreamServerStatus(e){let t=Number(e.uid),n=e.serverStatus&&e.serverStatus.url;switch(e.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(0,t,n));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(1,t,n),void this.streamingTasks.delete(n);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(2,t,n),void this.streamingTasks.delete(n);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(10,t,n),void this.streamingTasks.delete(n);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(3,t,n),void this.streamingTasks.delete(n);default:return void Ul.debug("inject stream server status",e)}}hasUrl(e){return this.streamingTasks.has(e)}}class Ap{constructor(){this.destChannelMediaInfos=new _s}setSrcChannelInfo(e){Ne(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){Ne(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){Te(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}class wp extends bd{constructor(e,t,n){super(),this.requestId=1,this.onOpen=()=>{this.emit("open"),this.startHeartBeatCheck()},this.onClose=e=>{this.emit("close"),this.dispose()},this.onMessage=e=>{if(!(e=JSON.parse(e.data))||"serverResponse"!==e.command||!e.requestId)return e&&"serverStatus"===e.command&&e.serverStatus&&e.serverStatus.command?(this.emit("status",e.serverStatus),void this.emit(e.serverStatus.command,e.serverStatus)):void 0;this.emit("req_".concat(e.requestId),e)},this.joinInfo=e,this.clientId=t,this.ws=new th("cross-channel-".concat(this.clientId),n),this.ws.on(pu.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(pu.CONNECTED,this.onOpen),this.ws.on(pu.ON_MESSAGE,this.onMessage),this.ws.on(pu.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(e){let t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new Ga((t,n)=>{let r=window.setTimeout(()=>{n(new xl(dl.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,i=>{window.clearTimeout(r),i.state&&0!==i.state?n(new xl(dl.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)}),this.once("dispose",()=>{window.clearTimeout(r),n(new xl(dl.WS_ABORT))})})}async request(e){if("closed"===this.ws.state)throw new xl(dl.WS_DISCONNECT);"connected"!==this.ws.state&&await(()=>new Ga((e,t)=>{this.ws.once(pu.CLOSED,()=>t(new xl(dl.WS_ABORT))),this.ws.once(pu.CONNECTED,e)}))();let t=this.sendMessage(e);if(!(e=await new Ga((e,n)=>{const r=()=>{n(new xl(dl.WS_ABORT))};this.ws.once(pu.RECONNECTING,r),this.ws.once(pu.CLOSED,r),this.once("req_".concat(t),e),qe(3e3).then(()=>{this.removeAllListeners("req_".concat(t)),this.ws.off(pu.RECONNECTING,r),this.ws.off(pu.CLOSED,r),n(new xl(dl.TIMEOUT,"cross channel ws request timeout"))})}))||200!==e.code)throw new xl(dl.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(cr(e)));return e}async connect(e){this.ws.removeAllListeners(pu.REQUEST_NEW_URLS),this.ws.on(pu.REQUEST_NEW_URLS,t=>{t(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){let t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class bp extends bd{constructor(e,t,n,r){super(),this.cancelToken=Pl.CancelToken.source(),this.requestId=0,this._state="RELAY_STATE_IDLE",this.errorCode="RELAY_OK",this.onStatus=e=>{var t;Ul.debug(To(t="[".concat(this.clientId,"] ChannelMediaStatus: ")).call(t,cr(e))),e&&e.command&&("onAudioPacketReceived"===e.command&&this.emit("event","PACKET_RECEIVED_AUDIO_FROM_SRC"),"onVideoPacketReceived"===e.command&&this.emit("event","PACKET_RECEIVED_VIDEO_FROM_SRC"),"onSrcTokenPrivilegeDidExpire"===e.command&&(this.errorCode="SRC_TOKEN_EXPIRED",this.state="RELAY_STATE_FAILURE"),"onDestTokenPrivilegeDidExpire"===e.command&&(this.errorCode="DEST_TOKEN_EXPIRED",this.state="RELAY_STATE_FAILURE"))},this.onReconnect=async()=>{Ul.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event","NETWORK_DISCONNECTED"),this.state="RELAY_STATE_IDLE",this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(e=>{"RELAY_STATE_IDLE"!==this.state&&(Ul.error("auto restart channel media relay failed",e.toString()),this.errorCode="SERVER_CONNECTION_LOST",this.state="RELAY_STATE_FAILURE")})},this.joinInfo=e,this.clientId=t,this.signal=new wp(this.joinInfo,this.clientId,n),this.httpRetryConfig=r}set state(e){e!==this._state&&("RELAY_STATE_FAILURE"!==e&&(this.errorCode="RELAY_OK"),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}async startChannelMediaRelay(e){if("RELAY_STATE_IDLE"!==this.state)throw new xl(dl.INVALID_OPERATION);this.state="RELAY_STATE_CONNECTING",await this.connect(),Ul.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(t){if(t.data&&t.data.serverResponse&&"SetSourceChannel"===t.data.serverResponse.command)throw new xl(dl.CROSS_CHANNEL_FAILED_JOIN_SRC);if(t.data&&t.data.serverResponse&&"SetDestChannelStatus"===t.serverResponse.command)throw new xl(dl.CROSS_CHANNEL_FAILED_JOIN_DEST);if(t.data&&t.data.serverResponse&&"StartPacketTransfer"===t.serverResponse.command)throw new xl(dl.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST);throw t}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if("RELAY_STATE_RUNNING"!==this.state)throw new xl(dl.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),Ul.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state="RELAY_STATE_IDLE",this.dispose()}dispose(){Ul.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Pl.CancelToken.source(),this.state="RELAY_STATE_IDLE",this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let e=await async function(e,t,n){var r,i;let s=Ka(r=cc(i=el.UAP_AP).call(i,0,el.AJAX_REQUEST_CONCURRENT)).call(r,t=>{var n;return e.proxyServer?To(n="https://".concat(e.proxyServer,"/ap/?url=")).call(n,t+"/api/v1?action=uap"):"https://".concat(t,"/api/v1?action=uap")});r=Ka(s).call(s,r=>function(e,t,n,r){t={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,ts:wd(),version:Yc,cname:t.cname,uid:t.uid.toString(),requestId:Sh,seq:Sh},Sh+=1;const i={service_name:"tele_channel",json_body:cr(t)};return yt(async()=>{var t=await mt(e,{data:i,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==t.code){var r=new xl(dl.UNEXPECTED_RESPONSE,"cross channel ap error, code"+t.code,{retry:!0});throw Ul.error(r.toString()),r}if(200!==(t=JSON.parse(t.json_body)).code){var s=new xl(dl.UNEXPECTED_RESPONSE,To(r="cross channel app center error, code: ".concat(t.code,", reason: ")).call(r,t.reason));throw Ul.error(s.toString()),s}if(!t.servers||0===t.servers.length)throw r=new xl(dl.UNEXPECTED_RESPONSE,"cross channel app center empty server"),Ul.error(r.toString()),r;return{vid:t.vid,workerToken:t.workerToken,addressList:Ka(s=t.servers).call(s,e=>{var t;return To(t="wss://".concat(e.address.replace(/\./g,"-"),".edge.agora.io:")).call(t,e.wss)})}},void 0,e=>!!(e.code!==dl.OPERATION_ABORTED&&e.code!==dl.UNEXPECTED_RESPONSE||e.data&&e.data.retry),r)}(r,e,t,n));try{let e=await Je(r);return Ds(r).call(r,e=>e.cancel()),e}catch(o){throw o[0]}}(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event","NETWORK_CONNECTED"),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){var t=this.genMessage(yu.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),Ul.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success")),t=this.genMessage(yu.SetSdkProfile,e),await this.signal.request(t),Ul.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success")),t=this.genMessage(yu.SetSourceChannel,e),await this.signal.request(t),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event","PACKET_JOINED_SRC_CHANNEL"),Ul.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success")),t=this.genMessage(yu.SetSourceUserId,e),await this.signal.request(t),Ul.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success")),t=this.genMessage(yu.SetDestChannel,e),await this.signal.request(t),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event","PACKET_JOINED_DEST_CHANNEL"),Ul.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success")),e=this.genMessage(yu.StartPacketTransfer,e),await this.signal.request(e),this.emit("event","PACKET_SENT_TO_DEST_CHANNEL"),this.state="RELAY_STATE_RUNNING",Ul.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success"))}async sendUpdateMessage(e){e=this.genMessage(yu.UpdateDestChannel,e),await this.signal.request(e),this.emit("event","PACKET_UPDATE_DEST_CHANNEL"),Ul.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let e=this.genMessage(yu.StopPacketTransfer);await this.signal.request(e),Ul.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){let n=[],r=[],i=[];this.requestId+=1;let s={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Yc,sid:this.joinInfo.sid,ts:wd(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.5.0"===s.sdkVersion&&(s.sdkVersion="0.0.1");let o=null,a=null;switch(e){case yu.SetSdkProfile:return s.clientRequest={command:"SetSdkProfile",type:"multi_channel"},s;case yu.SetSourceChannel:if(a=t&&t.getSrcChannelMediaInfo(),!a)throw new xl(dl.UNEXPECTED_ERROR,"can not find source config");return s.clientRequest={command:"SetSourceChannel",uid:"0",channelName:a.channelName,token:a.token||this.joinInfo.appId},s;case yu.SetSourceUserId:if(a=t&&t.getSrcChannelMediaInfo(),!a)throw new xl(dl.UNEXPECTED_ERROR,"can not find source config");return s.clientRequest={command:"SetSourceUserId",uid:a.uid+""},s;case yu.SetDestChannel:if(o=t&&t.getDestChannelMediaInfo(),!o)throw new xl(dl.UNEXPECTED_ERROR,"can not find dest config");return Ds(o).call(o,e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)}),s.clientRequest={command:"SetDestChannel",channelName:n,uid:r,token:i},s;case yu.StartPacketTransfer:return s.clientRequest={command:"StartPacketTransfer"},s;case yu.Reconnect:return s.clientRequest={command:"Reconnect"},s;case yu.StopPacketTransfer:return s.clientRequest={command:"StopPacketTransfer"},s;case yu.UpdateDestChannel:if(o=t&&t.getDestChannelMediaInfo(),!o)throw new xl(dl.UNEXPECTED_ERROR,"can not find dest config");return Ds(o).call(o,e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)}),s.clientRequest={command:"UpdateDestChannel",channelName:n,uid:r,token:i},s}return s}}class Op{constructor(e,t){this._trust_stream_added_state_=this._trust_video_mute_state_=this._trust_audio_mute_state_=this._trust_video_enabled_state_=this._trust_audio_enabled_state_=this._trust_in_room_=!0,this._video_muted_=this._audio_muted_=!1,this._video_enabled_=this._audio_enabled_=!0,this._video_added_=this._audio_added_=!1,this.uid=e,this._uintid=t}get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}}var Np=function(e,t,n,r){var i,s=arguments.length,o=3>s?t:null===r?r=oo(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;0<=a;a--)(i=e[a])&&(o=(3>s?i(o):3<s?i(t,n,o):i(t,n))||o);return 3<s&&o&&Ks(t,n,o),o},kp=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class Dp extends bd{constructor(e){var t,n,r,i;let s;if(super(),this._users=[],this._sessionId=null,this._bindEnabledTracks=[],this._leaveMutex=new Bd("client-leave"),this._publishMutex=new Bd("client-publish"),this._subscribeMutex=new _s,this._remoteStream=new _s,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._turnServer={servers:[],mode:"auto"},this._cloudProxyServerMode="disabled",this._isDualStreamEnabled=!1,this._streamFallbackTypeCacheMap=new _s,this._remoteStreamTypeCacheMap=new _s,this._axiosCancelSource=Pl.CancelToken.source(),this._networkQualitySensitivity="normal",this._handleLocalTrackEnable=(e,t,n)=>{this.publish(e,!1).then(t).catch(n)},this._handleLocalTrackDisable=(e,t,n)=>{this.unpublish(e,!1).then(t).catch(n)},this._handleUserOnline=e=>{var t;this.isStringUID&&"string"!=typeof e.uid&&Ul.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let n=hc(t=this._users).call(t,t=>t.uid===e.uid);n?n._trust_in_room_=!0:(t=new Op(e.uid,e.uint_id||e.uid),this._users.push(t),Ul.debug("[".concat(this._clientId,"] user online"),e.uid),this.emit(Zl.USER_JOINED,t))},this._handleUserOffline=e=>{var t;let n=hc(t=this._users).call(t,t=>t.uid===e.uid);n&&(this._handleRemoveStream(e),nt(this._users,n),this._remoteStreamTypeCacheMap.delete(n.uid),this._streamFallbackTypeCacheMap.delete(n.uid),Ul.debug("[".concat(this._clientId,"] user offline"),e.uid,"reason:",e.reason),this.emit(Zl.USER_LEAVED,n,e.reason))},this._handleAddAudioOrVideoStream=(e,t,n)=>{var r,i,s;let o=hc(r=this._users).call(r,e=>e.uid===t);var a,c;o?(Ul.debug(To(i=To(s="[".concat(this._clientId,"] stream added with uid ")).call(s,t,", type ")).call(i,e)),r="audio"===e?o.hasAudio:o.hasVideo,o._uintid||(o._uintid=n||t),o._trust_stream_added_state_=!0,"audio"===e?o._audio_added_=!0:o._video_added_=!0,("audio"===e?o.hasAudio:o.hasVideo)&&!r&&(Ul.info(To(a=To(c="[".concat(this._clientId,"] remote user ")).call(c,o.uid," published ")).call(a,e)),this.emit(Zl.USER_PUBLISHED,o,e)),"video"===e?Jd.onGatewayStream(this._sessionId,jl.ON_ADD_VIDEO_STREAM,Gl.ON_ADD_VIDEO_STREAM,{peer:n||t}):Jd.onGatewayStream(this._sessionId,jl.ON_ADD_AUDIO_STREAM,Gl.ON_ADD_AUDIO_STREAM,{peer:n||t}),(e=this._remoteStream.get(t))&&e.readyToReconnect&&"connecting"===e.connectionState&&e.reconnectPC().catch(e=>{Ul.error("[".concat(this._clientId,"] resubscribe error"),e.toString())})):Ul.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"))},this._handleRemoveStream=e=>{var t,n;let r=hc(t=this._users).call(t,t=>t.uid===e.uid);r?(Ul.debug(To(n="[".concat(this._clientId,"] stream removed with uid ")).call(n,e.uid)),t=()=>{},r.hasAudio&&r.hasVideo?t=()=>{var e,t;Ul.info(To(e="[".concat(this._clientId,"] remote user ")).call(e,r.uid," unpublished audio track")),this.emit(Zl.USER_UNPUBLISHED,r,"audio"),Ul.info(To(t="[".concat(this._clientId,"] remote user ")).call(t,r.uid," unpublished video track")),this.emit(Zl.USER_UNPUBLISHED,r,"video")}:r.hasVideo?t=()=>{var e;Ul.info(To(e="[".concat(this._clientId,"] remote user ")).call(e,r.uid," unpublished video track")),this.emit(Zl.USER_UNPUBLISHED,r,"video")}:r.hasAudio&&(t=()=>{var e;Ul.info(To(e="[".concat(this._clientId,"] remote user ")).call(e,r.uid," unpublished audio track")),this.emit(Zl.USER_UNPUBLISHED,r,"audio")}),r._trust_stream_added_state_=!0,r._audio_added_=!1,r._video_added_=!1,(n=this._remoteStream.get(r.uid))&&(n.closeP2PConnection(),this._remoteStream.delete(r.uid)),Jd.onGatewayStream(this._sessionId,jl.ON_REMOVE_STREAM,Gl.ON_REMOVE_STREAM,{peer:e.uint_id||e.uid}),t()):Ul.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"))},this._handleSetStreamLocalEnable=(e,t,n)=>{var r,i,s,o,a,c;let l=hc(r=this._users).call(r,e=>e.uid===t);if(l){if(Ul.debug(To(i=To(s=To(o="[".concat(this._clientId,"] local ")).call(o,e," ")).call(s,n?"enabled":"disabled"," with uid ")).call(i,t)),r="audio"===e?l.hasAudio:l.hasVideo,"audio"===e){l._trust_audio_enabled_state_=!0;var u,d,h=l._audio_enabled_;if(l._audio_enabled_=n,l._audio_enabled_===h)return;n=l._audio_enabled_?"enable-local-audio":"disable-local-audio",Ul.debug(To(u=To(d="[".concat(this._clientId,"] user-info-updated, uid: ")).call(d,t,", msg: ")).call(u,n)),this.emit(Zl.USER_INFO_UPDATED,t,n)}else{if(l._trust_video_enabled_state_=!0,u=l._video_enabled_,l._video_enabled_=n,l._video_enabled_===u)return;var p;n=l._video_enabled_?"enable-local-video":"disable-local-video",Ul.debug(To(h=To(p="[".concat(this._clientId,"] user-info-update, uid: ")).call(p,t,", msg: ")).call(h,n)),this.emit(Zl.USER_INFO_UPDATED,t,n)}if(r!==(n="audio"===e?l.hasAudio:l.hasVideo)){var f,_;if(!r&&n)return Ul.info(To(f=To(_="[".concat(this._clientId,"] remote user ")).call(_,t," published ")).call(f,e)),void this.emit(Zl.USER_PUBLISHED,l,e);(f=this._remoteStream.get(t))&&((_=un({},f.subscribeOptions)).audio=!!l.hasAudio&&_.audio,_.video=!!l.hasVideo&&_.video,_.audio||_.video?f.setSubscribeOptions(_):(f.closeP2PConnection().catch(e=>{Ul.warning("close sub pc error",e)}),this._remoteStream.delete(l.uid))),Ul.info(To(a=To(c="[".concat(this._clientId,"] remote user ")).call(c,l.uid," unpublished ")).call(a,e)),this.emit(Zl.USER_UNPUBLISHED,l,e)}}else Ul.error("[".concat(this._clientId,"] can not find target user!(disable_local)"))},this._handleMuteStream=(e,t,n)=>{var r,i,s;Ul.debug("[".concat(this._clientId,"] receive mute message"),e,t,n);let o=hc(r=this._users).call(r,t=>t.uid===e);var a;if(o){if(r="audio"===t?o.hasAudio:o.hasVideo,"audio"===t){o._trust_audio_mute_state_=!0;var c,l,u=o._audio_muted_;if(o._audio_muted_=n,o._audio_muted_===u)return;n=o._audio_muted_?"mute-audio":"unmute-audio",Ul.debug(To(c=To(l="[".concat(this._clientId,"] user-info-update, uid: ")).call(l,e,", msg: ")).call(c,n)),this.emit(Zl.USER_INFO_UPDATED,e,n)}else{if(o._trust_video_mute_state_=!0,c=o._video_muted_,o._video_muted_=n,o._video_muted_===c)return;var d;n=o._video_muted_?"mute-video":"unmute-video",Ul.debug(To(u=To(d="[".concat(this._clientId,"] user-info-update, uid: ")).call(d,e,", msg: ")).call(u,n)),this.emit(Zl.USER_INFO_UPDATED,e,n)}if(r!==(n="audio"===t?o.hasAudio:o.hasVideo)){var h,p;if(!r&&n)return Ul.info(To(h=To(p="[".concat(this._clientId,"] remote user ")).call(p,e," published ")).call(h,t)),void this.emit(Zl.USER_PUBLISHED,o,t);(h=this._remoteStream.get(e))&&((p=un({},h.subscribeOptions)).audio=!!o.hasAudio&&p.audio,p.video=!!o.hasVideo&&p.video,"video"===t&&h.pc._statsFilter.setVideoIsReady(!1),p.audio||p.video?h.setSubscribeOptions(p):(h.closeP2PConnection().catch(e=>{Ul.warning("close sub pc error",e)}),this._remoteStream.delete(o.uid))),Ul.info(To(i=To(s="[".concat(this._clientId,"] remote user ")).call(s,e," unpublished ")).call(i,t)),this.emit(Zl.USER_UNPUBLISHED,o,t)}}else Ul.warning(To(a="[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ")).call(a,e))},this._handleP2PLost=e=>{Ul.debug("[".concat(this._clientId,"] receive p2p lost"),e);let t=null;if(this._highStream&&this._highStream.pc.ID===e.p2pid)t=this._highStream;else if(this._lowStream&&this._lowStream.pc.ID===e.p2pid)t=this._lowStream;else{var n;Ds(n=this._remoteStream).call(n,n=>{n.pc.ID===e.p2pid&&(t=n)})}t?t.emit(ou.GATEWAY_P2P_LOST,e.p2pid):Ul.warning("P2PLost stream not found",e)},this._handleTokenWillExpire=()=>{Ul.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.emit(Zl.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)},this._handleBeforeUnload=e=>{void 0!==e.returnValue&&""!==e.returnValue||(this.leave(),Ul.info("[".concat(this._clientId,"] auto leave onbeforeunload")))},this._handleUpdateNetworkQuality=()=>{var e;if("normal"!==this._networkQualitySensitivity){if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.emit(Zl.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});var t={downlinkNetworkQuality:0,uplinkNetworkQuality:0};this._highStream&&!this._highStream.detecting&&(t.uplinkNetworkQuality=this._highStream.getNetworkQuality());var n=0;Ds(e=this._remoteStream).call(e,e=>n+=e.getNetworkQuality()),0<this._remoteStream.size&&(t.downlinkNetworkQuality=Math.round(n/this._remoteStream.size)),this.emit(Zl.NETWORK_QUALITY,t)}},this._codec=e.codec,this._mode=e.mode,e.proxyServer&&(this._proxyServer=e.proxyServer,Jd.setProxyServer(this._proxyServer),Ul.setProxyServer(this._proxyServer)),e.turnServer&&(this._turnServer=un({},this._turnServer,{mode:"manual"},e.turnServer)),this._clientId=Xe(5,"client-"),Ul.info(To(t=To(n=To(r=To(i="[".concat(this._clientId,"] Initializing AgoraRTC client v")).call(i,Yc," build: ")).call(r,"v4.5.0-0-g87245ad6(5/25/2021, 3:25:26 PM)",", mode: ")).call(n,this._mode,", codec: ")).call(t,this._codec)),e.clientRoleOptions)try{be(e.clientRoleOptions),s=Us({},e.clientRoleOptions)}catch(a){var o;Ul.warning(To(o="[".concat(this._clientId,"] ")).call(o,a.toString()))}this._statsCollector=new kd(this._clientId),this._statsCollector.onStatsException=(e,t,n)=>{var r,i,s;Ul.debug(To(r=To(i=To(s="[".concat(this._clientId,"] receive exception msg, code: ")).call(s,e,", msg: ")).call(i,t,", uid: ")).call(r,n)),this.emit(Zl.EXCEPTION,{code:e,msg:t,uid:n})},this._statsCollector.onUploadPublishDuration=(e,t,n,r)=>{var i;let s=hc(i=this._users).call(i,t=>t.uid===e);s&&Jd.peerPublishStatus(this._sessionId,{subscribeElapse:r,audioPublishDuration:t,videoPublishDuration:n,peer:s._uintid})},this._gateway=new Eh({clientId:this._clientId,mode:this._mode,codec:this._codec,websocketRetryConfig:e.websocketRetryConfig||eh,httpRetryConfig:e.httpRetryConfig||eh,forceWaitGatewayResponse:void 0===e.forceWaitGatewayResponse||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:s}),this._config=e,this._configDistribute=Ch,this._handleGatewayEvents(),nl.push(this)}get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._highStream?this._highStream.getAllTracks():[]}get uid(){return this._uid}get channelName(){return this._channelName}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}async join(e,t,n,r,i){var s;let o=Jd.reportApiInvoke(this._sessionId,{name:Wl.JOIN,options:[e,t,n,r],tag:Kl.TRACER});try{if(!n&&null!==n)throw new xl(dl.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&ve(n,"token",1,2047),e&&ve(e,"appid",1,2047),Te(t),r&&Re(r),i&&ve(i,"optionalInfo",1,2047)}catch(l){throw o.onError(l),l}if(Ul.info(To(s="[".concat(this._clientId,"] start join channel ")).call(s,t)),this._leaveMutex.isLocked&&(Ul.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),Ul.debug("[".concat(this._clientId,"] join: continue"))),"DISCONNECTED"!==this.connectionState)throw e=new xl(dl.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state")),o.onError(e),e;this._sessionId||(this._sessionId=Xe(32,"").toUpperCase()),this._gateway.state="CONNECTING",i={clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:"string"!=typeof r?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:i},"string"==typeof r&&(i.stringUid=r,this._uintUid?(i.uid=this._uintUid,this._uintUid=void 0):i.uid=0),"none"!==this._encryptionMode&&this._encryptionSecret&&(i.aesmode=this._encryptionMode,i.aespassword=await(async e=>{var t,n=ot("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB");return n=await window.crypto.subtle.importKey("spki",n,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),t=e,e=(new TextEncoder).encode(t),t=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},n,e),at(new Uint8Array(t))})(this._encryptionSecret),this._encryptionSalt&&(i.aessalt=this._encryptionSalt)),this._startSession(this._sessionId,{channel:t,appId:e}),zd(()=>{"CONNECTING"===this.connectionState&&Jd.joinChannelTimeout(this._sessionId,5)},5e3);try{var a;if(await async function(e,t,n){var r,i,s;if("disabled"!==e.cloudProxyServer){var o=await async function(e,t,n){var r,i=wd(),s=Ka(r=el.PROXY_CS).call(r,t=>{var n;return e.proxyServer?To(n="https://".concat(e.proxyServer,"/ap/?url=")).call(n,t+"/api/v1"):"https://".concat(t,"/api/v1")});if("proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer||"proxy5"===e.cloudProxyServer){i=Ka(s).call(s,e=>({url:e,areaCode:Th()}));var o=null;if(o=await xd({fragementLength:el.FRAGEMENT_LENGTH,referenceList:i,asyncMapHandler:r=>function({url:e,areaCode:t},n,r,i){const s=wd(),o={opid:133,flag:"proxy5"===n.cloudProxyServer?4194304:1048576,ts:+new Date,key:n.token,cname:n.cname,sid:n.sid,detail:{6:n.stringUid,11:t},uid:n.uid||0};return yt(async()=>await mt(e,{data:o,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":69}}),t=>{var r;if(0===t.code)return Jd.joinWebProxyAP(n.sid,{lts:s,sucess:1,apServerAddr:e,turnServerAddrList:Ka(r=t.addresses).call(r,e=>e.ip).join(","),errorCode:null,eventType:n.cloudProxyServer}),!1;throw t=Tt(t.code),new xl(dl.CAN_NOT_GET_GATEWAY_SERVER,t.desc,{retry:t.retry})},t=>{return t.code!==dl.OPERATION_ABORTED&&(t.code===dl.CAN_NOT_GET_GATEWAY_SERVER||t.code===dl.VOID_GATEWAY_ADDRESS?(Jd.joinWebProxyAP(o.sid,{lts:s,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:t.code,eventType:n.cloudProxyServer}),Ul.warning(To(r=To(i=To(a="[".concat(n.clientId,"] proxy ap server ")).call(a,e," failed, message: ")).call(i,t.message,", retry: ")).call(r,t.data.retry)),t.data.retry):(Jd.joinWebProxyAP(o.sid,{lts:s,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:t.code,eventType:n.cloudProxyServer}),!0));var r,i,a},i)}(r,e,t,n),allFailedhandler:()=>{throw Ul.error("[".concat(e.clientId,"] can not get proxy server after trying several times")),new xl(dl.CAN_NOT_GET_PROXY_SERVER)}}),!(i=o.addresses)||0===i.length)throw Ul.error("[".concat(e.clientId,"] can not get proxy server, empty proxy server list")),new xl(dl.CAN_NOT_GET_PROXY_SERVER,"empty proxy server list");return{addresses:Ka(i).call(i,e=>e.ip),serverResponse:{tcpport:i[0].port||443,udpport:i[0].port||Xc.udpport,username:Xc.username,password:Xc.password}}}if(r=null,r=await xd({fragementLength:el.FRAGEMENT_LENGTH,referenceList:s,asyncMapHandler:r=>function(e,t,n,r){const i=wd(),s={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,uid:t.uid,cname:t.cname,ts:Math.floor(wd()/1e3),version:Yc,seq:0,requestId:1};return yt(async()=>({res:await mt(e,{data:{service_name:"webrtc_proxy",json_body:cr(s)},cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}}),url:e}),e=>{if(!e.res.json_body)throw Ul.debug("[".concat(t.clientId,"] Get proxy server failed: no json_body")),new xl(dl.UNEXPECTED_RESPONSE,cr(e.res));const n=JSON.parse(e.res.json_body);var r,i;if(200!==n.code)throw Ul.debug(To(r=To(i="[".concat(t.clientId,"] Get proxy server failed: response code [")).call(i,n.code,"], reason [")).call(r,n.reason,"]")),new xl(dl.UNEXPECTED_RESPONSE,cr(e.res));return Ul.debug("[".concat(t.clientId,"] App return server length"),n.servers.length),!1},t=>t.code!==dl.OPERATION_ABORTED&&(Jd.requestProxyAppCenter(s.sid,{lts:i,succ:!1,APAddr:e,workerManagerList:null,ec:t.code,response:t.message}),!0),r)}(r,e,t,n),allFailedhandler:()=>{throw Ul.error("[".concat(e.clientId,"] can not get proxy server after trying several times")),new xl(dl.CAN_NOT_GET_PROXY_SERVER)}}),s=JSON.parse(r.res.json_body),s=Ka(o=s.servers).call(o,Fe),"443only"===e.cloudProxyServer)return{addresses:s,serverResponse:{tcpport:443,udpport:Xc.udpport,username:Xc.username,password:Xc.password}};Jd.requestProxyAppCenter(e.sid,{lts:i,succ:!0,APAddr:r.url,workerManagerList:cr(s),ec:null,response:cr(r.res)}),i=wd(),o=Ka(s).call(s,r=>function(e,t,n,r){const i=wd();let s=e;Pc(e).call(e,"http")||(s="https://".concat(e,":4000/v2/machine"));const o={command:"request",gatewayType:"http",appId:t.appId,cname:t.cname,uid:(t.uid||"").toString(),sdkVersion:"2.3.1",sid:t.sid,seq:1,ts:wd(),requestId:3,clientRequest:{appId:t.appId,cname:t.cname,uid:(t.uid||"").toString(),sid:t.sid}};return yt(async()=>({res:await mt(s,{data:o,cancelToken:n}),url:e}),e=>{if(!e.res.serverResponse)throw new xl(dl.UNEXPECTED_RESPONSE,"requeet worker manager server failed: serverResponse is undefined");return!1},t=>t.code!==dl.OPERATION_ABORTED&&(Jd.requestProxyWorkerManager(o.sid,{lts:i,succ:!1,workerManagerAddr:e,ec:t.code,response:t.message}),!0),r)}(r,e,t,n)),r=null;try{r=await Je(o)}catch(a){throw Ul.error("[".concat(e.clientId,"] can not get worker manager after trying several times")),new xl(dl.CAN_NOT_GET_PROXY_SERVER)}return Ds(o).call(o,e=>e.cancel()),Jd.requestProxyWorkerManager(e.sid,{lts:i,succ:!0,workerManagerAddr:r.url,ec:null,response:cr(r.res)}),{addresses:[r.url],serverResponse:r.res.serverResponse}}(e,t,n);"443only"===e.cloudProxyServer?e.proxyServer=el.PROXY_SERVER_TYPE2:"proxy3"!==e.cloudProxyServer&&"proxy4"!==e.cloudProxyServer&&"proxy5"!==e.cloudProxyServer||(e.proxyServer=el.PROXY_SERVER_TYPE3),Jd.setProxyServer(e.proxyServer),Ul.setProxyServer(e.proxyServer),"normal"===e.cloudProxyServer&&(e.proxyServer=o.addresses[0],Jd.setProxyServer(e.proxyServer),Ul.setProxyServer(e.proxyServer)),e.turnServer={mode:"manual",servers:Ka(r=o.addresses).call(r,t=>({turnServerURL:t,tcpport:"proxy3"===e.cloudProxyServer?void 0:o.serverResponse.tcpport?o.serverResponse.tcpport:Xc.tcpport,udpport:"proxy4"===e.cloudProxyServer?void 0:o.serverResponse.udpport?o.serverResponse.udpport:Xc.udpport,username:o.serverResponse.username||Xc.username,password:o.serverResponse.password||Xc.password,forceturn:"proxy4"!==e.cloudProxyServer&&"proxy5"!==e.cloudProxyServer,security:"proxy5"===e.cloudProxyServer}))},Ul.debug(To(i=To(s="[".concat(e.clientId,"] set proxy server: ")).call(s,e.proxyServer,", mode: ")).call(i,e.cloudProxyServer))}}(i,this._axiosCancelSource.token,this._config.httpRetryConfig||eh),i.stringUid&&!i.uid){var c;let e=await Lt(i.stringUid,i,this._axiosCancelSource.token,this._config.httpRetryConfig||eh);Ul.debug(To(c="getUserAccount Success ".concat(i.stringUid," => ")).call(c,e)),i.uid=e}this._configDistribute.startGetConfigDistribute(i,this._axiosCancelSource.token),this._configDistribute.on(Du.UPDATE_BITRATE_LIMIT,e=>{this._highStream&&this._highStream.handleUpdateBitrateLimit(e.uplink),e.low_stream_uplink&&this._lowStream&&this._lowStream.handleUpdateBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})});let r=await Pt(i,this._axiosCancelSource.token,this._config.httpRetryConfig||eh);this._key=n||e,this._joinInfo=un({},i,{cid:r.gatewayInfo.cid,uid:i.uid?i.uid:r.gatewayInfo.uid,vid:r.gatewayInfo.vid,apResponse:r.gatewayInfo.res,uni_lbs_ip:r.gatewayInfo.uni_lbs_ip,gatewayAddrs:r.gatewayInfo.gatewayAddrs});let s=await this._gateway.join(this._joinInfo,this._key);return o.onSuccess(s),this._appId=e,this._channelName=i.cname,this._uid=s,this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener("beforeunload",this._handleBeforeUnload),Ul.info(To(a="[".concat(this._clientId,"] Joining channel success: ")).call(a,t)),zd(()=>{Ul.startUpload()},5e3),s}catch(l){throw e=hl(l)?l[0]:l,Ul.error("[".concat(this._clientId,"] Joining channel failed, rollback"),e),e.code!==dl.OPERATION_ABORTED&&(this._gateway.state="DISCONNECTED",this._reset()),o.onError(e),e}}async leave(){let e=Jd.reportApiInvoke(this._sessionId,{name:Wl.LEAVE,options:[],tag:Kl.TRACER});Ul.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener("beforeunload",this._handleBeforeUnload),this._reset();let t=await this._leaveMutex.lock();if("DISCONNECTED"===this.connectionState)return Ul.info("[".concat(this._clientId,"] Leaving channel repeated, success")),t(),e.onSuccess();await this._gateway.leave("CONNECTED"!==this.connectionState),Ul.info("[".concat(this._clientId,"] Leaving channel success")),t(),e.onSuccess()}async publish(e,t=!0){var n,r;hl(e)||(e=[e]);let i=Jd.reportApiInvoke(this._sessionId,{name:Wl.PUBLISH,options:Ka(e).call(e,e=>e?Object(e).toString():"null"),tag:Kl.TRACER});if(0===e.length)return e=new xl(dl.INVALID_PARAMS,"track list is empty"),i.onError(e),e.throw();if("live"===this._mode&&"audience"===this._gateway.role)return e=new xl(dl.INVALID_OPERATION,"audience can not publish stream"),i.onError(e),e.throw();for(let o of e){if(!(o instanceof sh))return e=new xl(dl.INVALID_PARAMS,"pamameter is not local track"),i.onError(e),e.throw();if(!o._enabled&&t)return e=new xl(dl.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(o.getTrackId())),i.onError(e),e.throw()}Ul.info(To(n="[".concat(this._clientId,"] Publishing tracks, id ")).call(n,Ka(e).call(e,e=>"".concat(e.getTrackId()," ")))),await this._configDistribute.awaitConfigDistributeComplete(),t&&Ds(e).call(e,e=>{var t;let n=this._configDistribute.getBitrateLimit();e instanceof hp&&n&&e.setBitrateLimit(n.uplink),-1===nc(t=this._bindEnabledTracks).call(t,e)&&(e.addListener(Cu.NEED_ADD_TRACK,this._handleLocalTrackEnable),e.addListener(Cu.NEED_REMOVE_TRACK,this._handleLocalTrackDisable),this._bindEnabledTracks.push(e))}),n=await this._publishMutex.lock();try{let t=(await this._publishHighStream(e)).videoTrack;this._isDualStreamEnabled&&t&&!this._lowStream&&await this._publishLowStream(t),n(),i.onSuccess()}catch(s){throw n(),t&&Ds(e).call(e,e=>{var t,n;let r=nc(t=this._bindEnabledTracks).call(t,e);-1!==r&&(e.off(Cu.NEED_ADD_TRACK,this._handleLocalTrackEnable),e.off(Cu.NEED_REMOVE_TRACK,this._handleLocalTrackDisable),Qa(n=this._bindEnabledTracks).call(n,r,1))}),i.onError(s),Ul.error("[".concat(this._clientId,"] publish error"),s.toString()),s}Ul.info(To(r="[".concat(this._clientId,"] Publish success, id ")).call(r,Ka(e).call(e,e=>"".concat(e.getTrackId()," "))))}async unpublish(e,t=!0){var n,r,i;if(!this._highStream)return void Ul.warning("[".concat(this._clientId,"] Could not find tracks to unpublish"));var s=this._highStream.getAllTracks();e?hl(e)||(e=[e]):e=this._highStream.getAllTracks(),s=function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1){const r=e[n];if(Io(e).call(e,e=>e===r).length!==Io(t).call(t,e=>e===r).length)return!1}return!0}(s,e);let o=Jd.reportApiInvoke(this._sessionId,{name:Wl.UNPUBLISH,options:Ka(e).call(e,e=>e.getTrackId()),tag:Kl.TRACER});if(Ul.info(To(n=To(r="[".concat(this._clientId,"] Unpublish tracks, tracks ")).call(r,Ka(e).call(e,e=>"".concat(e.getTrackId()," ")),", isClosePC: ")).call(n,s)),n=s?void 0:await this._publishMutex.lock(),!this._highStream)return Ul.warning("[".concat(this._clientId,"] Could not find tracks to unpublish")),void(n&&n());try{this._lowStream&&0<Io(e).call(e,e=>"video"===e.trackMediaType).length&&(await this._lowStream.closeP2PConnection(),this._lowStream=void 0),s?await this._highStream.closeP2PConnection():await this._highStream.removeTracks(e,t),n&&n()}catch(a){if(a.code!==dl.OPERATION_ABORTED)throw o.onError(a),Ul.error("[".concat(this._clientId,"] unpublish error"),a.toString()),n&&n(),a;Ul.debug("[".concat(this._clientId,"] ignore unpub operation abort")),n&&n()}this._highStream&&"disconnected"===this._highStream.connectionState&&(this._highStream=void 0,this._lowStream=void 0),t&&Ds(e).call(e,e=>{var t,n;let r=nc(t=this._bindEnabledTracks).call(t,e);-1!==r&&(e.off(Cu.NEED_ADD_TRACK,this._handleLocalTrackEnable),e.off(Cu.NEED_REMOVE_TRACK,this._handleLocalTrackDisable),Qa(n=this._bindEnabledTracks).call(n,r,1))}),Ul.info(To(i="[".concat(this._clientId,"] Unpublish success,tracks ")).call(i,Ka(e).call(e,e=>"".concat(e.getTrackId())))),o.onSuccess()}async subscribe(e,t){var n,r,i,s;ge(t,"mediaType",["audio","video"]);let o=Jd.reportApiInvoke(this._sessionId,{name:Wl.SUBSCRIBE,options:[e.uid,t],tag:Kl.TRACER});if(!this._joinInfo)throw t=new xl(dl.INVALID_OPERATION,"Can't subscribe stream, not joined"),o.onError(t),t;if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw t=new xl(dl.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state")),o.onError(t),t;var a,c;if(!hc(n=this._users).call(n,t=>t===e))throw t=new xl(dl.INVALID_REMOTE_USER,"user is not in the channel"),Ul.error(To(a="[".concat(this._clientId,"] can not subscribe ")).call(a,e.uid,", this user is not in the channel")),o.onError(t),t;if(!e.hasAudio&&!e.hasVideo)throw t=new xl(dl.INVALID_REMOTE_USER,"user is not published"),Ul.error(To(c="[".concat(this._clientId,"] can not subscribe ")).call(c,e.uid,", user is not published")),o.onError(t),t;if(a={audio:"audio"===t,video:"video"===t},!e.hasAudio&&a.audio||!e.hasVideo&&a.video){var l,u,d=new xl(dl.REMOTE_USER_IS_NOT_PUBLISHED);throw Ul.error(To(l=To(u="[".concat(this._clientId,"] can not subscribe ")).call(u,e.uid," with mediaType ")).call(l,t,", remote track is not published")),o.onError(d),d}(l=this._subscribeMutex.get(e.uid))||(l=new Bd("sub-".concat(e.uid)),this._subscribeMutex.set(e.uid,l)),Ul.info(To(r=To(i="[".concat(this._clientId,"] subscribe user ")).call(i,e.uid,", mediaType: ")).call(r,t)),r=await l.lock(),i=this._remoteStream.get(e.uid);try{if(i)a.audio=a.audio||i.subscribeOptions.audio,a.video=a.video||i.subscribeOptions.video,await this._gateway.subscribeChange(i,a);else{i=new yp(e,this._statsCollector,this._joinInfo,a),this._remoteStream.set(e.uid,i);try{await this._gateway.subscribe(i)}catch(p){throw this._remoteStream.delete(e.uid),p}i.on(ou.CONNECTION_STATE_CHANGE,(t,n)=>{"connecting"===t?this.emit(Zl.MEDIA_RECONNECT_START,e.uid):"connected"===t&&this.emit(Zl.MEDIA_RECONNECT_END,e.uid)})}r()}catch(p){var h;throw o.onError(p),r(),Ul.error(To(h="[".concat(this._clientId,"] subscribe user ")).call(h,e.uid," error"),p),p}return Ul.info(To(d=To(s="[".concat(this._clientId,"] subscribe success user ")).call(s,e.uid,", mediaType: ")).call(d,t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(e=>{Ul.warning("[".concat(this._clientId,"] auto set fallback failed"),e)}),(t="audio"===t?e.audioTrack:e.videoTrack)?(o.onSuccess(t.getTrackId()),t):(t=new xl(dl.UNEXPECTED_ERROR,"can not find remote track in user object"),o.onError(t),t.throw())}async unsubscribe(e,t){var n,r,i,s,o;t&&ge(t,"mediaType",["audio","video"]);let a=Jd.reportApiInvoke(this._sessionId,{name:Wl.UNSUBSCRIBE,options:[e.uid,t],tag:Kl.TRACER});var c,l;if(!hc(n=this._users).call(n,t=>t===e))throw t=new xl(dl.INVALID_REMOTE_USER,"user is not in the channel"),Ul.error(To(c="[".concat(this._clientId,"] can not subscribe ")).call(c,e.uid,", user is not in the channel")),a.onError(t),t;if(Ul.info(To(r=To(i="[".concat(this._clientId,"] unsubscribe uid: ")).call(i,e.uid,", mediaType: ")).call(r,t)),(c=this._subscribeMutex.get(e.uid))||(c=new Bd("sub-".concat(e.uid)),this._subscribeMutex.set(e.uid,c)),c=await c.lock(),!(n=this._remoteStream.get(e.uid)))return Ul.warning(To(l="[".concat(this._clientId,"]: you have not subscribe the remote user ")).call(l,e.uid)),a.onSuccess(),void c();l=un({},n.subscribeOptions),"audio"===t?l.audio=!1:"video"===t?(l.video=!1,n.pc._statsFilter.setVideoIsReady(!1)):(l.audio=!1,l.video=!1);try{l.audio||l.video?await this._gateway.subscribeChange(n,l):(await n.closeP2PConnection(),this._remoteStream.delete(e.uid)),c()}catch(d){var u;if(d.code!==dl.OPERATION_ABORTED)throw a.onError(d),c(),Ul.error(To(u="[".concat(this._clientId,"] unsubscribe user ")).call(u,e.uid," error"),d.toString()),d;c(),Ul.debug("[".concat(this._clientId,"] ignore unsub operation abort"))}Ul.info(To(s=To(o="[".concat(this._clientId,"] unsubscribe success uid: ")).call(o,e.uid,", mediaType: ")).call(s,t)),a.onSuccess()}setLowStreamParameter(e){if(!e)throw new xl(dl.INVALID_PARAMS);null==e.width||Ee(e.width,"streamParameter.width"),null==e.height||Ee(e.height,"streamParameter.height"),null==e.framerate||Ee(e.framerate,"streamParameter.framerate"),null==e.bitrate||Ee(e.bitrate,"streamParameter.bitrate");let t=Jd.reportApiInvoke(this._sessionId,{name:Wl.SET_LOW_STREAM_PARAMETER,options:[e],tag:Kl.TRACER});(!e.width&&e.height||e.width&&!e.height)&&Ul.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),Ul.info("[".concat(this._clientId,"] set low stream parameter to"),cr(e));let n=this._configDistribute.getLowStreamConfigDistribute();n&&n.bitrate&&e.bitrate&&n.bitrate<e.bitrate&&(e.bitrate=n.bitrate),this._lowStreamParameter=e,t.onSuccess()}async enableDualStream(){let e=Jd.reportApiInvoke(this._sessionId,{name:Wl.ENABLE_DUAL_STREAM,options:[],tag:Kl.TRACER});if(!Pu.supportDualStream){Jd.streamSwitch(this._sessionId,{lts:wd(),isdual:!0,succ:!1});var t=new xl(dl.NOT_SUPPORTED,"Your browser is not support dual stream");throw e.onError(t),t}if(this._isDualStreamEnabled)throw t=new xl(dl.INVALID_OPERATION,"Dual stream is already enabled"),e.onError(t),t;if(this._highStream&&"connected"===this._highStream.connectionState&&this._highStream.videoTrack)try{await this._publishLowStream(this._highStream.videoTrack)}catch(n){throw Jd.streamSwitch(this._sessionId,{lts:wd(),isdual:!0,succ:!1}),e.onError(n),n}this._isDualStreamEnabled=!0,Jd.streamSwitch(this._sessionId,{lts:wd(),isdual:!0,succ:!0}),Ul.info("[".concat(this._clientId,"] enable dual stream")),e.onSuccess()}async disableDualStream(){let e=Jd.reportApiInvoke(this._sessionId,{name:Wl.DISABLE_DUAL_STREAM,options:[],tag:Kl.TRACER});if(this._lowStream)try{await this._lowStream.closeP2PConnection()}catch(t){throw Jd.streamSwitch(this._sessionId,{lts:wd(),isdual:!1,succ:!1}),e.onError(t),t}this._lowStream=void 0,this._isDualStreamEnabled=!1,this._highStream&&(this._highStream.lowStreamConnection=void 0),Jd.streamSwitch(this._sessionId,{lts:wd(),isdual:!1,succ:!0}),Ul.info("[".concat(this._clientId,"] disable dual stream")),e.onSuccess()}async setClientRole(e,t){ge(e,"role",["audience","host"]),t&&be(t);let n=Jd.reportApiInvoke(this._sessionId,{name:Wl.SET_CLIENT_ROLE,options:[e,t],tag:Kl.TRACER});if("rtc"===this._mode)return Ul.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),e=new xl(dl.INVALID_OPERATION,"rtc mode can not use setClientRole"),n.onError(e),e.throw();if(t&&t.level&&"host"===e)return e=new xl(dl.INVALID_OPERATION,"host mode can not set audience latency level"),n.onError(e),e.throw();try{var r,i;if("audience"===e&&this._highStream){let e=new xl(dl.INVALID_OPERATION,"can not set client role to audience when publishing stream");return n.onError(e),e.throw()}await this._gateway.setClientRole(e,t),Ul.info(To(r=To(i="[".concat(this._clientId,"] set client role to ")).call(i,e,", level: ")).call(r,t&&t.level)),n.onSuccess()}catch(s){throw n.onError(s),s}}setProxyServer(e){ve(e,"proxyServer");let t=Jd.reportApiInvoke(this._sessionId,{name:Wl.SET_PROXY_SERVER,options:[e],tag:Kl.TRACER});if("DISCONNECTED"!==this.connectionState)throw new xl(dl.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode)throw new xl(dl.INVALID_OPERATION,"You have already set the proxy");this._proxyServer=e,Jd.setProxyServer(this._proxyServer),Ul.setProxyServer(this._proxyServer),t.onSuccess()}setTurnServer(e){if(hl(e)||(e=[e]),"DISCONNECTED"!==this.connectionState)throw new xl(dl.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode)throw new xl(dl.INVALID_OPERATION,"You have already set the proxy");var t;if(Ae(e))return this._turnServer={servers:e,mode:"original-manual"},void Ul.info(To(t="[".concat(this._clientId,"] Set original turnserver success: ")).call(t,Ka(e).call(e,e=>e.urls).join(","),"."));Ds(e).call(e,e=>we(e)),this._turnServer={servers:e,mode:"manual"},Ul.info("[".concat(this._clientId,"] Set turnserver success."))}startProxyServer(e){let t=Jd.reportApiInvoke(this._sessionId,{name:Wl.START_PROXY_SERVER,options:[],tag:Kl.TRACER});if("DISCONNECTED"!==this.connectionState)throw e=new xl(dl.INVALID_OPERATION,"Start proxy server before join channel"),t.onError(e),e;if(this._proxyServer||"manual"===this._turnServer.mode)throw e=new xl(dl.INVALID_OPERATION,"You have already set the proxy"),t.onError(e),e;let n=[1,2,3,4,5];switch(void 0===e&&(e=1),e){case 1:this._cloudProxyServerMode="normal";break;case 2:this._cloudProxyServerMode="443only";break;case 3:this._cloudProxyServerMode="proxy3";break;case 4:this._cloudProxyServerMode="proxy4";break;case 5:this._cloudProxyServerMode="proxy5";break;default:throw e=new xl(dl.INVALID_PARAMS,"proxy server mode must be ".concat(n.join("|"))),t.onError(e),e}Ul.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),t.onSuccess()}stopProxyServer(){let e=Jd.reportApiInvoke(this._sessionId,{name:Wl.STOP_PROXY_SERVER,options:[],tag:Kl.TRACER});if("DISCONNECTED"!==this.connectionState)throw new xl(dl.INVALID_OPERATION,"Stop proxy server after leave channel");Jd.setProxyServer(),Ul.setProxyServer(),this._cloudProxyServerMode="disabled",Ul.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]},e.onSuccess()}async setRemoteVideoStreamType(e,t){var n,r;ge(t,"streamType",[0,1]);let i=Jd.reportApiInvoke(this._sessionId,{name:Wl.SET_REMOTE_VIDEO_STREAM_TYPE,options:[e,t],tag:Kl.TRACER});try{await this._gateway.setRemoteVideoStreamType(e,t),zd(()=>{var t;let n=hc(t=this._users).call(t,t=>t.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw i.onError(s),Ul.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}Ul.info(To(n=To(r="[".concat(this._clientId,"] set remote ")).call(r,e," video stream type to ")).call(n,t)),this._remoteStreamTypeCacheMap.set(e,t),i.onSuccess()}async setStreamFallbackOption(e,t){var n,r;ge(t,"fallbackType",[0,1,2]);let i=Jd.reportApiInvoke(this._sessionId,{name:Wl.SET_STREAM_FALLBACK_OPTION,options:["too long to show",t],tag:Kl.TRACER});try{await this._gateway.setStreamFallbackOption(e,t)}catch(s){throw i.onError(s),Ul.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}Ul.info(To(n=To(r="[".concat(this._clientId,"] set remote ")).call(r,e," stream fallback type to ")).call(n,t)),this._streamFallbackTypeCacheMap.set(e,t),i.onSuccess()}setEncryptionConfig(e,t,n){ge(e,"encryptionMode","aes-128-xts aes-256-xts aes-128-ecb sm4-128-ecb aes-128-gcm aes-256-gcm aes-128-gcm2 aes-256-gcm2 none".split(" ")),ve(t,"secret");let r=["aes-128-gcm2","aes-256-gcm2"];if(Rc(r).call(r,e)){if(!(n&&n instanceof Uint8Array&&32===n.length))throw new xl(dl.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new xl(dl.INVALID_PARAMS,"current encrypt mode does not need salt");/^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\[\]])(?=.{8,})/.test(t)||Ul.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=at(n))}async renewToken(e){ve(e,"token",1,2047);let t=Jd.reportApiInvoke(this._sessionId,{name:Wl.RENEW_TOKEN,options:[e],tag:Kl.TRACER});if(!this._key)return e=new xl(dl.INVALID_OPERATION,"renewToken should not be called before user join"),t.onError(e),e.throw();this._key=e;try{await this._gateway.renewToken(e)}catch(n){throw t.onError(n),Ul.error("[".concat(this._clientId,"] renewToken failed"),n.toString()),n}Ul.debug("[".concat(this._clientId,"] renewToken success")),t.onSuccess()}enableAudioVolumeIndicator(){let e=Jd.reportApiInvoke(this._sessionId,{name:Wl.ENABLE_AUDIO_VOLUME_INDICATOR,options:[],tag:Kl.TRACER});if(this._audioVolumeIndicationInterval)return Ul.warning("you have already enabled audio volume indicator!"),e.onSuccess();this._audioVolumeIndicationInterval=window.setInterval(()=>{var e,t,n;let r=ul(e=Ka(t=Ad(Id(n=this._remoteStream).call(n))).call(t,e=>({level:e.user.audioTrack?100*e.user.audioTrack._source.getAudioAvgLevel():0,uid:e.getUserId()}))).call(e,(e,t)=>e.level-t.level);this._highStream&&this._highStream.audioTrack&&(r.push({level:100*this._highStream.audioTrack._source.getAudioAvgLevel(),uid:this._highStream._userId}),r=ul(r).call(r,(e,t)=>e.level-t.level)),this.emit(Zl.VOLUME_INDICATOR,r)},el.AUDIO_VOLUME_INDICATION_INTERVAL||2e3),e.onSuccess()}getRTCStats(){let e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}startLiveStreaming(e,t){let n=Jd.reportApiInvoke(this._sessionId,{name:Wl.START_LIVE_STREAMING,options:[e,t],tag:Kl.TRACER});if(!t){if("h264"!==this._codec)return e=new xl(dl.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264"),n.onError(e),Ga.reject(e);if(!this._highStream)return e=new xl(dl.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming"),n.onError(e),Ga.reject(e)}return this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e)?(e=new xl(dl.LIVE_STREAMING_TASK_CONFLICT),n.onError(e),Ga.reject(e)):this._createLiveStreamingClient(t=t?fu.TRANSCODE:fu.RAW).startLiveStreamingTask(e,t).then(()=>n.onSuccess()).catch(e=>{throw n.onError(e),e})}setLiveTranscoding(e){let t=Jd.reportApiInvoke(this._sessionId,{name:Wl.SET_LIVE_TRANSCODING,options:[e],tag:Kl.TRACER});return this._createLiveStreamingClient(fu.TRANSCODE).setTranscodingConfig(e).then(()=>t.onSuccess()).catch(e=>{throw t.onError(e),e})}stopLiveStreaming(e){var t;let n=Jd.reportApiInvoke(this._sessionId,{name:Wl.STOP_LIVE_STREAMING,options:[e],tag:Kl.TRACER}),r=Io(t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient]).call(t,t=>t&&t.hasUrl(e));return r.length?Ga.all(Ka(r).call(r,t=>t&&t.stopLiveStreamingTask(e))).then(()=>n.onSuccess()).catch(e=>{throw n.onError(e),e}):(t=new xl(dl.INVALID_PARAMS,"can not find live streaming url to stop"),n.onError(t),Ga.reject(t))}async addInjectStreamUrl(e,t){let n=Jd.reportApiInvoke(this._sessionId,{name:Wl.ADD_INJECT_STREAM_URL,options:[e,t],tag:Kl.TRACER});try{if(!this._joinInfo)throw new xl(dl.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");let n=this._createLiveStreamingClient(fu.INJECT);n.setInjectStreamConfig(t,0),await n.startLiveStreamingTask(e,fu.INJECT)}catch(r){throw n.onError(r),r}n.onSuccess()}async removeInjectStreamUrl(){let e=Jd.reportApiInvoke(this._sessionId,{name:Wl.REMOVE_INJECT_STREAM_URL,options:[],tag:Kl.TRACER});try{var t,n;let e=this._createLiveStreamingClient(fu.INJECT),r=hc(t=Ad(Id(n=e.streamingTasks).call(n))).call(t,e=>e.mode===fu.INJECT);if(!this._joinInfo||!r)throw new xl(dl.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await e.stopLiveStreamingTask(r.url)}catch(r){throw e.onError(r),r}e.onSuccess()}async startChannelMediaRelay(e){let t=Jd.reportApiInvoke(this._sessionId,{name:Wl.START_CHANNEL_MEDIA_RELAY,options:[e],tag:Kl.TRACER});try{cn(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}catch(n){return t.onError(n),n.throw()}t.onSuccess()}async updateChannelMediaRelay(e){let t=Jd.reportApiInvoke(this._sessionId,{name:Wl.UPDATE_CHANNEL_MEDIA_RELAY,options:[e],tag:Kl.TRACER});try{cn(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}catch(n){return t.onError(n),n.throw()}t.onSuccess()}async stopChannelMediaRelay(){let e=Jd.reportApiInvoke(this._sessionId,{name:Wl.STOP_CHANNEL_MEDIA_RELAY,options:[],tag:Kl.TRACER});try{await this._createChannelMediaRelayClient().stopChannelMediaRelay()}catch(t){return e.onError(t),t.throw()}e.onSuccess()}sendStreamMessage(e){if(!this._joinInfo)throw new xl(dl.INVALID_OPERATION,"can not send data stream, not joined");if("string"==typeof e&&(e=(new TextEncoder).encode(e)),1024<new Blob([e]).size)throw new xl(dl.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(ru.DATA_STREAM,{payload:at(e)})}sendMetadata(e){if(!this._joinInfo)throw new xl(dl.INVALID_OPERATION,"can not send metadata, not joined");if(1024<new Blob([e]).size)throw new xl(dl.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ru.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:at(e)})}async sendCustomReportMessage(e){hl(e)||(e=[e]),Ds(e).call(e,Ie);let t=Jd.reportApiInvoke(this._sessionId,{name:Wl.SEND_CUSTOM_REPORT_MESSAGE,options:[],tag:Kl.TRACER});if(!this._joinInfo)return e=new xl(dl.INVALID_OPERATION,"can not send custom report, not joined"),t.onError(e),e.throw();await Jd.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._highStream?this._statsCollector.getLocalAudioTrackStats(this._highStream.connectionId):cu}getRemoteAudioStats(){var e;let t={};return Ds(e=this._remoteStream).call(e,(e,n)=>{t[n]=this._statsCollector.getRemoteAudioTrackStats(e.connectionId)}),t}getLocalVideoStats(){return this._highStream?this._statsCollector.getLocalVideoTrackStats(this._highStream.connectionId):lu}getRemoteVideoStats(){var e;let t={};return Ds(e=this._remoteStream).call(e,(e,n)=>{t[n]=this._statsCollector.getRemoteVideoTrackStats(e.connectionId)}),t}getRemoteNetworkQuality(){var e;let t={};return Ds(e=this._remoteStream).call(e,(e,n)=>{t[n]=this._statsCollector.getRemoteNetworkQualityStats(e.connectionId)}),t}async pickSVCLayer(e,t){ge(t.spatialLayer,"spatialLayer",[0,1,2,3]),ge(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw Ul.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}_reset(){var e,t,n;Ul.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Pl.CancelToken.source(),this._streamFallbackTypeCacheMap=new _s,this._remoteStreamTypeCacheMap=new _s,this._configDistribute.stopGetConfigDistribute(),this._defaultStreamFallbackType=this._proxyServer=this._joinInfo=void 0,this._sessionId=null,this._statsCollector.reset(),this._channelName=this._uid=this._appId=this._key=void 0,Ds(e=this._users).call(e,e=>{e.audioTrack&&(e.audioTrack.stop(),e.audioTrack._isDestroyed=!0),e.videoTrack&&(e.videoTrack.stop(),e.videoTrack._isDestroyed=!0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._highStream&&(this._highStream.closeP2PConnection(!0),this._highStream=void 0),Ds(t=this._bindEnabledTracks).call(t,e=>{e.off(Cu.NEED_ADD_TRACK,this._handleLocalTrackEnable),e.off(Cu.NEED_REMOVE_TRACK,this._handleLocalTrackDisable)}),this._bindEnabledTracks=[],this._lowStream&&(this._lowStream.closeP2PConnection(!0),this._lowStream=void 0),Ds(n=this._remoteStream).call(n,e=>{e.closeP2PConnection(!0)}),this._remoteStream=new _s,this._publishMutex=new Bd("client-publish"),this._subscribeMutex=new _s,this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0)}_startSession(e,t){var n,r,i;let s=e||Xe(32,"").toUpperCase();Ul.debug(e?To(n="[".concat(this._clientId,"] new Session ")).call(n,s):To(r=To(i="[".concat(this._clientId,"] renewSession ")).call(i,this._sessionId," => ")).call(r,s)),this._sessionId=s,t?Jd.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:t.channel,appid:t.appId,mode:this._mode}):this._joinInfo?Jd.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this._mode}):this._gateway.joinInfo&&Jd.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this._mode}),this._joinInfo&&(this._joinInfo.sid=s),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=s)}async _publishHighStream(e){if(!this._joinInfo)throw new xl(dl.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new xl(dl.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&el.FORCE_TURN&&!el.TURN_ENABLE_TCP&&!el.TURN_ENABLE_UDP)throw new xl(dl.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");if(Ul.debug("[".concat(this._clientId,"] publish high stream")),this._highStream)return await this._highStream.addTracks(e),this._highStream;this._highStream=new vp(this._statsCollector,this._joinInfo,this._codec),await this._highStream.addTracks(e);try{await this._gateway.publish(this._highStream,"high")}catch(t){throw this._highStream=void 0,t}return this._highStream.on(ou.CONNECTION_STATE_CHANGE,(e,t)=>{this._highStream&&("connected"===e?this.emit(Zl.MEDIA_RECONNECT_END,this._highStream.getUserId()):"connecting"===e&&this.emit(Zl.MEDIA_RECONNECT_START,this._highStream.getUserId()))}),this._highStream}async _publishLowStream(e){if(!this._joinInfo)throw new xl(dl.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new xl(dl.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(!this._highStream||"connected"!==this._highStream.connectionState)throw new xl(dl.UNEXPECTED_ERROR,"Could not find high stream");if(this._lowStream)return new xl(dl.UNEXPECTED_ERROR,"[".concat(this._clientId,"] Can't publish low stream when stream already publish")).throw();Ul.debug("[".concat(this._clientId,"] publish low stream")),this._lowStream=new vp(this._statsCollector,this._joinInfo,this._codec,!0);let t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate)),this._lowStream.lowStreamParameter=this._lowStreamParameter,await this._lowStream.addTracks([e]);try{await this._gateway.publish(this._lowStream,"low")}catch(n){throw this._lowStream=void 0,n}this._highStream.lowStreamConnection=this._lowStream}_createLiveStreamingClient(e){if(!this._joinInfo||!this._appId)return new xl(dl.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let t=()=>new Cp(this._joinInfo,this._config.websocketRetryConfig||eh,this._config.httpRetryConfig||eh),n=e=>{e.onLiveStreamError=(e,t)=>{Jd.reportApiInvoke(this._sessionId,{name:Wl.ON_LIVE_STREAM_ERROR,options:[e,t],tag:Kl.TRACER}).onSuccess(),this.emit(Zl.LIVE_STREAMING_ERROR,e,t)},e.onLiveStreamWarning=(e,t)=>{Jd.reportApiInvoke(this._sessionId,{name:Wl.ON_LIVE_STREAM_WARNING,options:[e,t],tag:Kl.TRACER}).onSuccess(),this.emit(Zl.LIVE_STREAMING_WARNING,e,t)},e.on(Su.REQUEST_WORKER_MANAGER_LIST,(e,t,n)=>{if(!this._joinInfo)return n(new xl(dl.INVALID_OPERATION,"can not find join info to get worker manager"));Mt(e,this._joinInfo,this._axiosCancelSource.token,eh).then(t).catch(n)})};switch(e){case fu.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=t(),n(this._liveRawStreamingClient)),this._liveRawStreamingClient;case fu.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=t(),n(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case fu.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=t(),this._injectStreamingClient.on(Su.REQUEST_WORKER_MANAGER_LIST,(e,t,n)=>{if(!this._joinInfo)return n(new xl(dl.INVALID_OPERATION,"can not find join info to get worker manager"));Mt(e,this._joinInfo,this._axiosCancelSource.token,eh).then(t).catch(n)}),this._injectStreamingClient.onInjectStatusChange=(e,t,n)=>{this.emit(Zl.INJECT_STREAM_STATUS,e,t,n)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){return this._joinInfo?(this._channelMediaRelayClient||(this._channelMediaRelayClient=new bp(this._joinInfo,this._clientId,this._config.websocketRetryConfig||eh,this._config.httpRetryConfig||eh),this._channelMediaRelayClient.on("state",e=>{"RELAY_STATE_FAILURE"===e&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.emit(Zl.CHANNEL_MEDIA_RELAY_STATE,e)}),this._channelMediaRelayClient.on("event",e=>{this.emit(Zl.CHANNEL_MEDIA_RELAY_EVENT,e)})),this._channelMediaRelayClient):new xl(dl.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw()}_handleGatewayEvents(){this._gateway.on(Iu.DISCONNECT_P2P,()=>{var e;Ul.debug("[".concat(this._clientId,"] start full reconnect")),this._highStream&&"disconnected"!==this._highStream.connectionState&&(Ul.debug("[".concat(this._clientId,"] ready to reconnect high stream")),this._highStream.readyToReconnectPC()),this._lowStream&&"disconnected"!==this._lowStream.connectionState&&(Ul.debug("[".concat(this._clientId,"] ready to reconnect low stream")),this._lowStream.readyToReconnectPC()),Ds(e=this._remoteStream).call(e,(e,t)=>{var n;Ul.debug(To(n="[".concat(this._clientId,"] ready to reconnect remote stream ")).call(n,t)),e.readyToReconnectPC()})}),this._gateway.on(Iu.CONNECTION_STATE_CHANGE,(e,t,n)=>{var r,i;let s=()=>{this.emit(Zl.CONNECTION_STATE_CHANGE,e,t,n)};if(Ul.info(To(r=To(i="[".concat(this._clientId,"] connection state change: ")).call(i,t," -> ")).call(r,e)),"DISCONNECTED"===e)return this._reset(),void s();var o,a;if("RECONNECTING"===e)this._highStream&&"connecting"===this._highStream.connectionState&&(Ul.debug("[".concat(this._clientId,"] ready to reconnect high stream")),this._highStream.readyToReconnectPC()),this._lowStream&&"connecting"===this._lowStream.connectionState&&(Ul.debug("[".concat(this._clientId,"] ready to reconnect low stream")),this._lowStream.readyToReconnectPC()),Ds(o=this._remoteStream).call(o,(e,t)=>{var n;"connecting"===e.connectionState&&(Ul.debug(To(n="[".concat(this._clientId,"] ready to reconnect remote stream ")).call(n,t)),e.readyToReconnectPC())}),Ds(a=this._users).call(a,e=>{e._trust_in_room_=!1,e._trust_audio_enabled_state_=!1,e._trust_video_enabled_state_=!1,e._trust_audio_mute_state_=!1,e._trust_video_mute_state_=!1,e._trust_stream_added_state_=!1}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._streamRemovedTimeout=this._userOfflineTimeout=void 0;else if("CONNECTED"===e){var c,l;Ds(c=this._streamFallbackTypeCacheMap).call(c,(e,t)=>{this._gateway.setStreamFallbackOption(t,e).catch(e=>Ul.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),e))}),Ds(l=this._remoteStreamTypeCacheMap).call(l,(e,t)=>{this._gateway.setRemoteVideoStreamType(t,e).catch(e=>Ul.warning("[".concat(this._clientId,"] auto set remote stream type failed"),e))}),this._highStream&&"connecting"===this._highStream.connectionState?this._highStream.reconnectPC().then(()=>{this._lowStream&&"connecting"===this._lowStream.connectionState&&this._lowStream.reconnectPC().catch(e=>{Ul.error("[".concat(this._clientId,"] republish low stream error"),e.toString()),this.emit(Zl.ERROR,{reason:e})})}).catch(e=>{Ul.error("[".concat(this._clientId,"] republish high stream error"),e.toString()),this.emit(Zl.ERROR,{reason:e})}):this._lowStream&&"connecting"===this._lowStream.connectionState&&this._lowStream.reconnectPC().catch(e=>{Ul.error("[".concat(this._clientId,"] republish low stream error"),e.toString()),this.emit(Zl.ERROR,{reason:e})}),this._userOfflineTimeout=window.setTimeout(()=>{var e;if("CONNECTED"===this.connectionState){this._userOfflineTimeout=void 0;var t=Io(e=this._users).call(e,e=>!e._trust_in_room_);Ds(t).call(t,e=>{var t;Ul.debug(To(t="[".concat(this._clientId,"] user offline timeout, emit user offline ")).call(t,e.uid)),this._handleUserOffline({uid:e.uid})})}},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{var e;"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,Ds(e=this._users).call(e,e=>{var t,n,r,i,s;e._trust_audio_mute_state_||(Ul.debug(To(t="[".concat(this._clientId,"] auto dispatch audio unmute event ")).call(t,e.uid)),this._handleMuteStream(e.uid,"audio",!1)),e._trust_video_mute_state_||(Ul.debug(To(n="[".concat(this._clientId,"] auto dispatch video unmute event ")).call(n,e.uid)),this._handleMuteStream(e.uid,"video",!1)),e._trust_audio_enabled_state_||(Ul.debug(To(r="[".concat(this._clientId,"] auto dispatch enable local audio ")).call(r,e.uid)),this._handleSetStreamLocalEnable("audio",e.uid,!0)),!e._trust_video_enabled_state_&&e._video_enabled_&&(Ul.debug(To(i="[".concat(this._clientId,"] auto dispatch enable local video ")).call(i,e.uid)),this._handleSetStreamLocalEnable("video",e.uid,!0)),e._trust_stream_added_state_||(Ul.debug(To(s="[".concat(this._clientId,"] auto dispatch stream remove ")).call(s,e.uid)),this._handleRemoveStream({uid:e.uid,uint_id:e._uintid}))}))},1e3)}s()}),this._gateway.on(Iu.REQUEST_NEW_GATEWAY_LIST,(e,t)=>{if(!this._joinInfo)return t(new xl(dl.UNEXPECTED_ERROR,"can not recover, no join info"));Pt(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||eh).then(t=>{var n;this._joinInfo&&(this._joinInfo.apResponse=t.gatewayInfo.res),e(Ka(n=t.gatewayInfo.gatewayAddrs).call(n,e=>{var t,n;return this._joinInfo&&this._joinInfo.proxyServer?(e=e.split(":"),To(t=To(n="wss://".concat(this._joinInfo.proxyServer,"/ws/?h=")).call(n,e[0],"&p=")).call(t,e[1])):"wss://".concat(e)}))}).catch(t)}),this._gateway.on(Iu.NETWORK_QUALITY,e=>{"normal"===this._networkQualitySensitivity&&this.emit(Zl.NETWORK_QUALITY,e)}),this._gateway.on(Iu.STREAM_TYPE_CHANGE,(e,t)=>{this.emit(Zl.STREAM_TYPE_CHANGED,e,t),Jd.reportApiInvoke(this._sessionId,{name:Wl.STREAM_TYPE_CHANGE,options:[e,t],tag:Kl.TRACER}).onSuccess(cr({uid:e,streamType:t}))}),this._gateway.on(Iu.IS_P2P_DISCONNECTED,e=>{var t,n,r;let i=[];return this._highStream&&i.push(this._highStream),Ds(t=this._remoteStream).call(t,e=>i.push(e)),0===i.length||0===Io(i).call(i,e=>"connected"===e.connectionState).length?e(!0):(Ul.debug(To(n="[".concat(this._clientId,"] ")).call(n,Ka(r=Io(i).call(i,e=>"connected"===e.connectionState)).call(r,e=>e.connectionId)," is connected")),void e(!1))}),this._gateway.on(Iu.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.signal.on(su.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(su.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(su.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.uint_id)),this._gateway.signal.on(su.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.uint_id)),this._gateway.signal.on(su.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(su.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(su.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,"audio",!0)),this._gateway.signal.on(su.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,"audio",!1)),this._gateway.signal.on(su.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,"video",!0)),this._gateway.signal.on(su.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,"video",!1)),this._gateway.signal.on(su.RECEIVE_METADATA,e=>{let t=ot(e.metadata);this.emit(Zl.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(su.ON_DATA_STREAM,e=>{e.seq&&delete e.seq,e.payload=ot(e.payload),this.emit(Zl.STREAM_MESSAGE,e.uid,e.payload),this.onStreamMessage&&this.onStreamMessage(e)}),this._gateway.signal.on(su.ON_CRYPT_ERROR,()=>{st(()=>{Ul.warning("[".concat(this._clientId,"] on crypt error")),this.emit(Zl.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(su.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(su.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{Ul.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._reset(),this._gateway.leave(!0),this.emit(Zl.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this._gateway.signal.on(su.ON_STREAM_FALLBACK_UPDATE,e=>{var t,n;Ul.debug(To(t=To(n="[".concat(this._clientId,"] stream fallback peerId: ")).call(n,e.stream_id,", attr: ")).call(t,e.stream_type)),this.emit(Zl.STREAM_FALLBACK,e.stream_id,1===e.stream_type?"fallback":"recover")}),this._gateway.signal.on(su.ON_PUBLISH_STREAM,e=>{var t;this.uid===this._uid&&(this._highStream&&this._highStream._waitingSuccessResponse&&"connected"===this._highStream.connectionState?(this._highStream.reportPublishEvent(!0,null,cr({proxy:e.proxy})),Ul.info(To(t="[".concat(this._clientId,"] on publish stream, ")).call(t,cr(e))),void 0!==e.proxy&&this.emit(Zl.IS_USING_CLOUD_PROXY,!!e.proxy)):this._lowStream?this._lowStream.reportPublishEvent(!0,null,cr({proxy:e.proxy})):Ul.warning("get on_publish_stream message but cannot handle"))}),this._gateway.signal.on(su.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(su.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(nu.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case ru.PUBLISH:var n;if(!t)break;if(!(e="high"===t.stream_type?this._highStream:this._lowStream))break;"offer"===t.state&&Jd.publish(this._joinInfo.sid,{lts:e.startTime,succ:!1,ec:dl.TIMEOUT,audio:t.audio,video:t.video,p2pid:t.p2p_id,publishRequestid:e.ID,screenshare:!(!e.videoTrack||-1===nc(n=e.videoTrack._hints).call(n,Au.SCREEN_TRACK)),audioName:e.audioTrack&&e.audioTrack.getTrackLabel(),videoName:e.videoTrack&&e.videoTrack.getTrackLabel()});break;case ru.SUBSCRIBE:(n=this._remoteStream.get(t.stream_id))&&t&&Jd.subscribe(this._joinInfo.sid,{lts:n.startTime,succ:!1,ec:dl.TIMEOUT,audio:!!t.audio,video:!!t.video,peerid:t.stream_id,subscribeRequestid:n.ID,p2pid:n.pc.ID})}})}}Np([St(),kp("design:type",Function),kp("design:paramtypes",[Object]),kp("design:returntype",void 0)],Dp.prototype,"setTurnServer",null),Np([St({report:Jd}),kp("design:type",Function),kp("design:paramtypes",[String,String,Uint8Array]),kp("design:returntype",void 0)],Dp.prototype,"setEncryptionConfig",null),Np([function(e={report:Jd}){return function(t,n,r){let i=t[n];if("function"==typeof i){let s="AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name;r.value=async function(...t){var r;let o=e.report.reportApiInvoke(this._sessionId||null,{name:To(r="".concat(s,".")).call(r,n),options:t,tag:Kl.TRACER});try{let e=await i.apply(this,t);return o.onSuccess(),e}catch(a){throw o.onError(a),a}}}return r}}({report:Jd}),kp("design:type",Function),kp("design:paramtypes",[Object,Object]),kp("design:returntype",Ga)],Dp.prototype,"pickSVCLayer",null);class Pp extends uh{constructor(e,t={}){super(),this.currentLoopCount=this.pausePlayTime=this.startPlayOffset=this.startPlayTime=0,this._currentState="stopped",this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}set currentState(e){e!==this._currentState&&(this._currentState=e,this.emit(au.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer.duration}get currentTime(){return"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:(this.context.currentTime-this.startPlayTime+this.startPlayOffset)%this.audioBuffer.duration}updateOptions(e){"stopped"===this.currentState?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):Ul.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=e,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch(gl){}this.reset()}}startSourceNode(){var e;this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=gc(e=this.handleSourceNodeEnded).call(e,this))}createSourceNode(){let e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}let Lp=new _s;var Mp=Wn.setInterval;let Up=De().name;class xp{constructor(e,t){this.id=0,xp.count+=1,this.id=xp.count,this.element=e,this.context=t}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{let t=document.createElement("audio");t.srcObject=new MediaStream([e.track]),t.play(),this.audioPlayerElement=t}}async switchSdp(){if(this.peerPair){var e=async(e,t)=>(t="offer"===t?await e.createOffer():await e.createAnswer(),await e.setLocalDescription(t),"complete"===e.iceGatheringState?e.localDescription:new Ga(t=>{e.onicegatheringstatechange=()=>{"complete"===e.iceGatheringState&&t(e.localDescription)}})),t=async(e,t)=>await e.setRemoteDescription(t);try{let n=await e(this.peerPair[0],"offer");await t(this.peerPair[1],n);let r=await e(this.peerPair[1],"answer");await t(this.peerPair[0],r)}catch(n){throw new xl(dl.LOCAL_AEC_ERROR,n.toString()).print()}}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let t;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),t=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(t)}catch(n){throw new xl(dl.LOCAL_AEC_ERROR,n.toString()).print()}if(!t)throw new xl(dl.LOCAL_AEC_ERROR,"no dest node when local aec").print();return e=t.stream.getAudioTracks()[0],this.audioTrack=e,e}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let e=await this.getTracksFromMediaElement(this.element);this.peerPair&&this.peerPair[0].addTrack(e),await this.switchSdp()}close(){var e;Ul.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&Ds(e=this.peerPair).call(e,e=>{e.close()}),this.audioPlayerElement=this.peerPair=void 0}}xp.count=0;var Vp=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Fp=window.AudioContext||window.webkitAudioContext;class Bp{constructor(){this.units=[],this._doesEnvironmentNeedAEC()&&(this.context=new Fp)}processExternalMediaAEC(e){var t;if(!this.context||!this._doesEnvironmentNeedAEC())return Ul.debug("the system does not need to process local aec"),-1;let n=hc(t=this.units).call(t,t=>t&&t.getElement()===e);return n||(n=new xp(e,this.context),this.units.push(n)),n.startEchoCancellation(),Ul.debug("start processing local audio echo cancellation, id is",n.id),n.id}_doesEnvironmentNeedAEC(){return De().name!==Mc.SAFARI}}!function(e,t,n,r){var i,s=arguments.length,o=3>s?t:null===r?r=oo(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;0<=a;a--)(i=e[a])&&(o=(3>s?i(o):3<s?i(t,n,o):i(t,n))||o);3<s&&o&&Ks(t,n,o)}([St({report:Jd}),Vp("design:type",Function),Vp("design:paramtypes",[HTMLAudioElement]),Vp("design:returntype",Number)],Bp.prototype,"processExternalMediaAEC",null);let jp=new Bp;var Gp,Hp,Wp,Kp;Z("PROCESS_ID",To(Gp=To(Hp=To(Wp=To(Kp="process-".concat(Xe(8,""),"-")).call(Kp,Xe(4,""),"-")).call(Wp,Xe(4,""),"-")).call(Hp,Xe(4,""),"-")).call(Gp,Xe(12,""))),function(){let e=De();var t=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia);Pu.getDisplayMedia=t,Pu.getStreamFromExtension=e.name===Mc.CHROME&&34<Number(e.version),Pu.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let e=new RTCPeerConnection,t=!1;try{e.addTransceiver("audio"),t=!0}catch(n){}return e.close(),t}(),Pu.supportMinBitrate=e.name===Mc.CHROME||e.name===Mc.EDGE,Pu.supportSetRtpSenderParameters=function(){let e=De();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Ue()||e.name===Mc.SAFARI||e.name===Mc.FIREFOX&&64<=Number(e.version))}(),e.name!==Mc.SAFARI&&De().name!==Mc.WECHAT||(Pu.supportDualStream=!1),Pu.webAudioMediaStreamDest=function(){let e=De();return!(e.name===Mc.SAFARI&&12>Number(e.version))}(),Pu.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,Pu.supportWebGL="undefined"!=typeof WebGLRenderingContext,Pu.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Ue()||(Pu.webAudioWithAEC=!0),Pu.supportShareAudio=function(){let e=De();return(e.os===Lc.WIN_10||e.os===Lc.WIN_81||e.os===Lc.WIN_7||e.os===Lc.LINUX||e.os===Lc.MAC_OS||e.os===Lc.MAC_OS_X)&&e.name===Mc.CHROME&&74<=Number(e.version)}(),Pu.supportDualStreamEncoding=function(){let e=De();return e.name===Mc.CHROME&&87===Number(e.version)}(),Ul.info("browser compatibility",cr(Pu),cr(e))}();let Yp={VERSION:Yc,BUILD:"v4.5.0-0-g87245ad6(5/25/2021, 3:25:26 PM)",setParameter:Z,getParameter:function(e){return el[e]},getSupportedCodec:async function(e){let t=null;return e?(t=new Bh({}),t.addStream(e)):t=new jh({}),e=zt(await t.createOfferSDP()),t.close(),e},checkSystemRequirements:function(){const e=Jd.reportApiInvoke(null,{name:Wl.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Kl.TRACER});var t=!1;try{var n=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,r=window.WebSocket;t=!!(window.RTCPeerConnection&&n&&r)}catch(i){return Ul.error("check system requirement failed: ",i),!1}return n=!1,(r=De()).name===Mc.CHROME&&58<=Number(r.version)&&r.os!==Lc.IOS&&(n=!0),r.name===Mc.FIREFOX&&56<=Number(r.version)&&(n=!0),r.name===Mc.OPERA&&45<=Number(r.version)&&(n=!0),r.name===Mc.SAFARI&&11<=Number(r.version)&&(n=!0),De().name!==Mc.WECHAT&&De().name!==Mc.QQ||r.os===Lc.IOS||(n=!0),Ul.debug("checkSystemRequirements, api:",t,"browser",n),e.onSuccess(t=t&&n),t},getDevices:function(e){return Wd.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Wd.getRecordingDevices(e)},getCameras:function(e){return Wd.getCamerasDevices(e)},getElectronScreenSources:lt,getPlaybackDevices:function(e){return Wd.getSpeakers(e)},createClient:function(e={codec:"vp8",mode:"rtc"}){const t=Jd.reportApiInvoke(null,{name:Wl.CREATE_CLIENT,options:[e],tag:Kl.TRACER});try{ge(e.codec,"config.codec",["vp8","vp9","av1","h264"]),ge(e.mode,"config.mode",["rtc","live"]),void 0!==e.proxyServer&&ve(e.proxyServer,"config.proxyServer",1,1e4),void 0!==e.turnServer&&we(e.turnServer),void 0!==e.httpRetryConfig&&Ce(e.httpRetryConfig),void 0!==e.websocketRetryConfig&&Ce(e.websocketRetryConfig)}catch(n){throw t.onError(n),n}return t.onSuccess(),new Dp(un({forceWaitGatewayResponse:!0},e,{role:"rtc"===e.mode?"host":e.role}))},createCameraVideoTrack:async function(e={encoderConfig:"480p_1"}){const t=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.CREATE_CAM_VIDEO_TRACK,options:[hn({},e)]}),n=Wt(e);var r=Xe(8,"track-");let i=null;Ul.info("start create camera video track with config",cr(e),"trackId",r);try{i=(await dt({video:n},r)).getVideoTracks()[0]||null}catch(s){throw t.onError(s),s}return i?(e.optimizationMode&&pn(r,i,e,e.encoderConfig&&X(e.encoderConfig)),e=new pp(i,e,n,e.scalabiltyMode?J(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r),t.onSuccess(e.getTrackId()),Ul.info("create camera video success, trackId:",r),e):(r=new xl(dl.UNEXPECTED_ERROR,"can not find track in media stream"),t.onError(r),r.throw())},createCustomVideoTrack:function(e){const t=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),n=new hp(e.mediaStreamTrack,{bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?J(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode);return t.onSuccess(n.getTrackId()),Ul.info("create custom video track success with config",e,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(e={},t="disable"){const n=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.CREATE_SCREEN_VIDEO_TRACK,options:[hn({},e),t]});e.encoderConfig?"string"==typeof e.encoderConfig||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";var r={};e.screenSourceType&&(r.mediaSource=e.screenSourceType),e.extensionId&&Pe()&&(r.extensionId=e.extensionId),e.electronScreenSourceId&&(r.sourceId=e.electronScreenSourceId);var i=e.encoderConfig?Q(e.encoderConfig):null;r.mandatory={chromeMediaSource:"desktop",maxWidth:i?i.width:void 0,maxHeight:i?i.height:void 0},i&&i.frameRate&&("number"==typeof i.frameRate?(r.mandatory.maxFrameRate=i.frameRate,r.mandatory.minFrameRate=i.frameRate):(r.mandatory.maxFrameRate=i.frameRate.max||i.frameRate.ideal||i.frameRate.exact||void 0,r.mandatory.minFrameRate=i.frameRate.min||i.frameRate.ideal||i.frameRate.exact||void 0),r.frameRate=i.frameRate),i&&i.width&&(r.width=i.width),i&&i.height&&(r.height=i.height),i=r;const s=Xe(8,"track-");let o=null;r=null;const a=Pu;if(!a.supportShareAudio&&"enable"===t)return e=new xl(dl.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio"),n.onError(e),e.throw();Ul.info("start create screen video track with config",e,"withAudio",t,"trackId",s);try{const e=await dt({screen:i,screenAudio:"auto"===t?a.supportShareAudio:"enable"===t},s);o=e.getVideoTracks()[0]||null,r=e.getAudioTracks()[0]||null}catch(c){throw n.onError(c),c}return o?r||"enable"!==t?(e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(pn(s,o,e,e.encoderConfig&&Q(e.encoderConfig)),e.encoderConfig&&"string"!=typeof e.encoderConfig&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax)),(e=new hp(o,e.encoderConfig?Q(e.encoderConfig):{},e.scalabiltyMode?J(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,s))._hints.push(Au.SCREEN_TRACK),r?(t=new ph(r),n.onSuccess([e.getTrackId(),t.getTrackId()]),Ul.info("create screen video track success","video:",e.getTrackId(),"audio:",t.getTrackId()),[e,t]):(n.onSuccess(e.getTrackId()),Ul.info("create screen video track success","video:",e.getTrackId()),e)):(o&&o.stop(),e=new xl(dl.SHARE_AUDIO_NOT_ALLOWED),n.onError(e),e.throw()):(e=new xl(dl.UNEXPECTED_ERROR,"can not find track in media stream"),n.onError(e),e.throw())},createMicrophoneAndCameraTracks:async function(e={},t={encoderConfig:"480p_1"}){var n,r,i;const s=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.CREATE_MIC_AND_CAM_TRACKS,options:[e,t]}),o=Wt(t),a=Kt(e),c=Xe(8,"track-"),l=Xe(8,"track-");let u=null,d=null;Ul.info(To(n=To(r=To(i="start create camera video track(".concat(l,") and microphone audio track(")).call(i,c,") with config, audio: ")).call(r,cr(e),", video: ")).call(n,cr(t)));try{var h;const e=await dt({audio:a,video:o},To(h="".concat(c,"-")).call(h,l));u=e.getAudioTracks()[0],d=e.getVideoTracks()[0]}catch(f){throw s.onError(f),f}if(!u||!d){var p=new xl(dl.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(p),p.throw()}return t.optimizationMode&&pn(l,d,t,t.encoderConfig&&X(t.encoderConfig)),e=new fh(u,e,a,c),t=new pp(d,t,o,t.scalabiltyMode?J(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,l),s.onSuccess([e.getTrackId(),t.getTrackId()]),Ul.info(To(p="create camera video track(".concat(l,") and microphone audio track(")).call(p,c,") success")),[e,t]},createMicrophoneAudioTrack:async function(e={}){const t=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.CREATE_MIC_AUDIO_TRACK,options:[e]}),n=Kt(e);var r=Xe(8,"track-");let i=null;Ul.info("start create microphone audio track with config",cr(e),"trackId",r);try{i=(await dt({audio:n},r)).getAudioTracks()[0]||null}catch(s){throw t.onError(s),s}return i?(e=new fh(i,e,n,r),t.onSuccess(e.getTrackId()),Ul.info("create microphone audio track success, trackId:",r),e):(r=new xl(dl.UNEXPECTED_ERROR,"can not find track in media stream"),t.onError(r),r.throw())},createCustomAudioTrack:function(e){const t=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),n=new ph(e.mediaStreamTrack,e.encoderConfig?$(e.encoderConfig):{});return Ul.info("create custom audio track success with config",e,"trackId",n.getTrackId()),t.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(e){const t=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.CREATE_BUFFER_AUDIO_TRACK,options:[e]}),n=Xe(8,"track-");Ul.info("start create buffer source audio track with config",cr(e),"trackId",n);const r=e.source;if(!(e.source instanceof AudioBuffer))try{e.source=await async function(e,t){var r=null;if("string"==typeof e){let t=Lp.get(e);if(t)return Ul.debug("use cached audio resource: ",e),t;try{r=(await yt(()=>Pl.get(e,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(n){throw new xl(dl.FETCH_AUDIO_FILE_FAILED,n.toString())}}else r=await new Ga((t,n)=>{const r=new FileReader;r.onload=e=>{e.target?t(e.target.result):n(new xl(dl.READ_LOCAL_AUDIO_FILE_ERROR))},r.onerror=()=>{n(new xl(dl.READ_LOCAL_AUDIO_FILE_ERROR))},r.readAsArrayBuffer(e)});return r=await function(e){const t=It();return new Ga((n,r)=>{t.decodeAudioData(e,e=>{n(e)},e=>{r(new xl(dl.DECODE_AUDIO_FILE_FAILED,e.toString()))})})}(r),"string"==typeof e&&t&&Lp.set(e,r),r}(e.source,e.cacheOnlineFile)}catch(s){return t.onError(s),s.throw()}const i=new Pp(e.source);return e=new _h(r,i,e.encoderConfig?$(e.encoderConfig):{},n),Ul.info("create buffer source audio track success, trackId:",n),t.onSuccess(e.getTrackId()),e},setLogLevel:function(e){Ul.setLogLevel(e)},enableLogUpload:function(){Ul.enableLogUpload()},disableLogUpload:function(){Ul.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new Ap},checkAudioTrackIsActive:async function(e,t=5e3){const n=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof ph||e instanceof Rp)){var r=new xl(dl.INVALID_TRACK,"the parameter is not a audio track");return n.onError(r),r.throw()}t&&1e3>t&&(t=1e3);const i=e instanceof ph?e.getTrackLabel():"remote_track";let s=r=e.getVolumeLevel(),o=r;const a=wd();return new Ga(r=>{const c=Mp(()=>{var l=e.getVolumeLevel();s=l>s?l:s,o=l<o?l:o,l=1e-4<s-o;var u,d=wd()-a;(l||d>t)&&(clearInterval(c),d={duration:d,deviceLabel:i,maxVolumeLevel:s,result:l},Ul.info(To(u="[track-".concat(e.getTrackId(),"] check audio track active completed. ")).call(u,cr(d))),n.onSuccess(d),r(l))},200)})},checkVideoTrackIsActive:async function(e,t=5e3){var n;const r=Jd.reportApiInvoke(null,{tag:Kl.TRACER,name:Wl.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof hp||e instanceof Tp))return e=new xl(dl.INVALID_TRACK,"the parameter is not a video track"),r.onError(e),e.throw();t&&1e3>t&&(t=1e3);var i=e instanceof hp?e.getTrackLabel():"remote_track",s=e.getMediaStreamTrack(!0);const o=document.createElement("video");o.style.width="1px",o.style.height="1px",o.setAttribute("muted",""),o.muted=!0,o.setAttribute("playsinline",""),o.controls=!1,Up===Mc.SAFARI&&(o.style.opacity="0.01",o.style.position="fixed",o.style.left="0",o.style.top="0",document.body.appendChild(o)),o.srcObject=new MediaStream([s]),o.play();const a=document.createElement("canvas");a.width=160,a.height=120;let c=s=0;try{const e=wd();s=await function(e,t,n,r){let i,s=0,o=null;return new Ga((r,a)=>{zd(()=>{i&&(i(),r(s))},t),i=At(()=>{e:{s>4&&i&&(i(),r(s));var t=n.getContext("2d");if(t){t.drawImage(e,0,0,160,120),t=t.getImageData(0,0,n.width,n.height);var c=Math.floor(t.data.length/3);if(o)for(let e=0;e<c;e+=3)if(t.data[e]!==o[e]){s+=1,o=t.data;break e}o=t.data}else t=new xl(dl.UNEXPECTED_ERROR,"can not get canvas 2d context."),Ul.error(t.toString()),a(t)}},30)})}(o,t,a),c=wd()-e}catch(l){throw r.onError(l),l}return Up===Mc.SAFARI&&(o.pause(),o.remove()),o.srcObject=null,i={duration:c,changedPicNum:s,deviceLabel:i,result:t=4<s},Ul.info(To(n="[track-".concat(e.getTrackId(),"] check video track active completed. ")).call(n,cr(i))),r.onSuccess(i),t},setArea:function(e){const t=Jd.reportApiInvoke(null,{name:Wl.SET_AREA,options:e,tag:Kl.TRACER});try{var n;let t=[];if("string"==typeof e&&(t=[e]),hl(e)&&(Ds(e).call(e,e=>{if(!Rc(Ou).call(Ou,e))throw new xl(dl.INVALID_PARAMS,"invalid area code")}),t=e),"[object Object]"===Object.prototype.toString.call(e)){const{areaCode:n,excludedArea:r}=e;if(!n)throw new xl(dl.INVALID_PARAMS,"area code is needed");e=n,"string"==typeof n&&(e=[n]),t=r?function(e,t){var n,r=[];if(Rc(e).call(e,"GLOBAL")){r=["GLOBAL","OVERSEA"];const i=Vs(ku);if("GLOBAL"===t)throw new xl(dl.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if("CHINA"===t)r=["OVERSEA"];else if(n=t,Rc(yh).call(yh,n)){e=Rh[t]||[];const n=[...r,t,...e];r=Io(i).call(i,e=>!Rc(n).call(n,e))}else if(function(e){let t=!1;return Ds(yh).call(yh,n=>{var r;Rc(r=Rh[n]).call(r,e)&&(t=!0)}),t}(t)){e=function(e){let t;return Ds(yh).call(yh,n=>{var r;Rc(r=Rh[n]).call(r,e)&&(t=n)}),t}(t);const n=[...r,e,t];r=Io(i).call(i,e=>!Rc(n).call(n,e))}else r=e;r=function(e){const t=[];return Ds(Ih).call(Ih,n=>{Rc(e).call(e,n)&&t.push(n)}),To(t).call(t,Io(e).call(e,e=>!Rc(Ih).call(Ih,e)))}(r)}else r=e;return r}(e,r):e}Z("AREAS",t);const r=(e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return Ka(e).call(e,e=>{const n=ku[e];(e=Vs(n))&&Ka(e).call(e,e=>{var r;"CODE"!==e&&(t[e]=To(r=t[e]).call(r,n[e]))})}),t})(t);Ka(n=Vs(r)).call(n,e=>{Z(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?r[e][0]:r[e])}),Ul.debug("set area success:",t.join(","))}catch(r){throw t.onError(r),r}t.onSuccess()},loadModule:function(e,t){e.moduleInit?e.moduleInit({logger:Ul,report:Jd},t):Ul.debug("Invalid Plugin")},processExternalMediaAEC:function(e){jp.processExternalMediaAEC(e)}};return Wd.on(ql.CAMERA_DEVICE_CHANGED,e=>{Ul.info("camera device changed",cr(e)),Yp.onCameraChanged&&Yp.onCameraChanged(e)}),Wd.on(ql.RECORDING_DEVICE_CHANGED,e=>{Ul.info("microphone device changed",cr(e)),Yp.onMicrophoneChanged&&Yp.onMicrophoneChanged(e)}),Wd.on(ql.PLAYOUT_DEVICE_CHANGED,e=>{Ul.debug("playout device changed",cr(e)),Yp.onPlaybackDeviceChanged&&Yp.onPlaybackDeviceChanged(e)}),hh.onAutoplayFailed=()=>{Ul.info("detect audio element autoplay failed"),Yp.onAudioAutoplayFailed&&Yp.onAudioAutoplayFailed()},ch.on("autoplay-failed",()=>{Ul.info("detect webaudio autoplay failed"),Yp.onAudioAutoplayFailed&&Yp.onAudioAutoplayFailed()}),Yp}()},zUnb:function(e,t,n){"use strict";function r(e){return"function"==typeof e}n.r(t);let i=!1;const s={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){const e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else i&&console.log("RxJS: Back to a better error behavior. Thank you. <3");i=e},get useDeprecatedSynchronousErrorHandling(){return i}};function o(e){setTimeout(()=>{throw e},0)}const a={closed:!0,next(e){},error(e){if(s.useDeprecatedSynchronousErrorHandling)throw e;o(e)},complete(){}},c=(()=>Array.isArray||(e=>e&&"number"==typeof e.length))();function l(e){return null!==e&&"object"==typeof e}const u=(()=>{function e(e){return Error.call(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((e,t)=>`${t+1}) ${e.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e})();let d=(()=>{class e{constructor(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}unsubscribe(){let t;if(this.closed)return;let{_parentOrParents:n,_ctorUnsubscribe:i,_unsubscribe:s,_subscriptions:o}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(null!==n)for(let e=0;e<n.length;++e)n[e].remove(this);if(r(s)){i&&(this._unsubscribe=void 0);try{s.call(this)}catch(a){t=a instanceof u?h(a.errors):[a]}}if(c(o)){let e=-1,n=o.length;for(;++e<n;){const n=o[e];if(l(n))try{n.unsubscribe()}catch(a){t=t||[],a instanceof u?t=t.concat(h(a.errors)):t.push(a)}}}if(t)throw new u(t)}add(t){let n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){const t=n;n=new e,n._subscriptions=[t]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}let{_parentOrParents:r}=n;if(null===r)n._parentOrParents=this;else if(r instanceof e){if(r===this)return n;n._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return n;r.push(this)}const i=this._subscriptions;return null===i?this._subscriptions=[n]:i.push(n),n}remove(e){const t=this._subscriptions;if(t){const n=t.indexOf(e);-1!==n&&t.splice(n,1)}}}return e.EMPTY=function(e){return e.closed=!0,e}(new e),e})();function h(e){return e.reduce((e,t)=>e.concat(t instanceof u?t.errors:t),[])}const p=(()=>"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random())();class f extends d{constructor(e,t,n){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=a;break;case 1:if(!e){this.destination=a;break}if("object"==typeof e){e instanceof f?(this.syncErrorThrowable=e.syncErrorThrowable,this.destination=e,e.add(this)):(this.syncErrorThrowable=!0,this.destination=new _(this,e));break}default:this.syncErrorThrowable=!0,this.destination=new _(this,e,t,n)}}[p](){return this}static create(e,t,n){const r=new f(e,t,n);return r.syncErrorThrowable=!1,r}next(e){this.isStopped||this._next(e)}error(e){this.isStopped||(this.isStopped=!0,this._error(e))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(e){this.destination.next(e)}_error(e){this.destination.error(e),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:e}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this}}class _ extends f{constructor(e,t,n,i){let s;super(),this._parentSubscriber=e;let o=this;r(t)?s=t:t&&(s=t.next,n=t.error,i=t.complete,t!==a&&(o=Object.create(t),r(o.unsubscribe)&&this.add(o.unsubscribe.bind(o)),o.unsubscribe=this.unsubscribe.bind(this))),this._context=o,this._next=s,this._error=n,this._complete=i}next(e){if(!this.isStopped&&this._next){const{_parentSubscriber:t}=this;s.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}error(e){if(!this.isStopped){const{_parentSubscriber:t}=this,{useDeprecatedSynchronousErrorHandling:n}=s;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):o(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;o(e)}}}complete(){if(!this.isStopped){const{_parentSubscriber:e}=this;if(this._complete){const t=()=>this._complete.call(this._context);s.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,t),this.unsubscribe()):(this.__tryOrUnsub(t),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(e,t){try{e.call(this._context,t)}catch(n){if(this.unsubscribe(),s.useDeprecatedSynchronousErrorHandling)throw n;o(n)}}__tryOrSetError(e,t,n){if(!s.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(r){return s.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=r,e.syncErrorThrown=!0,!0):(o(r),!0)}return!1}_unsubscribe(){const{_parentSubscriber:e}=this;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}const m=(()=>"function"==typeof Symbol&&Symbol.observable||"@@observable")();function g(e){return e}let E=(()=>{class e{constructor(e){this._isScalar=!1,e&&(this._subscribe=e)}lift(t){const n=new e;return n.source=this,n.operator=t,n}subscribe(e,t,n){const{operator:r}=this,i=function(e,t,n){if(e){if(e instanceof f)return e;if(e[p])return e[p]()}return e||t||n?new f(e,t,n):new f(a)}(e,t,n);if(i.add(r?r.call(i,this.source):this.source||s.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),s.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i}_trySubscribe(e){try{return this._subscribe(e)}catch(t){s.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),function(e){for(;e;){const{closed:t,destination:n,isStopped:r}=e;if(t||r)return!1;e=n&&n instanceof f?n:null}return!0}(e)?e.error(t):console.warn(t)}}forEach(e,t){return new(t=v(t))((t,n)=>{let r;r=this.subscribe(t=>{try{e(t)}catch(i){n(i),r&&r.unsubscribe()}},n,t)})}_subscribe(e){const{source:t}=this;return t&&t.subscribe(e)}[m](){return this}pipe(...e){return 0===e.length?this:(0===(t=e).length?g:1===t.length?t[0]:function(e){return t.reduce((e,t)=>t(e),e)})(this);var t}toPromise(e){return new(e=v(e))((e,t)=>{let n;this.subscribe(e=>n=e,e=>t(e),()=>e(n))})}}return e.create=t=>new e(t),e})();function v(e){if(e||(e=s.Promise||Promise),!e)throw new Error("no Promise impl found");return e}const S=(()=>{function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e})();class T extends d{constructor(e,t){super(),this.subject=e,this.subscriber=t,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const e=this.subject,t=e.observers;if(this.subject=null,!t||0===t.length||e.isStopped||e.closed)return;const n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}class R extends f{constructor(e){super(e),this.destination=e}}let y=(()=>{class e extends E{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[p](){return new R(this)}lift(e){const t=new I(this,this);return t.operator=e,t}next(e){if(this.closed)throw new S;if(!this.isStopped){const{observers:t}=this,n=t.length,r=t.slice();for(let i=0;i<n;i++)r[i].next(e)}}error(e){if(this.closed)throw new S;this.hasError=!0,this.thrownError=e,this.isStopped=!0;const{observers:t}=this,n=t.length,r=t.slice();for(let i=0;i<n;i++)r[i].error(e);this.observers.length=0}complete(){if(this.closed)throw new S;this.isStopped=!0;const{observers:e}=this,t=e.length,n=e.slice();for(let r=0;r<t;r++)n[r].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(e){if(this.closed)throw new S;return super._trySubscribe(e)}_subscribe(e){if(this.closed)throw new S;return this.hasError?(e.error(this.thrownError),d.EMPTY):this.isStopped?(e.complete(),d.EMPTY):(this.observers.push(e),new T(this,e))}asObservable(){const e=new E;return e.source=this,e}}return e.create=(e,t)=>new I(e,t),e})();class I extends y{constructor(e,t){super(),this.destination=e,this.source=t}next(e){const{destination:t}=this;t&&t.next&&t.next(e)}error(e){const{destination:t}=this;t&&t.error&&this.destination.error(e)}complete(){const{destination:e}=this;e&&e.complete&&this.destination.complete()}_subscribe(e){const{source:t}=this;return t?this.source.subscribe(e):d.EMPTY}}function C(e){return e&&"function"==typeof e.schedule}function A(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new w(e,t))}}class w{constructor(e,t){this.project=e,this.thisArg=t}call(e,t){return t.subscribe(new b(e,this.project,this.thisArg))}}class b extends f{constructor(e,t,n){super(e),this.project=t,this.count=0,this.thisArg=n||this}_next(e){let t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(t)}}const O=e=>t=>{for(let n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()};function N(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}const k=N(),D=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function P(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}const L=e=>{if(e&&"function"==typeof e[m])return r=e,e=>{const t=r[m]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if(D(e))return O(e);if(P(e))return n=e,e=>(n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,o),e);if(e&&"function"==typeof e[k])return t=e,e=>{const n=t[k]();for(;;){let t;try{t=n.next()}catch(r){return e.error(r),e}if(t.done){e.complete();break}if(e.next(t.value),e.closed)break}return"function"==typeof n.return&&e.add(()=>{n.return&&n.return()}),e};{const t=l(e)?"an invalid object":`'${e}'`;throw new TypeError(`You provided ${t} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`)}var t,n,r};function M(e,t){return new E(n=>{const r=new d;let i=0;return r.add(t.schedule(function(){i!==e.length?(n.next(e[i++]),n.closed||r.add(this.schedule())):n.complete()})),r})}function U(e,t){return t?function(e,t){if(null!=e){if(function(e){return e&&"function"==typeof e[m]}(e))return function(e,t){return new E(n=>{const r=new d;return r.add(t.schedule(()=>{const i=e[m]();r.add(i.subscribe({next(e){r.add(t.schedule(()=>n.next(e)))},error(e){r.add(t.schedule(()=>n.error(e)))},complete(){r.add(t.schedule(()=>n.complete()))}}))})),r})}(e,t);if(P(e))return function(e,t){return new E(n=>{const r=new d;return r.add(t.schedule(()=>e.then(e=>{r.add(t.schedule(()=>{n.next(e),r.add(t.schedule(()=>n.complete()))}))},e=>{r.add(t.schedule(()=>n.error(e)))}))),r})}(e,t);if(D(e))return M(e,t);if(function(e){return e&&"function"==typeof e[k]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new E(n=>{const r=new d;let i;return r.add(()=>{i&&"function"==typeof i.return&&i.return()}),r.add(t.schedule(()=>{i=e[k](),r.add(t.schedule(function(){if(n.closed)return;let e,t;try{const n=i.next();e=n.value,t=n.done}catch(r){return void n.error(r)}t?n.complete():(n.next(e),this.schedule())}))})),r})}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}(e,t):e instanceof E?e:new E(L(e))}class x extends f{constructor(e){super(),this.parent=e}_next(e){this.parent.notifyNext(e)}_error(e){this.parent.notifyError(e),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class V extends f{notifyNext(e){this.destination.next(e)}notifyError(e){this.destination.error(e)}notifyComplete(){this.destination.complete()}}function F(e,t){if(t.closed)return;if(e instanceof E)return e.subscribe(t);let n;try{n=L(e)(t)}catch(r){t.error(r)}return n}function B(e,t,n=Number.POSITIVE_INFINITY){return"function"==typeof t?r=>r.pipe(B((n,r)=>U(e(n,r)).pipe(A((e,i)=>t(n,e,r,i))),n)):("number"==typeof t&&(n=t),t=>t.lift(new j(e,n)))}class j{constructor(e,t=Number.POSITIVE_INFINITY){this.project=e,this.concurrent=t}call(e,t){return t.subscribe(new G(e,this.project,this.concurrent))}}class G extends V{constructor(e,t,n=Number.POSITIVE_INFINITY){super(e),this.project=t,this.concurrent=n,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}_tryNext(e){let t;const n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(t)}_innerSub(e){const t=new x(this),n=this.destination;n.add(t);const r=F(e,t);r!==t&&n.add(r)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(e){this.destination.next(e)}notifyComplete(){const e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function H(e=Number.POSITIVE_INFINITY){return B(g,e)}function W(e,t){return t?M(e,t):new E(O(e))}function K(){return function(e){return e.lift(new Y(e))}}class Y{constructor(e){this.connectable=e}call(e,t){const{connectable:n}=this;n._refCount++;const r=new q(e,n),i=t.subscribe(r);return r.closed||(r.connection=n.connect()),i}}class q extends f{constructor(e,t){super(e),this.connectable=t}_unsubscribe(){const{connectable:e}=this;if(!e)return void(this.connection=null);this.connectable=null;const t=e._refCount;if(t<=0)return void(this.connection=null);if(e._refCount=t-1,t>1)return void(this.connection=null);const{connection:n}=this,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}class z extends E{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._refCount=0,this._isComplete=!1}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject}connect(){let e=this._connection;return e||(this._isComplete=!1,e=this._connection=new d,e.add(this.source.subscribe(new Q(this.getSubject(),this))),e.closed&&(this._connection=null,e=d.EMPTY)),e}refCount(){return K()(this)}}const X=(()=>{const e=z.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}})();class Q extends R{constructor(e,t){super(e),this.connectable=t}_error(e){this._unsubscribe(),super._error(e)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const e=this.connectable;if(e){this.connectable=null;const t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}}}function J(){return new y}function $(e){for(let t in e)if(e[t]===$)return t;throw Error("Could not find renamed property on target object.")}function Z(e,t){for(const n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function ee(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(ee).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return""+e.overriddenName;if(e.name)return""+e.name;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function te(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const ne=$({__forward_ref__:$});function re(e){return e.__forward_ref__=re,e.toString=function(){return ee(this())},e}function ie(e){return se(e)?e():e}function se(e){return"function"==typeof e&&e.hasOwnProperty(ne)&&e.__forward_ref__===re}function oe(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function ae(e){return{factory:e.factory,providers:e.providers||[],imports:e.imports||[]}}function ce(e){return le(e,de)||le(e,pe)}function le(e,t){return e.hasOwnProperty(t)?e[t]:null}function ue(e){return e&&(e.hasOwnProperty(he)||e.hasOwnProperty(fe))?e[he]:null}const de=$({"\u0275prov":$}),he=$({"\u0275inj":$}),pe=$({ngInjectableDef:$}),fe=$({ngInjectorDef:$});var _e=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}({});let me;function ge(e){const t=me;return me=e,t}function Ee(e,t,n){const r=ce(e);if(r&&"root"==r.providedIn)return void 0===r.value?r.value=r.factory():r.value;if(n&_e.Optional)return null;if(void 0!==t)return t;throw new Error(`Injector: NOT_FOUND [${ee(e)}]`)}function ve(e){return{toString:e}.toString()}var Se=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}({}),Te=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}({});const Re="undefined"!=typeof globalThis&&globalThis,ye="undefined"!=typeof window&&window,Ie="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Ce="undefined"!=typeof global&&global,Ae=Re||Ce||ye||Ie,we={},be=[],Oe=$({"\u0275cmp":$}),Ne=$({"\u0275dir":$}),ke=$({"\u0275pipe":$}),De=$({"\u0275mod":$}),Pe=$({"\u0275loc":$}),Le=$({"\u0275fac":$}),Me=$({__NG_ELEMENT_ID__:$});let Ue=0;function xe(e){return ve(()=>{const t={},n={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===Se.OnPush,directiveDefs:null,pipeDefs:null,selectors:e.selectors||be,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||Te.Emulated,id:"c",styles:e.styles||be,_:null,setInput:null,schemas:e.schemas||null,tView:null},r=e.directives,i=e.features,s=e.pipes;return n.id+=Ue++,n.inputs=Ge(e.inputs,t),n.outputs=Ge(e.outputs),i&&i.forEach(e=>e(n)),n.directiveDefs=r?()=>("function"==typeof r?r():r).map(Ve):null,n.pipeDefs=s?()=>("function"==typeof s?s():s).map(Fe):null,n})}function Ve(e){return We(e)||function(e){return e[Ne]||null}(e)}function Fe(e){return function(e){return e[ke]||null}(e)}const Be={};function je(e){const t={type:e.type,bootstrap:e.bootstrap||be,declarations:e.declarations||be,imports:e.imports||be,exports:e.exports||be,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&ve(()=>{Be[e.id]=e.type}),t}function Ge(e,t){if(null==e)return we;const n={};for(const r in e)if(e.hasOwnProperty(r)){let i=e[r],s=i;Array.isArray(i)&&(s=i[1],i=i[0]),n[i]=r,t&&(t[i]=s)}return n}const He=xe;function We(e){return e[Oe]||null}function Ke(e,t){const n=e[De]||null;if(!n&&!0===t)throw new Error(`Type ${ee(e)} does not have '\u0275mod' property.`);return n}const Ye=20,qe=10;function ze(e){return Array.isArray(e)&&"object"==typeof e[1]}function Xe(e){return Array.isArray(e)&&!0===e[1]}function Qe(e){return 0!=(8&e.flags)}function Je(e){return 2==(2&e.flags)}function $e(e){return 1==(1&e.flags)}function Ze(e){return null!==e.template}function et(e,t){return e.hasOwnProperty(Le)?e[Le]:null}class tt extends Error{constructor(e,t){super(function(e,t){return`${e?`NG0${e}: `:""}${t}`}(e,t)),this.code=e}}function nt(e){return"string"==typeof e?e:null==e?"":String(e)}function rt(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():nt(e)}function it(e,t){const n=t?" in "+t:"";throw new tt("201",`No provider for ${rt(e)} found${n}`)}class st{constructor(e,t,n){this.previousValue=e,this.currentValue=t,this.firstChange=n}isFirstChange(){return this.firstChange}}function ot(){const e=ct(this),t=null==e?void 0:e.current;if(t){const n=e.previous;if(n===we)e.previous=t;else for(let e in t)n[e]=t[e];e.current=null,this.ngOnChanges(t)}}function at(e,t,n,r){const i=ct(e)||function(e,t){return e.__ngSimpleChanges__=t}(e,{previous:we,current:null}),s=i.current||(i.current={}),o=i.previous,a=this.declaredInputs[n],c=o[a];s[a]=new st(c&&c.currentValue,t,o===we),e[r]=t}function ct(e){return e.__ngSimpleChanges__||null}let lt=void 0;function ut(e){return!!e.listen}const dt={createRenderer:(e,t)=>void 0!==lt?lt:"undefined"!=typeof document?document:void 0};function ht(e){for(;Array.isArray(e);)e=e[0];return e}function pt(e,t){return ht(t[e])}function ft(e,t){return ht(t[e.index])}function _t(e,t){return e.data[t]}function mt(e,t){const n=t[e];return ze(n)?n:n[0]}function gt(e){const t=function(e){return e.__ngContext__||null}(e);return t?Array.isArray(t)?t:t.lView:null}function Et(e){return 128==(128&e[2])}function vt(e,t){return null==t?null:e[t]}function St(e){e[18]=0}function Tt(e,t){e[5]+=t;let n=e,r=e[3];for(;null!==r&&(1===t&&1===n[5]||-1===t&&0===n[5]);)r[5]+=t,n=r,r=r[3]}const Rt={lFrame:jt(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function yt(){return Rt.bindingsEnabled}function It(){return Rt.lFrame.lView}function Ct(){return Rt.lFrame.tView}function At(e){Rt.lFrame.contextLView=e}function wt(){let e=bt();for(;null!==e&&64===e.type;)e=e.parent;return e}function bt(){return Rt.lFrame.currentTNode}function Ot(e,t){const n=Rt.lFrame;n.currentTNode=e,n.isParent=t}function Nt(){return Rt.lFrame.isParent}function kt(){return Rt.isInCheckNoChangesMode}function Dt(e){Rt.isInCheckNoChangesMode=e}function Pt(){return Rt.lFrame.bindingIndex++}function Lt(e,t){const n=Rt.lFrame;n.bindingIndex=n.bindingRootIndex=e,Mt(t)}function Mt(e){Rt.lFrame.currentDirectiveIndex=e}function Ut(e){Rt.lFrame.currentQueryIndex=e}function xt(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function Vt(e,t,n){if(n&_e.SkipSelf){let r=t,i=e;for(;r=r.parent,!(null!==r||n&_e.Host||(r=xt(i),null===r)||(i=i[15],10&r.type)););if(null===r)return!1;t=r,e=i}const r=Rt.lFrame=Bt();return r.currentTNode=t,r.lView=e,!0}function Ft(e){const t=Bt(),n=e[1];Rt.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function Bt(){const e=Rt.lFrame,t=null===e?null:e.child;return null===t?jt(e):t}function jt(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function Gt(){const e=Rt.lFrame;return Rt.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const Ht=Gt;function Wt(){const e=Gt();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Kt(){return Rt.lFrame.selectedIndex}function Yt(e){Rt.lFrame.selectedIndex=e}function qt(){const e=Rt.lFrame;return _t(e.tView,e.selectedIndex)}function zt(e,t){for(let n=t.directiveStart,r=t.directiveEnd;n<r;n++){const t=e.data[n].type.prototype,{ngAfterContentInit:r,ngAfterContentChecked:i,ngAfterViewInit:s,ngAfterViewChecked:o,ngOnDestroy:a}=t;r&&(e.contentHooks||(e.contentHooks=[])).push(-n,r),i&&((e.contentHooks||(e.contentHooks=[])).push(n,i),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,i)),s&&(e.viewHooks||(e.viewHooks=[])).push(-n,s),o&&((e.viewHooks||(e.viewHooks=[])).push(n,o),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,o)),null!=a&&(e.destroyHooks||(e.destroyHooks=[])).push(n,a)}}function Xt(e,t,n){$t(e,t,3,n)}function Qt(e,t,n,r){(3&e[2])===n&&$t(e,t,n,r)}function Jt(e,t){let n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function $t(e,t,n,r){const i=null!=r?r:-1,s=t.length-1;let o=0;for(let a=void 0!==r?65535&e[18]:0;a<s;a++)if("number"==typeof t[a+1]){if(o=t[a],null!=r&&o>=r)break}else t[a]<0&&(e[18]+=65536),(o<i||-1==i)&&(Zt(e,n,t,a),e[18]=(4294901760&e[18])+a+2),a++}function Zt(e,t,n,r){const i=n[r]<0,s=n[r+1],o=e[i?-n[r]:n[r]];i?e[2]>>11<e[18]>>16&&(3&e[2])===t&&(e[2]+=2048,s.call(o)):s.call(o)}const en=-1;class tn{constructor(e,t,n){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=n}}function nn(e,t,n){const r=ut(e);let i=0;for(;i<n.length;){const s=n[i];if("number"==typeof s){if(0!==s)break;i++;const o=n[i++],a=n[i++],c=n[i++];r?e.setAttribute(t,a,c,o):t.setAttributeNS(o,a,c)}else{const o=s,a=n[++i];sn(o)?r&&e.setProperty(t,o,a):r?e.setAttribute(t,o,a):t.setAttribute(o,a),i++}}return i}function rn(e){return 3===e||4===e||6===e}function sn(e){return 64===e.charCodeAt(0)}function on(e,t){if(null===t||0===t.length);else if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let r=0;r<t.length;r++){const i=t[r];"number"==typeof i?n=i:0===n||an(e,n,i,null,-1===n||2===n?t[++r]:null)}}return e}function an(e,t,n,r,i){let s=0,o=e.length;if(-1===t)o=-1;else for(;s<e.length;){const n=e[s++];if("number"==typeof n){if(n===t){o=-1;break}if(n>t){o=s-1;break}}}for(;s<e.length;){const t=e[s];if("number"==typeof t)break;if(t===n){if(null===r)return void(null!==i&&(e[s+1]=i));if(r===e[s+1])return void(e[s+2]=i)}s++,null!==r&&s++,null!==i&&s++}-1!==o&&(e.splice(o,0,t),s=o+1),e.splice(s++,0,n),null!==r&&e.splice(s++,0,r),null!==i&&e.splice(s++,0,i)}function cn(e){return e!==en}function ln(e){return 32767&e}function un(e,t){let n=e>>16,r=t;for(;n>0;)r=r[15],n--;return r}let dn=!0;function hn(e){const t=dn;return dn=e,t}let pn=0;function fn(e,t){const n=mn(e,t);if(-1!==n)return n;const r=t[1];r.firstCreatePass&&(e.injectorIndex=t.length,_n(r.data,e),_n(t,null),_n(r.blueprint,null));const i=gn(e,t),s=e.injectorIndex;if(cn(i)){const e=ln(i),n=un(i,t),r=n[1].data;for(let i=0;i<8;i++)t[s+i]=n[e+i]|r[e+i]}return t[s+8]=i,s}function _n(e,t){e.push(0,0,0,0,0,0,0,0,t)}function mn(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function gn(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,r=null,i=t;for(;null!==i;){const e=i[1],t=e.type;if(r=2===t?e.declTNode:1===t?i[6]:null,null===r)return en;if(n++,i=i[15],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return en}function En(e,t,n){!function(e,t,n){let r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(Me)&&(r=n[Me]),null==r&&(r=n[Me]=pn++);const i=255&r,s=1<<i,o=64&i,a=32&i,c=t.data;128&i?o?a?c[e+7]|=s:c[e+6]|=s:a?c[e+5]|=s:c[e+4]|=s:o?a?c[e+3]|=s:c[e+2]|=s:a?c[e+1]|=s:c[e]|=s}(e,t,n)}function vn(e,t,n){if(n&_e.Optional)return e;it(t,"NodeInjector")}function Sn(e,t,n,r){if(n&_e.Optional&&void 0===r&&(r=null),0==(n&(_e.Self|_e.Host))){const i=e[9],s=ge(void 0);try{return i?i.get(t,r,n&_e.Optional):Ee(t,r,n&_e.Optional)}finally{ge(s)}}return vn(r,t,n)}function Tn(e,t,n,r=_e.Default,i){if(null!==e){const s=function(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(Me)?e[Me]:void 0;return"number"==typeof t?t>=0?255&t:yn:t}(n);if("function"==typeof s){if(!Vt(t,e,r))return r&_e.Host?vn(i,n,r):Sn(t,n,r,i);try{const e=s();if(null!=e||r&_e.Optional)return e;it(n)}finally{Ht()}}else if("number"==typeof s){let i=null,o=mn(e,t),a=en,c=r&_e.Host?t[16][6]:null;for((-1===o||r&_e.SkipSelf)&&(a=-1===o?gn(e,t):t[o+8],a!==en&&wn(r,!1)?(i=t[1],o=ln(a),t=un(a,t)):o=-1);-1!==o;){const e=t[1];if(An(s,o,e.data)){const e=In(o,t,n,i,r,c);if(e!==Rn)return e}a=t[o+8],a!==en&&wn(r,t[1].data[o+8]===c)&&An(s,o,t)?(i=e,o=ln(a),t=un(a,t)):o=-1}}}return Sn(t,n,r,i)}const Rn={};function yn(){return new bn(wt(),It())}function In(e,t,n,r,i,s){const o=t[1],a=o.data[e+8],c=function(e,t,n,r,i){const s=e.providerIndexes,o=t.data,a=1048575&s,c=e.directiveStart,l=s>>20,u=i?a+l:e.directiveEnd;for(let d=r?a:a+l;d<u;d++){const e=o[d];if(d<c&&n===e||d>=c&&e.type===n)return d}if(i){const e=o[c];if(e&&Ze(e)&&e.type===n)return c}return null}(a,o,n,null==r?Je(a)&&dn:r!=o&&0!=(3&a.type),i&_e.Host&&s===a);return null!==c?Cn(t,o,c,a):Rn}function Cn(e,t,n,r){let i=e[n];const s=t.data;if(i instanceof tn){const o=i;o.resolving&&function(e,t){throw new tt("200","Circular dependency in DI detected for "+e)}(rt(s[n]));const a=hn(o.canSeeViewProviders);o.resolving=!0;const c=o.injectImpl?ge(o.injectImpl):null;Vt(e,r,_e.Default);try{i=e[n]=o.factory(void 0,s,e,r),t.firstCreatePass&&n>=r.directiveStart&&function(e,t,n){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:s}=t.type.prototype;if(r){const r=((o=t).type.prototype.ngOnChanges&&(o.setInput=at),ot);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,r),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,r)}var o;i&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,i),s&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,s),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,s))}(n,s[n],t)}finally{null!==c&&ge(c),hn(a),o.resolving=!1,Ht()}}return i}function An(e,t,n){const r=64&e,i=32&e;let s;return s=128&e?r?i?n[t+7]:n[t+6]:i?n[t+5]:n[t+4]:r?i?n[t+3]:n[t+2]:i?n[t+1]:n[t],!!(s&1<<e)}function wn(e,t){return!(e&_e.Self||e&_e.Host&&t)}class bn{constructor(e,t){this._tNode=e,this._lView=t}get(e,t){return Tn(this._tNode,this._lView,e,void 0,t)}}function On(e){const t=e;if(se(e))return()=>{const e=On(ie(t));return e?e():null};let n=et(t);if(null===n){const e=ue(t);n=e&&e.factory}return n||null}function Nn(e){return ve(()=>{const t=e.prototype.constructor,n=t[Le]||On(t),r=Object.prototype;let i=Object.getPrototypeOf(e.prototype).constructor;for(;i&&i!==r;){const e=i[Le]||On(i);if(e&&e!==n)return e;i=Object.getPrototypeOf(i)}return e=>new e})}const kn="__parameters__";function Dn(e,t,n){return ve(()=>{const r=function(e){return function(...t){if(e){const n=e(...t);for(const e in n)this[e]=n[e]}}}(t);function i(...e){if(this instanceof i)return r.apply(this,e),this;const t=new i(...e);return n.annotation=t,n;function n(e,n,r){const i=e.hasOwnProperty(kn)?e[kn]:Object.defineProperty(e,kn,{value:[]})[kn];for(;i.length<=r;)i.push(null);return(i[r]=i[r]||[]).push(t),e}}return n&&(i.prototype=Object.create(n.prototype)),i.prototype.ngMetadataName=e,i.annotationCls=i,i})}class Pn{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=oe({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}toString(){return"InjectionToken "+this._desc}}const Ln=new Pn("AnalyzeForEntryComponents"),Mn=Function;function Un(e,t){e.forEach(e=>Array.isArray(e)?Un(e,t):t(e))}function xn(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function Vn(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function Fn(e,t,n){let r=jn(e,t);return r>=0?e[1|r]=n:(r=~r,function(e,t,n,r){let i=e.length;if(i==t)e.push(n,r);else if(1===i)e.push(r,e[0]),e[0]=n;else{for(i--,e.push(e[i-1],e[i]);i>t;)e[i]=e[i-2],i--;e[t]=n,e[t+1]=r}}(e,r,t,n)),r}function Bn(e,t){const n=jn(e,t);if(n>=0)return e[1|n]}function jn(e,t){return function(e,t,n){let r=0,i=e.length>>1;for(;i!==r;){const n=r+(i-r>>1),s=e[n<<1];if(t===s)return n<<1;s>t?i=n:r=n+1}return~(i<<1)}(e,t)}const Gn=Dn("Inject",e=>({token:e})),Hn=Dn("Optional"),Wn=Dn("Self"),Kn=Dn("SkipSelf"),Yn=Dn("Host"),qn={},zn=/\n/gm,Xn="__source",Qn=$({provide:String,useValue:$});let Jn=void 0;function $n(e){const t=Jn;return Jn=e,t}function Zn(e,t=_e.Default){if(void 0===Jn)throw new Error("inject() must be called from an injection context");return null===Jn?Ee(e,void 0,t):Jn.get(e,t&_e.Optional?null:void 0,t)}function er(e,t=_e.Default){return(me||Zn)(ie(e),t)}function tr(e){const t=[];for(let n=0;n<e.length;n++){const r=ie(e[n]);if(Array.isArray(r)){if(0===r.length)throw new Error("Arguments array must have arguments.");let e=void 0,n=_e.Default;for(let t=0;t<r.length;t++){const i=r[t];i instanceof Hn||"Optional"===i.ngMetadataName||i===Hn?n|=_e.Optional:i instanceof Kn||"SkipSelf"===i.ngMetadataName||i===Kn?n|=_e.SkipSelf:i instanceof Wn||"Self"===i.ngMetadataName||i===Wn?n|=_e.Self:i instanceof Yn||"Host"===i.ngMetadataName||i===Yn?n|=_e.Host:e=i instanceof Gn||i===Gn?i.token:i}t.push(er(e,n))}else t.push(er(r))}return t}function nr(e){return e.ngDebugContext}function rr(e){return e.ngOriginalError}function ir(e,...t){e.error(...t)}class sr{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e),n=this._findContext(e),r=function(e){return e.ngErrorLogger||ir}(e);r(this._console,"ERROR",e),t&&r(this._console,"ORIGINAL ERROR",t),n&&r(this._console,"ERROR CONTEXT",n)}_findContext(e){return e?nr(e)?nr(e):this._findContext(rr(e)):null}_findOriginalError(e){let t=rr(e);for(;t&&rr(t);)t=rr(t);return t}}function or(e,t){e.__ngContext__=t}const ar=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Ae))();function cr(e){return e instanceof Function?e():e}var lr=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}({});function ur(e,t){return(void 0)(e,t)}function dr(e){const t=e[3];return Xe(t)?t[3]:t}function hr(e){return fr(e[13])}function pr(e){return fr(e[4])}function fr(e){for(;null!==e&&!Xe(e);)e=e[4];return e}function _r(e,t,n,r,i){if(null!=r){let s,o=!1;Xe(r)?s=r:ze(r)&&(o=!0,r=r[0]);const a=ht(r);0===e&&null!==n?null==i?Rr(t,n,a):Tr(t,n,a,i||null,!0):1===e&&null!==n?Tr(t,n,a,i||null,!0):2===e?function(e,t,n){const r=Ir(e,t);r&&function(e,t,n,r){ut(e)?e.removeChild(t,n,r):t.removeChild(n)}(e,r,t,n)}(t,a,o):3===e&&t.destroyNode(a),null!=s&&function(e,t,n,r,i){const s=n[7];s!==ht(n)&&_r(t,e,r,s,i);for(let o=qe;o<n.length;o++){const i=n[o];Or(i[1],i,e,t,r,s)}}(t,e,s,n,i)}}function mr(e,t,n){return ut(e)?e.createElement(t,n):null===n?e.createElement(t):e.createElementNS(n,t)}function gr(e,t){const n=e[9],r=n.indexOf(t),i=t[3];1024&t[2]&&(t[2]&=-1025,Tt(i,-1)),n.splice(r,1)}function Er(e,t){if(e.length<=qe)return;const n=qe+t,r=e[n];if(r){const s=r[17];null!==s&&s!==e&&gr(s,r),t>0&&(e[n-1][4]=r[4]);const o=Vn(e,qe+t);Or(r[1],i=r,i[11],2,null,null),i[0]=null,i[6]=null;const a=o[19];null!==a&&a.detachView(o[1]),r[3]=null,r[4]=null,r[2]&=-129}var i;return r}function vr(e,t){if(!(256&t[2])){const n=t[11];ut(n)&&n.destroyNode&&Or(e,t,n,3,null,null),function(e){let t=e[13];if(!t)return Sr(e[1],e);for(;t;){let n=null;if(ze(t))n=t[13];else{const e=t[10];e&&(n=e)}if(!n){for(;t&&!t[4]&&t!==e;)ze(t)&&Sr(t[1],t),t=t[3];null===t&&(t=e),ze(t)&&Sr(t[1],t),n=t&&t[4]}t=n}}(t)}}function Sr(e,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let r=0;r<n.length;r+=2){const e=t[n[r]];if(!(e instanceof tn)){const t=n[r+1];if(Array.isArray(t))for(let n=0;n<t.length;n+=2)t[n+1].call(e[t[n]]);else t.call(e)}}}(e,t),function(e,t){const n=e.cleanup,r=t[7];let i=-1;if(null!==n)for(let s=0;s<n.length-1;s+=2)if("string"==typeof n[s]){const e=n[s+1],o="function"==typeof e?e(t):ht(t[e]),a=r[i=n[s+2]],c=n[s+3];"boolean"==typeof c?o.removeEventListener(n[s],a,c):c>=0?r[i=c]():r[i=-c].unsubscribe(),s+=2}else{const e=r[i=n[s+1]];n[s].call(e)}if(null!==r){for(let e=i+1;e<r.length;e++)(0,r[e])();t[7]=null}}(e,t),1===t[1].type&&ut(t[11])&&t[11].destroy();const n=t[17];if(null!==n&&Xe(t[3])){n!==t[3]&&gr(n,t);const r=t[19];null!==r&&r.detachView(e)}}}function Tr(e,t,n,r,i){ut(e)?e.insertBefore(t,n,r,i):t.insertBefore(n,r,i)}function Rr(e,t,n){ut(e)?e.appendChild(t,n):t.appendChild(n)}function yr(e,t,n,r,i){null!==r?Tr(e,t,n,r,i):Rr(e,t,n)}function Ir(e,t){return ut(e)?e.parentNode(t):t.parentNode}function Cr(e,t,n,r){const i=function(e,t,n){return function(e,t,n){let r=t;for(;null!==r&&40&r.type;)r=(t=r).parent;if(null===r)return n[0];if(2&r.flags){const t=e.data[r.directiveStart].encapsulation;if(t===Te.None||t===Te.Emulated)return null}return ft(r,n)}(e,t.parent,n)}(e,r,t),s=t[11],o=function(e,t,n){return function(e,t,n){return 40&e.type?ft(e,n):null}(e,0,n)}(r.parent||t[6],0,t);if(null!=i)if(Array.isArray(n))for(let a=0;a<n.length;a++)yr(s,i,n[a],o,!1);else yr(s,i,n,o,!1)}function Ar(e,t){if(null!==t){const n=t.type;if(3&n)return ft(t,e);if(4&n)return wr(-1,e[t.index]);if(8&n){const n=t.child;if(null!==n)return Ar(e,n);{const n=e[t.index];return Xe(n)?wr(-1,n):ht(n)}}if(32&n)return ur(t,e)()||ht(e[t.index]);{const n=e[16],r=n[6],i=dr(n),s=r.projection[t.projection];return null!=s?Ar(i,s):Ar(e,t.next)}}return null}function wr(e,t){const n=qe+e+1;if(n<t.length){const e=t[n],r=e[1].firstChild;if(null!==r)return Ar(e,r)}return t[7]}function br(e,t,n,r,i,s,o){for(;null!=n;){const a=r[n.index],c=n.type;if(o&&0===t&&(a&&or(ht(a),r),n.flags|=4),64!=(64&n.flags))if(8&c)br(e,t,n.child,r,i,s,!1),_r(t,e,i,a,s);else if(32&c){const o=ur(n,r);let c;for(;c=o();)_r(t,e,i,c,s);_r(t,e,i,a,s)}else 16&c?Nr(e,t,r,n,i,s):_r(t,e,i,a,s);n=o?n.projectionNext:n.next}}function Or(e,t,n,r,i,s){br(n,r,e.firstChild,t,i,s,!1)}function Nr(e,t,n,r,i,s){const o=n[16],a=o[6].projection[r.projection];if(Array.isArray(a))for(let c=0;c<a.length;c++)_r(t,e,i,a[c],s);else br(e,t,a,o[3],i,s,!0)}function kr(e,t,n){ut(e)?e.setAttribute(t,"style",n):t.style.cssText=n}function Dr(e,t,n){ut(e)?""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n):t.className=n}function Pr(e,t,n){let r=e.length;for(;;){const i=e.indexOf(t,n);if(-1===i)return i;if(0===i||e.charCodeAt(i-1)<=32){const n=t.length;if(i+n===r||e.charCodeAt(i+n)<=32)return i}n=i+1}}const Lr="ng-template";function Mr(e,t,n){let r=0;for(;r<e.length;){let i=e[r++];if(n&&"class"===i){if(i=e[r],-1!==Pr(i.toLowerCase(),t,0))return!0}else if(1===i){for(;r<e.length&&"string"==typeof(i=e[r++]);)if(i.toLowerCase()===t)return!0;return!1}}return!1}function Ur(e){return 4===e.type&&e.value!==Lr}function xr(e,t,n){return t===(4!==e.type||n?e.value:Lr)}function Vr(e,t,n){let r=4;const i=e.attrs||[],s=function(e){for(let t=0;t<e.length;t++)if(rn(e[t]))return t;return e.length}(i);let o=!1;for(let a=0;a<t.length;a++){const c=t[a];if("number"!=typeof c){if(!o)if(4&r){if(r=2|1&r,""!==c&&!xr(e,c,n)||""===c&&1===t.length){if(Fr(r))return!1;o=!0}}else{const l=8&r?c:t[++a];if(8&r&&null!==e.attrs){if(!Mr(e.attrs,l,n)){if(Fr(r))return!1;o=!0}continue}const u=Br(8&r?"class":c,i,Ur(e),n);if(-1===u){if(Fr(r))return!1;o=!0;continue}if(""!==l){let e;e=u>s?"":i[u+1].toLowerCase();const t=8&r?e:null;if(t&&-1!==Pr(t,l,0)||2&r&&l!==e){if(Fr(r))return!1;o=!0}}}}else{if(!o&&!Fr(r)&&!Fr(c))return!1;if(o&&Fr(c))continue;o=!1,r=c|1&r}}return Fr(r)||o}function Fr(e){return 0==(1&e)}function Br(e,t,n,r){if(null===t)return-1;let i=0;if(r||!n){let n=!1;for(;i<t.length;){const r=t[i];if(r===e)return i;if(3===r||6===r)n=!0;else{if(1===r||2===r){let e=t[++i];for(;"string"==typeof e;)e=t[++i];continue}if(4===r)break;if(0===r){i+=4;continue}}i+=n?1:2}return-1}return function(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const r=e[n];if("number"==typeof r)return-1;if(r===t)return n;n++}return-1}(t,e)}function jr(e,t,n=!1){for(let r=0;r<t.length;r++)if(Vr(e,t[r],n))return!0;return!1}function Gr(e,t){return e?":not("+t.trim()+")":t}function Hr(e){let t=e[0],n=1,r=2,i="",s=!1;for(;n<e.length;){let o=e[n];if("string"==typeof o)if(2&r){const t=e[++n];i+="["+o+(t.length>0?'="'+t+'"':"")+"]"}else 8&r?i+="."+o:4&r&&(i+=" "+o);else""===i||Fr(o)||(t+=Gr(s,i),i=""),r=o,s=s||!Fr(r);n++}return""!==i&&(t+=Gr(s,i)),t}const Wr={};function Kr(e){Yr(Ct(),It(),Kt()+e,kt())}function Yr(e,t,n,r){if(!r)if(3==(3&t[2])){const r=e.preOrderCheckHooks;null!==r&&Xt(t,r,n)}else{const r=e.preOrderHooks;null!==r&&Qt(t,r,0,n)}Yt(n)}function qr(e,t){return e<<17|t<<2}function zr(e){return e>>17&32767}function Xr(e){return 2|e}function Qr(e){return(131068&e)>>2}function Jr(e,t){return-131069&e|t<<2}function $r(e){return 1|e}function Zr(e,t){const n=e.contentQueries;if(null!==n)for(let r=0;r<n.length;r+=2){const i=n[r],s=n[r+1];if(-1!==s){const n=e.data[s];Ut(i),n.contentQueries(2,t[s],s)}}}function ei(e,t,n,r,i,s,o,a,c,l){const u=t.blueprint.slice();return u[0]=i,u[2]=140|r,St(u),u[3]=u[15]=e,u[8]=n,u[10]=o||e&&e[10],u[11]=a||e&&e[11],u[12]=c||e&&e[12]||null,u[9]=l||e&&e[9]||null,u[6]=s,u[16]=2==t.type?e[16]:u,u}function ti(e,t,n,r,i){let s=e.data[t];if(null===s)s=function(e,t,n,r,i){const s=bt(),o=Nt(),a=e.data[t]=function(e,t,n,r,i,s){return{type:n,index:r,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:i,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?s:s&&s.parent,n,t,r,i);return null===e.firstChild&&(e.firstChild=a),null!==s&&(o?null==s.child&&null!==a.parent&&(s.child=a):null===s.next&&(s.next=a)),a}(e,t,n,r,i),Rt.lFrame.inI18n&&(s.flags|=64);else if(64&s.type){s.type=n,s.value=r,s.attrs=i;const e=function(){const e=Rt.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();s.injectorIndex=null===e?-1:e.injectorIndex}return Ot(s,!0),s}function ni(e,t,n,r){if(0===n)return-1;const i=t.length;for(let s=0;s<n;s++)t.push(r),e.blueprint.push(r),e.data.push(null);return i}function ri(e,t,n){Ft(t);try{const r=e.viewQuery;null!==r&&ki(1,r,n);const i=e.template;null!==i&&oi(e,t,i,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&Zr(e,t),e.staticViewQueries&&ki(2,e.viewQuery,n);const s=e.components;null!==s&&function(e,t){for(let n=0;n<t.length;n++)Ai(e,t[n])}(t,s)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0),r}finally{t[2]&=-5,Wt()}}function ii(e,t,n,r){const i=t[2];if(256==(256&i))return;Ft(t);const s=kt();try{St(t),Rt.lFrame.bindingIndex=e.bindingStartIndex,null!==n&&oi(e,t,n,2,r);const o=3==(3&i);if(!s)if(o){const n=e.preOrderCheckHooks;null!==n&&Xt(t,n,null)}else{const n=e.preOrderHooks;null!==n&&Qt(t,n,0,null),Jt(t,0)}if(function(e){for(let t=hr(e);null!==t;t=pr(t)){if(!t[2])continue;const e=t[9];for(let t=0;t<e.length;t++){const n=e[t],r=n[3];0==(1024&n[2])&&Tt(r,1),n[2]|=1024}}}(t),function(e){for(let t=hr(e);null!==t;t=pr(t))for(let e=qe;e<t.length;e++){const n=t[e],r=n[1];Et(n)&&ii(r,n,r.template,n[8])}}(t),null!==e.contentQueries&&Zr(e,t),!s)if(o){const n=e.contentCheckHooks;null!==n&&Xt(t,n)}else{const n=e.contentHooks;null!==n&&Qt(t,n,1),Jt(t,1)}!function(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let e=0;e<n.length;e++){const r=n[e];if(r<0)Yt(~r);else{const i=r,s=n[++e],o=n[++e];Lt(s,i),o(2,t[i])}}}finally{Yt(-1)}}(e,t);const a=e.components;null!==a&&function(e,t){for(let n=0;n<t.length;n++)Ii(e,t[n])}(t,a);const c=e.viewQuery;if(null!==c&&ki(2,c,r),!s)if(o){const n=e.viewCheckHooks;null!==n&&Xt(t,n)}else{const n=e.viewHooks;null!==n&&Qt(t,n,2),Jt(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),s||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,Tt(t[3],-1))}finally{Wt()}}function si(e,t,n,r){const i=t[10],s=!kt(),o=4==(4&t[2]);try{s&&!o&&i.begin&&i.begin(),o&&ri(e,t,r),ii(e,t,n,r)}finally{s&&!o&&i.end&&i.end()}}function oi(e,t,n,r,i){const s=Kt();try{Yt(-1),2&r&&t.length>Ye&&Yr(e,t,Ye,kt()),n(r,i)}finally{Yt(s)}}function ai(e,t,n){yt()&&(function(e,t,n,r){const i=n.directiveStart,s=n.directiveEnd;e.firstCreatePass||fn(n,t),or(r,t);const o=n.initialInputs;for(let a=i;a<s;a++){const r=e.data[a],s=Ze(r);s&&Si(t,n,r);const c=Cn(t,e,a,n);or(c,t),null!==o&&Ti(0,a-i,c,r,0,o),s&&(mt(n.index,t)[8]=c)}}(e,t,n,ft(n,t)),128==(128&n.flags)&&function(e,t,n){const r=n.directiveStart,i=n.directiveEnd,s=n.index,o=Rt.lFrame.currentDirectiveIndex;try{Yt(s);for(let n=r;n<i;n++){const r=e.data[n],i=t[n];Mt(n),null===r.hostBindings&&0===r.hostVars&&null===r.hostAttrs||_i(r,i)}}finally{Yt(-1),Mt(o)}}(e,t,n))}function ci(e,t,n=ft){const r=t.localNames;if(null!==r){let i=t.index+1;for(let s=0;s<r.length;s+=2){const o=r[s+1],a=-1===o?n(t,e):e[o];e[i++]=a}}}function li(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=ui(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function ui(e,t,n,r,i,s,o,a,c,l){const u=Ye+r,d=u+i,h=function(e,t){const n=[];for(let r=0;r<t;r++)n.push(r<e?null:Wr);return n}(u,d),p="function"==typeof l?l():l;return h[1]={type:e,blueprint:h,template:n,queries:null,viewQuery:a,declTNode:t,data:h.slice().fill(null,u),bindingStartIndex:u,expandoStartIndex:d,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:c,consts:p,incompleteFirstPass:!1}}function di(e,t,n){for(let r in e)if(e.hasOwnProperty(r)){const i=e[r];(n=null===n?{}:n).hasOwnProperty(r)?n[r].push(t,i):n[r]=[t,i]}return n}function hi(e,t,n,r,i,s,o,a){const c=ft(t,n);let l,u=t.inputs;var d;!a&&null!=u&&(l=u[r])?(Ui(e,n,l,r,i),Je(t)&&function(e,t){const n=mt(t,e);16&n[2]||(n[2]|=64)}(n,t.index)):3&t.type&&(r="class"===(d=r)?"className":"for"===d?"htmlFor":"formaction"===d?"formAction":"innerHtml"===d?"innerHTML":"readonly"===d?"readOnly":"tabindex"===d?"tabIndex":d,i=null!=o?o(i,t.value||"",r):i,ut(s)?s.setProperty(c,r,i):sn(r)||(c.setProperty?c.setProperty(r,i):c[r]=i))}function pi(e,t,n,r){let i=!1;if(yt()){const s=function(e,t,n){const r=e.directiveRegistry;let i=null;if(r)for(let s=0;s<r.length;s++){const o=r[s];jr(n,o.selectors,!1)&&(i||(i=[]),En(fn(n,t),e,o.type),Ze(o)?(mi(e,n),i.unshift(o)):i.push(o))}return i}(e,t,n),o=null===r?null:{"":-1};if(null!==s){i=!0,Ei(n,e.data.length,s.length);for(let e=0;e<s.length;e++){const t=s[e];t.providersResolver&&t.providersResolver(t)}let r=!1,a=!1,c=ni(e,t,s.length,null);for(let i=0;i<s.length;i++){const l=s[i];n.mergedAttrs=on(n.mergedAttrs,l.hostAttrs),vi(e,n,t,c,l),gi(c,l,o),null!==l.contentQueries&&(n.flags|=8),null===l.hostBindings&&null===l.hostAttrs&&0===l.hostVars||(n.flags|=128);const u=l.type.prototype;!r&&(u.ngOnChanges||u.ngOnInit||u.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index),r=!0),a||!u.ngOnChanges&&!u.ngDoCheck||((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index),a=!0),c++}!function(e,t){const n=t.directiveEnd,r=e.data,i=t.attrs,s=[];let o=null,a=null;for(let c=t.directiveStart;c<n;c++){const e=r[c],n=e.inputs,l=null===i||Ur(t)?null:Ri(n,i);s.push(l),o=di(n,c,o),a=di(e.outputs,c,a)}null!==o&&(o.hasOwnProperty("class")&&(t.flags|=16),o.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=s,t.inputs=o,t.outputs=a}(e,n)}o&&function(e,t,n){if(t){const r=e.localNames=[];for(let e=0;e<t.length;e+=2){const i=n[t[e+1]];if(null==i)throw new tt("301",`Export of name '${t[e+1]}' not found!`);r.push(t[e],i)}}}(n,r,o)}return n.mergedAttrs=on(n.mergedAttrs,n.attrs),i}function fi(e,t,n,r,i,s){const o=s.hostBindings;if(o){let n=e.hostBindingOpCodes;null===n&&(n=e.hostBindingOpCodes=[]);const s=~t.index;(function(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(n)!=s&&n.push(s),n.push(r,i,o)}}function _i(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function mi(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function gi(e,t,n){if(n){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)n[t.exportAs[r]]=e;Ze(t)&&(n[""]=e)}}function Ei(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function vi(e,t,n,r,i){e.data[r]=i;const s=i.factory||(i.factory=et(i.type)),o=new tn(s,Ze(i),null);e.blueprint[r]=o,n[r]=o,fi(e,t,0,r,ni(e,n,i.hostVars,Wr),i)}function Si(e,t,n){const r=ft(t,e),i=li(n),s=e[10],o=wi(e,ei(e,i,null,n.onPush?64:16,r,t,s,s.createRenderer(r,n),null,null));e[t.index]=o}function Ti(e,t,n,r,i,s){const o=s[t];if(null!==o){const e=r.setInput;for(let t=0;t<o.length;){const i=o[t++],s=o[t++],a=o[t++];null!==e?r.setInput(n,a,i,s):n[s]=a}}}function Ri(e,t){let n=null,r=0;for(;r<t.length;){const i=t[r];if(0!==i)if(5!==i){if("number"==typeof i)break;e.hasOwnProperty(i)&&(null===n&&(n=[]),n.push(i,e[i],t[r+1])),r+=2}else r+=2;else r+=4}return n}function yi(e,t,n,r){return new Array(e,!0,!1,t,null,0,r,n,null,null)}function Ii(e,t){const n=mt(t,e);if(Et(n)){const e=n[1];80&n[2]?ii(e,n,e.template,n[8]):n[5]>0&&Ci(n)}}function Ci(e){for(let n=hr(e);null!==n;n=pr(n))for(let e=qe;e<n.length;e++){const t=n[e];if(1024&t[2]){const e=t[1];ii(e,t,e.template,t[8])}else t[5]>0&&Ci(t)}const t=e[1].components;if(null!==t)for(let n=0;n<t.length;n++){const r=mt(t[n],e);Et(r)&&r[5]>0&&Ci(r)}}function Ai(e,t){const n=mt(t,e),r=n[1];!function(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])}(r,n),ri(r,n,n[8])}function wi(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function bi(e){for(;e;){e[2]|=64;const t=dr(e);if(0!=(512&e[2])&&!t)return e;e=t}return null}function Oi(e,t,n){const r=t[10];r.begin&&r.begin();try{ii(e,t,e.template,n)}catch(i){throw Mi(t,i),i}finally{r.end&&r.end()}}function Ni(e){!function(e){for(let t=0;t<e.components.length;t++){const n=e.components[t],r=gt(n),i=r[1];si(i,r,i.template,n)}}(e[8])}function ki(e,t,n){Ut(0),t(e,n)}const Di=(()=>Promise.resolve(null))();function Pi(e){return e[7]||(e[7]=[])}function Li(e){return e.cleanup||(e.cleanup=[])}function Mi(e,t){const n=e[9],r=n?n.get(sr,null):null;r&&r.handleError(t)}function Ui(e,t,n,r,i){for(let s=0;s<n.length;){const o=n[s++],a=n[s++],c=t[o],l=e.data[o];null!==l.setInput?l.setInput(c,i,r,a):c[a]=i}}function xi(e,t,n){let r=n?e.styles:null,i=n?e.classes:null,s=0;if(null!==t)for(let o=0;o<t.length;o++){const e=t[o];"number"==typeof e?s=e:1==s?i=te(i,e):2==s&&(r=te(r,e+": "+t[++o]+";"))}n?e.styles=r:e.stylesWithoutHost=r,n?e.classes=i:e.classesWithoutHost=i}const Vi=new Pn("INJECTOR",-1);class Fi{get(e,t=qn){if(t===qn){const t=new Error(`NullInjectorError: No provider for ${ee(e)}!`);throw t.name="NullInjectorError",t}return t}}const Bi=new Pn("Set Injector scope."),ji={},Gi={},Hi=[];let Wi=void 0;function Ki(){return void 0===Wi&&(Wi=new Fi),Wi}function Yi(e,t=null,n=null,r){return new qi(e,n,t||Ki(),r)}class qi{constructor(e,t,n,r=null){this.parent=n,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const i=[];t&&Un(t,n=>this.processProvider(n,e,t)),Un([e],e=>this.processInjectorType(e,[],i)),this.records.set(Vi,Qi(void 0,this));const s=this.records.get(Bi);this.scope=null!=s?s.value:null,this.source=r||("object"==typeof e?null:ee(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,t=qn,n=_e.Default){this.assertNotDestroyed();const r=$n(this);try{if(!(n&_e.SkipSelf)){let t=this.records.get(e);if(void 0===t){const n=("function"==typeof(i=e)||"object"==typeof i&&i instanceof Pn)&&ce(e);t=n&&this.injectableDefInScope(n)?Qi(zi(e),ji):null,this.records.set(e,t)}if(null!=t)return this.hydrate(e,t)}return(n&_e.Self?Ki():this.parent).get(e,t=n&_e.Optional&&t===qn?null:t)}catch(s){if("NullInjectorError"===s.name){if((s.ngTempTokenPath=s.ngTempTokenPath||[]).unshift(ee(e)),r)throw s;return function(e,t,n,r){const i=e.ngTempTokenPath;throw t[Xn]&&i.unshift(t[Xn]),e.message=function(e,t,n,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;let i=ee(t);if(Array.isArray(t))i=t.map(ee).join(" -> ");else if("object"==typeof t){let e=[];for(let n in t)if(t.hasOwnProperty(n)){let r=t[n];e.push(n+":"+("string"==typeof r?JSON.stringify(r):ee(r)))}i=`{${e.join(", ")}}`}return`${n}${r?"("+r+")":""}[${i}]: ${e.replace(zn,"\n  ")}`}("\n"+e.message,i,n,r),e.ngTokenPath=i,e.ngTempTokenPath=null,e}(s,e,"R3InjectorError",this.source)}throw s}finally{$n(r)}var i}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((t,n)=>e.push(ee(n))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(e,t,n){if(!(e=ie(e)))return!1;let r=ue(e);const i=null==r&&e.ngModule||void 0,s=void 0===i?e:i,o=-1!==n.indexOf(s);if(void 0!==i&&(r=ue(i)),null==r)return!1;if(null!=r.imports&&!o){let e;n.push(s);try{Un(r.imports,r=>{this.processInjectorType(r,t,n)&&(void 0===e&&(e=[]),e.push(r))})}finally{}if(void 0!==e)for(let t=0;t<e.length;t++){const{ngModule:n,providers:r}=e[t];Un(r,e=>this.processProvider(e,n,r||Hi))}}this.injectorDefTypes.add(s),this.records.set(s,Qi(r.factory,ji));const a=r.providers;if(null!=a&&!o){const t=e;Un(a,e=>this.processProvider(e,t,a))}return void 0!==i&&void 0!==e.providers}processProvider(e,t,n){let r=$i(e=ie(e))?e:ie(e&&e.provide);const i=function(e,t,n){return Ji(e)?Qi(void 0,e.useValue):Qi(Xi(e),ji)}(e);if($i(e)||!0!==e.multi)this.records.get(r);else{let t=this.records.get(r);t||(t=Qi(void 0,ji,!0),t.factory=()=>tr(t.multi),this.records.set(r,t)),r=e,t.multi.push(e)}this.records.set(r,i)}hydrate(e,t){var n;return t.value===ji&&(t.value=Gi,t.value=t.factory()),"object"==typeof t.value&&t.value&&null!==(n=t.value)&&"object"==typeof n&&"function"==typeof n.ngOnDestroy&&this.onDestroy.add(t.value),t.value}injectableDefInScope(e){return!!e.providedIn&&("string"==typeof e.providedIn?"any"===e.providedIn||e.providedIn===this.scope:this.injectorDefTypes.has(e.providedIn))}}function zi(e){const t=ce(e),n=null!==t?t.factory:et(e);if(null!==n)return n;const r=ue(e);if(null!==r)return r.factory;if(e instanceof Pn)throw new Error(`Token ${ee(e)} is missing a \u0275prov definition.`);if(e instanceof Function)return function(e){const t=e.length;if(t>0){const n=function(e,t){const n=[];for(let r=0;r<e;r++)n.push("?");return n}(t);throw new Error(`Can't resolve all parameters for ${ee(e)}: (${n.join(", ")}).`)}const n=function(e){const t=e&&(e[de]||e[pe]);if(t){const n=function(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),t}return null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new Error("unreachable")}function Xi(e,t,n){let r=void 0;if($i(e)){const t=ie(e);return et(t)||zi(t)}if(Ji(e))r=()=>ie(e.useValue);else if((i=e)&&i.useFactory)r=()=>e.useFactory(...tr(e.deps||[]));else if(function(e){return!(!e||!e.useExisting)}(e))r=()=>er(ie(e.useExisting));else{const t=ie(e&&(e.useClass||e.provide));if(!function(e){return!!e.deps}(e))return et(t)||zi(t);r=()=>new t(...tr(e.deps))}var i;return r}function Qi(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function Ji(e){return null!==e&&"object"==typeof e&&Qn in e}function $i(e){return"function"==typeof e}const Zi=function(e,t,n){return function(e,t=null,n=null,r){const i=Yi(e,t,n,r);return i._resolveInjectorDefTypes(),i}({name:n},t,e,n)};let es=(()=>{class e{static create(e,t){return Array.isArray(e)?Zi(e,t,""):Zi(e.providers,e.parent,e.name||"")}}return e.THROW_IF_NOT_FOUND=qn,e.NULL=new Fi,e.\u0275prov=oe({token:e,providedIn:"any",factory:()=>er(Vi)}),e.__NG_ELEMENT_ID__=-1,e})();function ts(e,t){zt(gt(e)[1],wt())}function ns(e){let t=Object.getPrototypeOf(e.type.prototype).constructor,n=!0;const r=[e];for(;t;){let i=void 0;if(Ze(e))i=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Error("Directives cannot inherit Components");i=t.\u0275dir}if(i){if(n){r.push(i);const t=e;t.inputs=rs(e.inputs),t.declaredInputs=rs(e.declaredInputs),t.outputs=rs(e.outputs);const n=i.hostBindings;n&&os(e,n);const s=i.viewQuery,o=i.contentQueries;if(s&&is(e,s),o&&ss(e,o),Z(e.inputs,i.inputs),Z(e.declaredInputs,i.declaredInputs),Z(e.outputs,i.outputs),Ze(i)&&i.data.animation){const t=e.data;t.animation=(t.animation||[]).concat(i.data.animation)}}const t=i.features;if(t)for(let r=0;r<t.length;r++){const i=t[r];i&&i.ngInherit&&i(e),i===ns&&(n=!1)}}t=Object.getPrototypeOf(t)}!function(e){let t=0,n=null;for(let r=e.length-1;r>=0;r--){const i=e[r];i.hostVars=t+=i.hostVars,i.hostAttrs=on(i.hostAttrs,n=on(n,i.hostAttrs))}}(r)}function rs(e){return e===we?{}:e===be?[]:e}function is(e,t){const n=e.viewQuery;e.viewQuery=n?(e,r)=>{t(e,r),n(e,r)}:t}function ss(e,t){const n=e.contentQueries;e.contentQueries=n?(e,r,i)=>{t(e,r,i),n(e,r,i)}:t}function os(e,t){const n=e.hostBindings;e.hostBindings=n?(e,r)=>{t(e,r),n(e,r)}:t}let as=null;function cs(){if(!as){const e=Ae.Symbol;if(e&&e.iterator)as=e.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const n=e[t];"entries"!==n&&"size"!==n&&Map.prototype[n]===Map.prototype.entries&&(as=n)}}}return as}function ls(e){return!!us(e)&&(Array.isArray(e)||!(e instanceof Map)&&cs()in e)}function us(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function ds(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function hs(e,t,n,r){return ds(e,Pt(),n)?t+nt(n)+r:Wr}function ps(e,t,n,r,i,s,o,a){const c=It(),l=Ct(),u=e+Ye,d=l.firstCreatePass?function(e,t,n,r,i,s,o,a,c){const l=t.consts,u=ti(t,e,4,o||null,vt(l,a));pi(t,n,u,vt(l,c)),zt(t,u);const d=u.tViews=ui(2,u,r,i,s,t.directiveRegistry,t.pipeRegistry,null,t.schemas,l);return null!==t.queries&&(t.queries.template(t,u),d.queries=t.queries.embeddedTView(u)),u}(u,l,c,t,n,r,i,s,o):l.data[u];Ot(d,!1);const h=c[11].createComment("");Cr(l,c,h,d),or(h,c),wi(c,c[u]=yi(h,c,h,d)),$e(d)&&ai(l,c,d),null!=o&&ci(c,d,a)}function fs(e,t=_e.Default){const n=It();return null===n?er(e,t):Tn(wt(),n,ie(e),t)}function _s(e,t,n){const r=It();return ds(r,Pt(),t)&&hi(Ct(),qt(),r,e,t,r[11],n,!1),_s}function ms(e,t,n,r,i){const s=i?"class":"style";Ui(e,n,t.inputs[s],s,r)}function gs(e,t,n,r){const i=It(),s=Ct(),o=Ye+e,a=i[11],c=i[o]=mr(a,t,Rt.lFrame.currentNamespace),l=s.firstCreatePass?function(e,t,n,r,i,s,o){const a=t.consts,c=ti(t,e,2,i,vt(a,s));return pi(t,n,c,vt(a,o)),null!==c.attrs&&xi(c,c.attrs,!1),null!==c.mergedAttrs&&xi(c,c.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,c),c}(o,s,i,0,t,n,r):s.data[o];Ot(l,!0);const u=l.mergedAttrs;null!==u&&nn(a,c,u);const d=l.classes;null!==d&&Dr(a,c,d);const h=l.styles;null!==h&&kr(a,c,h),64!=(64&l.flags)&&Cr(s,i,c,l),0===Rt.lFrame.elementDepthCount&&or(c,i),Rt.lFrame.elementDepthCount++,$e(l)&&(ai(s,i,l),function(e,t,n){if(Qe(t)){const r=t.directiveEnd;for(let i=t.directiveStart;i<r;i++){const t=e.data[i];t.contentQueries&&t.contentQueries(1,n[i],i)}}}(s,l,i)),null!==r&&ci(i,l)}function Es(){let e=wt();Nt()?Rt.lFrame.isParent=!1:(e=e.parent,Ot(e,!1));const t=e;Rt.lFrame.elementDepthCount--;const n=Ct();n.firstCreatePass&&(zt(n,e),Qe(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function(e){return 0!=(16&e.flags)}(t)&&ms(n,t,It(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function(e){return 0!=(32&e.flags)}(t)&&ms(n,t,It(),t.stylesWithoutHost,!1)}function vs(e,t,n,r){gs(e,t,n,r),Es()}function Ss(){return It()}function Ts(e){return!!e&&"function"==typeof e.then}function Rs(e){return!!e&&"function"==typeof e.subscribe}function ys(e,t,n=!1,r){const i=It(),s=Ct(),o=wt();return function(e,t,n,r,i,s,o=!1,a){const c=$e(r),l=e.firstCreatePass&&Li(e),u=Pi(t);let d=!0;if(3&r.type){const h=ft(r,t),p=a?a(h):we,f=p.target||h,_=u.length,m=a?e=>a(ht(e[r.index])).target:r.index;if(ut(n)){let o=null;if(!a&&c&&(o=function(e,t,n,r){const i=e.cleanup;if(null!=i)for(let s=0;s<i.length-1;s+=2){const e=i[s];if(e===n&&i[s+1]===r){const e=t[7],n=i[s+2];return e.length>n?e[n]:null}"string"==typeof e&&(s+=2)}return null}(e,t,i,r.index)),null!==o)(o.__ngLastListenerFn__||o).__ngNextListenerFn__=s,o.__ngLastListenerFn__=s,d=!1;else{s=Cs(r,t,s,!1);const e=n.listen(p.name||f,i,s);u.push(s,e),l&&l.push(i,m,_,_+1)}}else s=Cs(r,t,s,!0),f.addEventListener(i,s,o),u.push(s),l&&l.push(i,m,_,o)}else s=Cs(r,t,s,!1);const h=r.outputs;let p;if(d&&null!==h&&(p=h[i])){const e=p.length;if(e)for(let n=0;n<e;n+=2){const e=t[p[n]][p[n+1]].subscribe(s),o=u.length;u.push(s,e),l&&l.push(i,r.index,o,-(o+1))}}}(s,i,i[11],o,e,t,n,r),ys}function Is(e,t,n){try{return!1!==t(n)}catch(r){return Mi(e,r),!1}}function Cs(e,t,n,r){return function i(s){if(s===Function)return n;const o=2&e.flags?mt(e.index,t):t;0==(32&t[2])&&bi(o);let a=Is(t,n,s),c=i.__ngNextListenerFn__;for(;c;)a=Is(t,c,s)&&a,c=c.__ngNextListenerFn__;return r&&!1===a&&(s.preventDefault(),s.returnValue=!1),a}}function As(e=1){return function(e){return(Rt.lFrame.contextLView=function(e,t){for(;e>0;)t=t[15],e--;return t}(e,Rt.lFrame.contextLView))[8]}(e)}function ws(e,t,n){return bs(e,"",t,"",n),ws}function bs(e,t,n,r,i){const s=It(),o=hs(s,t,n,r);return o!==Wr&&hi(Ct(),qt(),s,e,o,s[11],i,!1),bs}const Os=[];function Ns(e,t,n,r,i){const s=e[n+1],o=null===t;let a=r?zr(s):Qr(s),c=!1;for(;0!==a&&(!1===c||o);){const n=e[a+1];ks(e[a],t)&&(c=!0,e[a+1]=r?$r(n):Xr(n)),a=r?zr(n):Qr(n)}c&&(e[n+1]=r?Xr(s):$r(s))}function ks(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&jn(e,t)>=0}function Ds(e,t){return function(e,t,n,r){const i=It(),s=Ct(),o=function(e){const t=Rt.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+2,n}();s.firstUpdatePass&&function(e,t,n,r){const i=e.data;if(null===i[n+1]){const s=i[Kt()],o=function(e,t){return t>=e.expandoStartIndex}(e,n);(function(e,t){return 0!=(16&e.flags)})(s)&&null===t&&!o&&(t=!1),t=function(e,t,n,r){const i=function(e){const t=Rt.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let s=t.residualClasses;if(null===i)0===t.classBindings&&(n=Ls(n=Ps(null,e,t,n,r),t.attrs,r),s=null);else{const o=t.directiveStylingLast;if(-1===o||e[o]!==i)if(n=Ps(i,e,t,n,r),null===s){let n=function(e,t,n){const r=t.classBindings;if(0!==Qr(r))return e[zr(r)]}(e,t);void 0!==n&&Array.isArray(n)&&(n=Ps(null,e,t,n[1],r),n=Ls(n,t.attrs,r),function(e,t,n,r){e[zr(t.classBindings)]=r}(e,t,0,n))}else s=function(e,t,n){let r=void 0;const i=t.directiveEnd;for(let s=1+t.directiveStylingLast;s<i;s++)r=Ls(r,e[s].hostAttrs,true);return Ls(r,t.attrs,true)}(e,t)}return void 0!==s&&(t.residualClasses=s),n}(i,s,t,r),function(e,t,n,r,i,s){let o=t.classBindings,a=zr(o),c=Qr(o);e[r]=n;let l,u=!1;if(Array.isArray(n)){const e=n;l=e[1],(null===l||jn(e,l)>0)&&(u=!0)}else l=n;if(i)if(0!==c){const t=zr(e[a+1]);e[r+1]=qr(t,a),0!==t&&(e[t+1]=Jr(e[t+1],r)),e[a+1]=131071&e[a+1]|r<<17}else e[r+1]=qr(a,0),0!==a&&(e[a+1]=Jr(e[a+1],r)),a=r;else e[r+1]=qr(c,0),0===a?a=r:e[c+1]=Jr(e[c+1],r),c=r;u&&(e[r+1]=Xr(e[r+1])),Ns(e,l,r,!0),Ns(e,l,r,!1),function(e,t,n,r,i){const s=e.residualClasses;null!=s&&"string"==typeof t&&jn(s,t)>=0&&(n[r+1]=$r(n[r+1]))}(t,l,e,r),o=qr(a,c),t.classBindings=o}(i,s,t,n,o)}}(s,e,o,true),t!==Wr&&ds(i,o,t)&&function(e,t,n,r,i,s,o,a){if(!(3&t.type))return;const c=e.data,l=c[a+1];Us(1==(1&l)?Ms(c,t,n,i,Qr(l),o):void 0)||(Us(s)||function(e){return 2==(2&e)}(l)&&(s=Ms(c,null,n,i,a,o)),function(e,t,n,r,i){const s=ut(e);i?s?e.addClass(n,r):n.classList.add(r):s?e.removeClass(n,r):n.classList.remove(r)}(r,0,pt(Kt(),n),i,s))}(s,s.data[Kt()],i,i[11],e,i[o+1]=function(e,t){return null==e||"object"==typeof e&&(e=ee(function(e){return e instanceof class{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return"SafeValue must use [property]=binding: "+this.changingThisBreaksApplicationSecurity+" (see https://g.co/ng/security#xss)"}}?e.changingThisBreaksApplicationSecurity:e}(e))),e}(t),true,o)}(e,t),Ds}function Ps(e,t,n,r,i){let s=null;const o=n.directiveEnd;let a=n.directiveStylingLast;for(-1===a?a=n.directiveStart:a++;a<o&&(s=t[a],r=Ls(r,s.hostAttrs,i),s!==e);)a++;return null!==e&&(n.directiveStylingLast=a),r}function Ls(e,t,n){const r=n?1:2;let i=-1;if(null!==t)for(let s=0;s<t.length;s++){const o=t[s];"number"==typeof o?i=o:i===r&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),Fn(e,o,!!n||t[++s]))}return void 0===e?null:e}function Ms(e,t,n,r,i,s){const o=null===t;let a=void 0;for(;i>0;){const t=e[i],s=Array.isArray(t),c=s?t[1]:t,l=null===c;let u=n[i+1];u===Wr&&(u=l?Os:void 0);let d=l?Bn(u,r):c===r?u:void 0;if(s&&!Us(d)&&(d=Bn(t,r)),Us(d)&&(a=d,o))return a;const h=e[i+1];i=o?zr(h):Qr(h)}if(null!==t){let e=s?t.residualClasses:t.residualStyles;null!=e&&(a=Bn(e,r))}return a}function Us(e){return void 0!==e}function xs(e,t=""){const n=It(),r=Ct(),i=e+Ye,s=r.firstCreatePass?ti(r,i,1,t,null):r.data[i],o=n[i]=function(e,t){return ut(e)?e.createText(t):e.createTextNode(t)}(n[11],t);Cr(r,n,o,s),Ot(s,!1)}function Vs(e,t,n){const r=It(),i=hs(r,e,t,n);return i!==Wr&&function(e,t,n){const r=pt(t,e);!function(e,t,n){ut(e)?e.setValue(t,n):t.textContent=n}(e[11],r,n)}(r,Kt(),i),Vs}const Fs=void 0;var Bs=["en",[["a","p"],["AM","PM"],Fs],[["AM","PM"],Fs,Fs],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Fs,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Fs,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Fs,"{1} 'at' {0}",Fs],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(e){let t=Math.floor(Math.abs(e)),n=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===n?1:5}];let js={};function Gs(e){return e in js||(js[e]=Ae.ng&&Ae.ng.common&&Ae.ng.common.locales&&Ae.ng.common.locales[e]),js[e]}var Hs=function(e){return e[e.LocaleId=0]="LocaleId",e[e.DayPeriodsFormat=1]="DayPeriodsFormat",e[e.DayPeriodsStandalone=2]="DayPeriodsStandalone",e[e.DaysFormat=3]="DaysFormat",e[e.DaysStandalone=4]="DaysStandalone",e[e.MonthsFormat=5]="MonthsFormat",e[e.MonthsStandalone=6]="MonthsStandalone",e[e.Eras=7]="Eras",e[e.FirstDayOfWeek=8]="FirstDayOfWeek",e[e.WeekendRange=9]="WeekendRange",e[e.DateFormat=10]="DateFormat",e[e.TimeFormat=11]="TimeFormat",e[e.DateTimeFormat=12]="DateTimeFormat",e[e.NumberSymbols=13]="NumberSymbols",e[e.NumberFormats=14]="NumberFormats",e[e.CurrencyCode=15]="CurrencyCode",e[e.CurrencySymbol=16]="CurrencySymbol",e[e.CurrencyName=17]="CurrencyName",e[e.Currencies=18]="Currencies",e[e.Directionality=19]="Directionality",e[e.PluralCase=20]="PluralCase",e[e.ExtraData=21]="ExtraData",e}({});const Ws="en-US";let Ks=Ws;function Ys(e){var t,n;n="Expected localeId to be defined",null==(t=e)&&function(e,t,n,r){throw new Error("ASSERTION ERROR: "+e+` [Expected=> null != ${t} <=Actual]`)}(n,t),"string"==typeof e&&(Ks=e.toLowerCase().replace(/_/g,"-"))}function qs(e,t,n,r,i){if(e=ie(e),Array.isArray(e))for(let s=0;s<e.length;s++)qs(e[s],t,n,r,i);else{const s=Ct(),o=It();let a=$i(e)?e:ie(e.provide),c=Xi(e);const l=wt(),u=1048575&l.providerIndexes,d=l.directiveStart,h=l.providerIndexes>>20;if($i(e)||!e.multi){const r=new tn(c,i,fs),p=Qs(a,t,i?u:u+h,d);-1===p?(En(fn(l,o),s,a),zs(s,e,t.length),t.push(a),l.directiveStart++,l.directiveEnd++,i&&(l.providerIndexes+=1048576),n.push(r),o.push(r)):(n[p]=r,o[p]=r)}else{const p=Qs(a,t,u+h,d),f=Qs(a,t,u,u+h),_=p>=0&&n[p],m=f>=0&&n[f];if(i&&!m||!i&&!_){En(fn(l,o),s,a);const u=function(e,t,n,r,i){const s=new tn(e,n,fs);return s.multi=[],s.index=t,s.componentProviders=0,Xs(s,i,r&&!n),s}(i?$s:Js,n.length,i,r,c);!i&&m&&(n[f].providerFactory=u),zs(s,e,t.length,0),t.push(a),l.directiveStart++,l.directiveEnd++,i&&(l.providerIndexes+=1048576),n.push(u),o.push(u)}else zs(s,e,p>-1?p:f,Xs(n[i?f:p],c,!i&&r));!i&&r&&m&&n[f].componentProviders++}}}function zs(e,t,n,r){const i=$i(t);if(i||t.useClass){const s=(t.useClass||t).prototype.ngOnDestroy;if(s){const o=e.destroyHooks||(e.destroyHooks=[]);if(!i&&t.multi){const e=o.indexOf(n);-1===e?o.push(n,[r,s]):o[e+1].push(r,s)}else o.push(n,s)}}}function Xs(e,t,n){return n&&e.componentProviders++,e.multi.push(t)-1}function Qs(e,t,n,r){for(let i=n;i<r;i++)if(t[i]===e)return i;return-1}function Js(e,t,n,r){return Zs(this.multi,[])}function $s(e,t,n,r){const i=this.multi;let s;if(this.providerFactory){const e=this.providerFactory.componentProviders,t=Cn(n,n[1],this.providerFactory.index,r);s=t.slice(0,e),Zs(i,s);for(let n=e;n<t.length;n++)s.push(t[n])}else s=[],Zs(i,s);return s}function Zs(e,t){for(let n=0;n<e.length;n++)t.push((0,e[n])());return t}function eo(e,t=[]){return n=>{n.providersResolver=(n,r)=>function(e,t,n){const r=Ct();if(r.firstCreatePass){const i=Ze(e);qs(n,r.data,r.blueprint,i,!0),qs(t,r.data,r.blueprint,i,!1)}}(n,r?r(e):e,t)}}class to{}class no{resolveComponentFactory(e){throw function(e){const t=Error(`No component factory found for ${ee(e)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=e,t}(e)}}let ro=(()=>{class e{}return e.NULL=new no,e})();function io(...e){}function so(e,t){return new ao(ft(e,t))}const oo=function(){return so(wt(),It())};let ao=(()=>{class e{constructor(e){this.nativeElement=e}}return e.__NG_ELEMENT_ID__=oo,e})();class co{}let lo=(()=>{class e{}return e.\u0275prov=oe({token:e,providedIn:"root",factory:()=>null}),e})();class uo{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const ho=new uo("11.0.9");class po{constructor(){}supports(e){return ls(e)}create(e){return new _o(e)}}const fo=(e,t)=>t;class _o{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||fo}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,n=this._removalsHead,r=0,i=null;for(;t||n;){const s=!n||t&&t.currentIndex<vo(n,r,i)?t:n,o=vo(s,r,i),a=s.currentIndex;if(s===n)r--,n=n._nextRemoved;else if(t=t._next,null==s.previousIndex)r++;else{i||(i=[]);const e=o-r,t=a-r;if(e!=t){for(let n=0;n<e;n++){const r=n<i.length?i[n]:i[n]=0,s=r+n;t<=s&&s<e&&(i[n]=r+1)}i[s.previousIndex]=t-e}}o!==a&&e(s,o,a)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!ls(e))throw new Error(`Error trying to diff '${ee(e)}'. Only arrays and iterables are allowed`);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t,n,r,i=this._itHead,s=!1;if(Array.isArray(e)){this.length=e.length;for(let t=0;t<this.length;t++)n=e[t],r=this._trackByFn(t,n),null!==i&&Object.is(i.trackById,r)?(s&&(i=this._verifyReinsertion(i,n,r,t)),Object.is(i.item,n)||this._addIdentityChange(i,n)):(i=this._mismatch(i,n,r,t),s=!0),i=i._next}else t=0,function(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[cs()]();let r;for(;!(r=n.next()).done;)t(r.value)}}(e,e=>{r=this._trackByFn(t,e),null!==i&&Object.is(i.trackById,r)?(s&&(i=this._verifyReinsertion(i,e,r,t)),Object.is(i.item,e)||this._addIdentityChange(i,e)):(i=this._mismatch(i,e,r,t),s=!0),i=i._next,t++}),this.length=t;return this._truncate(i),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,n,r){let i;return null===e?i=this._itTail:(i=e._prev,this._remove(e)),null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,i,r)):null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,i,r)):e=this._addAfter(new mo(t,n),i,r),e}_verifyReinsertion(e,t,n,r){let i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==i?e=this._reinsertAfter(i,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const r=e._prevRemoved,i=e._nextRemoved;return null===r?this._removalsHead=i:r._nextRemoved=i,null===i?this._removalsTail=r:i._prevRemoved=r,this._insertAfter(e,t,n),this._addToMoves(e,n),e}_moveAfter(e,t,n){return this._unlink(e),this._insertAfter(e,t,n),this._addToMoves(e,n),e}_addAfter(e,t,n){return this._insertAfter(e,t,n),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,n){const r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new Eo),this._linkedRecords.put(e),e.currentIndex=n,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,n=e._next;return null===t?this._itHead=n:t._next=n,null===n?this._itTail=t:n._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Eo),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class mo{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class go{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let n;for(n=this._head;null!==n;n=n._nextDup)if((null===t||t<=n.currentIndex)&&Object.is(n.trackById,e))return n;return null}remove(e){const t=e._prevDup,n=e._nextDup;return null===t?this._head=n:t._nextDup=n,null===n?this._tail=t:n._prevDup=t,null===this._head}}class Eo{constructor(){this.map=new Map}put(e){const t=e.trackById;let n=this.map.get(t);n||(n=new go,this.map.set(t,n)),n.add(e)}get(e,t){const n=this.map.get(e);return n?n.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function vo(e,t,n){const r=e.previousIndex;if(null===r)return r;let i=0;return n&&r<n.length&&(i=n[r]),r+t+i}class So{constructor(){}supports(e){return e instanceof Map||us(e)}create(){return new To}}class To{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||us(e)))throw new Error(`Error trying to diff '${ee(e)}'. Only maps and objects are allowed`)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(e,n)=>{if(t&&t.key===n)this._maybeAddToChanges(t,e),this._appendAfter=t,t=t._next;else{const r=this._getOrCreateRecordForKey(n,e);t=this._insertBeforeOrAppend(t,r)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let e=t;null!==e;e=e._nextRemoved)e===this._mapHead&&(this._mapHead=null),this._records.delete(e.key),e._nextRemoved=e._next,e.previousValue=e.currentValue,e.currentValue=null,e._prev=null,e._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const n=e._prev;return t._next=e,t._prev=n,e._prev=t,n&&(n._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const n=this._records.get(e);this._maybeAddToChanges(n,t);const r=n._prev,i=n._next;return r&&(r._next=i),i&&(i._prev=r),n._next=null,n._prev=null,n}const n=new Ro(e);return this._records.set(e,n),n.currentValue=t,this._addToAdditions(n),n}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(n=>t(e[n],n))}}class Ro{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}let yo=(()=>{class e{constructor(e){this.factories=e}static create(t,n){if(null!=n){const e=n.factories.slice();t=t.concat(e)}return new e(t)}static extend(t){return{provide:e,useFactory:n=>{if(!n)throw new Error("Cannot extend IterableDiffers without a parent injector");return e.create(t,n)},deps:[[e,new Kn,new Hn]]}}find(e){const t=this.factories.find(t=>t.supports(e));if(null!=t)return t;throw new Error(`Cannot find a differ supporting object '${e}' of type '${n=e,n.name||typeof n}'`);var n}}return e.\u0275prov=oe({token:e,providedIn:"root",factory:()=>new e([new po])}),e})(),Io=(()=>{class e{constructor(e){this.factories=e}static create(t,n){if(n){const e=n.factories.slice();t=t.concat(e)}return new e(t)}static extend(t){return{provide:e,useFactory:n=>{if(!n)throw new Error("Cannot extend KeyValueDiffers without a parent injector");return e.create(t,n)},deps:[[e,new Kn,new Hn]]}}find(e){const t=this.factories.find(t=>t.supports(e));if(t)return t;throw new Error(`Cannot find a differ supporting object '${e}'`)}}return e.\u0275prov=oe({token:e,providedIn:"root",factory:()=>new e([new So])}),e})();function Co(e,t,n,r,i=!1){for(;null!==n;){const s=t[n.index];if(null!==s&&r.push(ht(s)),Xe(s))for(let e=qe;e<s.length;e++){const t=s[e],n=t[1].firstChild;null!==n&&Co(t[1],t,n,r)}const o=n.type;if(8&o)Co(e,t,n.child,r);else if(32&o){const e=ur(n,t);let i;for(;i=e();)r.push(i)}else if(16&o){const e=t[16],i=e[6].projection[n.projection];if(Array.isArray(i))r.push(...i);else{const t=dr(e);Co(t[1],t,i,r,!0)}}n=i?n.projectionNext:n.next}return r}class Ao{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return Co(t,e,t.firstChild,[])}get context(){return this._lView[8]}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(Xe(e)){const t=e[8],n=t?t.indexOf(this):-1;n>-1&&(Er(e,n),Vn(t,n))}this._attachedToViewContainer=!1}vr(this._lView[1],this._lView)}onDestroy(e){!function(e,t,n,r){const i=Pi(t);i.push(r)}(0,this._lView,0,e)}markForCheck(){bi(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){Oi(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(e,t,n){Dt(!0);try{Oi(e,t,n)}finally{Dt(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){var e;this._appRef=null,Or(this._lView[1],e=this._lView,e[11],2,null,null)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}}class wo extends Ao{constructor(e){super(e),this._view=e}detectChanges(){Ni(this._view)}checkNoChanges(){!function(e){Dt(!0);try{Ni(e)}finally{Dt(!1)}}(this._view)}get context(){return null}}const bo=function(e=!1){return function(e,t,n){if(!n&&Je(e)){const n=mt(e.index,t);return new Ao(n,n)}return 47&e.type?new Ao(t[16],t):null}(wt(),It(),e)};let Oo=(()=>{class e{}return e.__NG_ELEMENT_ID__=bo,e.__ChangeDetectorRef__=!0,e})();const No=[new So],ko=new yo([new po]),Do=new Io(No),Po=function(){return e=wt(),t=It(),4&e.type?new Uo(t,e,so(e,t)):null;var e,t};let Lo=(()=>{class e{}return e.__NG_ELEMENT_ID__=Po,e})();const Mo=Lo,Uo=class extends Mo{constructor(e,t,n){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=n}createEmbeddedView(e){const t=this._declarationTContainer.tViews,n=ei(this._declarationLView,t,e,16,null,t.declTNode,null,null,null,null);n[17]=this._declarationLView[this._declarationTContainer.index];const r=this._declarationLView[19];return null!==r&&(n[19]=r.createEmbeddedView(t)),ri(t,n,e),new Ao(n)}};class xo{}class Vo{}const Fo=function(){return function(e,t){let n;const r=t[e.index];if(Xe(r))n=r;else{let i;if(8&e.type)i=ht(r);else{const n=t[11];i=n.createComment("");const r=ft(e,t);Tr(n,Ir(n,r),i,function(e,t){return ut(e)?e.nextSibling(t):t.nextSibling}(n,r),!1)}t[e.index]=n=yi(r,t,i,e),wi(t,n)}return new Go(n,e,t)}(wt(),It())};let Bo=(()=>{class e{}return e.__NG_ELEMENT_ID__=Fo,e})();const jo=Bo,Go=class extends jo{constructor(e,t,n){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=n}get element(){return so(this._hostTNode,this._hostLView)}get injector(){return new bn(this._hostTNode,this._hostLView)}get parentInjector(){const e=gn(this._hostTNode,this._hostLView);if(cn(e)){const t=un(e,this._hostLView),n=ln(e);return new bn(t[1].data[n+8],t)}return new bn(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=Ho(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-qe}createEmbeddedView(e,t,n){const r=e.createEmbeddedView(t||{});return this.insert(r,n),r}createComponent(e,t,n,r,i){const s=n||this.parentInjector;if(!i&&null==e.ngModule&&s){const e=s.get(xo,null);e&&(i=e)}const o=e.create(s,r,void 0,i);return this.insert(o.hostView,t),o}insert(e,t){const n=e._lView,r=n[1];if(Xe(n[3])){const t=this.indexOf(e);if(-1!==t)this.detach(t);else{const t=n[3],r=new Go(t,t[6],t[3]);r.detach(r.indexOf(e))}}const i=this._adjustIndex(t),s=this._lContainer;!function(e,t,n,r){const i=qe+r,s=n.length;r>0&&(n[i-1][4]=t),r<s-qe?(t[4]=n[i],xn(n,qe+r,t)):(n.push(t),t[4]=null),t[3]=n;const o=t[17];null!==o&&n!==o&&function(e,t){const n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(o,t);const a=t[19];null!==a&&a.insertView(e),t[2]|=128}(r,n,s,i);const o=wr(i,s),a=n[11],c=Ir(a,s[7]);return null!==c&&function(e,t,n,r,i,s){r[0]=i,r[6]=t,Or(e,r,n,1,i,s)}(r,s[6],a,n,c,o),e.attachToViewContainerRef(),xn(Wo(s),i,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=Ho(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),n=Er(this._lContainer,t);n&&(Vn(Wo(this._lContainer),t),vr(n[1],n))}detach(e){const t=this._adjustIndex(e,-1),n=Er(this._lContainer,t);return n&&null!=Vn(Wo(this._lContainer),t)?new Ao(n):null}_adjustIndex(e,t=0){return null==e?this.length+t:e}};function Ho(e){return e[8]}function Wo(e){return e[8]||(e[8]=[])}const Ko={};class Yo extends ro{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=We(e);return new Xo(t,this.ngModule)}}function qo(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}const zo=new Pn("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>ar});class Xo extends to{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=e.selectors.map(Hr).join(","),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return qo(this.componentDef.inputs)}get outputs(){return qo(this.componentDef.outputs)}create(e,t,n,r){const i=(r=r||this.ngModule)?function(e,t){return{get:(n,r,i)=>{const s=e.get(n,Ko,i);return s!==Ko||r===Ko?s:t.get(n,r,i)}}}(e,r.injector):e,s=i.get(co,dt),o=i.get(lo,null),a=s.createRenderer(null,this.componentDef),c=this.componentDef.selectors[0][0]||"div",l=n?function(e,t,n){if(ut(e))return e.selectRootElement(t,n===Te.ShadowDom);let r="string"==typeof t?e.querySelector(t):t;return r.textContent="",r}(a,n,this.componentDef.encapsulation):mr(s.createRenderer(null,this.componentDef),c,function(e){const t=e.toLowerCase();return"svg"===t?"http://www.w3.org/2000/svg":"math"===t?"http://www.w3.org/1998/MathML/":null}(c)),u=this.componentDef.onPush?576:528,d={components:[],scheduler:ar,clean:Di,playerHandler:null,flags:0},h=ui(0,null,null,1,0,null,null,null,null,null),p=ei(null,h,d,u,null,null,s,a,o,i);let f,_;Ft(p);try{const e=function(e,t,n,r,i,s){const o=n[1];n[20]=e;const a=ti(o,20,2,"#host",null),c=a.mergedAttrs=t.hostAttrs;null!==c&&(xi(a,c,!0),null!==e&&(nn(i,e,c),null!==a.classes&&Dr(i,e,a.classes),null!==a.styles&&kr(i,e,a.styles)));const l=r.createRenderer(e,t),u=ei(n,li(t),null,t.onPush?64:16,n[20],a,r,l,null,null);return o.firstCreatePass&&(En(fn(a,n),o,t.type),mi(o,a),Ei(a,n.length,1)),wi(n,u),n[20]=u}(l,this.componentDef,p,s,a);if(l)if(n)nn(a,l,["ng-version",ho.full]);else{const{attrs:e,classes:t}=function(e){const t=[],n=[];let r=1,i=2;for(;r<e.length;){let s=e[r];if("string"==typeof s)2===i?""!==s&&t.push(s,e[++r]):8===i&&n.push(s);else{if(!Fr(i))break;i=s}r++}return{attrs:t,classes:n}}(this.componentDef.selectors[0]);e&&nn(a,l,e),t&&t.length>0&&Dr(a,l,t.join(" "))}if(_=_t(h,Ye),void 0!==t){const e=_.projection=[];for(let n=0;n<this.ngContentSelectors.length;n++){const r=t[n];e.push(null!=r?Array.from(r):null)}}f=function(e,t,n,r,i){const s=n[1],o=function(e,t,n){const r=wt();e.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),vi(e,r,t,ni(e,t,1,null),n));const i=Cn(t,e,r.directiveStart,r);or(i,t);const s=ft(r,t);return s&&or(s,t),i}(s,n,t);if(r.components.push(o),e[8]=o,i&&i.forEach(e=>e(o,t)),t.contentQueries){const e=wt();t.contentQueries(1,o,e.directiveStart)}const a=wt();return!s.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(Yt(a.index),fi(n[1],a,0,a.directiveStart,a.directiveEnd,t),_i(t,o)),o}(e,this.componentDef,p,d,[ts]),ri(h,p,null)}finally{Wt()}return new Qo(this.componentType,f,so(_,p),p,_)}}class Qo extends class{}{constructor(e,t,n,r,i){super(),this.location=n,this._rootLView=r,this._tNode=i,this.instance=t,this.hostView=this.changeDetectorRef=new wo(r),this.componentType=e}get injector(){return new bn(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}const Jo=new Map;class $o extends xo{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new Yo(this);const n=Ke(e),r=e[Pe]||null;r&&Ys(r),this._bootstrapComponents=cr(n.bootstrap),this._r3Injector=Yi(e,t,[{provide:xo,useValue:this},{provide:ro,useValue:this.componentFactoryResolver}],ee(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,t=es.THROW_IF_NOT_FOUND,n=_e.Default){return e===es||e===xo||e===Vi?this:this._r3Injector.get(e,t,n)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class Zo extends Vo{constructor(e){super(),this.moduleType=e,null!==Ke(e)&&function(e){const t=new Set;!function e(n){const r=Ke(n,!0),i=r.id;null!==i&&(function(e,t,n){if(t&&t!==n)throw new Error(`Duplicate module registered for ${e} - ${ee(t)} vs ${ee(t.name)}`)}(i,Jo.get(i),n),Jo.set(i,n));const s=cr(r.imports);for(const o of s)t.has(o)||(t.add(o),e(o))}(e)}(e)}create(e){return new $o(this.moduleType,e)}}const ea=class extends y{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,n){let r,i=e=>null,s=()=>null;e&&"object"==typeof e?(r=this.__isAsync?t=>{setTimeout(()=>e.next(t))}:t=>{e.next(t)},e.error&&(i=this.__isAsync?t=>{setTimeout(()=>e.error(t))}:t=>{e.error(t)}),e.complete&&(s=this.__isAsync?()=>{setTimeout(()=>e.complete())}:()=>{e.complete()})):(r=this.__isAsync?t=>{setTimeout(()=>e(t))}:t=>{e(t)},t&&(i=this.__isAsync?e=>{setTimeout(()=>t(e))}:e=>{t(e)}),n&&(s=this.__isAsync?()=>{setTimeout(()=>n())}:()=>{n()}));const o=super.subscribe(r,i,s);return e instanceof d&&e.add(o),o}},ta=new Pn("Application Initializer");let na=(()=>{class e{constructor(e){this.appInits=e,this.resolve=io,this.reject=io,this.initialized=!1,this.done=!1,this.donePromise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}runInitializers(){if(this.initialized)return;const e=[],t=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let n=0;n<this.appInits.length;n++){const t=this.appInits[n]();Ts(t)&&e.push(t)}Promise.all(e).then(()=>{t()}).catch(e=>{this.reject(e)}),0===e.length&&t(),this.initialized=!0}}return e.\u0275fac=function(t){return new(t||e)(er(ta,8))},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})();const ra=new Pn("AppId"),ia={provide:ra,useFactory:function(){return`${sa()}${sa()}${sa()}`},deps:[]};function sa(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const oa=new Pn("Platform Initializer"),aa=new Pn("Platform ID"),ca=new Pn("appBootstrapListener");let la=(()=>{class e{log(e){console.log(e)}warn(e){console.warn(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})();const ua=new Pn("LocaleId"),da=new Pn("DefaultCurrencyCode");class ha{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}const pa=function(e){return new Zo(e)},fa=pa,_a=function(e){return Promise.resolve(pa(e))},ma=function(e){const t=pa(e),n=cr(Ke(e).declarations).reduce((e,t)=>{const n=We(t);return n&&e.push(new Xo(n)),e},[]);return new ha(t,n)},ga=ma,Ea=function(e){return Promise.resolve(ma(e))};let va=(()=>{class e{constructor(){this.compileModuleSync=fa,this.compileModuleAsync=_a,this.compileModuleAndAllComponentsSync=ga,this.compileModuleAndAllComponentsAsync=Ea}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})();const Sa=(()=>Promise.resolve(0))();function Ta(e){"undefined"==typeof Zone?Sa.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class Ra{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new ea(!1),this.onMicrotaskEmpty=new ea(!1),this.onStable=new ea(!1),this.onError=new ea(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const n=this;n._nesting=0,n._outer=n._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(n._inner=n._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(n._inner=n._inner.fork(Zone.longStackTraceZoneSpec)),n.shouldCoalesceEventChangeDetection=t,n.lastRequestAnimationFrameId=-1,n.nativeRequestAnimationFrame=function(){let e=Ae.requestAnimationFrame,t=Ae.cancelAnimationFrame;if("undefined"!=typeof Zone&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function(e){const t=!!e.shouldCoalesceEventChangeDetection&&e.nativeRequestAnimationFrame&&(()=>{!function(e){-1===e.lastRequestAnimationFrameId&&(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(Ae,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,Ca(e),Ia(e)},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),Ca(e))}(e)});e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0,maybeDelayChangeDetection:t},onInvokeTask:(n,r,i,s,o,a)=>{try{return Aa(e),n.invokeTask(i,s,o,a)}finally{t&&"eventTask"===s.type&&t(),wa(e)}},onInvoke:(t,n,r,i,s,o,a)=>{try{return Aa(e),t.invoke(r,i,s,o,a)}finally{wa(e)}},onHasTask:(t,n,r,i)=>{t.hasTask(r,i),n===r&&("microTask"==i.change?(e._hasPendingMicrotasks=i.microTask,Ca(e),Ia(e)):"macroTask"==i.change&&(e.hasPendingMacrotasks=i.macroTask))},onHandleError:(t,n,r,i)=>(t.handleError(r,i),e.runOutsideAngular(()=>e.onError.emit(i)),!1)})}(n)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Ra.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Ra.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,t,n){return this._inner.run(e,t,n)}runTask(e,t,n,r){const i=this._inner,s=i.scheduleEventTask("NgZoneEvent: "+r,e,ya,io,io);try{return i.runTask(s,t,n)}finally{i.cancelTask(s)}}runGuarded(e,t,n){return this._inner.runGuarded(e,t,n)}runOutsideAngular(e){return this._outer.run(e)}}const ya={};function Ia(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function Ca(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||e.shouldCoalesceEventChangeDetection&&-1!==e.lastRequestAnimationFrameId)}function Aa(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function wa(e){e._nesting--,Ia(e)}class ba{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new ea,this.onMicrotaskEmpty=new ea,this.onStable=new ea,this.onError=new ea}run(e,t,n){return e.apply(t,n)}runGuarded(e,t,n){return e.apply(t,n)}runOutsideAngular(e){return e()}runTask(e,t,n,r){return e.apply(t,n)}}let Oa=(()=>{class e{constructor(e){this._ngZone=e,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Ra.assertNotInAngularZone(),Ta(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Ta(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(t=>!t.updateCb||!t.updateCb(e)||(clearTimeout(t.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,t,n){let r=-1;t&&t>0&&(r=setTimeout(()=>{this._callbacks=this._callbacks.filter(e=>e.timeoutId!==r),e(this._didWork,this.getPendingTasks())},t)),this._callbacks.push({doneCb:e,timeoutId:r,updateCb:n})}whenStable(e,t,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/dist/task-tracking.js" loaded?');this.addCallback(e,t,n),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(e,t,n){return[]}}return e.\u0275fac=function(t){return new(t||e)(er(Ra))},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})(),Na=(()=>{class e{constructor(){this._applications=new Map,Pa.addToWindow(this)}registerApplication(e,t){this._applications.set(e,t)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,t=!0){return Pa.findTestabilityInTree(this,e,t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})();class ka{addToWindow(e){}findTestabilityInTree(e,t,n){return null}}let Da,Pa=new ka,La=!0,Ma=!1;function Ua(){return Ma=!0,La}const xa=new Pn("AllowMultipleToken");class Va{constructor(e,t){this.name=e,this.token=t}}function Fa(e,t,n=[]){const r="Platform: "+t,i=new Pn(r);return(t=[])=>{let s=Ba();if(!s||s.injector.get(xa,!1))if(e)e(n.concat(t).concat({provide:i,useValue:!0}));else{const e=n.concat(t).concat({provide:i,useValue:!0},{provide:Bi,useValue:"platform"});!function(e){if(Da&&!Da.destroyed&&!Da.injector.get(xa,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");Da=e.get(ja);const t=e.get(oa,null);t&&t.forEach(e=>e())}(es.create({providers:e,name:r}))}return function(e){const t=Ba();if(!t)throw new Error("No platform exists!");if(!t.injector.get(e,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return t}(i)}}function Ba(){return Da&&!Da.destroyed?Da:null}let ja=(()=>{class e{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,t){const n=function(e,t){let n;return n="noop"===e?new ba:("zone.js"===e?void 0:e)||new Ra({enableLongStackTrace:Ua(),shouldCoalesceEventChangeDetection:t}),n}(t?t.ngZone:void 0,t&&t.ngZoneEventCoalescing||!1),r=[{provide:Ra,useValue:n}];return n.run(()=>{const t=es.create({providers:r,parent:this.injector,name:e.moduleType.name}),i=e.create(t),s=i.injector.get(sr,null);if(!s)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return n.runOutsideAngular(()=>{const e=n.onError.subscribe({next:e=>{s.handleError(e)}});i.onDestroy(()=>{Wa(this._modules,i),e.unsubscribe()})}),function(e,t,n){try{const r=n();return Ts(r)?r.catch(n=>{throw t.runOutsideAngular(()=>e.handleError(n)),n}):r}catch(r){throw t.runOutsideAngular(()=>e.handleError(r)),r}}(s,n,()=>{const e=i.injector.get(na);return e.runInitializers(),e.donePromise.then(()=>(Ys(i.injector.get(ua,Ws)||Ws),this._moduleDoBootstrap(i),i))})})}bootstrapModule(e,t=[]){const n=Ga({},t);return function(e,t,n){const r=new Zo(n);return Promise.resolve(r)}(0,0,e).then(e=>this.bootstrapModuleFactory(e,n))}_moduleDoBootstrap(e){const t=e.injector.get(Ha);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(e=>t.bootstrap(e));else{if(!e.instance.ngDoBootstrap)throw new Error(`The module ${ee(e.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);e.instance.ngDoBootstrap(t)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(e=>e.destroy()),this._destroyListeners.forEach(e=>e()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(t){return new(t||e)(er(es))},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})();function Ga(e,t){return Array.isArray(t)?t.reduce(Ga,e):Object.assign(Object.assign({},e),t)}let Ha=(()=>{class e{constructor(e,t,n,r,i,s){this._zone=e,this._console=t,this._injector=n,this._exceptionHandler=r,this._componentFactoryResolver=i,this._initStatus=s,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const o=new E(e=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{e.next(this._stable),e.complete()})}),a=new E(e=>{let t;this._zone.runOutsideAngular(()=>{t=this._zone.onStable.subscribe(()=>{Ra.assertNotInAngularZone(),Ta(()=>{this._stable||this._zone.hasPendingMacrotasks||this._zone.hasPendingMicrotasks||(this._stable=!0,e.next(!0))})})});const n=this._zone.onUnstable.subscribe(()=>{Ra.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{e.next(!1)}))});return()=>{t.unsubscribe(),n.unsubscribe()}});this.isStable=function(...e){let t=Number.POSITIVE_INFINITY,n=null,r=e[e.length-1];return C(r)?(n=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(t=e.pop())):"number"==typeof r&&(t=e.pop()),null===n&&1===e.length&&e[0]instanceof E?e[0]:H(t)(W(e,n))}(o,a.pipe(e=>{return K()((t=J,function(e){let n;n="function"==typeof t?t:function(){return t};const r=Object.create(e,X);return r.source=e,r.subjectFactory=n,r})(e));var t}))}bootstrap(e,t){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let n;n=e instanceof to?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(n.componentType);const r=n.isBoundToModule?void 0:this._injector.get(xo),i=n.create(es.NULL,[],t||n.selector,r),s=i.location.nativeElement,o=i.injector.get(Oa,null),a=o&&i.injector.get(Na);return o&&a&&a.registerApplication(s,o),i.onDestroy(()=>{this.detachView(i.hostView),Wa(this.components,i),a&&a.unregisterApplication(s)}),this._loadComponent(i),Ua()&&this._console.log("Angular is running in development mode. Call enableProdMode() to enable production mode."),i}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const t=e;this._views.push(t),t.attachToAppRef(this)}detachView(e){const t=e;Wa(this._views,t),t.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(ca,[]).concat(this._bootstrapListeners).forEach(t=>t(e))}ngOnDestroy(){this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return e.\u0275fac=function(t){return new(t||e)(er(Ra),er(la),er(es),er(sr),er(ro),er(na))},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})();function Wa(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class Ka{}class Ya{}const qa={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};let za=(()=>{class e{constructor(e,t){this._compiler=e,this._config=t||qa}load(e){return this.loadAndCompile(e)}loadAndCompile(e){let[t,r]=e.split("#");return void 0===r&&(r="default"),n("zn8P")(t).then(e=>e[r]).then(e=>Xa(e,t,r)).then(e=>this._compiler.compileModuleAsync(e))}loadFactory(e){let[t,r]=e.split("#"),i="NgFactory";return void 0===r&&(r="default",i=""),n("zn8P")(this._config.factoryPathPrefix+t+this._config.factoryPathSuffix).then(e=>e[r+i]).then(e=>Xa(e,t,r))}}return e.\u0275fac=function(t){return new(t||e)(er(va),er(Ya,8))},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})();function Xa(e,t,n){if(!e)throw new Error(`Cannot find '${n}' in '${t}'`);return e}const Qa=Fa(null,"core",[{provide:aa,useValue:"unknown"},{provide:ja,deps:[es]},{provide:Na,deps:[]},{provide:la,deps:[]}]),Ja=[{provide:Ha,useClass:Ha,deps:[Ra,la,es,sr,ro,na]},{provide:zo,deps:[Ra],useFactory:function(e){let t=[];return e.onStable.subscribe(()=>{for(;t.length;)t.pop()()}),function(e){t.push(e)}}},{provide:na,useClass:na,deps:[[new Hn,ta]]},{provide:va,useClass:va,deps:[]},ia,{provide:yo,useFactory:function(){return ko},deps:[]},{provide:Io,useFactory:function(){return Do},deps:[]},{provide:ua,useFactory:function(e){return Ys(e=e||"undefined"!=typeof $localize&&$localize.locale||Ws),e},deps:[[new Gn(ua),new Hn,new Kn]]},{provide:da,useValue:"USD"}];let $a=(()=>{class e{constructor(e){}}return e.\u0275mod=je({type:e}),e.\u0275inj=ae({factory:function(t){return new(t||e)(er(Ha))},providers:Ja}),e})(),Za=null;function ec(){return Za}const tc=new Pn("DocumentToken");let nc=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=oe({factory:rc,token:e,providedIn:"platform"}),e})();function rc(){return er(sc)}const ic=new Pn("Location Initialized");let sc=(()=>{class e extends nc{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=ec().getLocation(),this._history=ec().getHistory()}getBaseHrefFromDOM(){return ec().getBaseHref(this._doc)}onPopState(e){ec().getGlobalEventTarget(this._doc,"window").addEventListener("popstate",e,!1)}onHashChange(e){ec().getGlobalEventTarget(this._doc,"window").addEventListener("hashchange",e,!1)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,t,n){oc()?this._history.pushState(e,t,n):this.location.hash=n}replaceState(e,t,n){oc()?this._history.replaceState(e,t,n):this.location.hash=n}forward(){this._history.forward()}back(){this._history.back()}getState(){return this._history.state}}return e.\u0275fac=function(t){return new(t||e)(er(tc))},e.\u0275prov=oe({factory:ac,token:e,providedIn:"platform"}),e})();function oc(){return!!window.history.pushState}function ac(){return new sc(er(tc))}function cc(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function lc(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function uc(e){return e&&"?"!==e[0]?"?"+e:e}let dc=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=oe({factory:hc,token:e,providedIn:"root"}),e})();function hc(e){const t=er(tc).location;return new fc(er(nc),t&&t.origin||"")}const pc=new Pn("appBaseHref");let fc=(()=>{class e extends dc{constructor(e,t){if(super(),this._platformLocation=e,null==t&&(t=this._platformLocation.getBaseHrefFromDOM()),null==t)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=t}onPopState(e){this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e)}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return cc(this._baseHref,e)}path(e=!1){const t=this._platformLocation.pathname+uc(this._platformLocation.search),n=this._platformLocation.hash;return n&&e?`${t}${n}`:t}pushState(e,t,n,r){const i=this.prepareExternalUrl(n+uc(r));this._platformLocation.pushState(e,t,i)}replaceState(e,t,n,r){const i=this.prepareExternalUrl(n+uc(r));this._platformLocation.replaceState(e,t,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}}return e.\u0275fac=function(t){return new(t||e)(er(nc),er(pc,8))},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})(),_c=(()=>{class e extends dc{constructor(e,t){super(),this._platformLocation=e,this._baseHref="",null!=t&&(this._baseHref=t)}onPopState(e){this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e)}getBaseHref(){return this._baseHref}path(e=!1){let t=this._platformLocation.hash;return null==t&&(t="#"),t.length>0?t.substring(1):t}prepareExternalUrl(e){const t=cc(this._baseHref,e);return t.length>0?"#"+t:t}pushState(e,t,n,r){let i=this.prepareExternalUrl(n+uc(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.pushState(e,t,i)}replaceState(e,t,n,r){let i=this.prepareExternalUrl(n+uc(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.replaceState(e,t,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}}return e.\u0275fac=function(t){return new(t||e)(er(nc),er(pc,8))},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})(),mc=(()=>{class e{constructor(e,t){this._subject=new ea,this._urlChangeListeners=[],this._platformStrategy=e;const n=this._platformStrategy.getBaseHref();this._platformLocation=t,this._baseHref=lc(Ec(n)),this._platformStrategy.onPopState(e=>{this._subject.emit({url:this.path(!0),pop:!0,state:e.state,type:e.type})})}path(e=!1){return this.normalize(this._platformStrategy.path(e))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(e,t=""){return this.path()==this.normalize(e+uc(t))}normalize(t){return e.stripTrailingSlash(function(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,Ec(t)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._platformStrategy.prepareExternalUrl(e)}go(e,t="",n=null){this._platformStrategy.pushState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+uc(t)),n)}replaceState(e,t="",n=null){this._platformStrategy.replaceState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+uc(t)),n)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}onUrlChange(e){this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(e=>{this._notifyUrlChangeListeners(e.url,e.state)}))}_notifyUrlChangeListeners(e="",t){this._urlChangeListeners.forEach(n=>n(e,t))}subscribe(e,t,n){return this._subject.subscribe({next:e,error:t,complete:n})}}return e.\u0275fac=function(t){return new(t||e)(er(dc),er(nc))},e.normalizeQueryParams=uc,e.joinWithSlash=cc,e.stripTrailingSlash=lc,e.\u0275prov=oe({factory:gc,token:e,providedIn:"root"}),e})();function gc(){return new mc(er(dc),er(nc))}function Ec(e){return e.replace(/\/index.html$/,"")}var vc=function(e){return e[e.Zero=0]="Zero",e[e.One=1]="One",e[e.Two=2]="Two",e[e.Few=3]="Few",e[e.Many=4]="Many",e[e.Other=5]="Other",e}({});class Sc{}let Tc=(()=>{class e extends Sc{constructor(e){super(),this.locale=e}getPluralCategory(e,t){switch(function(e){return function(e){const t=function(e){return e.toLowerCase().replace(/_/g,"-")}(e);let n=Gs(t);if(n)return n;const r=t.split("-")[0];if(n=Gs(r),n)return n;if("en"===r)return Bs;throw new Error(`Missing locale data for the locale "${e}".`)}(e)[Hs.PluralCase]}(t||this.locale)(e)){case vc.Zero:return"zero";case vc.One:return"one";case vc.Two:return"two";case vc.Few:return"few";case vc.Many:return"many";default:return"other"}}}return e.\u0275fac=function(t){return new(t||e)(er(ua))},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})();function Rc(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const e=n.indexOf("="),[r,i]=-1==e?[n,""]:[n.slice(0,e),n.slice(e+1)];if(r.trim()===t)return decodeURIComponent(i)}return null}class yc{constructor(e,t,n,r){this.$implicit=e,this.ngForOf=t,this.index=n,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Ic=(()=>{class e{constructor(e,t,n){this._viewContainer=e,this._template=t,this._differs=n,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;if(!this._differ&&n)try{this._differ=this._differs.find(n).create(this.ngForTrackBy)}catch(t){throw new Error(`Cannot find a differ supporting object '${n}' of type '${e=n,e.name||typeof e}'. NgFor only supports binding to Iterables such as Arrays.`)}}var e;if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const t=[];e.forEachOperation((e,n,r)=>{if(null==e.previousIndex){const n=this._viewContainer.createEmbeddedView(this._template,new yc(null,this._ngForOf,-1,-1),null===r?void 0:r),i=new Cc(e,n);t.push(i)}else if(null==r)this._viewContainer.remove(null===n?void 0:n);else if(null!==n){const i=this._viewContainer.get(n);this._viewContainer.move(i,r);const s=new Cc(e,i);t.push(s)}});for(let n=0;n<t.length;n++)this._perViewChange(t[n].view,t[n].record);for(let n=0,r=this._viewContainer.length;n<r;n++){const e=this._viewContainer.get(n);e.context.index=n,e.context.count=r,e.context.ngForOf=this._ngForOf}e.forEachIdentityChange(e=>{this._viewContainer.get(e.currentIndex).context.$implicit=e.item})}_perViewChange(e,t){e.context.$implicit=t.item}static ngTemplateContextGuard(e,t){return!0}}return e.\u0275fac=function(t){return new(t||e)(fs(Bo),fs(Lo),fs(yo))},e.\u0275dir=He({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),e})();class Cc{constructor(e,t){this.record=e,this.view=t}}let Ac=(()=>{class e{constructor(e,t){this._viewContainer=e,this._context=new wc,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=t}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){bc("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){bc("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,t){return!0}}return e.\u0275fac=function(t){return new(t||e)(fs(Bo),fs(Lo))},e.\u0275dir=He({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),e})();class wc{constructor(){this.$implicit=null,this.ngIf=null}}function bc(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${ee(t)}'.`)}let Oc=(()=>{class e{}return e.\u0275mod=je({type:e}),e.\u0275inj=ae({factory:function(t){return new(t||e)},providers:[{provide:Sc,useClass:Tc}]}),e})(),Nc=(()=>{class e{}return e.\u0275prov=oe({token:e,providedIn:"root",factory:()=>new kc(er(tc),window)}),e})();class kc{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){var t;if(!this.supportsScrolling())return;const n=null!==(t=this.document.getElementById(e))&&void 0!==t?t:this.document.getElementsByName(e)[0];void 0!==n&&(this.scrollToElement(n),this.attemptFocus(n))}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),n=t.left+this.window.pageXOffset,r=t.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(n-i[0],r-i[1])}attemptFocus(e){return e.focus(),this.document.activeElement===e}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=Dc(this.window.history)||Dc(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch(e){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(e){return!1}}}function Dc(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class Pc extends class extends class{}{constructor(){super()}supportsDOMEvents(){return!0}}{static makeCurrent(){var e;e=new Pc,Za||(Za=e)}getProperty(e,t){return e[t]}log(e){window.console&&window.console.log&&window.console.log(e)}logGroup(e){window.console&&window.console.group&&window.console.group(e)}logGroupEnd(){window.console&&window.console.groupEnd&&window.console.groupEnd()}onAndCancel(e,t,n){return e.addEventListener(t,n,!1),()=>{e.removeEventListener(t,n,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){return e.parentNode&&e.parentNode.removeChild(e),e}getValue(e){return e.value}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getHistory(){return window.history}getLocation(){return window.location}getBaseHref(e){const t=Mc||(Mc=document.querySelector("base"),Mc)?Mc.getAttribute("href"):null;return null==t?null:(n=t,Lc||(Lc=document.createElement("a")),Lc.setAttribute("href",n),"/"===Lc.pathname.charAt(0)?Lc.pathname:"/"+Lc.pathname);var n}resetBaseElement(){Mc=null}getUserAgent(){return window.navigator.userAgent}performanceNow(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}supportsCookies(){return!0}getCookie(e){return Rc(document.cookie,e)}}let Lc,Mc=null;const Uc=new Pn("TRANSITION_ID"),xc=[{provide:ta,useFactory:function(e,t,n){return()=>{n.get(na).donePromise.then(()=>{const n=ec();Array.prototype.slice.apply(t.querySelectorAll("style[ng-transition]")).filter(t=>t.getAttribute("ng-transition")===e).forEach(e=>n.remove(e))})}},deps:[Uc,tc,es],multi:!0}];class Vc{static init(){var e;e=new Vc,Pa=e}addToWindow(e){Ae.getAngularTestability=(t,n=!0)=>{const r=e.findTestabilityInTree(t,n);if(null==r)throw new Error("Could not find testability for element.");return r},Ae.getAllAngularTestabilities=()=>e.getAllTestabilities(),Ae.getAllAngularRootElements=()=>e.getAllRootElements(),Ae.frameworkStabilizers||(Ae.frameworkStabilizers=[]),Ae.frameworkStabilizers.push(e=>{const t=Ae.getAllAngularTestabilities();let n=t.length,r=!1;const i=function(t){r=r||t,n--,0==n&&e(r)};t.forEach(function(e){e.whenStable(i)})})}findTestabilityInTree(e,t,n){if(null==t)return null;const r=e.getTestability(t);return null!=r?r:n?ec().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null}}const Fc=new Pn("EventManagerPlugins");let Bc=(()=>{class e{constructor(e,t){this._zone=t,this._eventNameToPlugin=new Map,e.forEach(e=>e.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,t,n){return this._findPluginFor(t).addEventListener(e,t,n)}addGlobalEventListener(e,t,n){return this._findPluginFor(t).addGlobalEventListener(e,t,n)}getZone(){return this._zone}_findPluginFor(e){const t=this._eventNameToPlugin.get(e);if(t)return t;const n=this._plugins;for(let r=0;r<n.length;r++){const t=n[r];if(t.supports(e))return this._eventNameToPlugin.set(e,t),t}throw new Error("No event manager plugin found for event "+e)}}return e.\u0275fac=function(t){return new(t||e)(er(Fc),er(Ra))},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})();class jc{constructor(e){this._doc=e}addGlobalEventListener(e,t,n){const r=ec().getGlobalEventTarget(this._doc,e);if(!r)throw new Error(`Unsupported event target ${r} for event ${t}`);return this.addEventListener(r,t,n)}}let Gc=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(e){const t=new Set;e.forEach(e=>{this._stylesSet.has(e)||(this._stylesSet.add(e),t.add(e))}),this.onStylesAdded(t)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})(),Hc=(()=>{class e extends Gc{constructor(e){super(),this._doc=e,this._hostNodes=new Set,this._styleNodes=new Set,this._hostNodes.add(e.head)}_addStylesToHost(e,t){e.forEach(e=>{const n=this._doc.createElement("style");n.textContent=e,this._styleNodes.add(t.appendChild(n))})}addHost(e){this._addStylesToHost(this._stylesSet,e),this._hostNodes.add(e)}removeHost(e){this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach(t=>this._addStylesToHost(e,t))}ngOnDestroy(){this._styleNodes.forEach(e=>ec().remove(e))}}return e.\u0275fac=function(t){return new(t||e)(er(tc))},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})();const Wc={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Kc=/%COMP%/g;function Yc(e,t,n){for(let r=0;r<t.length;r++){let i=t[r];Array.isArray(i)?Yc(e,i,n):(i=i.replace(Kc,e),n.push(i))}return n}function qc(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let zc=(()=>{class e{constructor(e,t,n){this.eventManager=e,this.sharedStylesHost=t,this.appId=n,this.rendererByCompId=new Map,this.defaultRenderer=new Xc(e)}createRenderer(e,t){if(!e||!t)return this.defaultRenderer;switch(t.encapsulation){case Te.Emulated:{let n=this.rendererByCompId.get(t.id);return n||(n=new Qc(this.eventManager,this.sharedStylesHost,t,this.appId),this.rendererByCompId.set(t.id,n)),n.applyToHost(e),n}case 1:case Te.ShadowDom:return new Jc(this.eventManager,this.sharedStylesHost,e,t);default:if(!this.rendererByCompId.has(t.id)){const e=Yc(t.id,t.styles,[]);this.sharedStylesHost.addStyles(e),this.rendererByCompId.set(t.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(t){return new(t||e)(er(Bc),er(Hc),er(ra))},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})();class Xc{constructor(e){this.eventManager=e,this.data=Object.create(null)}destroy(){}createElement(e,t){return t?document.createElementNS(Wc[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){e.appendChild(t)}insertBefore(e,t,n){e&&e.insertBefore(t,n)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error(`The selector "${e}" did not match any elements`);return t||(n.textContent=""),n}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,n,r){if(r){t=r+":"+t;const i=Wc[r];i?e.setAttributeNS(i,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}removeAttribute(e,t,n){if(n){const r=Wc[n];r?e.removeAttributeNS(r,t):e.removeAttribute(`${n}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,n,r){r&(lr.DashCase|lr.Important)?e.style.setProperty(t,n,r&lr.Important?"important":""):e.style[t]=n}removeStyle(e,t,n){n&lr.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,n){e[t]=n}setValue(e,t){e.nodeValue=t}listen(e,t,n){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,qc(n)):this.eventManager.addEventListener(e,t,qc(n))}}class Qc extends Xc{constructor(e,t,n,r){super(e),this.component=n;const i=Yc(r+"-"+n.id,n.styles,[]);t.addStyles(i),this.contentAttr="_ngcontent-%COMP%".replace(Kc,r+"-"+n.id),this.hostAttr="_nghost-%COMP%".replace(Kc,r+"-"+n.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const n=super.createElement(e,t);return super.setAttribute(n,this.contentAttr,""),n}}class Jc extends Xc{constructor(e,t,n,r){super(e),this.sharedStylesHost=t,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const i=Yc(r.id,r.styles,[]);for(let s=0;s<i.length;s++){const e=document.createElement("style");e.textContent=i[s],this.shadowRoot.appendChild(e)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,n){return super.insertBefore(this.nodeOrShadowRoot(e),t,n)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let $c=(()=>{class e extends jc{constructor(e){super(e)}supports(e){return!0}addEventListener(e,t,n){return e.addEventListener(t,n,!1),()=>this.removeEventListener(e,t,n)}removeEventListener(e,t,n){return e.removeEventListener(t,n)}}return e.\u0275fac=function(t){return new(t||e)(er(tc))},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})();const Zc=["alt","control","meta","shift"],el={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},tl={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},nl={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let rl=(()=>{class e extends jc{constructor(e){super(e)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,n,r){const i=e.parseEventName(n),s=e.eventCallback(i.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>ec().onAndCancel(t,i.domEventName,s))}static parseEventName(t){const n=t.toLowerCase().split("."),r=n.shift();if(0===n.length||"keydown"!==r&&"keyup"!==r)return null;const i=e._normalizeKey(n.pop());let s="";if(Zc.forEach(e=>{const t=n.indexOf(e);t>-1&&(n.splice(t,1),s+=e+".")}),s+=i,0!=n.length||0===i.length)return null;const o={};return o.domEventName=r,o.fullKey=s,o}static getEventFullKey(e){let t="",n=function(e){let t=e.key;if(null==t){if(t=e.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&tl.hasOwnProperty(t)&&(t=tl[t]))}return el[t]||t}(e);return n=n.toLowerCase()," "===n?n="space":"."===n&&(n="dot"),Zc.forEach(r=>{r!=n&&(0,nl[r])(e)&&(t+=r+".")}),t+=n,t}static eventCallback(t,n,r){return i=>{e.getEventFullKey(i)===t&&r.runGuarded(()=>n(i))}}static _normalizeKey(e){switch(e){case"esc":return"escape";default:return e}}}return e.\u0275fac=function(t){return new(t||e)(er(tc))},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})();const il=Fa(Qa,"browser",[{provide:aa,useValue:"browser"},{provide:oa,useValue:function(){Pc.makeCurrent(),Vc.init()},multi:!0},{provide:tc,useFactory:function(){return function(e){lt=e}(document),document},deps:[]}]),sl=[[],{provide:Bi,useValue:"root"},{provide:sr,useFactory:function(){return new sr},deps:[]},{provide:Fc,useClass:$c,multi:!0,deps:[tc,Ra,aa]},{provide:Fc,useClass:rl,multi:!0,deps:[tc]},[],{provide:zc,useClass:zc,deps:[Bc,Hc,ra]},{provide:co,useExisting:zc},{provide:Gc,useExisting:Hc},{provide:Hc,useClass:Hc,deps:[tc]},{provide:Oa,useClass:Oa,deps:[Ra]},{provide:Bc,useClass:Bc,deps:[Fc,Ra]},[]];let ol=(()=>{class e{constructor(e){if(e)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:e,providers:[{provide:ra,useValue:t.appId},{provide:Uc,useExisting:ra},xc]}}}return e.\u0275mod=je({type:e}),e.\u0275inj=ae({factory:function(t){return new(t||e)(er(e,12))},providers:sl,imports:[Oc,$a]}),e})();function al(...e){let t=e[e.length-1];return C(t)?(e.pop(),M(e,t)):W(e)}"undefined"!=typeof window&&window;class cl extends y{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return t&&!t.closed&&e.next(this._value),t}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new S;return this._value}next(e){super.next(this._value=e)}}class ll extends f{notifyNext(e,t,n,r,i){this.destination.next(t)}notifyError(e,t){this.destination.error(e)}notifyComplete(e){this.destination.complete()}}class ul extends f{constructor(e,t,n){super(),this.parent=e,this.outerValue=t,this.outerIndex=n,this.index=0}_next(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)}_error(e){this.parent.notifyError(e,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}function dl(e,t,n,r,i=new ul(e,n,r)){if(!i.closed)return t instanceof E?t.subscribe(i):L(t)(i)}const hl={};class pl{constructor(e){this.resultSelector=e}call(e,t){return t.subscribe(new fl(e,this.resultSelector))}}class fl extends ll{constructor(e,t){super(e),this.resultSelector=t,this.active=0,this.values=[],this.observables=[]}_next(e){this.values.push(hl),this.observables.push(e)}_complete(){const e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(let n=0;n<t;n++)this.add(dl(this,e[n],void 0,n))}}notifyComplete(e){0==(this.active-=1)&&this.destination.complete()}notifyNext(e,t,n){const r=this.values,i=this.toRespond?r[n]===hl?--this.toRespond:this.toRespond:0;r[n]=t,0===i&&(this.resultSelector?this._tryResultSelector(r):this.destination.next(r.slice()))}_tryResultSelector(e){let t;try{t=this.resultSelector.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)}}const _l=(()=>{function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e})();function ml(...e){return H(1)(al(...e))}const gl=new E(e=>e.complete());function El(e){return e?function(e){return new E(t=>e.schedule(()=>t.complete()))}(e):gl}function vl(e){return new E(t=>{let n;try{n=e()}catch(r){return void t.error(r)}return(n?U(n):El()).subscribe(t)})}function Sl(e,t){return"function"==typeof t?n=>n.pipe(Sl((n,r)=>U(e(n,r)).pipe(A((e,i)=>t(n,e,r,i))))):t=>t.lift(new Tl(e))}class Tl{constructor(e){this.project=e}call(e,t){return t.subscribe(new Rl(e,this.project))}}class Rl extends V{constructor(e,t){super(e),this.project=t,this.index=0}_next(e){let t;const n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this._innerSub(t)}_innerSub(e){const t=this.innerSubscription;t&&t.unsubscribe();const n=new x(this),r=this.destination;r.add(n),this.innerSubscription=F(e,n),this.innerSubscription!==n&&r.add(this.innerSubscription)}_complete(){const{innerSubscription:e}=this;e&&!e.closed||super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(e){this.destination.next(e)}}const yl=(()=>{function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e})();function Il(e){return t=>0===e?El():t.lift(new Cl(e))}class Cl{constructor(e){if(this.total=e,this.total<0)throw new yl}call(e,t){return t.subscribe(new Al(e,this.total))}}class Al extends f{constructor(e,t){super(e),this.total=t,this.count=0}_next(e){const t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))}}function wl(e,t){let n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new bl(e,t,n))}}class bl{constructor(e,t,n=!1){this.accumulator=e,this.seed=t,this.hasSeed=n}call(e,t){return t.subscribe(new Ol(e,this.accumulator,this.seed,this.hasSeed))}}class Ol extends f{constructor(e,t,n,r){super(e),this.accumulator=t,this._seed=n,this.hasSeed=r,this.index=0}get seed(){return this._seed}set seed(e){this.hasSeed=!0,this._seed=e}_next(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)}_tryNext(e){const t=this.index++;let n;try{n=this.accumulator(this.seed,e,t)}catch(r){this.destination.error(r)}this.seed=n,this.destination.next(n)}}function Nl(e,t){return function(n){return n.lift(new kl(e,t))}}class kl{constructor(e,t){this.predicate=e,this.thisArg=t}call(e,t){return t.subscribe(new Dl(e,this.predicate,this.thisArg))}}class Dl extends f{constructor(e,t,n){super(e),this.predicate=t,this.thisArg=n,this.count=0}_next(e){let t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}t&&this.destination.next(e)}}function Pl(e){return function(t){const n=new Ll(e),r=t.lift(n);return n.caught=r}}class Ll{constructor(e){this.selector=e}call(e,t){return t.subscribe(new Ml(e,this.selector,this.caught))}}class Ml extends V{constructor(e,t,n){super(e),this.selector=t,this.caught=n}error(e){if(!this.isStopped){let n;try{n=this.selector(e,this.caught)}catch(t){return void super.error(t)}this._unsubscribeAndRecycle();const r=new x(this);this.add(r);const i=F(n,r);i!==r&&this.add(i)}}}function Ul(e,t){return B(e,t,1)}function xl(e){return function(t){return 0===e?El():t.lift(new Vl(e))}}class Vl{constructor(e){if(this.total=e,this.total<0)throw new yl}call(e,t){return t.subscribe(new Fl(e,this.total))}}class Fl extends f{constructor(e,t){super(e),this.total=t,this.ring=new Array,this.count=0}_next(e){const t=this.ring,n=this.total,r=this.count++;t.length<n?t.push(e):t[r%n]=e}_complete(){const e=this.destination;let t=this.count;if(t>0){const n=this.count>=this.total?this.total:this.count,r=this.ring;for(let i=0;i<n;i++){const i=t++%n;e.next(r[i])}}e.complete()}}function Bl(e=Hl){return t=>t.lift(new jl(e))}class jl{constructor(e){this.errorFactory=e}call(e,t){return t.subscribe(new Gl(e,this.errorFactory))}}class Gl extends f{constructor(e,t){super(e),this.errorFactory=t,this.hasValue=!1}_next(e){this.hasValue=!0,this.destination.next(e)}_complete(){if(this.hasValue)return this.destination.complete();{let t;try{t=this.errorFactory()}catch(e){t=e}this.destination.error(t)}}}function Hl(){return new _l}function Wl(e=null){return t=>t.lift(new Kl(e))}class Kl{constructor(e){this.defaultValue=e}call(e,t){return t.subscribe(new Yl(e,this.defaultValue))}}class Yl extends f{constructor(e,t){super(e),this.defaultValue=t,this.isEmpty=!0}_next(e){this.isEmpty=!1,this.destination.next(e)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}function ql(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Nl((t,n)=>e(t,n,r)):g,Il(1),n?Wl(t):Bl(()=>new _l))}function zl(){}function Xl(e,t,n){return function(r){return r.lift(new Ql(e,t,n))}}class Ql{constructor(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}call(e,t){return t.subscribe(new Jl(e,this.nextOrObserver,this.error,this.complete))}}class Jl extends f{constructor(e,t,n,i){super(e),this._tapNext=zl,this._tapError=zl,this._tapComplete=zl,this._tapError=n||zl,this._tapComplete=i||zl,r(t)?(this._context=this,this._tapNext=t):t&&(this._context=t,this._tapNext=t.next||zl,this._tapError=t.error||zl,this._tapComplete=t.complete||zl)}_next(e){try{this._tapNext.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.next(e)}_error(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)}_complete(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()}}class $l{constructor(e){this.callback=e}call(e,t){return t.subscribe(new Zl(e,this.callback))}}class Zl extends f{constructor(e,t){super(e),this.add(new d(t))}}class eu{constructor(e,t){this.id=e,this.url=t}}class tu extends eu{constructor(e,t,n="imperative",r=null){super(e,t),this.navigationTrigger=n,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class nu extends eu{constructor(e,t,n){super(e,t),this.urlAfterRedirects=n}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class ru extends eu{constructor(e,t,n){super(e,t),this.reason=n}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class iu extends eu{constructor(e,t,n){super(e,t),this.error=n}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class su extends eu{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ou extends eu{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class au extends eu{constructor(e,t,n,r,i){super(e,t),this.urlAfterRedirects=n,this.state=r,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class cu extends eu{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class lu extends eu{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class uu{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class du{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class hu{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class pu{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class fu{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class _u{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class mu{constructor(e,t,n){this.routerEvent=e,this.position=t,this.anchor=n}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const gu="primary";class Eu{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function vu(e){return new Eu(e)}function Su(e){const t=Error("NavigationCancelingError: "+e);return t.ngNavigationCancelingError=!0,t}function Tu(e,t,n){const r=n.path.split("/");if(r.length>e.length)return null;if("full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;const i={};for(let s=0;s<r.length;s++){const t=r[s],n=e[s];if(t.startsWith(":"))i[t.substring(1)]=n;else if(t!==n.path)return null}return{consumed:e.slice(0,r.length),posParams:i}}function Ru(e,t){const n=Object.keys(e),r=Object.keys(t);if(!n||!r||n.length!=r.length)return!1;let i;for(let s=0;s<n.length;s++)if(i=n[s],!yu(e[i],t[i]))return!1;return!0}function yu(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),r=[...t].sort();return n.every((e,t)=>r[t]===e)}return e===t}function Iu(e){return Array.prototype.concat.apply([],e)}function Cu(e){return e.length>0?e[e.length-1]:null}function Au(e,t){for(const n in e)e.hasOwnProperty(n)&&t(e[n],n)}function wu(e){return Rs(e)?e:Ts(e)?U(Promise.resolve(e)):al(e)}function bu(e,t,n){return n?function(e,t){return Ru(e,t)}(e.queryParams,t.queryParams)&&Ou(e.root,t.root):function(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>yu(e[n],t[n]))}(e.queryParams,t.queryParams)&&Nu(e.root,t.root)}function Ou(e,t){if(!Mu(e.segments,t.segments))return!1;if(e.numberOfChildren!==t.numberOfChildren)return!1;for(const n in t.children){if(!e.children[n])return!1;if(!Ou(e.children[n],t.children[n]))return!1}return!0}function Nu(e,t){return ku(e,t,t.segments)}function ku(e,t,n){if(e.segments.length>n.length)return!!Mu(e.segments.slice(0,n.length),n)&&!t.hasChildren();if(e.segments.length===n.length){if(!Mu(e.segments,n))return!1;for(const n in t.children){if(!e.children[n])return!1;if(!Nu(e.children[n],t.children[n]))return!1}return!0}{const r=n.slice(0,e.segments.length),i=n.slice(e.segments.length);return!!Mu(e.segments,r)&&!!e.children.primary&&ku(e.children.primary,t,i)}}class Du{constructor(e,t,n){this.root=e,this.queryParams=t,this.fragment=n}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=vu(this.queryParams)),this._queryParamMap}toString(){return Vu.serialize(this)}}class Pu{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Au(t,(e,t)=>e.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Fu(this)}}class Lu{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=vu(this.parameters)),this._parameterMap}toString(){return Yu(this)}}function Mu(e,t){return e.length===t.length&&e.every((e,n)=>e.path===t[n].path)}class Uu{}class xu{parse(e){const t=new Ju(e);return new Du(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){return`${"/"+Bu(e.root,!0)}${function(e){const t=Object.keys(e).map(t=>{const n=e[t];return Array.isArray(n)?n.map(e=>`${Gu(t)}=${Gu(e)}`).join("&"):`${Gu(t)}=${Gu(n)}`});return t.length?"?"+t.join("&"):""}(e.queryParams)}${"string"==typeof e.fragment?"#"+encodeURI(e.fragment):""}`}}const Vu=new xu;function Fu(e){return e.segments.map(e=>Yu(e)).join("/")}function Bu(e,t){if(!e.hasChildren())return Fu(e);if(t){const t=e.children.primary?Bu(e.children.primary,!1):"",n=[];return Au(e.children,(e,t)=>{t!==gu&&n.push(`${t}:${Bu(e,!1)}`)}),n.length>0?`${t}(${n.join("//")})`:t}{const t=function(e,t){let n=[];return Au(e.children,(e,r)=>{r===gu&&(n=n.concat(t(e,r)))}),Au(e.children,(e,r)=>{r!==gu&&(n=n.concat(t(e,r)))}),n}(e,(t,n)=>n===gu?[Bu(e.children.primary,!1)]:[`${n}:${Bu(t,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children.primary?`${Fu(e)}/${t[0]}`:`${Fu(e)}/(${t.join("//")})`}}function ju(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Gu(e){return ju(e).replace(/%3B/gi,";")}function Hu(e){return ju(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Wu(e){return decodeURIComponent(e)}function Ku(e){return Wu(e.replace(/\+/g,"%20"))}function Yu(e){return`${Hu(e.path)}${t=e.parameters,Object.keys(t).map(e=>`;${Hu(e)}=${Hu(t[e])}`).join("")}`;var t}const qu=/^[^\/()?;=#]+/;function zu(e){const t=e.match(qu);return t?t[0]:""}const Xu=/^[^=?&#]+/,Qu=/^[^?&#]+/;class Ju{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Pu([],{}):new Pu([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n.primary=new Pu(e,t)),n}parseSegment(){const e=zu(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new Lu(Wu(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=zu(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){const e=zu(this.remaining);e&&(n=e,this.capture(n))}e[Wu(t)]=Wu(n)}parseQueryParam(e){const t=function(e){const t=e.match(Xu);return t?t[0]:""}(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){const e=function(e){const t=e.match(Qu);return t?t[0]:""}(this.remaining);e&&(n=e,this.capture(n))}const r=Ku(t),i=Ku(n);if(e.hasOwnProperty(r)){let t=e[r];Array.isArray(t)||(t=[t],e[r]=t),t.push(i)}else e[r]=i}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=zu(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new Error(`Cannot parse url '${this.url}'`);let i=void 0;n.indexOf(":")>-1?(i=n.substr(0,n.indexOf(":")),this.capture(i),this.capture(":")):e&&(i=gu);const s=this.parseChildren();t[i]=1===Object.keys(s).length?s.primary:new Pu([],s),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class $u{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=Zu(e,this._root);return t?t.children.map(e=>e.value):[]}firstChild(e){const t=Zu(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=ed(e,this._root);return t.length<2?[]:t[t.length-2].children.map(e=>e.value).filter(t=>t!==e)}pathFromRoot(e){return ed(e,this._root).map(e=>e.value)}}function Zu(e,t){if(e===t.value)return t;for(const n of t.children){const t=Zu(e,n);if(t)return t}return null}function ed(e,t){if(e===t.value)return[t];for(const n of t.children){const r=ed(e,n);if(r.length)return r.unshift(t),r}return[]}class td{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function nd(e){const t={};return e&&e.children.forEach(e=>t[e.value.outlet]=e),t}class rd extends $u{constructor(e,t){super(e),this.snapshot=t,ld(this,e)}toString(){return this.snapshot.toString()}}function id(e,t){const n=function(e,t){const n=new ad([],{},{},"",{},gu,t,null,e.root,-1,{});return new cd("",new td(n,[]))}(e,t),r=new cl([new Lu("",{})]),i=new cl({}),s=new cl({}),o=new cl({}),a=new cl(""),c=new sd(r,i,o,a,s,gu,t,n.root);return c.snapshot=n.root,new rd(new td(c,[]),n)}class sd{constructor(e,t,n,r,i,s,o,a){this.url=e,this.params=t,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=s,this.component=o,this._futureSnapshot=a}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(A(e=>vu(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(A(e=>vu(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function od(e,t="emptyOnly"){const n=e.pathFromRoot;let r=0;if("always"!==t)for(r=n.length-1;r>=1;){const e=n[r],t=n[r-1];if(e.routeConfig&&""===e.routeConfig.path)r--;else{if(t.component)break;r--}}return function(e){return e.reduce((e,t)=>({params:Object.assign(Object.assign({},e.params),t.params),data:Object.assign(Object.assign({},e.data),t.data),resolve:Object.assign(Object.assign({},e.resolve),t._resolvedData)}),{params:{},data:{},resolve:{}})}(n.slice(r))}class ad{constructor(e,t,n,r,i,s,o,a,c,l,u){this.url=e,this.params=t,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=s,this.component=o,this.routeConfig=a,this._urlSegment=c,this._lastPathIndex=l,this._resolve=u}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=vu(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=vu(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(e=>e.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class cd extends $u{constructor(e,t){super(t),this.url=e,ld(this,t)}toString(){return ud(this._root)}}function ld(e,t){t.value._routerState=e,t.children.forEach(t=>ld(e,t))}function ud(e){const t=e.children.length>0?` { ${e.children.map(ud).join(", ")} } `:"";return`${e.value}${t}`}function dd(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,Ru(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),Ru(t.params,n.params)||e.params.next(n.params),function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Ru(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),Ru(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function hd(e,t){var n,r;return Ru(e.params,t.params)&&Mu(n=e.url,r=t.url)&&n.every((e,t)=>Ru(e.parameters,r[t].parameters))&&!(!e.parent!=!t.parent)&&(!e.parent||hd(e.parent,t.parent))}function pd(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const r=n.value;r._futureSnapshot=t.value;const i=function(e,t,n){return t.children.map(t=>{for(const r of n.children)if(e.shouldReuseRoute(t.value,r.value.snapshot))return pd(e,t,r);return pd(e,t)})}(e,t,n);return new td(r,i)}{const n=e.retrieve(t.value);if(n){const e=n.route;return fd(t,e),e}{const n=new sd(new cl((r=t.value).url),new cl(r.params),new cl(r.queryParams),new cl(r.fragment),new cl(r.data),r.outlet,r.component,r),i=t.children.map(t=>pd(e,t));return new td(n,i)}}var r}function fd(e,t){if(e.value.routeConfig!==t.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(e.children.length!==t.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");t.value._futureSnapshot=e.value;for(let n=0;n<e.children.length;++n)fd(e.children[n],t.children[n])}function _d(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function md(e){return"object"==typeof e&&null!=e&&e.outlets}function gd(e,t,n,r,i){let s={};return r&&Au(r,(e,t)=>{s[t]=Array.isArray(e)?e.map(e=>""+e):""+e}),new Du(n.root===e?t:Ed(n.root,e,t),s,i)}function Ed(e,t,n){const r={};return Au(e.children,(e,i)=>{r[i]=e===t?n:Ed(e,t,n)}),new Pu(e.segments,r)}class vd{constructor(e,t,n){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=n,e&&n.length>0&&_d(n[0]))throw new Error("Root segment cannot have matrix parameters");const r=n.find(md);if(r&&r!==Cu(n))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Sd{constructor(e,t,n){this.segmentGroup=e,this.processChildren=t,this.index=n}}function Td(e,t,n){if(e||(e=new Pu([],{})),0===e.segments.length&&e.hasChildren())return Rd(e,t,n);const r=function(e,t,n){let r=0,i=t;const s={match:!1,pathIndex:0,commandIndex:0};for(;i<e.segments.length;){if(r>=n.length)return s;const t=e.segments[i],o=n[r];if(md(o))break;const a=""+o,c=r<n.length-1?n[r+1]:null;if(i>0&&void 0===a)break;if(a&&c&&"object"==typeof c&&void 0===c.outlets){if(!Ad(a,c,t))return s;r+=2}else{if(!Ad(a,{},t))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(e,t,n),i=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const t=new Pu(e.segments.slice(0,r.pathIndex),{});return t.children.primary=new Pu(e.segments.slice(r.pathIndex),e.children),Rd(t,0,i)}return r.match&&0===i.length?new Pu(e.segments,{}):r.match&&!e.hasChildren()?yd(e,t,n):r.match?Rd(e,0,i):yd(e,t,n)}function Rd(e,t,n){if(0===n.length)return new Pu(e.segments,{});{const r=function(e){return md(e[0])?e[0].outlets:{[gu]:e}}(n),i={};return Au(r,(n,r)=>{"string"==typeof n&&(n=[n]),null!==n&&(i[r]=Td(e.children[r],t,n))}),Au(e.children,(e,t)=>{void 0===r[t]&&(i[t]=e)}),new Pu(e.segments,i)}}function yd(e,t,n){const r=e.segments.slice(0,t);let i=0;for(;i<n.length;){const s=n[i];if(md(s)){const e=Id(s.outlets);return new Pu(r,e)}if(0===i&&_d(n[0])){r.push(new Lu(e.segments[t].path,n[0])),i++;continue}const o=md(s)?s.outlets.primary:""+s,a=i<n.length-1?n[i+1]:null;o&&a&&_d(a)?(r.push(new Lu(o,Cd(a))),i+=2):(r.push(new Lu(o,{})),i++)}return new Pu(r,{})}function Id(e){const t={};return Au(e,(e,n)=>{"string"==typeof e&&(e=[e]),null!==e&&(t[n]=yd(new Pu([],{}),0,e))}),t}function Cd(e){const t={};return Au(e,(e,n)=>t[n]=""+e),t}function Ad(e,t,n){return e==n.path&&Ru(t,n.parameters)}class wd{constructor(e,t,n,r){this.routeReuseStrategy=e,this.futureState=t,this.currState=n,this.forwardEvent=r}activate(e){const t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),dd(this.futureState.root),this.activateChildRoutes(t,n,e)}deactivateChildRoutes(e,t,n){const r=nd(t);e.children.forEach(e=>{const t=e.value.outlet;this.deactivateRoutes(e,r[t],n),delete r[t]}),Au(r,(e,t)=>{this.deactivateRouteAndItsChildren(e,n)})}deactivateRoutes(e,t,n){const r=e.value,i=t?t.value:null;if(r===i)if(r.component){const i=n.getContext(r.outlet);i&&this.deactivateChildRoutes(e,t,i.children)}else this.deactivateChildRoutes(e,t,n);else i&&this.deactivateRouteAndItsChildren(t,n)}deactivateRouteAndItsChildren(e,t){this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const n=t.getContext(e.value.outlet);if(n&&n.outlet){const t=n.outlet.detach(),r=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:t,route:e,contexts:r})}}deactivateRouteAndOutlet(e,t){const n=t.getContext(e.value.outlet),r=n&&e.value.component?n.children:t,i=nd(e);for(const s of Object.keys(i))this.deactivateRouteAndItsChildren(i[s],r);n&&n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated())}activateChildRoutes(e,t,n){const r=nd(t);e.children.forEach(e=>{this.activateRoutes(e,r[e.value.outlet],n),this.forwardEvent(new _u(e.value.snapshot))}),e.children.length&&this.forwardEvent(new pu(e.value.snapshot))}activateRoutes(e,t,n){const r=e.value,i=t?t.value:null;if(dd(r),r===i)if(r.component){const i=n.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,i.children)}else this.activateChildRoutes(e,t,n);else if(r.component){const t=n.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const e=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),t.children.onOutletReAttached(e.contexts),t.attachRef=e.componentRef,t.route=e.route.value,t.outlet&&t.outlet.attach(e.componentRef,e.route.value),bd(e.route)}else{const n=function(e){for(let t=e.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig;if(e&&e.component)return null}return null}(r.snapshot),i=n?n.module.componentFactoryResolver:null;t.attachRef=null,t.route=r,t.resolver=i,t.outlet&&t.outlet.activateWith(r,i),this.activateChildRoutes(e,null,t.children)}}else this.activateChildRoutes(e,null,n)}}function bd(e){dd(e.value),e.children.forEach(bd)}class Od{constructor(e,t){this.routes=e,this.module=t}}function Nd(e){return"function"==typeof e}function kd(e){return e instanceof Du}const Dd=Symbol("INITIAL_VALUE");function Pd(){return Sl(e=>function(...e){let t=void 0,n=void 0;return C(e[e.length-1])&&(n=e.pop()),"function"==typeof e[e.length-1]&&(t=e.pop()),1===e.length&&c(e[0])&&(e=e[0]),W(e,n).lift(new pl(t))}(e.map(e=>e.pipe(Il(1),function(...e){const t=e[e.length-1];return C(t)?(e.pop(),n=>ml(e,n,t)):t=>ml(e,t)}(Dd)))).pipe(wl((e,t)=>{let n=!1;return t.reduce((e,r,i)=>{if(e!==Dd)return e;if(r===Dd&&(n=!0),!n){if(!1===r)return r;if(i===t.length-1||kd(r))return r}return e},e)},Dd),Nl(e=>e!==Dd),A(e=>kd(e)?e:!0===e),Il(1)))}let Ld=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=xe({type:e,selectors:[["ng-component"]],decls:1,vars:0,template:function(e,t){1&e&&vs(0,"router-outlet")},directives:function(){return[Ch]},encapsulation:2}),e})();function Md(e,t=""){for(let n=0;n<e.length;n++){const r=e[n];Ud(r,xd(t,r))}}function Ud(e,t){e.children&&Md(e.children,t)}function xd(e,t){return t?e||t.path?e&&!t.path?e+"/":!e&&t.path?t.path:`${e}/${t.path}`:"":e}function Vd(e){const t=e.children&&e.children.map(Vd),n=t?Object.assign(Object.assign({},e),{children:t}):Object.assign({},e);return!n.component&&(t||n.loadChildren)&&n.outlet&&n.outlet!==gu&&(n.component=Ld),n}function Fd(e){return e.outlet||gu}function Bd(e,t){const n=e.filter(e=>Fd(e)===t);return n.push(...e.filter(e=>Fd(e)!==t)),n}const jd={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function Gd(e,t,n){var r;if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?Object.assign({},jd):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const i=(t.matcher||Tu)(n,e,t);if(!i)return Object.assign({},jd);const s={};Au(i.posParams,(e,t)=>{s[t]=e.path});const o=i.consumed.length>0?Object.assign(Object.assign({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,lastChild:i.consumed.length,parameters:o,positionalParamSegments:null!==(r=i.posParams)&&void 0!==r?r:{}}}function Hd(e,t,n,r,i="corrected"){if(n.length>0&&function(e,t,n){return n.some(n=>Wd(e,t,n)&&Fd(n)!==gu)}(e,n,r)){const i=new Pu(t,function(e,t,n,r){const i={};i.primary=r,r._sourceSegment=e,r._segmentIndexShift=t.length;for(const s of n)if(""===s.path&&Fd(s)!==gu){const n=new Pu([],{});n._sourceSegment=e,n._segmentIndexShift=t.length,i[Fd(s)]=n}return i}(e,t,r,new Pu(n,e.children)));return i._sourceSegment=e,i._segmentIndexShift=t.length,{segmentGroup:i,slicedSegments:[]}}if(0===n.length&&function(e,t,n){return n.some(n=>Wd(e,t,n))}(e,n,r)){const s=new Pu(e.segments,function(e,t,n,r,i,s){const o={};for(const a of r)if(Wd(e,n,a)&&!i[Fd(a)]){const n=new Pu([],{});n._sourceSegment=e,n._segmentIndexShift="legacy"===s?e.segments.length:t.length,o[Fd(a)]=n}return Object.assign(Object.assign({},i),o)}(e,t,n,r,e.children,i));return s._sourceSegment=e,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:n}}const s=new Pu(e.segments,e.children);return s._sourceSegment=e,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:n}}function Wd(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}function Kd(e,t,n,r){return!!(Fd(e)===r||r!==gu&&Wd(t,n,e))&&("**"===e.path||Gd(t,e,n).matched)}function Yd(e,t,n){return 0===t.length&&!e.children[n]}class qd{constructor(e){this.segmentGroup=e||null}}class zd{constructor(e){this.urlTree=e}}function Xd(e){return new E(t=>t.error(new qd(e)))}function Qd(e){return new E(t=>t.error(new zd(e)))}function Jd(e){return new E(t=>t.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${e}'`)))}class $d{constructor(e,t,n,r,i){this.configLoader=t,this.urlSerializer=n,this.urlTree=r,this.config=i,this.allowRedirects=!0,this.ngModule=e.get(xo)}apply(){const e=Hd(this.urlTree.root,[],[],this.config).segmentGroup,t=new Pu(e.segments,e.children);return this.expandSegmentGroup(this.ngModule,this.config,t,gu).pipe(A(e=>this.createUrlTree(Zd(e),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Pl(e=>{if(e instanceof zd)return this.allowRedirects=!1,this.match(e.urlTree);if(e instanceof qd)throw this.noMatchError(e);throw e}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,gu).pipe(A(t=>this.createUrlTree(Zd(t),e.queryParams,e.fragment))).pipe(Pl(e=>{if(e instanceof qd)throw this.noMatchError(e);throw e}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,t,n){const r=e.segments.length>0?new Pu([],{[gu]:e}):e;return new Du(r,t,n)}expandSegmentGroup(e,t,n,r){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(e,t,n).pipe(A(e=>new Pu([],e))):this.expandSegment(e,n,t,n.segments,r,!0)}expandChildren(e,t,n){const r=[];for(const i of Object.keys(n.children))"primary"===i?r.unshift(i):r.push(i);return U(r).pipe(Ul(r=>{const i=n.children[r],s=Bd(t,r);return this.expandSegmentGroup(e,s,i,r).pipe(A(e=>({segment:e,outlet:r})))}),wl((e,t)=>(e[t.outlet]=t.segment,e),{}),function(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Nl((t,n)=>e(t,n,r)):g,xl(1),n?Wl(t):Bl(()=>new _l))}())}expandSegment(e,t,n,r,i,s){return U(n).pipe(Ul(o=>this.expandSegmentAgainstRoute(e,t,n,o,r,i,s).pipe(Pl(e=>{if(e instanceof qd)return al(null);throw e}))),ql(e=>!!e),Pl((e,n)=>{if(e instanceof _l||"EmptyError"===e.name){if(Yd(t,r,i))return al(new Pu([],{}));throw new qd(t)}throw e}))}expandSegmentAgainstRoute(e,t,n,r,i,s,o){return Kd(r,t,i,s)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(e,t,r,i,s):o&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s):Xd(t):Xd(t)}expandSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,r,s):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,n,r){const i=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?Qd(i):this.lineralizeSegments(n,i).pipe(B(n=>{const i=new Pu(n,{});return this.expandSegment(e,i,t,n,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s){const{matched:o,consumedSegments:a,lastChild:c,positionalParamSegments:l}=Gd(t,r,i);if(!o)return Xd(t);const u=this.applyRedirectCommands(a,r.redirectTo,l);return r.redirectTo.startsWith("/")?Qd(u):this.lineralizeSegments(r,u).pipe(B(r=>this.expandSegment(e,t,n,r.concat(i.slice(c)),s,!1)))}matchSegmentAgainstRoute(e,t,n,r,i){if("**"===n.path)return n.loadChildren?this.configLoader.load(e.injector,n).pipe(A(e=>(n._loadedConfig=e,new Pu(r,{})))):al(new Pu(r,{}));const{matched:s,consumedSegments:o,lastChild:a}=Gd(t,n,r);if(!s)return Xd(t);const c=r.slice(a);return this.getChildConfig(e,n,r).pipe(B(e=>{const r=e.module,s=e.routes,{segmentGroup:a,slicedSegments:l}=Hd(t,o,c,s),u=new Pu(a.segments,a.children);if(0===l.length&&u.hasChildren())return this.expandChildren(r,s,u).pipe(A(e=>new Pu(o,e)));if(0===s.length&&0===l.length)return al(new Pu(o,{}));const d=Fd(n)===i;return this.expandSegment(r,u,s,l,d?gu:i,!0).pipe(A(e=>new Pu(o.concat(e.segments),e.children)))}))}getChildConfig(e,t,n){return t.children?al(new Od(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?al(t._loadedConfig):this.runCanLoadGuards(e.injector,t,n).pipe(B(n=>n?this.configLoader.load(e.injector,t).pipe(A(e=>(t._loadedConfig=e,e))):function(e){return new E(t=>t.error(Su(`Cannot load children because the guard of the route "path: '${e.path}'" returned false`)))}(t))):al(new Od([],e))}runCanLoadGuards(e,t,n){const r=t.canLoad;return r&&0!==r.length?al(r.map(r=>{const i=e.get(r);let s;if(function(e){return e&&Nd(e.canLoad)}(i))s=i.canLoad(t,n);else{if(!Nd(i))throw new Error("Invalid CanLoad guard");s=i(t,n)}return wu(s)})).pipe(Pd(),Xl(e=>{if(!kd(e))return;const t=Su(`Redirecting to "${this.urlSerializer.serialize(e)}"`);throw t.url=e,t}),A(e=>!0===e)):al(!0)}lineralizeSegments(e,t){let n=[],r=t.root;for(;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return al(n);if(r.numberOfChildren>1||!r.children.primary)return Jd(e.redirectTo);r=r.children.primary}}applyRedirectCommands(e,t,n){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,n)}applyRedirectCreatreUrlTree(e,t,n,r){const i=this.createSegmentGroup(e,t.root,n,r);return new Du(i,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const n={};return Au(e,(e,r)=>{if("string"==typeof e&&e.startsWith(":")){const i=e.substring(1);n[r]=t[i]}else n[r]=e}),n}createSegmentGroup(e,t,n,r){const i=this.createSegments(e,t.segments,n,r);let s={};return Au(t.children,(t,i)=>{s[i]=this.createSegmentGroup(e,t,n,r)}),new Pu(i,s)}createSegments(e,t,n,r){return t.map(t=>t.path.startsWith(":")?this.findPosParam(e,t,r):this.findOrReturn(t,n))}findPosParam(e,t,n){const r=n[t.path.substring(1)];if(!r)throw new Error(`Cannot redirect to '${e}'. Cannot find '${t.path}'.`);return r}findOrReturn(e,t){let n=0;for(const r of t){if(r.path===e.path)return t.splice(n),r;n++}return e}}function Zd(e){const t={};for(const n of Object.keys(e.children)){const r=Zd(e.children[n]);(r.segments.length>0||r.hasChildren())&&(t[n]=r)}return function(e){if(1===e.numberOfChildren&&e.children.primary){const t=e.children.primary;return new Pu(e.segments.concat(t.segments),t.children)}return e}(new Pu(e.segments,t))}class eh{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class th{constructor(e,t){this.component=e,this.route=t}}function nh(e,t,n){const r=e._root;return ih(r,t?t._root:null,n,[r.value])}function rh(e,t,n){const r=function(e){if(!e)return null;for(let t=e.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig}return null}(t);return(r?r.module.injector:n).get(e)}function ih(e,t,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=nd(t);return e.children.forEach(e=>{!function(e,t,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=e.value,o=t?t.value:null,a=n?n.getContext(e.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){const c=function(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!Mu(e.url,t.url);case"pathParamsOrQueryParamsChange":return!Mu(e.url,t.url)||!Ru(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!hd(e,t)||!Ru(e.queryParams,t.queryParams);case"paramsChange":default:return!hd(e,t)}}(o,s,s.routeConfig.runGuardsAndResolvers);c?i.canActivateChecks.push(new eh(r)):(s.data=o.data,s._resolvedData=o._resolvedData),ih(e,t,s.component?a?a.children:null:n,r,i),c&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new th(a.outlet.component,o))}else o&&sh(t,a,i),i.canActivateChecks.push(new eh(r)),ih(e,null,s.component?a?a.children:null:n,r,i)}(e,s[e.value.outlet],n,r.concat([e.value]),i),delete s[e.value.outlet]}),Au(s,(e,t)=>sh(e,n.getContext(t),i)),i}function sh(e,t,n){const r=nd(e),i=e.value;Au(r,(e,r)=>{sh(e,i.component?t?t.children.getContext(r):null:t,n)}),n.canDeactivateChecks.push(new th(i.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,i))}class oh{}function ah(e){return new E(t=>t.error(e))}class ch{constructor(e,t,n,r,i,s){this.rootComponentType=e,this.config=t,this.urlTree=n,this.url=r,this.paramsInheritanceStrategy=i,this.relativeLinkResolution=s}recognize(){const e=Hd(this.urlTree.root,[],[],this.config.filter(e=>void 0===e.redirectTo),this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,gu);if(null===t)return null;const n=new ad([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},gu,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new td(n,t),i=new cd(this.url,r);return this.inheritParamsAndData(i._root),i}inheritParamsAndData(e){const t=e.value,n=od(t,this.paramsInheritanceStrategy);t.params=Object.freeze(n.params),t.data=Object.freeze(n.data),e.children.forEach(e=>this.inheritParamsAndData(e))}processSegmentGroup(e,t,n){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,n)}processChildren(e,t){const n=[];for(const i of Object.keys(t.children)){const r=t.children[i],s=Bd(e,i),o=this.processSegmentGroup(s,r,i);if(null===o)return null;n.push(...o)}const r=function(e){const t=[];for(const n of e){if(!lh(n)){t.push(n);continue}const e=t.find(e=>n.value.routeConfig===e.value.routeConfig);void 0!==e?e.children.push(...n.children):t.push(n)}return t}(n);return r.sort((e,t)=>e.value.outlet===gu?-1:t.value.outlet===gu?1:e.value.outlet.localeCompare(t.value.outlet)),r}processSegment(e,t,n,r){for(const i of e){const e=this.processSegmentAgainstRoute(i,t,n,r);if(null!==e)return e}return Yd(t,n,r)?[]:null}processSegmentAgainstRoute(e,t,n,r){if(e.redirectTo||!Kd(e,t,n,r))return null;let i,s=[],o=[];if("**"===e.path){const r=n.length>0?Cu(n).parameters:{};i=new ad(n,r,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,hh(e),Fd(e),e.component,e,uh(t),dh(t)+n.length,ph(e))}else{const r=Gd(t,e,n);if(!r.matched)return null;s=r.consumedSegments,o=n.slice(r.lastChild),i=new ad(s,r.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,hh(e),Fd(e),e.component,e,uh(t),dh(t)+s.length,ph(e))}const a=function(e){return e.children?e.children:e.loadChildren?e._loadedConfig.routes:[]}(e),{segmentGroup:c,slicedSegments:l}=Hd(t,s,o,a.filter(e=>void 0===e.redirectTo),this.relativeLinkResolution);if(0===l.length&&c.hasChildren()){const e=this.processChildren(a,c);return null===e?null:[new td(i,e)]}if(0===a.length&&0===l.length)return[new td(i,[])];const u=Fd(e)===r,d=this.processSegment(a,c,l,u?gu:r);return null===d?null:[new td(i,d)]}}function lh(e){const t=e.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function uh(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function dh(e){let t=e,n=t._segmentIndexShift?t._segmentIndexShift:0;for(;t._sourceSegment;)t=t._sourceSegment,n+=t._segmentIndexShift?t._segmentIndexShift:0;return n-1}function hh(e){return e.data||{}}function ph(e){return e.resolve||{}}function fh(e){return Sl(t=>{const n=e(t);return n?U(n).pipe(A(()=>t)):al(t)})}class _h extends class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}{}const mh=new Pn("ROUTES");class gh{constructor(e,t,n,r){this.loader=e,this.compiler=t,this.onLoadStartListener=n,this.onLoadEndListener=r}load(e,t){return this.onLoadStartListener&&this.onLoadStartListener(t),this.loadModuleFactory(t.loadChildren).pipe(A(n=>{this.onLoadEndListener&&this.onLoadEndListener(t);const r=n.create(e);return new Od(Iu(r.injector.get(mh)).map(Vd),r)}))}loadModuleFactory(e){return"string"==typeof e?U(this.loader.load(e)):wu(e()).pipe(B(e=>e instanceof Vo?al(e):U(this.compiler.compileModuleAsync(e))))}}class Eh{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new vh,this.attachRef=null}}class vh{constructor(){this.contexts=new Map}onChildOutletCreated(e,t){const n=this.getOrCreateContext(e);n.outlet=t,this.contexts.set(e,n)}onChildOutletDestroyed(e){const t=this.getContext(e);t&&(t.outlet=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let t=this.getContext(e);return t||(t=new Eh,this.contexts.set(e,t)),t}getContext(e){return this.contexts.get(e)||null}}class Sh{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,t){return e}}function Th(e){throw e}function Rh(e,t,n){return t.parse("/")}function yh(e,t){return al(null)}let Ih=(()=>{class e{constructor(e,t,n,r,i,s,o,a){this.rootComponentType=e,this.urlSerializer=t,this.rootContexts=n,this.location=r,this.config=a,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.lastLocationChangeInfo=null,this.navigationId=0,this.isNgZoneEnabled=!1,this.events=new y,this.errorHandler=Th,this.malformedUriErrorHandler=Rh,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:yh,afterPreactivation:yh},this.urlHandlingStrategy=new Sh,this.routeReuseStrategy=new _h,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.ngModule=i.get(xo),this.console=i.get(la);const c=i.get(Ra);this.isNgZoneEnabled=c instanceof Ra&&Ra.isInAngularZone(),this.resetConfig(a),this.currentUrlTree=new Du(new Pu([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new gh(s,o,e=>this.triggerEvent(new uu(e)),e=>this.triggerEvent(new du(e))),this.routerState=id(this.currentUrlTree,this.rootComponentType),this.transitions=new cl({id:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}setupNavigations(e){const t=this.events;return e.pipe(Nl(e=>0!==e.id),A(e=>Object.assign(Object.assign({},e),{extractedUrl:this.urlHandlingStrategy.extract(e.rawUrl)})),Sl(e=>{let n=!1,r=!1;return al(e).pipe(Xl(e=>{this.currentNavigation={id:e.id,initialUrl:e.currentRawUrl,extractedUrl:e.extractedUrl,trigger:e.source,extras:e.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Sl(e=>{const n=!this.navigated||e.extractedUrl.toString()!==this.browserUrlTree.toString();if(("reload"===this.onSameUrlNavigation||n)&&this.urlHandlingStrategy.shouldProcessUrl(e.rawUrl))return al(e).pipe(Sl(e=>{const n=this.transitions.getValue();return t.next(new tu(e.id,this.serializeUrl(e.extractedUrl),e.source,e.restoredState)),n!==this.transitions.getValue()?gl:Promise.resolve(e)}),(r=this.ngModule.injector,i=this.configLoader,s=this.urlSerializer,o=this.config,Sl(e=>function(e,t,n,r,i){return new $d(e,t,n,r,i).apply()}(r,i,s,e.extractedUrl,o).pipe(A(t=>Object.assign(Object.assign({},e),{urlAfterRedirects:t}))))),Xl(e=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:e.urlAfterRedirects})}),function(e,t,n,r,i){return B(s=>function(e,t,n,r,i="emptyOnly",s="legacy"){try{const o=new ch(e,t,n,r,i,s).recognize();return null===o?ah(new oh):al(o)}catch(o){return ah(o)}}(e,t,s.urlAfterRedirects,n(s.urlAfterRedirects),r,i).pipe(A(e=>Object.assign(Object.assign({},s),{targetSnapshot:e}))))}(this.rootComponentType,this.config,e=>this.serializeUrl(e),this.paramsInheritanceStrategy,this.relativeLinkResolution),Xl(e=>{"eager"===this.urlUpdateStrategy&&(e.extras.skipLocationChange||this.setBrowserUrl(e.urlAfterRedirects,!!e.extras.replaceUrl,e.id,e.extras.state),this.browserUrlTree=e.urlAfterRedirects);const n=new su(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.next(n)}));var r,i,s,o;if(n&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:n,extractedUrl:r,source:i,restoredState:s,extras:o}=e,a=new tu(n,this.serializeUrl(r),i,s);t.next(a);const c=id(r,this.rootComponentType).snapshot;return al(Object.assign(Object.assign({},e),{targetSnapshot:c,urlAfterRedirects:r,extras:Object.assign(Object.assign({},o),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=e.rawUrl,this.browserUrlTree=e.urlAfterRedirects,e.resolve(null),gl}),fh(e=>{const{targetSnapshot:t,id:n,extractedUrl:r,rawUrl:i,extras:{skipLocationChange:s,replaceUrl:o}}=e;return this.hooks.beforePreactivation(t,{navigationId:n,appliedUrlTree:r,rawUrlTree:i,skipLocationChange:!!s,replaceUrl:!!o})}),Xl(e=>{const t=new ou(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}),A(e=>Object.assign(Object.assign({},e),{guards:nh(e.targetSnapshot,e.currentSnapshot,this.rootContexts)})),function(e,t){return B(n=>{const{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=n;return 0===o.length&&0===s.length?al(Object.assign(Object.assign({},n),{guardsResult:!0})):function(e,t,n,r){return U(e).pipe(B(e=>function(e,t,n,r,i){const s=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return s&&0!==s.length?al(s.map(s=>{const o=rh(s,t,i);let a;if(function(e){return e&&Nd(e.canDeactivate)}(o))a=wu(o.canDeactivate(e,t,n,r));else{if(!Nd(o))throw new Error("Invalid CanDeactivate guard");a=wu(o(e,t,n,r))}return a.pipe(ql())})).pipe(Pd()):al(!0)}(e.component,e.route,n,t,r)),ql(e=>!0!==e,!0))}(o,r,i,e).pipe(B(n=>n&&"boolean"==typeof n?function(e,t,n,r){return U(t).pipe(Ul(t=>ml(function(e,t){return null!==e&&t&&t(new hu(e)),al(!0)}(t.route.parent,r),function(e,t){return null!==e&&t&&t(new fu(e)),al(!0)}(t.route,r),function(e,t,n){const r=t[t.length-1],i=t.slice(0,t.length-1).reverse().map(e=>function(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(e)).filter(e=>null!==e).map(t=>vl(()=>al(t.guards.map(i=>{const s=rh(i,t.node,n);let o;if(function(e){return e&&Nd(e.canActivateChild)}(s))o=wu(s.canActivateChild(r,e));else{if(!Nd(s))throw new Error("Invalid CanActivateChild guard");o=wu(s(r,e))}return o.pipe(ql())})).pipe(Pd())));return al(i).pipe(Pd())}(e,t.path,n),function(e,t,n){const r=t.routeConfig?t.routeConfig.canActivate:null;return r&&0!==r.length?al(r.map(r=>vl(()=>{const i=rh(r,t,n);let s;if(function(e){return e&&Nd(e.canActivate)}(i))s=wu(i.canActivate(t,e));else{if(!Nd(i))throw new Error("Invalid CanActivate guard");s=wu(i(t,e))}return s.pipe(ql())}))).pipe(Pd()):al(!0)}(e,t.route,n))),ql(e=>!0!==e,!0))}(r,s,e,t):al(n)),A(e=>Object.assign(Object.assign({},n),{guardsResult:e})))})}(this.ngModule.injector,e=>this.triggerEvent(e)),Xl(e=>{if(kd(e.guardsResult)){const t=Su(`Redirecting to "${this.serializeUrl(e.guardsResult)}"`);throw t.url=e.guardsResult,t}const t=new au(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot,!!e.guardsResult);this.triggerEvent(t)}),Nl(e=>{if(!e.guardsResult){this.resetUrlToCurrentUrlTree();const n=new ru(e.id,this.serializeUrl(e.extractedUrl),"");return t.next(n),e.resolve(!1),!1}return!0}),fh(e=>{if(e.guards.canActivateChecks.length)return al(e).pipe(Xl(e=>{const t=new cu(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}),Sl(e=>{let n=!1;return al(e).pipe((r=this.paramsInheritanceStrategy,i=this.ngModule.injector,B(e=>{const{targetSnapshot:t,guards:{canActivateChecks:n}}=e;if(!n.length)return al(e);let s=0;return U(n).pipe(Ul(e=>function(e,t,n,r){return function(e,t,n,r){const i=Object.keys(e);if(0===i.length)return al({});const s={};return U(i).pipe(B(i=>function(e,t,n,r){const i=rh(e,t,r);return wu(i.resolve?i.resolve(t,n):i(t,n))}(e[i],t,n,r).pipe(Xl(e=>{s[i]=e}))),xl(1),B(()=>Object.keys(s).length===i.length?al(s):gl))}(e._resolve,e,t,r).pipe(A(t=>(e._resolvedData=t,e.data=Object.assign(Object.assign({},e.data),od(e,n).resolve),null)))}(e.route,t,r,i)),Xl(()=>s++),xl(1),B(t=>s===n.length?al(e):gl))})),Xl({next:()=>n=!0,complete:()=>{if(!n){const n=new ru(e.id,this.serializeUrl(e.extractedUrl),"At least one route resolver didn't emit any value.");t.next(n),e.resolve(!1)}}}));var r,i}),Xl(e=>{const t=new lu(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}))}),fh(e=>{const{targetSnapshot:t,id:n,extractedUrl:r,rawUrl:i,extras:{skipLocationChange:s,replaceUrl:o}}=e;return this.hooks.afterPreactivation(t,{navigationId:n,appliedUrlTree:r,rawUrlTree:i,skipLocationChange:!!s,replaceUrl:!!o})}),A(e=>{const t=function(e,t,n){const r=pd(e,t._root,n?n._root:void 0);return new rd(r,t)}(this.routeReuseStrategy,e.targetSnapshot,e.currentRouterState);return Object.assign(Object.assign({},e),{targetRouterState:t})}),Xl(e=>{this.currentUrlTree=e.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl),this.routerState=e.targetRouterState,"deferred"===this.urlUpdateStrategy&&(e.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,!!e.extras.replaceUrl,e.id,e.extras.state),this.browserUrlTree=e.urlAfterRedirects)}),(s=this.rootContexts,o=this.routeReuseStrategy,a=e=>this.triggerEvent(e),A(e=>(new wd(o,e.targetRouterState,e.currentRouterState,a).activate(s),e))),Xl({next(){n=!0},complete(){n=!0}}),(i=()=>{if(!n&&!r){this.resetUrlToCurrentUrlTree();const n=new ru(e.id,this.serializeUrl(e.extractedUrl),`Navigation ID ${e.id} is not equal to the current navigation id ${this.navigationId}`);t.next(n),e.resolve(!1)}this.currentNavigation=null},e=>e.lift(new $l(i))),Pl(n=>{if(r=!0,(i=n)&&i.ngNavigationCancelingError){const r=kd(n.url);r||(this.navigated=!0,this.resetStateAndUrl(e.currentRouterState,e.currentUrlTree,e.rawUrl));const i=new ru(e.id,this.serializeUrl(e.extractedUrl),n.message);t.next(i),r?setTimeout(()=>{const t=this.urlHandlingStrategy.merge(n.url,this.rawUrlTree);this.scheduleNavigation(t,"imperative",null,{skipLocationChange:e.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy},{resolve:e.resolve,reject:e.reject,promise:e.promise})},0):e.resolve(!1)}else{this.resetStateAndUrl(e.currentRouterState,e.currentUrlTree,e.rawUrl);const r=new iu(e.id,this.serializeUrl(e.extractedUrl),n);t.next(r);try{e.resolve(this.errorHandler(n))}catch(s){e.reject(s)}}var i;return gl}));var i,s,o,a}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}getTransition(){const e=this.transitions.value;return e.urlAfterRedirects=this.browserUrlTree,e}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const t=this.extractLocationChangeInfoFromEvent(e);this.shouldScheduleNavigation(this.lastLocationChangeInfo,t)&&setTimeout(()=>{const{source:e,state:n,urlTree:r}=t,i={replaceUrl:!0};if(n){const e=Object.assign({},n);delete e.navigationId,0!==Object.keys(e).length&&(i.state=e)}this.scheduleNavigation(r,e,n,i)},0),this.lastLocationChangeInfo=t}))}extractLocationChangeInfoFromEvent(e){var t;return{source:"popstate"===e.type?"popstate":"hashchange",urlTree:this.parseUrl(e.url),state:(null===(t=e.state)||void 0===t?void 0:t.navigationId)?e.state:null,transitionId:this.getTransition().id}}shouldScheduleNavigation(e,t){if(!e)return!0;const n=t.urlTree.toString()===e.urlTree.toString();return!(t.transitionId===e.transitionId&&n&&("hashchange"===t.source&&"popstate"===e.source||"popstate"===t.source&&"hashchange"===e.source))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){Md(e),this.config=e.map(Vd),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0)}createUrlTree(e,t={}){const{relativeTo:n,queryParams:r,fragment:i,queryParamsHandling:s,preserveFragment:o}=t,a=n||this.routerState.root,c=o?this.currentUrlTree.fragment:i;let l=null;switch(s){case"merge":l=Object.assign(Object.assign({},this.currentUrlTree.queryParams),r);break;case"preserve":l=this.currentUrlTree.queryParams;break;default:l=r||null}return null!==l&&(l=this.removeEmptyProps(l)),function(e,t,n,r,i){if(0===n.length)return gd(t.root,t.root,t,r,i);const s=function(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new vd(!0,0,e);let t=0,n=!1;const r=e.reduce((e,r,i)=>{if("object"==typeof r&&null!=r){if(r.outlets){const t={};return Au(r.outlets,(e,n)=>{t[n]="string"==typeof e?e.split("/"):e}),[...e,{outlets:t}]}if(r.segmentPath)return[...e,r.segmentPath]}return"string"!=typeof r?[...e,r]:0===i?(r.split("/").forEach((r,i)=>{0==i&&"."===r||(0==i&&""===r?n=!0:".."===r?t++:""!=r&&e.push(r))}),e):[...e,r]},[]);return new vd(n,t,r)}(n);if(s.toRoot())return gd(t.root,new Pu([],{}),t,r,i);const o=function(e,t,n){if(e.isAbsolute)return new Sd(t.root,!0,0);if(-1===n.snapshot._lastPathIndex){const e=n.snapshot._urlSegment;return new Sd(e,e===t.root,0)}const r=_d(e.commands[0])?0:1;return function(e,t,n){let r=e,i=t,s=n;for(;s>i;){if(s-=i,r=r.parent,!r)throw new Error("Invalid number of '../'");i=r.segments.length}return new Sd(r,!1,i-s)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+r,e.numberOfDoubleDots)}(s,t,e),a=o.processChildren?Rd(o.segmentGroup,o.index,s.commands):Td(o.segmentGroup,o.index,s.commands);return gd(o.segmentGroup,a,t,r,i)}(a,this.currentUrlTree,e,l,c)}navigateByUrl(e,t={skipLocationChange:!1}){const n=kd(e)?e:this.parseUrl(e),r=this.urlHandlingStrategy.merge(n,this.rawUrlTree);return this.scheduleNavigation(r,"imperative",null,t)}navigate(e,t={skipLocationChange:!1}){return function(e){for(let t=0;t<e.length;t++){const n=e[t];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${t}`)}}(e),this.navigateByUrl(this.createUrlTree(e,t),t)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let t;try{t=this.urlSerializer.parse(e)}catch(n){t=this.malformedUriErrorHandler(n,this.urlSerializer,e)}return t}isActive(e,t){if(kd(e))return bu(this.currentUrlTree,e,t);const n=this.parseUrl(e);return bu(this.currentUrlTree,n,t)}removeEmptyProps(e){return Object.keys(e).reduce((t,n)=>{const r=e[n];return null!=r&&(t[n]=r),t},{})}processNavigations(){this.navigations.subscribe(e=>{this.navigated=!0,this.lastSuccessfulId=e.id,this.events.next(new nu(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,this.currentNavigation=null,e.resolve(!0)},e=>{this.console.warn("Unhandled Navigation Error: ")})}scheduleNavigation(e,t,n,r,i){const s=this.getTransition(),o="imperative"!==t&&"imperative"===(null==s?void 0:s.source),a=(this.lastSuccessfulId===s.id||this.currentNavigation?s.rawUrl:s.urlAfterRedirects).toString()===e.toString();if(o&&a)return Promise.resolve(!0);let c,l,u;i?(c=i.resolve,l=i.reject,u=i.promise):u=new Promise((e,t)=>{c=e,l=t});const d=++this.navigationId;return this.setTransition({id:d,source:t,restoredState:n,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:r,resolve:c,reject:l,promise:u,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),u.catch(e=>Promise.reject(e))}setBrowserUrl(e,t,n,r){const i=this.urlSerializer.serialize(e);r=r||{},this.location.isCurrentPathEqualTo(i)||t?this.location.replaceState(i,"",Object.assign(Object.assign({},r),{navigationId:n})):this.location.go(i,"",Object.assign(Object.assign({},r),{navigationId:n}))}resetStateAndUrl(e,t,n){this.routerState=e,this.currentUrlTree=t,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n),this.resetUrlToCurrentUrlTree()}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",{navigationId:this.lastSuccessfulId})}}return e.\u0275fac=function(t){return new(t||e)(er(Mn),er(Uu),er(vh),er(mc),er(es),er(Ka),er(va),er(void 0))},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})(),Ch=(()=>{class e{constructor(e,t,n,r,i){this.parentContexts=e,this.location=t,this.resolver=n,this.changeDetector=i,this.activated=null,this._activatedRoute=null,this.activateEvents=new ea,this.deactivateEvents=new ea,this.name=r||gu,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,e}attach(e,t){this.activated=e,this._activatedRoute=t,this.location.insert(e.hostView)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,t){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=e;const n=(t=t||this.resolver).resolveComponentFactory(e._futureSnapshot.routeConfig.component),r=this.parentContexts.getOrCreateContext(this.name).children,i=new Ah(e,r,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,i),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(t){return new(t||e)(fs(vh),fs(Bo),fs(ro),("name",function(e,t){const n=e.attrs;if(n){const e=n.length;let r=0;for(;r<e;){const i=n[r];if(rn(i))break;if(0===i)r+=2;else if("number"==typeof i)for(r++;r<e&&"string"==typeof n[r];)r++;else{if(i===t)return n[r+1];r+=2}}}return null}(wt(),"name")),fs(Oo))},e.\u0275dir=He({type:e,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),e})();class Ah{constructor(e,t,n){this.route=e,this.childContexts=t,this.parent=n}get(e,t){return e===sd?this.route:e===vh?this.childContexts:this.parent.get(e,t)}}class wh{}class bh{preload(e,t){return al(null)}}let Oh=(()=>{class e{constructor(e,t,n,r,i){this.router=e,this.injector=r,this.preloadingStrategy=i,this.loader=new gh(t,n,t=>e.triggerEvent(new uu(t)),t=>e.triggerEvent(new du(t)))}setUpPreloading(){this.subscription=this.router.events.pipe(Nl(e=>e instanceof nu),Ul(()=>this.preload())).subscribe(()=>{})}preload(){const e=this.injector.get(xo);return this.processRoutes(e,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,t){const n=[];for(const r of t)if(r.loadChildren&&!r.canLoad&&r._loadedConfig){const e=r._loadedConfig;n.push(this.processRoutes(e.module,e.routes))}else r.loadChildren&&!r.canLoad?n.push(this.preloadConfig(e,r)):r.children&&n.push(this.processRoutes(e,r.children));return U(n).pipe(H(),A(e=>{}))}preloadConfig(e,t){return this.preloadingStrategy.preload(t,()=>this.loader.load(e.injector,t).pipe(B(e=>(t._loadedConfig=e,this.processRoutes(e.module,e.routes)))))}}return e.\u0275fac=function(t){return new(t||e)(er(Ih),er(Ka),er(va),er(es),er(wh))},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})(),Nh=(()=>{class e{constructor(e,t,n={}){this.router=e,this.viewportScroller=t,this.options=n,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},n.scrollPositionRestoration=n.scrollPositionRestoration||"disabled",n.anchorScrolling=n.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof tu?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof nu&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof mu&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,t){this.router.triggerEvent(new mu(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,t))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(er(Ih),er(Nc),er(void 0))},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})();const kh=new Pn("ROUTER_CONFIGURATION"),Dh=new Pn("ROUTER_FORROOT_GUARD"),Ph=[mc,{provide:Uu,useClass:xu},{provide:Ih,useFactory:function(e,t,n,r,i,s,o,a={},c,l){const u=new Ih(null,e,t,n,r,i,s,Iu(o));if(c&&(u.urlHandlingStrategy=c),l&&(u.routeReuseStrategy=l),function(e,t){e.errorHandler&&(t.errorHandler=e.errorHandler),e.malformedUriErrorHandler&&(t.malformedUriErrorHandler=e.malformedUriErrorHandler),e.onSameUrlNavigation&&(t.onSameUrlNavigation=e.onSameUrlNavigation),e.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=e.paramsInheritanceStrategy),e.relativeLinkResolution&&(t.relativeLinkResolution=e.relativeLinkResolution),e.urlUpdateStrategy&&(t.urlUpdateStrategy=e.urlUpdateStrategy)}(a,u),a.enableTracing){const e=ec();u.events.subscribe(t=>{e.logGroup("Router Event: "+t.constructor.name),e.log(t.toString()),e.log(t),e.logGroupEnd()})}return u},deps:[Uu,vh,mc,es,Ka,va,mh,kh,[class{},new Hn],[class{},new Hn]]},vh,{provide:sd,useFactory:function(e){return e.routerState.root},deps:[Ih]},{provide:Ka,useClass:za},Oh,bh,class{preload(e,t){return t().pipe(Pl(()=>al(null)))}},{provide:kh,useValue:{enableTracing:!1}}];function Lh(){return new Va("Router",Ih)}let Mh=(()=>{class e{constructor(e,t){}static forRoot(t,n){return{ngModule:e,providers:[Ph,Fh(t),{provide:Dh,useFactory:Vh,deps:[[Ih,new Hn,new Kn]]},{provide:kh,useValue:n||{}},{provide:dc,useFactory:xh,deps:[nc,[new Gn(pc),new Hn],kh]},{provide:Nh,useFactory:Uh,deps:[Ih,Nc,kh]},{provide:wh,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:bh},{provide:Va,multi:!0,useFactory:Lh},[Bh,{provide:ta,multi:!0,useFactory:jh,deps:[Bh]},{provide:Hh,useFactory:Gh,deps:[Bh]},{provide:ca,multi:!0,useExisting:Hh}]]}}static forChild(t){return{ngModule:e,providers:[Fh(t)]}}}return e.\u0275mod=je({type:e}),e.\u0275inj=ae({factory:function(t){return new(t||e)(er(Dh,8),er(Ih,8))}}),e})();function Uh(e,t,n){return n.scrollOffset&&t.setOffset(n.scrollOffset),new Nh(e,t,n)}function xh(e,t,n={}){return n.useHash?new _c(e,t):new fc(e,t)}function Vh(e){return"guarded"}function Fh(e){return[{provide:Ln,multi:!0,useValue:e},{provide:mh,multi:!0,useValue:e}]}let Bh=(()=>{class e{constructor(e){this.injector=e,this.initNavigation=!1,this.resultOfPreactivationDone=new y}appInitializer(){return this.injector.get(ic,Promise.resolve(null)).then(()=>{let e=null;const t=new Promise(t=>e=t),n=this.injector.get(Ih),r=this.injector.get(kh);return"disabled"===r.initialNavigation?(n.setUpLocationChangeListener(),e(!0)):"enabled"===r.initialNavigation||"enabledBlocking"===r.initialNavigation?(n.hooks.afterPreactivation=()=>this.initNavigation?al(null):(this.initNavigation=!0,e(!0),this.resultOfPreactivationDone),n.initialNavigation()):e(!0),t})}bootstrapListener(e){const t=this.injector.get(kh),n=this.injector.get(Oh),r=this.injector.get(Nh),i=this.injector.get(Ih),s=this.injector.get(Ha);e===s.components[0]&&("enabledNonBlocking"!==t.initialNavigation&&void 0!==t.initialNavigation||i.initialNavigation(),n.setUpPreloading(),r.init(),i.resetRootComponentType(s.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}}return e.\u0275fac=function(t){return new(t||e)(er(es))},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})();function jh(e){return e.appInitializer.bind(e)}function Gh(e){return e.bootstrapListener.bind(e)}const Hh=new Pn("Router Initializer");function Wh(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{c(r.next(e))}catch(t){s(t)}}function a(e){try{c(r.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}c((r=r.apply(e,t||[])).next())})}var Kh=n("5nFl"),Yh=n.n(Kh);let qh=(()=>{class e{constructor(){this.rtc={client:null,localAudioTrack:null,localVideoTrack:null},this.options={appId:"",channel:"test"},this.remoteUsers=[],this.updateUserInfo=new cl(null),this.liveUsersList=[]}createRTCClient(e){this.rtc.client=Yh.a.createClient("live"==e?{mode:"live",codec:"vp8"}:{mode:"rtc",codec:"h264"})}switchCamera(e,t){return Wh(this,void 0,void 0,function*(){const n=(yield Yh.a.getCameras()).find(t=>t.label===e);yield t.setDevice(n.deviceId)})}localUser(e,t,n){return Wh(this,void 0,void 0,function*(){"live"==n&&(yield this.rtc.client.setClientRole("audience")),yield this.rtc.client.join(this.options.appId,this.options.channel,e,t),"live"!=n&&(this.rtc.localAudioTrack=yield Yh.a.createMicrophoneAudioTrack(),this.rtc.localVideoTrack=yield Yh.a.createCameraVideoTrack({encoderConfig:"120p"}),this.switchCamera("OBS Virtual Camera",this.rtc.localVideoTrack),this.rtc.localVideoTrack.play("local-player"),yield this.rtc.client.publish([this.rtc.localAudioTrack,this.rtc.localVideoTrack]))})}agoraServerEvents(e){e.client.on("user-published",(t,n)=>Wh(this,void 0,void 0,function*(){if(console.log(t,n,"user-published"),yield e.client.subscribe(t,n),"video"===n){const e=t.videoTrack;setTimeout(()=>{e.play("remote-playerlist"+t.uid)},100)}"audio"===n&&t.audioTrack.play()})),e.client.on("user-unpublished",e=>{console.log(e,"user-unpublished")}),e.client.on("user-joined",e=>{const t=e.uid;this.remoteUsers.push({uid:+t}),this.liveUsersList.push({uid:+t}),this.updateUserInfo.next(t),console.log("user-joined",e,this.remoteUsers,"event1")})}leaveCall(){return Wh(this,void 0,void 0,function*(){this.rtc.localAudioTrack.close(),this.rtc.localVideoTrack.close(),this.rtc.client.remoteUsers.forEach(e=>{const t=document.getElementById("remote-playerlist"+e.uid.toString());t&&t.remove()}),yield this.rtc.client.leave()})}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class zh{}class Xh{}class Qh{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(e=>{const t=e.indexOf(":");if(t>0){const n=e.slice(0,t),r=n.toLowerCase(),i=e.slice(t+1).trim();this.maybeSetNormalizedName(n,r),this.headers.has(r)?this.headers.get(r).push(i):this.headers.set(r,[i])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(t=>{let n=e[t];const r=t.toLowerCase();"string"==typeof n&&(n=[n]),n.length>0&&(this.headers.set(r,n),this.maybeSetNormalizedName(t,r))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof Qh?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){const t=new Qh;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof Qh?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){const t=e.name.toLowerCase();switch(e.op){case"a":case"s":let n=e.value;if("string"==typeof n&&(n=[n]),0===n.length)return;this.maybeSetNormalizedName(e.name,t);const r=("a"===e.op?this.headers.get(t):void 0)||[];r.push(...n),this.headers.set(t,r);break;case"d":const i=e.value;if(i){let e=this.headers.get(t);if(!e)return;e=e.filter(e=>-1===i.indexOf(e)),0===e.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,e)}else this.headers.delete(t),this.normalizedNames.delete(t)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}}class Jh{encodeKey(e){return $h(e)}encodeValue(e){return $h(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}function $h(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/gi,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%2B/gi,"+").replace(/%3D/gi,"=").replace(/%3F/gi,"?").replace(/%2F/gi,"/")}class Zh{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new Jh,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(e,t){const n=new Map;return e.length>0&&e.split("&").forEach(e=>{const r=e.indexOf("="),[i,s]=-1==r?[t.decodeKey(e),""]:[t.decodeKey(e.slice(0,r)),t.decodeValue(e.slice(r+1))],o=n.get(i)||[];o.push(s),n.set(i,o)}),n}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{const n=e.fromObject[t];this.map.set(t,Array.isArray(n)?n:[n])})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map(e=>t+"="+this.encoder.encodeValue(e)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const t=new Zh({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat([e]),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const t=("a"===e.op?this.map.get(e.param):void 0)||[];t.push(e.value),this.map.set(e.param,t);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let t=this.map.get(e.param)||[];const n=t.indexOf(e.value);-1!==n&&t.splice(n,1),t.length>0?this.map.set(e.param,t):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}function ep(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}function tp(e){return"undefined"!=typeof Blob&&e instanceof Blob}function np(e){return"undefined"!=typeof FormData&&e instanceof FormData}class rp{constructor(e,t,n,r){let i;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==n?n:null,i=r):i=n,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.params&&(this.params=i.params)),this.headers||(this.headers=new Qh),this.params){const e=this.params.toString();if(0===e.length)this.urlWithParams=t;else{const n=t.indexOf("?");this.urlWithParams=t+(-1===n?"?":n<t.length-1?"&":"")+e}}else this.params=new Zh,this.urlWithParams=t}serializeBody(){return null===this.body?null:ep(this.body)||tp(this.body)||np(this.body)||"string"==typeof this.body?this.body:this.body instanceof Zh?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||np(this.body)?null:tp(this.body)?this.body.type||null:ep(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Zh?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||Array.isArray(this.body)?"application/json":null}clone(e={}){const t=e.method||this.method,n=e.url||this.url,r=e.responseType||this.responseType,i=void 0!==e.body?e.body:this.body,s=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,o=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let a=e.headers||this.headers,c=e.params||this.params;return void 0!==e.setHeaders&&(a=Object.keys(e.setHeaders).reduce((t,n)=>t.set(n,e.setHeaders[n]),a)),e.setParams&&(c=Object.keys(e.setParams).reduce((t,n)=>t.set(n,e.setParams[n]),c)),new rp(t,n,i,{params:c,headers:a,reportProgress:o,responseType:r,withCredentials:s})}}var ip=function(e){return e[e.Sent=0]="Sent",e[e.UploadProgress=1]="UploadProgress",e[e.ResponseHeader=2]="ResponseHeader",e[e.DownloadProgress=3]="DownloadProgress",e[e.Response=4]="Response",e[e.User=5]="User",e}({});class sp{constructor(e,t=200,n="OK"){this.headers=e.headers||new Qh,this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText||n,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class op extends sp{constructor(e={}){super(e),this.type=ip.ResponseHeader}clone(e={}){return new op({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class ap extends sp{constructor(e={}){super(e),this.type=ip.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new ap({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class cp extends sp{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?"Http failure during parsing for "+(e.url||"(unknown url)"):`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function lp(e,t){return{body:t,headers:e.headers,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let up=(()=>{class e{constructor(e){this.handler=e}request(e,t,n={}){let r;if(e instanceof rp)r=e;else{let i=void 0;i=n.headers instanceof Qh?n.headers:new Qh(n.headers);let s=void 0;n.params&&(s=n.params instanceof Zh?n.params:new Zh({fromObject:n.params})),r=new rp(e,t,void 0!==n.body?n.body:null,{headers:i,params:s,reportProgress:n.reportProgress,responseType:n.responseType||"json",withCredentials:n.withCredentials})}const i=al(r).pipe(Ul(e=>this.handler.handle(e)));if(e instanceof rp||"events"===n.observe)return i;const s=i.pipe(Nl(e=>e instanceof ap));switch(n.observe||"body"){case"body":switch(r.responseType){case"arraybuffer":return s.pipe(A(e=>{if(null!==e.body&&!(e.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return e.body}));case"blob":return s.pipe(A(e=>{if(null!==e.body&&!(e.body instanceof Blob))throw new Error("Response is not a Blob.");return e.body}));case"text":return s.pipe(A(e=>{if(null!==e.body&&"string"!=typeof e.body)throw new Error("Response is not a string.");return e.body}));case"json":default:return s.pipe(A(e=>e.body))}case"response":return s;default:throw new Error(`Unreachable: unhandled observe type ${n.observe}}`)}}delete(e,t={}){return this.request("DELETE",e,t)}get(e,t={}){return this.request("GET",e,t)}head(e,t={}){return this.request("HEAD",e,t)}jsonp(e,t){return this.request("JSONP",e,{params:(new Zh).append(t,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,t={}){return this.request("OPTIONS",e,t)}patch(e,t,n={}){return this.request("PATCH",e,lp(n,t))}post(e,t,n={}){return this.request("POST",e,lp(n,t))}put(e,t,n={}){return this.request("PUT",e,lp(n,t))}}return e.\u0275fac=function(t){return new(t||e)(er(zh))},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})();class dp{constructor(e,t){this.next=e,this.interceptor=t}handle(e){return this.interceptor.intercept(e,this.next)}}const hp=new Pn("HTTP_INTERCEPTORS");let pp=(()=>{class e{intercept(e,t){return t.handle(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})();const fp=/^\)\]\}',?\n/;class _p{}let mp=(()=>{class e{constructor(){}build(){return new XMLHttpRequest}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})(),gp=(()=>{class e{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new E(t=>{const n=this.xhrFactory.build();if(n.open(e.method,e.urlWithParams),e.withCredentials&&(n.withCredentials=!0),e.headers.forEach((e,t)=>n.setRequestHeader(e,t.join(","))),e.headers.has("Accept")||n.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const t=e.detectContentTypeHeader();null!==t&&n.setRequestHeader("Content-Type",t)}if(e.responseType){const t=e.responseType.toLowerCase();n.responseType="json"!==t?t:"text"}const r=e.serializeBody();let i=null;const s=()=>{if(null!==i)return i;const t=1223===n.status?204:n.status,r=n.statusText||"OK",s=new Qh(n.getAllResponseHeaders()),o=function(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(n)||e.url;return i=new op({headers:s,status:t,statusText:r,url:o}),i},o=()=>{let{headers:r,status:i,statusText:o,url:a}=s(),c=null;204!==i&&(c=void 0===n.response?n.responseText:n.response),0===i&&(i=c?200:0);let l=i>=200&&i<300;if("json"===e.responseType&&"string"==typeof c){const e=c;c=c.replace(fp,"");try{c=""!==c?JSON.parse(c):null}catch(u){c=e,l&&(l=!1,c={error:u,text:c})}}l?(t.next(new ap({body:c,headers:r,status:i,statusText:o,url:a||void 0})),t.complete()):t.error(new cp({error:c,headers:r,status:i,statusText:o,url:a||void 0}))},a=e=>{const{url:r}=s(),i=new cp({error:e,status:n.status||0,statusText:n.statusText||"Unknown Error",url:r||void 0});t.error(i)};let c=!1;const l=r=>{c||(t.next(s()),c=!0);let i={type:ip.DownloadProgress,loaded:r.loaded};r.lengthComputable&&(i.total=r.total),"text"===e.responseType&&n.responseText&&(i.partialText=n.responseText),t.next(i)},u=e=>{let n={type:ip.UploadProgress,loaded:e.loaded};e.lengthComputable&&(n.total=e.total),t.next(n)};return n.addEventListener("load",o),n.addEventListener("error",a),e.reportProgress&&(n.addEventListener("progress",l),null!==r&&n.upload&&n.upload.addEventListener("progress",u)),n.send(r),t.next({type:ip.Sent}),()=>{n.removeEventListener("error",a),n.removeEventListener("load",o),e.reportProgress&&(n.removeEventListener("progress",l),null!==r&&n.upload&&n.upload.removeEventListener("progress",u)),n.readyState!==n.DONE&&n.abort()}})}}return e.\u0275fac=function(t){return new(t||e)(er(_p))},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})();const Ep=new Pn("XSRF_COOKIE_NAME"),vp=new Pn("XSRF_HEADER_NAME");class Sp{}let Tp=(()=>{class e{constructor(e,t,n){this.doc=e,this.platform=t,this.cookieName=n,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=Rc(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return e.\u0275fac=function(t){return new(t||e)(er(tc),er(aa),er(Ep))},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})(),Rp=(()=>{class e{constructor(e,t){this.tokenService=e,this.headerName=t}intercept(e,t){const n=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||n.startsWith("http://")||n.startsWith("https://"))return t.handle(e);const r=this.tokenService.getToken();return null===r||e.headers.has(this.headerName)||(e=e.clone({headers:e.headers.set(this.headerName,r)})),t.handle(e)}}return e.\u0275fac=function(t){return new(t||e)(er(Sp),er(vp))},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})(),yp=(()=>{class e{constructor(e,t){this.backend=e,this.injector=t,this.chain=null}handle(e){if(null===this.chain){const e=this.injector.get(hp,[]);this.chain=e.reduceRight((e,t)=>new dp(e,t),this.backend)}return this.chain.handle(e)}}return e.\u0275fac=function(t){return new(t||e)(er(Xh),er(es))},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})(),Ip=(()=>{class e{static disable(){return{ngModule:e,providers:[{provide:Rp,useClass:pp}]}}static withOptions(t={}){return{ngModule:e,providers:[t.cookieName?{provide:Ep,useValue:t.cookieName}:[],t.headerName?{provide:vp,useValue:t.headerName}:[]]}}}return e.\u0275mod=je({type:e}),e.\u0275inj=ae({factory:function(t){return new(t||e)},providers:[Rp,{provide:hp,useExisting:Rp,multi:!0},{provide:Sp,useClass:Tp},{provide:Ep,useValue:"XSRF-TOKEN"},{provide:vp,useValue:"X-XSRF-TOKEN"}]}),e})(),Cp=(()=>{class e{}return e.\u0275mod=je({type:e}),e.\u0275inj=ae({factory:function(t){return new(t||e)},providers:[up,{provide:zh,useClass:yp},gp,{provide:Xh,useExisting:gp},mp,{provide:_p,useExisting:mp}],imports:[[Ip.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),e})(),Ap=(()=>{class e{constructor(e){this.http=e}getRequest(e,t={}){return this.http.get(e,{params:t}).pipe(A(e=>e),Pl(e=>this.handleError(e)))}handleError(e){return function(e,t){return new E(t=>t.error(e))}(e)}}return e.\u0275fac=function(t){return new(t||e)(er(up))},e.\u0275prov=oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),wp=(()=>{class e{constructor(e){this.api=e}generateTokenAndUid(e){return Wh(this,void 0,void 0,function*(){const t={params:new Zh({fromString:"channel=test&uid="+e})},n=yield this.api.getRequest("https://test-agora.herokuapp.com/access_token?",t.params).toPromise();return{uid:e,token:n.token}})}generateUid(){return Math.floor(Math.pow(10,4)+9*Math.random()*Math.pow(10,4))}}return e.\u0275fac=function(t){return new(t||e)(er(Ap))},e.\u0275prov=oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function bp(e,t){return new E(n=>{const r=e.length;if(0===r)return void n.complete();const i=new Array(r);let s=0,o=0;for(let a=0;a<r;a++){const c=U(e[a]);let l=!1;n.add(c.subscribe({next:e=>{l||(l=!0,o++),i[a]=e},error:e=>n.error(e),complete:()=>{s++,s!==r&&l||(o===r&&n.next(t?t.reduce((e,t,n)=>(e[t]=i[n],e),{}):i),n.complete())}}))}})}function Op(e){return null==e||0===e.length}function Np(e){return null!=e&&"number"==typeof e.length}const kp=new Pn("NgValidators"),Dp=new Pn("NgAsyncValidators"),Pp=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class Lp{static min(e){return t=>{if(Op(t.value)||Op(e))return null;const n=parseFloat(t.value);return!isNaN(n)&&n<e?{min:{min:e,actual:t.value}}:null}}static max(e){return t=>{if(Op(t.value)||Op(e))return null;const n=parseFloat(t.value);return!isNaN(n)&&n>e?{max:{max:e,actual:t.value}}:null}}static required(e){return Op(e.value)?{required:!0}:null}static requiredTrue(e){return!0===e.value?null:{required:!0}}static email(e){return Op(e.value)||Pp.test(e.value)?null:{email:!0}}static minLength(e){return t=>Op(t.value)||!Np(t.value)?null:t.value.length<e?{minlength:{requiredLength:e,actualLength:t.value.length}}:null}static maxLength(e){return t=>Np(t.value)&&t.value.length>e?{maxlength:{requiredLength:e,actualLength:t.value.length}}:null}static pattern(e){if(!e)return Lp.nullValidator;let t,n;return"string"==typeof e?(n="","^"!==e.charAt(0)&&(n+="^"),n+=e,"$"!==e.charAt(e.length-1)&&(n+="$"),t=new RegExp(n)):(n=e.toString(),t=e),e=>{if(Op(e.value))return null;const r=e.value;return t.test(r)?null:{pattern:{requiredPattern:n,actualValue:r}}}}static nullValidator(e){return null}static compose(e){if(!e)return null;const t=e.filter(Mp);return 0==t.length?null:function(e){return xp(Vp(e,t))}}static composeAsync(e){if(!e)return null;const t=e.filter(Mp);return 0==t.length?null:function(e){return function(...e){if(1===e.length){const t=e[0];if(c(t))return bp(t,null);if(l(t)&&Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);return bp(e.map(e=>t[e]),e)}}if("function"==typeof e[e.length-1]){const t=e.pop();return bp(e=1===e.length&&c(e[0])?e[0]:e,null).pipe(A(e=>t(...e)))}return bp(e,null)}(Vp(e,t).map(Up)).pipe(A(xp))}}}function Mp(e){return null!=e}function Up(e){const t=Ts(e)?U(e):e;return Rs(t),t}function xp(e){let t={};return e.forEach(e=>{t=null!=e?Object.assign(Object.assign({},t),e):t}),0===Object.keys(t).length?null:t}function Vp(e,t){return t.map(t=>t(e))}function Fp(e){return e.map(e=>function(e){return!e.validate}(e)?e:t=>e.validate(t))}function Bp(e){return null!=e?Lp.compose(Fp(e)):null}function jp(e){return null!=e?Lp.composeAsync(Fp(e)):null}function Gp(e,t){return null===e?[t]:Array.isArray(e)?[...e,t]:[e,t]}let Hp=(()=>{class e{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Bp(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=jp(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e){this.control&&this.control.reset(e)}hasError(e,t){return!!this.control&&this.control.hasError(e,t)}getError(e,t){return this.control?this.control.getError(e,t):null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=He({type:e}),e})(),Wp=(()=>{class e extends Hp{get formDirective(){return null}get path(){return null}}return e.\u0275fac=function(t){return Kp(t||e)},e.\u0275dir=He({type:e,features:[ns]}),e})();const Kp=Nn(Wp);let Yp=(()=>{class e extends class{constructor(e){this._cd=e}get ngClassUntouched(){var e,t,n;return null!==(n=null===(t=null===(e=this._cd)||void 0===e?void 0:e.control)||void 0===t?void 0:t.untouched)&&void 0!==n&&n}get ngClassTouched(){var e,t,n;return null!==(n=null===(t=null===(e=this._cd)||void 0===e?void 0:e.control)||void 0===t?void 0:t.touched)&&void 0!==n&&n}get ngClassPristine(){var e,t,n;return null!==(n=null===(t=null===(e=this._cd)||void 0===e?void 0:e.control)||void 0===t?void 0:t.pristine)&&void 0!==n&&n}get ngClassDirty(){var e,t,n;return null!==(n=null===(t=null===(e=this._cd)||void 0===e?void 0:e.control)||void 0===t?void 0:t.dirty)&&void 0!==n&&n}get ngClassValid(){var e,t,n;return null!==(n=null===(t=null===(e=this._cd)||void 0===e?void 0:e.control)||void 0===t?void 0:t.valid)&&void 0!==n&&n}get ngClassInvalid(){var e,t,n;return null!==(n=null===(t=null===(e=this._cd)||void 0===e?void 0:e.control)||void 0===t?void 0:t.invalid)&&void 0!==n&&n}get ngClassPending(){var e,t,n;return null!==(n=null===(t=null===(e=this._cd)||void 0===e?void 0:e.control)||void 0===t?void 0:t.pending)&&void 0!==n&&n}}{constructor(e){super(e)}}return e.\u0275fac=function(t){return new(t||e)(fs(Wp,10))},e.\u0275dir=He({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:14,hostBindings:function(e,t){2&e&&Ds("ng-untouched",t.ngClassUntouched)("ng-touched",t.ngClassTouched)("ng-pristine",t.ngClassPristine)("ng-dirty",t.ngClassDirty)("ng-valid",t.ngClassValid)("ng-invalid",t.ngClassInvalid)("ng-pending",t.ngClassPending)},features:[ns]}),e})(),qp=(()=>{class e{constructor(){this._accessors=[]}add(e,t){this._accessors.push([e,t])}remove(e){for(let t=this._accessors.length-1;t>=0;--t)if(this._accessors[t][1]===e)return void this._accessors.splice(t,1)}select(e){this._accessors.forEach(t=>{this._isSameGroup(t,e)&&t[1]!==e&&t[1].fireUncheck(e.value)})}_isSameGroup(e,t){return!!e[0].control&&e[0]._parent===t._control._parent&&e[1].name===t.name}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=oe({token:e,factory:e.\u0275fac}),e})();function zp(e,t){e.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function Xp(e,t,n){const r=function(e){return e._rawValidators}(e);null!==t.validator?e.setValidators(Gp(r,t.validator)):"function"==typeof r&&e.setValidators([r]);const i=function(e){return e._rawAsyncValidators}(e);if(null!==t.asyncValidator?e.setAsyncValidators(Gp(i,t.asyncValidator)):"function"==typeof i&&e.setAsyncValidators([i]),n){const n=()=>e.updateValueAndValidity();zp(t._rawValidators,n),zp(t._rawAsyncValidators,n)}}function Qp(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function Jp(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const $p="VALID",Zp="INVALID",ef="PENDING",tf="DISABLED";function nf(e){return(af(e)?e.validators:e)||null}function rf(e){return Array.isArray(e)?Bp(e):e||null}function sf(e,t){return(af(t)?t.asyncValidators:e)||null}function of(e){return Array.isArray(e)?jp(e):e||null}function af(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}class cf{constructor(e,t){this._hasOwnPendingAsyncValidator=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=e,this._rawAsyncValidators=t,this._composedValidatorFn=rf(this._rawValidators),this._composedAsyncValidatorFn=of(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===$p}get invalid(){return this.status===Zp}get pending(){return this.status==ef}get disabled(){return this.status===tf}get enabled(){return this.status!==tf}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._rawValidators=e,this._composedValidatorFn=rf(e)}setAsyncValidators(e){this._rawAsyncValidators=e,this._composedAsyncValidatorFn=of(e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=ef,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=tf,this.errors=null,this._forEachChild(t=>{t.disable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(e=>e(!0))}enable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=$p,this._forEachChild(t=>{t.enable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(e=>e(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),this.status!==$p&&this.status!==ef||this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?tf:$p}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=ef,this._hasOwnPendingAsyncValidator=!0;const t=Up(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(t=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(t,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}get(e){return function(e,t,n){if(null==t)return null;if(Array.isArray(t)||(t=t.split(".")),Array.isArray(t)&&0===t.length)return null;let r=e;return t.forEach(e=>{r=r instanceof uf?r.controls.hasOwnProperty(e)?r.controls[e]:null:r instanceof df&&r.at(e)||null}),r}(this,e)}getError(e,t){const n=t?this.get(t):this;return n&&n.errors?n.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new ea,this.statusChanges=new ea}_calculateStatus(){return this._allControlsDisabled()?tf:this.errors?Zp:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(ef)?ef:this._anyControlsHaveStatus(Zp)?Zp:$p}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_isBoxedValue(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){af(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class lf extends cf{constructor(e=null,t,n){super(nf(t),sf(n,t)),this._onChange=[],this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!n})}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(e=>e(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=null,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){Jp(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){Jp(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){this._isBoxedValue(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}}class uf extends cf{constructor(e,t,n){super(nf(t),sf(n,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!n})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t){this.registerControl(e,t),this.updateValueAndValidity(),this._onCollectionChange()}removeControl(e){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity(),this._onCollectionChange()}setControl(e,t){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity(),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){this._checkAllValuesPresent(e),Object.keys(e).forEach(n=>{this._throwIfControlMissing(n),this.controls[n].setValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){Object.keys(e).forEach(n=>{this.controls[n]&&this.controls[n].patchValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}reset(e={},t={}){this._forEachChild((n,r)=>{n.reset(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,n)=>(e[n]=t instanceof lf?t.value:t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(e,t)=>!!t._syncPendingControls()||e);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[e])throw new Error(`Cannot find form control with name: ${e}.`)}_forEachChild(e){Object.keys(this.controls).forEach(t=>e(this.controls[t],t))}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const t of Object.keys(this.controls)){const n=this.controls[t];if(this.contains(t)&&e(n))return!0}return!1}_reduceValue(){return this._reduceChildren({},(e,t,n)=>((t.enabled||this.disabled)&&(e[n]=t.value),e))}_reduceChildren(e,t){let n=e;return this._forEachChild((e,r)=>{n=t(n,e,r)}),n}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent(e){this._forEachChild((t,n)=>{if(void 0===e[n])throw new Error(`Must supply a value for form control with name: '${n}'.`)})}}class df extends cf{constructor(e,t,n){super(nf(t),sf(n,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!n})}at(e){return this.controls[e]}push(e){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity(),this._onCollectionChange()}insert(e,t){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity()}removeAt(e){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),this.updateValueAndValidity()}setControl(e,t){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),t&&(this.controls.splice(e,0,t),this._registerControl(t)),this.updateValueAndValidity(),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){this._checkAllValuesPresent(e),e.forEach((e,n)=>{this._throwIfControlMissing(n),this.at(n).setValue(e,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e.forEach((e,n)=>{this.at(n)&&this.at(n).patchValue(e,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}reset(e=[],t={}){this._forEachChild((n,r)=>{n.reset(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e instanceof lf?e.value:e.getRawValue())}clear(){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity())}_syncPendingControls(){let e=this.controls.reduce((e,t)=>!!t._syncPendingControls()||e,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(e))throw new Error("Cannot find form control at index "+e)}_forEachChild(e){this.controls.forEach((t,n)=>{e(t,n)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_checkAllValuesPresent(e){this._forEachChild((t,n)=>{if(void 0===e[n])throw new Error(`Must supply a value for form control at index: ${n}.`)})}_allControlsDisabled(){for(const e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}}const hf={provide:Wp,useExisting:re(()=>ff)},pf=(()=>Promise.resolve(null))();let ff=(()=>{class e extends Wp{constructor(e,t){super(),this.submitted=!1,this._directives=[],this.ngSubmit=new ea,this.form=new uf({},Bp(e),jp(t))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){pf.then(()=>{const t=this._findContainer(e.path);e.control=t.registerControl(e.name,e.control),function(e,t){Xp(e,t,!0),t.valueAccessor.writeValue(e.value),function(e,t){t.valueAccessor.registerOnChange(n=>{e._pendingValue=n,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&Qp(e,t)})}(e,t),function(e,t){const n=(e,n)=>{t.valueAccessor.writeValue(e),n&&t.viewToModelUpdate(e)};e.registerOnChange(n),t._registerOnDestroy(()=>{e._unregisterOnChange(n)})}(e,t),function(e,t){t.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&Qp(e,t),"submit"!==e.updateOn&&e.markAsTouched()})}(e,t),function(e,t){if(t.valueAccessor.setDisabledState){const n=e=>{t.valueAccessor.setDisabledState(e)};e.registerOnDisabledChange(n),t._registerOnDestroy(()=>{e._unregisterOnDisabledChange(n)})}}(e,t)}(e.control,e),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.push(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){pf.then(()=>{const t=this._findContainer(e.path);t&&t.removeControl(e.name),Jp(this._directives,e)})}addFormGroup(e){pf.then(()=>{const t=this._findContainer(e.path),n=new uf({});(function(e,t){Xp(e,t,!1)})(n,e),t.registerControl(e.name,n),n.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){pf.then(()=>{const t=this._findContainer(e.path);t&&t.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,t){pf.then(()=>{this.form.get(e.path).setValue(t)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submitted=!0,t=this._directives,this.form._syncPendingControls(),t.forEach(e=>{const t=e.control;"submit"===t.updateOn&&t._pendingChange&&(e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1)}),this.ngSubmit.emit(e),!1;var t}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}}return e.\u0275fac=function(t){return new(t||e)(fs(kp,10),fs(Dp,10))},e.\u0275dir=He({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(e,t){1&e&&ys("submit",function(e){return t.onSubmit(e)})("reset",function(){return t.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[eo([hf]),ns]}),e})(),_f=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=He({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),e})(),mf=(()=>{class e{}return e.\u0275mod=je({type:e}),e.\u0275inj=ae({factory:function(t){return new(t||e)}}),e})(),gf=(()=>{class e{}return e.\u0275mod=je({type:e}),e.\u0275inj=ae({factory:function(t){return new(t||e)},providers:[qp],imports:[mf]}),e})();function Ef(e,t){if(1&e&&(gs(0,"div",13),gs(1,"div",19),xs(2),Es(),Es()),2&e){const e=t.$implicit;Kr(1),ws("id","remote-playerlist"+e.uid),Kr(1),Vs(" ",e.name," ")}}function vf(e,t){1&e&&(gs(0,"div"),vs(1,"img",5),Es())}function Sf(e,t){if(1&e&&(gs(0,"div",6),gs(1,"div"),vs(2,"div",7),gs(3,"div"),xs(4),Es(),Es(),Es()),2&e){const e=t.$implicit,n=t.index;Kr(2),ws("id","remote-playerlist"+e.uid),Kr(2),Vs("user ",n+1,"")}}const Tf=[{path:"user/:id",component:(()=>{class e{constructor(e,t,n){this.stream=e,this.api=t,this.common=n,this.hideBtns=!0}ngOnInit(){}startCall(){return Wh(this,void 0,void 0,function*(){const e=this.common.generateUid(),t=yield this.common.generateTokenAndUid(e);this.stream.createRTCClient(""),this.stream.agoraServerEvents(this.stream.rtc),yield this.stream.localUser(t.token,e,""),this.hideBtns=!1})}mute(){return Wh(this,void 0,void 0,function*(){this.stream.rtc.localAudioTrack.setEnabled(!1)})}unmute(){this.stream.rtc.localAudioTrack.setEnabled(!0)}logout(){return Wh(this,void 0,void 0,function*(){yield this.stream.leaveCall()})}}return e.\u0275fac=function(t){return new(t||e)(fs(qh),fs(Ap),fs(wp))},e.\u0275cmp=xe({type:e,selectors:[["app-basic"]],decls:28,vars:3,consts:[[1,"container-fluid","banner"],[1,"banner-text"],[1,"container"],["id","join-form","name","join-form",1,"mt-4"],[1,"row","join-info-group"],[1,"col-sm"],[1,"join-info-text"],[1,"button-group","mt-3"],["id","join","type","submit",1,"btn","btn-live","btn-sm",3,"click"],["id","mic-btn","type","button",1,"btn","btn-live","btn-sm",3,"disabled"],["id","mic-icon",1,"fas","fa-microphone"],["id","leave","type","button",1,"btn","btn-live","btn-sm",3,"disabled","click"],[1,"row","video-group"],[1,"col"],["id","local-player-name",1,"player-name"],["id","local-player",1,"player"],[1,"btn","btn-live","btn-sm",3,"click"],[1,"w-100"],["class","col",4,"ngFor","ngForOf"],[1,"ui","centered","medium","image",2,"width","200px","height","200px",3,"id"]],template:function(e,t){1&e&&(gs(0,"div",0),gs(1,"p",1),xs(2,"Video Call"),Es(),Es(),gs(3,"div",2),gs(4,"form",3),gs(5,"div",4),gs(6,"div",5),gs(7,"p",6),xs(8,"Join call"),Es(),Es(),Es(),gs(9,"div",7),gs(10,"button",8),ys("click",function(){return t.startCall()}),xs(11," Join "),Es(),gs(12,"button",9),vs(13,"i",10),Es(),gs(14,"button",11),ys("click",function(){return t.logout()}),xs(15," Leave "),Es(),Es(),Es(),gs(16,"div",12),gs(17,"div",13),vs(18,"p",14),vs(19,"div",15),Es(),gs(20,"div"),gs(21,"button",16),ys("click",function(){return t.mute()}),xs(22,"mute"),Es(),gs(23,"button",16),ys("click",function(){return t.unmute()}),xs(24,"unmute"),Es(),Es(),gs(25,"div",17),xs(26,"Remote Users"),Es(),ps(27,Ef,3,2,"div",18),Es(),Es()),2&e&&(Kr(12),_s("disabled",t.hideBtns),Kr(2),_s("disabled",t.hideBtns),Kr(13),_s("ngForOf",t.stream.remoteUsers))},directives:[_f,Yp,ff,Ic],styles:[".banner[_ngcontent-%COMP%]{padding:10px;background-color:#2f3fb0;color:#fff}.banner-text[_ngcontent-%COMP%]{padding:8px 20px;margin:0}#join-form[_ngcontent-%COMP%]{margin-top:10px}.tips[_ngcontent-%COMP%]{font-size:12px;color:grey}.join-info-text[_ngcontent-%COMP%], .tips[_ngcontent-%COMP%], input[_ngcontent-%COMP%]{margin-bottom:2px}input[_ngcontent-%COMP%]{width:100%}.player[_ngcontent-%COMP%]{width:480px;height:320px}.player-name[_ngcontent-%COMP%]{margin:8px 0}@media (max-width:640px){.player[_ngcontent-%COMP%]{width:320px;height:240px}}.btn-live[_ngcontent-%COMP%]{background-color:#2f3fb0;color:#fff;border:1px solid #2f3fb0}.btn-live[_ngcontent-%COMP%]:hover{color:#2f3fb0;background-color:#fff;border:1px solid #2f3fb0}"]}),e})()},{path:"live",component:(()=>{class e{constructor(e,t,n){this.stream=e,this.api=t,this.common=n}ngOnInit(){}joinLiveCall(){return Wh(this,void 0,void 0,function*(){const e=this.common.generateUid(),t=yield this.common.generateTokenAndUid(e);this.stream.createRTCClient("live"),this.stream.agoraServerEvents(this.stream.rtc),yield this.stream.localUser(t.token,e,"live")})}}return e.\u0275fac=function(t){return new(t||e)(fs(qh),fs(Ap),fs(wp))},e.\u0275cmp=xe({type:e,selectors:[["app-live"]],decls:12,vars:2,consts:[[1,"elements"],[2,"font-size","14pt"],[4,"ngIf"],["class","col","id","remote-container",4,"ngFor","ngForOf"],[3,"click"],["src","assets/agora.png","alt","A black, brown, and white dog wearing a kerchief",1,"agora-img"],["id","remote-container",1,"col"],[1,"ui","centered","medium","image",2,"width","200px","height","200px","display","flex","border","1px solid",3,"id"]],template:function(e,t){1&e&&(gs(0,"div",0),gs(1,"h1"),xs(2," Live Streaming"),vs(3,"br"),gs(4,"small",1),xs(5,"Powered by Agora.io"),Es(),Es(),gs(6,"h4"),xs(7,"Remote video"),Es(),ps(8,vf,2,0,"div",2),ps(9,Sf,5,2,"div",3),gs(10,"button",4),ys("click",function(){return t.joinLiveCall()}),xs(11,"watch live video"),Es(),Es()),2&e&&(Kr(8),_s("ngIf",0==t.stream.liveUsersList.length),Kr(1),_s("ngForOf",t.stream.liveUsersList))},directives:[Ac,Ic],styles:[".player[_ngcontent-%COMP%]{width:480px;height:320px}#remote-container[_ngcontent-%COMP%]{display:flex}#remote-container[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{height:auto;position:relative!important}.elements[_ngcontent-%COMP%]{text-align:center}.agora-img[_ngcontent-%COMP%]{height:400px;width:80%}"]}),e})()}];let Rf=(()=>{class e{}return e.\u0275mod=je({type:e}),e.\u0275inj=ae({factory:function(t){return new(t||e)},imports:[[Mh.forRoot(Tf)],Mh]}),e})();function yf(e,t){if(1&e){const e=Ss();gs(0,"button",1),ys("click",function(){return At(e),As().open(1)}),xs(1,"user1"),Es()}}function If(e,t){if(1&e){const e=Ss();gs(0,"button",1),ys("click",function(){return At(e),As().open(2)}),xs(1,"user2"),Es()}}function Cf(e,t){if(1&e){const e=Ss();gs(0,"button",1),ys("click",function(){return At(e),As().open(3)}),xs(1,"live"),Es()}}let Af=(()=>{class e{constructor(e){this.router=e,this.title="video-app",this.hide=!0}open(e){3!=e?(this.router.navigate(["/user/"+e]),this.hide=!1):(this.router.navigate(["/live"]),this.hide=!1)}}return e.\u0275fac=function(t){return new(t||e)(fs(Ih))},e.\u0275cmp=xe({type:e,selectors:[["app-root"]],decls:4,vars:3,consts:[[3,"click",4,"ngIf"],[3,"click"]],template:function(e,t){1&e&&(ps(0,yf,2,0,"button",0),ps(1,If,2,0,"button",0),ps(2,Cf,2,0,"button",0),vs(3,"router-outlet")),2&e&&(_s("ngIf",t.hide),Kr(1),_s("ngIf",t.hide),Kr(1),_s("ngIf",t.hide))},directives:[Ac,Ch],styles:[""]}),e})(),wf=(()=>{class e{}return e.\u0275mod=je({type:e,bootstrap:[Af]}),e.\u0275inj=ae({factory:function(t){return new(t||e)},providers:[],imports:[[ol,Rf,gf,Cp]]}),e})();(function(){if(Ma)throw new Error("Cannot enable prod mode after platform setup.");La=!1})(),il().bootstrapModule(wf).catch(e=>console.error(e))},zn8P:function(e,t){function n(e){return Promise.resolve().then(function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="zn8P"}},[[0,0]]]);